<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="6900px" preserveAspectRatio="none" style="width:1802px;height:6900px;" version="1.1" viewBox="0 0 1802 6900" width="1802px" zoomAndPan="magnify"><defs><filter height="300%" id="f1g5kzaghnfd4b" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="661" x="571.5" y="22.9951">2.2.1. Fulfil Handler Consume (Success) (single message, includes individual transfers from Bulk)</text><rect fill="#FFFFE0" height="6855.4141" style="stroke: #A80036; stroke-width: 1.0;" width="1639" x="29" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="799.5" y="46.3638">Central Service</text><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="74" y="195.125"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="6688.6875" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="344" y="125.7266"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="811" y="5138.3047"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="811" y="5599.4297"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1015.5" y="2159.1484"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1015.5" y="2772.875"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1015.5" y="3458.7344"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1015.5" y="6301.2891"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1134" y="1667.7578"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1134" y="6762.4141"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="150.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1237" y="707.5156"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="135.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1237" y="1028.2422"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="121.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1237" y="3568.8047"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="120.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1237" y="3772.6016"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="150.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1237" y="4100.1953"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="136.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1237" y="4333.3906"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="121.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1237" y="4569.4531"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="92.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1615" y="736.6484"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="77.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1615" y="1057.375"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1615" y="3597.9375"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="62.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1615" y="3801.7344"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="62.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1615" y="4129.3281"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1615" y="4362.5234"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1615" y="4598.5859"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="5689.8438" style="stroke: #000000; stroke-width: 2.0;" width="1778" x="13" y="132.7266"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="5658.7109" style="stroke: #000000; stroke-width: 2.0;" width="1758" x="23" y="156.8594"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="120.6641" style="stroke: #000000; stroke-width: 2.0;" width="404.5" x="283.5" y="240.125"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="89.5313" style="stroke: #000000; stroke-width: 2.0;" width="384.5" x="293.5" y="264.2578"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="106.6641" style="stroke: #000000; stroke-width: 2.0;" width="665.5" x="293.5" y="374.7891"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="102.5313" style="stroke: #000000; stroke-width: 2.0;" width="902.5" x="293.5" y="495.4531"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="3093.2188" style="stroke: #000000; stroke-width: 2.0;" width="1517.5" x="253.5" y="611.9844"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="2767.625" style="stroke: #000000; stroke-width: 2.0;" width="1474.5" x="263.5" y="930.5781"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="2331.8281" style="stroke: #000000; stroke-width: 2.0;" width="942.5" x="273.5" y="1178.9063"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="1001.1094" style="stroke: #000000; stroke-width: 2.0;" width="922.5" x="283.5" y="1203.0391"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="969.9766" style="stroke: #000000; stroke-width: 2.0;" width="902.5" x="293.5" y="1227.1719"/><rect fill="#FFFFFF" height="491.3906" style="stroke: none; stroke-width: 1.0;" width="902.5" x="293.5" y="1705.7578"/><rect fill="#FFFFFF" height="613.7266" style="stroke: none; stroke-width: 1.0;" width="942.5" x="273.5" y="2211.1484"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="584.9219" style="stroke: #000000; stroke-width: 2.0;" width="922.5" x="283.5" y="2232.9531"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="553.7891" style="stroke: #000000; stroke-width: 2.0;" width="902.5" x="293.5" y="2257.0859"/><rect fill="#FFFFFF" height="476.2578" style="stroke: none; stroke-width: 1.0;" width="902.5" x="293.5" y="2334.6172"/><rect fill="#FFFFFF" height="103.2031" style="stroke: none; stroke-width: 1.0;" width="942.5" x="273.5" y="2824.875"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="74.3984" style="stroke: #000000; stroke-width: 2.0;" width="298.5" x="293.5" y="2846.6797"/><rect fill="#FFFFFF" height="582.6563" style="stroke: none; stroke-width: 1.0;" width="942.5" x="273.5" y="2928.0781"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="566.6563" style="stroke: #000000; stroke-width: 2.0;" width="818.5" x="283.5" y="2937.0781"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="535.5234" style="stroke: #000000; stroke-width: 2.0;" width="798.5" x="293.5" y="2961.2109"/><rect fill="#FFFFFF" height="476.2578" style="stroke: none; stroke-width: 1.0;" width="798.5" x="293.5" y="3020.4766"/><rect fill="#FFFFFF" height="180.4688" style="stroke: none; stroke-width: 1.0;" width="1474.5" x="263.5" y="3517.7344"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="2035.4297" style="stroke: #000000; stroke-width: 2.0;" width="1448.5" x="273.5" y="3719.2031"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="243.3281" style="stroke: #000000; stroke-width: 2.0;" width="1422.5" x="283.5" y="4022.6641"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="212.1953" style="stroke: #000000; stroke-width: 2.0;" width="1402.5" x="293.5" y="4046.7969"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="197.9297" style="stroke: #000000; stroke-width: 2.0;" width="1400.5" x="293.5" y="4279.9922"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="1255.7109" style="stroke: #000000; stroke-width: 2.0;" width="1428.5" x="283.5" y="4491.9219"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="182.7969" style="stroke: #000000; stroke-width: 2.0;" width="1408.5" x="293.5" y="4516.0547"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="924.5781" style="stroke: #000000; stroke-width: 2.0;" width="596.5" x="293.5" y="4712.8516"/><rect fill="#FFFFFF" height="461.125" style="stroke: none; stroke-width: 1.0;" width="596.5" x="293.5" y="5176.3047"/><rect fill="#FFFFFF" height="103.2031" style="stroke: none; stroke-width: 1.0;" width="1428.5" x="283.5" y="5644.4297"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="74.3984" style="stroke: #000000; stroke-width: 2.0;" width="352.5" x="293.5" y="5666.2344"/><rect fill="#FFFFFF" height="53.9375" style="stroke: none; stroke-width: 1.0;" width="1758" x="23" y="5761.6328"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="970.8438" style="stroke: #000000; stroke-width: 2.0;" width="922.5" x="283.5" y="5836.5703"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="939.7109" style="stroke: #000000; stroke-width: 2.0;" width="902.5" x="293.5" y="5860.7031"/><rect fill="#FFFFFF" height="461.125" style="stroke: none; stroke-width: 1.0;" width="902.5" x="293.5" y="6339.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="79" x2="79" y1="115.7266" y2="6824.4141"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="348.5" x2="348.5" y1="115.7266" y2="6824.4141"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="816" x2="816" y1="115.7266" y2="6824.4141"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="919" x2="919" y1="115.7266" y2="6824.4141"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1020" x2="1020" y1="115.7266" y2="6824.4141"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1139" x2="1139" y1="115.7266" y2="6824.4141"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1242" x2="1242" y1="115.7266" y2="6824.4141"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1620" x2="1620" y1="115.7266" y2="6824.4141"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="37" y="76.4297"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="33" y="80.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="40" y="100.4248">Fulfil-Topic</text><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="37" y="6823.4141"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="33" y="6827.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="40" y="6847.4092">Fulfil-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="303.5" y="112.4248">Fulfil Handler</text><ellipse cx="349" cy="83.4297" fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="345,71.4297,351,66.4297,349,71.4297,351,76.4297,345,71.4297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="303.5" y="6836.4092">Fulfil Handler</text><ellipse cx="349" cy="6855.7109" fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="345,6843.7109,351,6838.7109,349,6843.7109,351,6848.7109,345,6843.7109" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="120" x="756" y="60.1328"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="120" x="752" y="64.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="793.5" y="84.1279">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="759" y="100.4248">transfer-position</text><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="120" x="756" y="6823.4141"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="120" x="752" y="6827.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="793.5" y="6847.4092">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="759" y="6863.7061">transfer-position</text><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="51" x="894" y="60.1328"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="51" x="890" y="64.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="897" y="84.1279">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="36" x="897.5" y="100.4248">event</text><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="51" x="894" y="6823.4141"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="51" x="890" y="6827.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="897" y="6847.4092">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="36" x="897.5" y="6863.7061">event</text><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="963" y="60.1328"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="959" y="64.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="998" y="84.1279">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="966" y="100.4248">bulk-processing</text><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="963" y="6823.4141"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="959" y="6827.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="998" y="6847.4092">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="966" y="6863.7061">bulk-processing</text><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="1096" y="60.1328"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="1092" y="64.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="1116.5" y="84.1279">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="1099" y="100.4248">notification</text><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="1096" y="6823.4141"/><rect fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="1092" y="6827.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="1116.5" y="6847.4092">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="1099" y="6863.7061">notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="1196" y="112.4248">Position DAO</text><ellipse cx="1242" cy="83.4297" fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1230" x2="1254" y1="97.4297" y2="97.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="1196" y="6836.4092">Position DAO</text><ellipse cx="1242" cy="6855.7109" fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1230" x2="1254" y1="6869.7109" y2="6869.7109"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1576" y="112.4248">Central Store</text><path d="M1602,63.4297 C1602,53.4297 1620,53.4297 1620,53.4297 C1620,53.4297 1638,53.4297 1638,63.4297 L1638,89.4297 C1638,99.4297 1620,99.4297 1620,99.4297 C1620,99.4297 1602,99.4297 1602,89.4297 L1602,63.4297 " fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1602,63.4297 C1602,73.4297 1620,73.4297 1620,73.4297 C1620,73.4297 1638,73.4297 1638,63.4297 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1576" y="6836.4092">Central Store</text><path d="M1602,6849.7109 C1602,6839.7109 1620,6839.7109 1620,6839.7109 C1620,6839.7109 1638,6839.7109 1638,6849.7109 L1638,6875.7109 C1638,6885.7109 1620,6885.7109 1620,6885.7109 C1620,6885.7109 1602,6885.7109 1602,6875.7109 L1602,6849.7109 " fill="#FEFECE" filter="url(#f1g5kzaghnfd4b)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1602,6849.7109 C1602,6859.7109 1620,6859.7109 1620,6859.7109 C1620,6859.7109 1638,6859.7109 1638,6849.7109 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="74" y="195.125"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="6688.6875" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="344" y="125.7266"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="811" y="5138.3047"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="811" y="5599.4297"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1015.5" y="2159.1484"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1015.5" y="2772.875"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1015.5" y="3458.7344"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1015.5" y="6301.2891"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1134" y="1667.7578"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1134" y="6762.4141"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="150.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1237" y="707.5156"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="135.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1237" y="1028.2422"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="121.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1237" y="3568.8047"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="120.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1237" y="3772.6016"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="150.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1237" y="4100.1953"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="136.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1237" y="4333.3906"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="121.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1237" y="4569.4531"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="92.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1615" y="736.6484"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="77.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1615" y="1057.375"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1615" y="3597.9375"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="62.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1615" y="3801.7344"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="62.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1615" y="4129.3281"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1615" y="4362.5234"/><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1615" y="4598.5859"/><path d="M13,132.7266 L265,132.7266 L265,139.7266 L255,149.7266 L13,149.7266 L13,132.7266 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="5689.8438" style="stroke: #000000; stroke-width: 2.0;" width="1778" x="13" y="132.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="28" y="145.7935">Fulfil Handler Consume (Success)</text><path d="M23,156.8594 L86,156.8594 L86,163.8594 L76,173.8594 L23,173.8594 L23,156.8594 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="5658.7109" style="stroke: #000000; stroke-width: 2.0;" width="1758" x="23" y="156.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="38" y="169.9263">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="138" x="101" y="169.0698">[Consume Single Message]</text><polygon fill="#A80036" points="95,191.125,85,195.125,95,199.125,91,195.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="89" x2="343" y1="195.125" y2="195.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="101" y="190.0591">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="112" y="190.0591">Consume Fulfil event message for Payer</text><path d="M283.5,240.125 L366.5,240.125 L366.5,247.125 L356.5,257.125 L283.5,257.125 L283.5,240.125 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="120.6641" style="stroke: #000000; stroke-width: 2.0;" width="404.5" x="283.5" y="240.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="298.5" y="253.1919">break</text><path d="M293.5,264.2578 L431.5,264.2578 L431.5,271.2578 L421.5,281.2578 L293.5,281.2578 L293.5,264.2578 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="89.5313" style="stroke: #000000; stroke-width: 2.0;" width="384.5" x="293.5" y="264.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="308.5" y="277.3247">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="396" y1="332.7891" y2="332.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="396" y1="332.7891" y2="345.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="396" y1="345.7891" y2="345.7891"/><polygon fill="#A80036" points="365,341.7891,355,345.7891,365,349.7891,361,345.7891" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="361" y="312.5903">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="294" x="372" y="297.4575">Validate event - Rule: type IN ['fulfil', 'bulk-fulfil'] &amp;&amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="372" y="312.5903">action == 'commit'</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="372" y="327.7231">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="452" y="327.7231">2001</text><path d="M293.5,374.7891 L503.5,374.7891 L503.5,381.7891 L493.5,391.7891 L293.5,391.7891 L293.5,374.7891 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="106.6641" style="stroke: #000000; stroke-width: 2.0;" width="665.5" x="293.5" y="374.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="165" x="308.5" y="387.856">Persist Event Information</text><polygon fill="#A80036" points="907.5,409.0547,917.5,413.0547,907.5,417.0547,911.5,413.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="913.5" y1="413.0547" y2="413.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="361" y="407.9888">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="372" y="407.9888">Publish event information</text><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="647.5" x="300.5" y="421.0547"/><polygon fill="#EEEEEE" points="300.5,421.0547,364.5,421.0547,364.5,428.0547,354.5,438.0547,300.5,438.0547,300.5,421.0547" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="313.5" y="435.1216">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="555.75" y="454.1216">Event Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="558.75" y="469.2544"/><path d="M293.5,495.4531 L507.5,495.4531 L507.5,502.4531 L497.5,512.4531 L293.5,512.4531 L293.5,495.4531 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="102.5313" style="stroke: #000000; stroke-width: 2.0;" width="902.5" x="293.5" y="495.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="169" x="308.5" y="508.52">Validate FSPIOP-Signature</text><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="884.5" x="300.5" y="537.5859"/><polygon fill="#EEEEEE" points="300.5,537.5859,364.5,537.5859,364.5,544.5859,354.5,554.5859,300.5,554.5859,300.5,537.5859" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="313.5" y="551.6528">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="587.75" y="570.6528">Validate message.content.headers.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="112" x="789.75" y="570.6528">FSPIOP-Signature</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="587.75" y="585.7856">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="667.75" y="585.7856">3105/3106</text><path d="M253.5,611.9844 L584.5,611.9844 L584.5,618.9844 L574.5,628.9844 L253.5,628.9844 L253.5,611.9844 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3093.2188" style="stroke: #000000; stroke-width: 2.0;" width="1517.5" x="253.5" y="611.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="286" x="268.5" y="625.0513">Validate Transfer Fulfilment Duplicate Check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="396" y1="650.25" y2="650.25"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="396" y1="650.25" y2="663.25"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="396" y1="663.25" y2="663.25"/><polygon fill="#A80036" points="365,659.25,355,663.25,365,667.25,361,663.25" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="361" y="645.1841">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="203" x="372" y="645.1841">Generate transferFulfilmentId uuid</text><polygon fill="#A80036" points="1225,703.5156,1235,707.5156,1225,711.5156,1229,707.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1231" y1="707.5156" y2="707.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="361" y="694.8833">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="341" x="372" y="687.3169">Request to retrieve transfer fulfilment hashes by transferId</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="372" y="702.4497">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="446" y="702.4497">2003</text><polygon fill="#A80036" points="1603,732.6484,1613,736.6484,1603,740.6484,1607,736.6484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1247" x2="1609" y1="736.6484" y2="736.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="1254" y="731.5825">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="314" x="1265" y="731.5825">Request Transfer fulfilment duplicate message hashes</text><polygon fill="#FFFFE0" filter="url(#f1g5kzaghnfd4b)" points="1489,749.6484,1751,749.6484,1761,775.6484,1751,802.6484,1489,802.6484,1479,775.6484,1489,749.6484" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="1491" y="765.7153">SELET transferId, hash</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="1491" y="780.8481">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="220" x="1529" y="780.8481">transferFulfilmentDuplicateCheck</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="1491" y="795.981">WHERE transferId = request.params.id</text><polygon fill="#A80036" points="1258,825.1797,1248,829.1797,1258,833.1797,1254,829.1797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1252" x2="1619" y1="829.1797" y2="829.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="1264" y="824.1138">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="1275" y="824.1138">Return existing hashes</text><polygon fill="#A80036" points="365,854.3125,355,858.3125,365,862.3125,361,858.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="359" x2="1241" y1="858.3125" y2="858.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="371" y="853.2466">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="382" y="853.2466">Return (list of) transfer fulfil messages hash(es)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="396" y1="902.5781" y2="902.5781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="396" y1="902.5781" y2="915.5781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="396" y1="915.5781" y2="915.5781"/><polygon fill="#A80036" points="365,911.5781,355,915.5781,365,919.5781,361,915.5781" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="361" y="889.9458">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="267" x="372" y="882.3794">Loop the list of returned hashes and compare</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="372" y="897.5122">each entry with the calculated message hash</text><path d="M263.5,930.5781 L326.5,930.5781 L326.5,937.5781 L316.5,947.5781 L263.5,947.5781 L263.5,930.5781 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2767.625" style="stroke: #000000; stroke-width: 2.0;" width="1474.5" x="263.5" y="930.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="278.5" y="943.645">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="84" x="341.5" y="942.7886">[Hash matched]</text><polygon fill="#A80036" points="907.5,979.9766,917.5,983.9766,907.5,987.9766,911.5,983.9766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="913.5" y1="983.9766" y2="983.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="971.3442">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="379" y="963.7778">Publish event information (for duplicate)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="379" y="978.9106">(Event Handler Consume)</text><polygon fill="#A80036" points="1225,1024.2422,1235,1028.2422,1225,1032.2422,1229,1028.2422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1231" y1="1028.2422" y2="1028.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="1015.6099">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="331" x="379" y="1008.0435">Request to retrieve Transfer Fulfilment and Transfer state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="379" y="1023.1763">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="453" y="1023.1763">2003</text><polygon fill="#A80036" points="1603,1053.375,1613,1057.375,1603,1061.375,1607,1057.375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1247" x2="1609" y1="1057.375" y2="1057.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1254" y="1052.3091">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="331" x="1272" y="1052.3091">Request to retrieve Transfer Fulfilment and Transfer state</text><polygon fill="#FFFFE0" filter="url(#f1g5kzaghnfd4b)" points="1558,1070.375,1682,1070.375,1692,1089.375,1682,1108.375,1558,1108.375,1548,1089.375,1558,1070.375" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="1560" y="1086.4419">transferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="1560" y="1101.5747">transferStateChange</text><polygon fill="#A80036" points="1258,1130.7734,1248,1134.7734,1258,1138.7734,1254,1134.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1252" x2="1619" y1="1134.7734" y2="1134.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1264" y="1129.7075">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="1282" y="1129.7075">Return Transfer Fulfilment and Transfer state</text><polygon fill="#A80036" points="365,1159.9063,355,1163.9063,365,1167.9063,361,1163.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="359" x2="1241" y1="1163.9063" y2="1163.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="371" y="1158.8403">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="389" y="1158.8403">Return Transfer Fulfilment and Transfer state</text><path d="M273.5,1178.9063 L336.5,1178.9063 L336.5,1185.9063 L326.5,1195.9063 L273.5,1195.9063 L273.5,1178.9063 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2331.8281" style="stroke: #000000; stroke-width: 2.0;" width="942.5" x="273.5" y="1178.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="288.5" y="1191.9731">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="169" x="351.5" y="1191.1167">[transferFulfilment.isValid == 0]</text><path d="M283.5,1203.0391 L366.5,1203.0391 L366.5,1210.0391 L356.5,1220.0391 L283.5,1220.0391 L283.5,1203.0391 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1001.1094" style="stroke: #000000; stroke-width: 2.0;" width="922.5" x="283.5" y="1203.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="298.5" y="1216.106">break</text><path d="M293.5,1227.1719 L356.5,1227.1719 L356.5,1234.1719 L346.5,1244.1719 L293.5,1244.1719 L293.5,1227.1719 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="969.9766" style="stroke: #000000; stroke-width: 2.0;" width="902.5" x="293.5" y="1227.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="308.5" y="1240.2388">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="94" x="371.5" y="1239.3823">[If type == 'fulfil']</text><path d="M359,1249.3047 L359,1622.3047 L638,1622.3047 L638,1259.3047 L628,1249.3047 L359,1249.3047 " fill="#FFFF00" filter="url(#f1g5kzaghnfd4b)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M628,1249.3047 L628,1259.3047 L638,1259.3047 L628,1249.3047 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="365" y="1266.3716">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="1281.5044">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="377" y="1296.6372">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="377" y="1311.77">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="377" y="1326.9028">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="377" y="1342.0356">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="377" y="1357.1685">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="389" y="1372.3013">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="389" y="1387.4341">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="377" y="1402.5669">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="377" y="1417.6997">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="389" y="1432.8325">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="401" y="1447.9653">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="401" y="1463.0981">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="401" y="1478.231">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="401" y="1493.3638">action: fulfil-duplicate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="401" y="1508.4966">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="401" y="1523.6294">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="413" y="1538.7622">status: "error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="413" y="1553.895">code: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="401" y="1569.0278">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="389" y="1584.1606">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="377" y="1599.2935">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="1614.4263">}</text><polygon fill="#A80036" points="1122,1663.7578,1132,1667.7578,1122,1671.7578,1126,1667.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1128" y1="1667.7578" y2="1667.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="1655.1255">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="318" x="379" y="1647.5591">Publish Notification event for Payee - Modified Request</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="379" y="1662.6919">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="459" y="1662.6919">3106</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="293.5" x2="1196" y1="1706.7578" y2="1706.7578"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="121" x="298.5" y="1716.9683">[If type == 'bulk-fulfil']</text><path d="M359,1725.5625 L359,2098.5625 L638,2098.5625 L638,1735.5625 L628,1725.5625 L359,1725.5625 " fill="#FFFF00" filter="url(#f1g5kzaghnfd4b)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M628,1725.5625 L628,1735.5625 L638,1735.5625 L628,1725.5625 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="365" y="1742.6294">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="1757.7622">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="377" y="1772.895">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="377" y="1788.0278">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="377" y="1803.1606">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="377" y="1818.2935">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="377" y="1833.4263">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="389" y="1848.5591">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="389" y="1863.6919">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="377" y="1878.8247">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="377" y="1893.9575">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="389" y="1909.0903">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="401" y="1924.2231">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="401" y="1939.356">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="401" y="1954.4888">type: bulk-processing,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="401" y="1969.6216">action: fulfil-duplicate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="401" y="1984.7544">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="401" y="1999.8872">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="413" y="2015.02">status: "error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="413" y="2030.1528">code: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="401" y="2045.2856">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="389" y="2060.4185">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="377" y="2075.5513">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="2090.6841">}</text><polygon fill="#A80036" points="1003.5,2155.1484,1013.5,2159.1484,1003.5,2163.1484,1007.5,2159.1484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1009.5" y1="2159.1484" y2="2159.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="2138.9497">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="318" x="379" y="2123.8169">Publish Notification event for Payee - Modified Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="379" y="2138.9497">3106 to Bulk Processing Topic</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="379" y="2154.0825">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="459" y="2154.0825">3106</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="273.5" x2="1216" y1="2212.1484" y2="2212.1484"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="241" x="278.5" y="2222.3589">[transferState IN ['COMMITTED', 'ABORTED']]</text><path d="M283.5,2232.9531 L366.5,2232.9531 L366.5,2239.9531 L356.5,2249.9531 L283.5,2249.9531 L283.5,2232.9531 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="584.9219" style="stroke: #000000; stroke-width: 2.0;" width="922.5" x="283.5" y="2232.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="298.5" y="2246.02">break</text><path d="M293.5,2257.0859 L356.5,2257.0859 L356.5,2264.0859 L346.5,2274.0859 L293.5,2274.0859 L293.5,2257.0859 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="553.7891" style="stroke: #000000; stroke-width: 2.0;" width="902.5" x="293.5" y="2257.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="308.5" y="2270.1528">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="94" x="371.5" y="2269.2964">[If type == 'fulfil']</text><rect fill="#FFFFFF" filter="url(#f1g5kzaghnfd4b)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="884.5" x="300.5" y="2274.2188"/><polygon fill="#EEEEEE" points="300.5,2274.2188,364.5,2274.2188,364.5,2281.2188,354.5,2291.2188,300.5,2291.2188,300.5,2274.2188" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="313.5" y="2288.2856">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="632.75" y="2307.2856">Send notification to Participant (Payee)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="635.75" y="2322.4185"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="293.5" x2="1196" y1="2335.6172" y2="2335.6172"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="121" x="298.5" y="2345.8276">[If type == 'bulk-fulfil']</text><path d="M359,2354.4219 L359,2727.4219 L638,2727.4219 L638,2364.4219 L628,2354.4219 L359,2354.4219 " fill="#FFFF00" filter="url(#f1g5kzaghnfd4b)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M628,2354.4219 L628,2364.4219 L638,2364.4219 L628,2354.4219 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="365" y="2371.4888">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="2386.6216">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="377" y="2401.7544">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="377" y="2416.8872">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="377" y="2432.02">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="377" y="2447.1528">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="377" y="2462.2856">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="389" y="2477.4185">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="389" y="2492.5513">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="377" y="2507.6841">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="377" y="2522.8169">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="389" y="2537.9497">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="401" y="2553.0825">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="401" y="2568.2153">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="401" y="2583.3481">type: bulk-processing,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="401" y="2598.481">action: fulfil-duplicate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="401" y="2613.6138">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="401" y="2628.7466">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="413" y="2643.8794">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="413" y="2659.0122">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="401" y="2674.145">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="389" y="2689.2778">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="377" y="2704.4106">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="2719.5435">}</text><polygon fill="#A80036" points="1003.5,2768.875,1013.5,2772.875,1003.5,2776.875,1007.5,2772.875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1009.5" y1="2772.875" y2="2772.875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="2760.2427">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="349" x="379" y="2752.6763">Publish Notification event for Payee to Bulk Processing Topic</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="379" y="2767.8091">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="459" y="2767.8091">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="273.5" x2="1216" y1="2825.875" y2="2825.875"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="168" x="278.5" y="2836.0854">[transferState NOT 'RESERVED']</text><path d="M293.5,2846.6797 L376.5,2846.6797 L376.5,2853.6797 L366.5,2863.6797 L293.5,2863.6797 L293.5,2846.6797 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="74.3984" style="stroke: #000000; stroke-width: 2.0;" width="298.5" x="293.5" y="2846.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="308.5" y="2859.7466">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="396" y1="2900.0781" y2="2900.0781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="396" y1="2900.0781" y2="2913.0781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="396" y1="2913.0781" y2="2913.0781"/><polygon fill="#A80036" points="365,2909.0781,355,2913.0781,365,2917.0781,361,2913.0781" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="2887.4458">18</text><text fill="#FF00FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="201" x="379" y="2879.8794">Reference: Failure in validation</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="379" y="2895.0122">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="453" y="2895.0122">2001</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="273.5" x2="1216" y1="2929.0781" y2="2929.0781"/><path d="M283.5,2937.0781 L366.5,2937.0781 L366.5,2944.0781 L356.5,2954.0781 L283.5,2954.0781 L283.5,2937.0781 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="566.6563" style="stroke: #000000; stroke-width: 2.0;" width="818.5" x="283.5" y="2937.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="298.5" y="2950.145">break</text><path d="M293.5,2961.2109 L356.5,2961.2109 L356.5,2968.2109 L346.5,2978.2109 L293.5,2978.2109 L293.5,2961.2109 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="535.5234" style="stroke: #000000; stroke-width: 2.0;" width="798.5" x="293.5" y="2961.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="308.5" y="2974.2778">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="94" x="371.5" y="2973.4214">[If type == 'fulfil']</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="396" y1="2999.4766" y2="2999.4766"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="396" y1="2999.4766" y2="3012.4766"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="396" y1="3012.4766" y2="3012.4766"/><polygon fill="#A80036" points="365,3008.4766,355,3012.4766,365,3016.4766,361,3012.4766" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="2994.4106">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="379" y="2994.4106">Allow previous request to complete</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="293.5" x2="1092" y1="3021.4766" y2="3021.4766"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="121" x="298.5" y="3031.687">[If type == 'bulk-fulfil']</text><path d="M359,3040.2813 L359,3413.2813 L638,3413.2813 L638,3050.2813 L628,3040.2813 L359,3040.2813 " fill="#FFFF00" filter="url(#f1g5kzaghnfd4b)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M628,3040.2813 L628,3050.2813 L638,3050.2813 L628,3040.2813 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="365" y="3057.3481">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="3072.481">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="377" y="3087.6138">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="377" y="3102.7466">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="377" y="3117.8794">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="377" y="3133.0122">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="377" y="3148.145">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="389" y="3163.2778">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="389" y="3178.4106">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="377" y="3193.5435">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="377" y="3208.6763">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="389" y="3223.8091">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="401" y="3238.9419">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="401" y="3254.0747">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="401" y="3269.2075">type: bulk-processing,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="401" y="3284.3403">action: fulfil-duplicate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="401" y="3299.4731">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="401" y="3314.606">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="413" y="3329.7388">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="413" y="3344.8716">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="401" y="3360.0044">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="389" y="3375.1372">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="377" y="3390.27">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="3405.4028">}</text><polygon fill="#A80036" points="1003.5,3454.7344,1013.5,3458.7344,1003.5,3462.7344,1007.5,3458.7344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1009.5" y1="3458.7344" y2="3458.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="3446.1021">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="349" x="379" y="3438.5356">Publish Notification event for Payee to Bulk Processing Topic</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="379" y="3453.6685">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="459" y="3453.6685">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="263.5" x2="1738" y1="3518.7344" y2="3518.7344"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="106" x="268.5" y="3528.9448">[Hash not matched]</text><polygon fill="#A80036" points="1225,3564.8047,1235,3568.8047,1225,3572.8047,1229,3568.8047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1231" y1="3568.8047" y2="3568.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="3556.1724">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="379" y="3548.606">Request to persist transfer hash</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="379" y="3563.7388">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="459" y="3563.7388">2003</text><polygon fill="#A80036" points="1603,3593.9375,1613,3597.9375,1603,3601.9375,1607,3597.9375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1247" x2="1609" y1="3597.9375" y2="3597.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1254" y="3592.8716">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="1272" y="3592.8716">Persist hash</text><polygon fill="#FFFFE0" filter="url(#f1g5kzaghnfd4b)" points="1521,3640.9375,1718,3640.9375,1728,3651.9375,1718,3663.9375,1521,3663.9375,1511,3651.9375,1521,3640.9375" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="1523" y="3657.0044">transferFulfilmentDuplicateCheck</text><polygon fill="#A80036" points="365,3686.2031,355,3690.2031,365,3694.2031,361,3690.2031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="359" x2="1241" y1="3690.2031" y2="3690.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="371" y="3685.1372">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="389" y="3685.1372">Return success</text><path d="M273.5,3719.2031 L571.5,3719.2031 L571.5,3726.2031 L561.5,3736.2031 L273.5,3736.2031 L273.5,3719.2031 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2035.4297" style="stroke: #000000; stroke-width: 2.0;" width="1448.5" x="273.5" y="3719.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="253" x="288.5" y="3732.27">Validate and persist Transfer Fulfilment</text><polygon fill="#A80036" points="1225,3768.6016,1235,3772.6016,1225,3776.6016,1229,3772.6016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1231" y1="3772.6016" y2="3772.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="3759.9692">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252" x="379" y="3752.4028">Request information for the validate checks</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="379" y="3767.5356">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="453" y="3767.5356">2003</text><polygon fill="#A80036" points="1603,3797.7344,1613,3801.7344,1603,3805.7344,1607,3801.7344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1247" x2="1609" y1="3801.7344" y2="3801.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1254" y="3796.6685">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1272" y="3796.6685">Fetch from database</text><polygon fill="#FFFFE0" filter="url(#f1g5kzaghnfd4b)" points="1595,3814.7344,1645,3814.7344,1655,3825.7344,1645,3837.7344,1595,3837.7344,1585,3825.7344,1595,3814.7344" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="1597" y="3830.8013">transfer</text><polygon fill="#A80036" points="1258,3860,1248,3864,1258,3868,1254,3864" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1252" x2="1619" y1="3864" y2="3864"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1264" y="3858.9341">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1285" y="3858.9341"/><polygon fill="#A80036" points="365,3889.1328,355,3893.1328,365,3897.1328,361,3893.1328" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="359" x2="1241" y1="3893.1328" y2="3893.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="371" y="3888.0669">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="389" y="3888.0669">Return transfer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="396" y1="3937.3984" y2="3937.3984"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="396" y1="3937.3984" y2="3950.3984"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="396" y1="3950.3984" y2="3950.3984"/><polygon fill="#A80036" points="365,3946.3984,355,3950.3984,365,3954.3984,361,3950.3984" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="3924.7661">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="425" x="379" y="3917.1997">Validate that Transfer.ilpCondition = SHA-256 (content.payload.fulfilment)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="379" y="3932.3325">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="453" y="3932.3325">2001</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="396" y1="3994.6641" y2="3994.6641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="396" y1="3994.6641" y2="4007.6641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="396" y1="4007.6641" y2="4007.6641"/><polygon fill="#A80036" points="365,4003.6641,355,4007.6641,365,4011.6641,361,4007.6641" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="3982.0317">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="379" y="3974.4653">Validate expirationDate</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="379" y="3989.5981">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="453" y="3989.5981">3303</text><path d="M283.5,4022.6641 L350.5,4022.6641 L350.5,4029.6641 L340.5,4039.6641 L283.5,4039.6641 L283.5,4022.6641 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="243.3281" style="stroke: #000000; stroke-width: 2.0;" width="1422.5" x="283.5" y="4022.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="298.5" y="4035.731">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="226" x="365.5" y="4034.8745">[Transfer.ilpCondition validate successful]</text><path d="M293.5,4046.7969 L571.5,4046.7969 L571.5,4053.7969 L561.5,4063.7969 L293.5,4063.7969 L293.5,4046.7969 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="212.1953" style="stroke: #000000; stroke-width: 2.0;" width="1402.5" x="293.5" y="4046.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="233" x="308.5" y="4059.8638">Request current Settlement Window</text><polygon fill="#A80036" points="1225,4096.1953,1235,4100.1953,1225,4104.1953,1229,4100.1953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1231" y1="4100.1953" y2="4100.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="4087.563">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="355" x="379" y="4079.9966">Request to retrieve current/latest transfer settlement window</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="379" y="4095.1294">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="453" y="4095.1294">2003</text><polygon fill="#A80036" points="1603,4125.3281,1613,4129.3281,1603,4133.3281,1607,4129.3281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1247" x2="1609" y1="4129.3281" y2="4129.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1254" y="4124.2622">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="1272" y="4124.2622">Fetch settlementWindowId</text><polygon fill="#FFFFE0" filter="url(#f1g5kzaghnfd4b)" points="1563,4142.3281,1676,4142.3281,1686,4153.3281,1676,4165.3281,1563,4165.3281,1553,4153.3281,1563,4142.3281" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1565" y="4158.395">settlementWindow</text><polygon fill="#A80036" points="1258,4187.5938,1248,4191.5938,1258,4195.5938,1254,4191.5938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1252" x2="1619" y1="4191.5938" y2="4191.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1264" y="4186.5278">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1285" y="4186.5278"/><polygon fill="#A80036" points="365,4246.9922,355,4250.9922,365,4254.9922,361,4250.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="359" x2="1241" y1="4250.9922" y2="4250.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="371" y="4230.7935">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="446" x="389" y="4215.6606">Return settlementWindowId to be appended during transferFulfilment insert</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35" x="389" y="4230.7935">TODO</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="393" x="424" y="4230.7935">: During settlement design make sure transfers in 'RECEIVED-FULFIL'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="389" y="4245.9263">state are updated to the next settlement window</text><path d="M293.5,4279.9922 L449.5,4279.9922 L449.5,4286.9922 L439.5,4296.9922 L293.5,4296.9922 L293.5,4279.9922 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="197.9297" style="stroke: #000000; stroke-width: 2.0;" width="1400.5" x="293.5" y="4279.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="308.5" y="4293.0591">Persist fulfilment</text><polygon fill="#A80036" points="1225,4329.3906,1235,4333.3906,1225,4337.3906,1229,4333.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1231" y1="4333.3906" y2="4333.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="4320.7583">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="448" x="379" y="4313.1919">Persist fulfilment with the result of the above check (transferFulfilment.isValid)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="379" y="4328.3247">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="453" y="4328.3247">2003</text><polygon fill="#A80036" points="1603,4358.5234,1613,4362.5234,1603,4366.5234,1607,4362.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1247" x2="1609" y1="4362.5234" y2="4362.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1254" y="4357.4575">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="1272" y="4357.4575">Persist to database</text><polygon fill="#FFFFE0" filter="url(#f1g5kzaghnfd4b)" points="1566,4405.5234,1674,4405.5234,1684,4424.5234,1674,4443.5234,1566,4443.5234,1556,4424.5234,1566,4405.5234" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="1568" y="4421.5903">transferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="1568" y="4436.7231">transferExtension</text><polygon fill="#A80036" points="365,4465.9219,355,4469.9219,365,4473.9219,361,4469.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="359" x2="1241" y1="4469.9219" y2="4469.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="371" y="4464.856">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="389" y="4464.856">Return success</text><path d="M283.5,4491.9219 L346.5,4491.9219 L346.5,4498.9219 L336.5,4508.9219 L283.5,4508.9219 L283.5,4491.9219 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1255.7109" style="stroke: #000000; stroke-width: 2.0;" width="1428.5" x="283.5" y="4491.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="298.5" y="4504.9888">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="226" x="361.5" y="4504.1323">[Transfer.ilpCondition validate successful]</text><path d="M293.5,4516.0547 L728.5,4516.0547 L728.5,4523.0547 L718.5,4533.0547 L293.5,4533.0547 L293.5,4516.0547 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="182.7969" style="stroke: #000000; stroke-width: 2.0;" width="1408.5" x="293.5" y="4516.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="390" x="308.5" y="4529.1216">Persist Transfer State (with transferState='RECEIVED-FULFIL')</text><polygon fill="#A80036" points="1225,4565.4531,1235,4569.4531,1225,4573.4531,1229,4569.4531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1231" y1="4569.4531" y2="4569.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="4556.8208">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="379" y="4549.2544">Request to persist transfer state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="379" y="4564.3872">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="453" y="4564.3872">2003</text><polygon fill="#A80036" points="1603,4594.5859,1613,4598.5859,1603,4602.5859,1607,4598.5859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1247" x2="1609" y1="4598.5859" y2="4598.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1254" y="4593.52">38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1272" y="4593.52">Persist transfer state</text><polygon fill="#FFFFE0" filter="url(#f1g5kzaghnfd4b)" points="1558,4641.5859,1682,4641.5859,1692,4652.5859,1682,4664.5859,1558,4664.5859,1548,4652.5859,1558,4641.5859" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="1560" y="4657.6528">transferStateChange</text><polygon fill="#A80036" points="365,4686.8516,355,4690.8516,365,4694.8516,361,4690.8516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="359" x2="1241" y1="4690.8516" y2="4690.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="371" y="4685.7856">39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="389" y="4685.7856">Return success</text><path d="M293.5,4712.8516 L356.5,4712.8516 L356.5,4719.8516 L346.5,4729.8516 L293.5,4729.8516 L293.5,4712.8516 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="924.5781" style="stroke: #000000; stroke-width: 2.0;" width="596.5" x="293.5" y="4712.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="308.5" y="4725.9185">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="94" x="371.5" y="4725.062">[If type == 'fulfil']</text><path d="M359,4734.9844 L359,5107.9844 L638,5107.9844 L638,4744.9844 L628,4734.9844 L359,4734.9844 " fill="#FFFF00" filter="url(#f1g5kzaghnfd4b)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M628,4734.9844 L628,4744.9844 L638,4744.9844 L628,4734.9844 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="365" y="4752.0513">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="4767.1841">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="377" y="4782.3169">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="377" y="4797.4497">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="377" y="4812.5825">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="377" y="4827.7153">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="377" y="4842.8481">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="389" y="4857.981">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="389" y="4873.1138">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="377" y="4888.2466">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="377" y="4903.3794">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="389" y="4918.5122">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="401" y="4933.645">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="401" y="4948.7778">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="401" y="4963.9106">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="401" y="4979.0435">action: commit,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="401" y="4994.1763">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="401" y="5009.3091">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="413" y="5024.4419">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="413" y="5039.5747">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="401" y="5054.7075">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="389" y="5069.8403">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="377" y="5084.9731">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="5100.106">}</text><polygon fill="#A80036" points="799,5134.3047,809,5138.3047,799,5142.3047,803,5138.3047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="805" y1="5138.3047" y2="5138.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="5133.2388">40</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="379" y="5133.2388">Route &amp; Publish Position event for Payee</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="293.5" x2="890" y1="5177.3047" y2="5177.3047"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="121" x="298.5" y="5187.5151">[If type == 'bulk-fulfil']</text><path d="M359,5196.1094 L359,5569.1094 L638,5569.1094 L638,5206.1094 L628,5196.1094 L359,5196.1094 " fill="#FFFF00" filter="url(#f1g5kzaghnfd4b)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M628,5196.1094 L628,5206.1094 L638,5206.1094 L628,5196.1094 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="365" y="5213.1763">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="5228.3091">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="377" y="5243.4419">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="377" y="5258.5747">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="377" y="5273.7075">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="377" y="5288.8403">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="377" y="5303.9731">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="389" y="5319.106">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="389" y="5334.2388">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="377" y="5349.3716">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="377" y="5364.5044">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="389" y="5379.6372">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="401" y="5394.77">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="401" y="5409.9028">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="401" y="5425.0356">type: bulk-position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="401" y="5440.1685">action: commit,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="401" y="5455.3013">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="401" y="5470.4341">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="413" y="5485.5669">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="413" y="5500.6997">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="401" y="5515.8325">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="389" y="5530.9653">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="377" y="5546.0981">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="5561.231">}</text><polygon fill="#A80036" points="799,5595.4297,809,5599.4297,799,5603.4297,803,5599.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="805" y1="5599.4297" y2="5599.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="5594.3638">41</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="379" y="5594.3638">Route &amp; Publish Position event for Payee</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="283.5" x2="1712" y1="5645.4297" y2="5645.4297"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="209" x="288.5" y="5655.6401">[Validate Fulfil Transfer not successful]</text><path d="M293.5,5666.2344 L376.5,5666.2344 L376.5,5673.2344 L366.5,5683.2344 L293.5,5683.2344 L293.5,5666.2344 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="74.3984" style="stroke: #000000; stroke-width: 2.0;" width="352.5" x="293.5" y="5666.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="308.5" y="5679.3013">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="396" y1="5719.6328" y2="5719.6328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="396" y1="5719.6328" y2="5732.6328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="396" y1="5732.6328" y2="5732.6328"/><polygon fill="#A80036" points="365,5728.6328,355,5732.6328,365,5736.6328,361,5732.6328" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="5707.0005">42</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="379" y="5699.4341">Route &amp; Publish Notification event for Payee</text><text fill="#FF00FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="201" x="379" y="5714.5669">Reference: Failure in validation</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="1781" y1="5762.6328" y2="5762.6328"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="143" x="28" y="5772.8433">[Consume Batch Messages]</text><path d="M136,5781.4375 L136,5806.4375 L335,5806.4375 L335,5791.4375 L325,5781.4375 L136,5781.4375 " fill="#ADD8E6" filter="url(#f1g5kzaghnfd4b)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M325,5781.4375 L325,5791.4375 L335,5791.4375 L325,5781.4375 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="142" y="5798.5044">To be delivered by future story</text><path d="M283.5,5836.5703 L529.5,5836.5703 L529.5,5843.5703 L519.5,5853.5703 L283.5,5853.5703 L283.5,5836.5703 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="970.8438" style="stroke: #000000; stroke-width: 2.0;" width="922.5" x="283.5" y="5836.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="201" x="298.5" y="5849.6372">Reference: Failure in validation</text><path d="M293.5,5860.7031 L356.5,5860.7031 L356.5,5867.7031 L346.5,5877.7031 L293.5,5877.7031 L293.5,5860.7031 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="939.7109" style="stroke: #000000; stroke-width: 2.0;" width="902.5" x="293.5" y="5860.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="308.5" y="5873.77">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="121" x="371.5" y="5872.9136">[If type == 'bulk-fulfil']</text><path d="M359,5882.8359 L359,6255.8359 L638,6255.8359 L638,5892.8359 L628,5882.8359 L359,5882.8359 " fill="#FFFF00" filter="url(#f1g5kzaghnfd4b)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M628,5882.8359 L628,5892.8359 L638,5892.8359 L628,5882.8359 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="365" y="5899.9028">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="5915.0356">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="377" y="5930.1685">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="377" y="5945.3013">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="377" y="5960.4341">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="377" y="5975.5669">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="377" y="5990.6997">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="389" y="6005.8325">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="389" y="6020.9653">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="377" y="6036.0981">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="377" y="6051.231">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="389" y="6066.3638">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="401" y="6081.4966">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="401" y="6096.6294">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="401" y="6111.7622">type: bulk-processing,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="401" y="6126.895">action: commit,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="401" y="6142.0278">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="401" y="6157.1606">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="413" y="6172.2935">status: "error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="413" y="6187.4263">code: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="401" y="6202.5591">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="389" y="6217.6919">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="377" y="6232.8247">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="6247.9575">}</text><polygon fill="#A80036" points="1003.5,6297.2891,1013.5,6301.2891,1003.5,6305.2891,1007.5,6301.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1009.5" y1="6301.2891" y2="6301.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="6288.6567">43</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="349" x="379" y="6281.0903">Publish Notification event for Payee to Bulk Processing Topic</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="379" y="6296.2231">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="459" y="6296.2231">2003</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="293.5" x2="1196" y1="6340.2891" y2="6340.2891"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="94" x="298.5" y="6350.4995">[If type == 'fulfil']</text><path d="M359,6359.0938 L359,6732.0938 L638,6732.0938 L638,6369.0938 L628,6359.0938 L359,6359.0938 " fill="#FFFF00" filter="url(#f1g5kzaghnfd4b)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M628,6359.0938 L628,6369.0938 L638,6369.0938 L628,6359.0938 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="365" y="6376.1606">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="6391.2935">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="377" y="6406.4263">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="377" y="6421.5591">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="377" y="6436.6919">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="377" y="6451.8247">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="377" y="6466.9575">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="389" y="6482.0903">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="389" y="6497.2231">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="377" y="6512.356">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="377" y="6527.4888">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="389" y="6542.6216">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="401" y="6557.7544">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="401" y="6572.8872">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="401" y="6588.02">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="401" y="6603.1528">action: commit,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="401" y="6618.2856">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="401" y="6633.4185">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="413" y="6648.5513">status: "error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="413" y="6663.6841">code: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="401" y="6678.8169">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="389" y="6693.9497">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="377" y="6709.0825">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="6724.2153">}</text><polygon fill="#A80036" points="1122,6758.4141,1132,6762.4141,1122,6766.4141,1126,6762.4141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1128" y1="6762.4141" y2="6762.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="6757.3481">44</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="379" y="6757.3481">Route &amp; Publish Notification event for Payee</text><!--
@startuml
title 2.2.1. Fulfil Handler Consume (Success) (single message, includes individual transfers from Bulk)

autonumber

collections "Fulfil-Topic" as TOPIC_FULFIL
control "Fulfil Handler" as FULF_HANDLER
collections "topic-\nevent" as TOPIC_EVENT
collections "topic-\ntransfer-position" as TOPIC_TRANSFER_POSITION
collections "topic-\nnotification" as TOPIC_NOTIFICATIONS
collections "topic-\nbulk-processing" as TOPIC_BULK_PROCESSING
entity "Position DAO" as POS_DAO
database "Central Store" as DB
box "Central Service" #LightYellow
    participant TOPIC_FULFIL
    participant FULF_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant TOPIC_EVENT
    participant TOPIC_BULK_PROCESSING
    participant TOPIC_NOTIFICATIONS
    participant POS_DAO
    participant DB
end box
activate FULF_HANDLER
group Fulfil Handler Consume (Success)
    alt Consume Single Message
        TOPIC_FULFIL <- FULF_HANDLER: Consume Fulfil event message for Payer
        activate TOPIC_FULFIL
        deactivate TOPIC_FULFIL
        break
            group Validate Event
                FULF_HANDLER <-> FULF_HANDLER: Validate event - Rule: type IN ['fulfil', 'bulk-fulfil'] &&\naction == 'commit'\n<color #FF0000><b>Error codes:</b> 2001</color>
            end
        end
        group Persist Event Information
            FULF_HANDLER -> TOPIC_EVENT: Publish event information
            ref over FULF_HANDLER, TOPIC_EVENT: Event Handler Consume\n
        end
        group Validate FSPIOP-Signature
            |||
            ref over FULF_HANDLER, TOPIC_NOTIFICATIONS: Validate message.content.headers.**FSPIOP-Signature**\n<color #FF0000><b>Error codes:</b> 3105/3106</color>
        end
        group Validate Transfer Fulfilment Duplicate Check
            FULF_HANDLER -> FULF_HANDLER: Generate transferFulfilmentId uuid
            FULF_HANDLER -> POS_DAO: Request to retrieve transfer fulfilment hashes by transferId\n<color #FF0000><b>Error code:</b> 2003</color>
            activate POS_DAO
            POS_DAO -> DB: Request Transfer fulfilment duplicate message hashes
            hnote over DB #lightyellow
                SELET transferId, hash
                FROM **transferFulfilmentDuplicateCheck**
                WHERE transferId = request.params.id
            end note
            activate DB
            POS_DAO <- - DB: Return existing hashes
            deactivate DB
            POS_DAO - -> FULF_HANDLER: Return (list of) transfer fulfil messages hash(es)
            deactivate POS_DAO
            FULF_HANDLER -> FULF_HANDLER: Loop the list of returned hashes and compare \neach entry with the calculated message hash
            alt Hash matched
                FULF_HANDLER -> TOPIC_EVENT: Publish event information (for duplicate) \n(Event Handler Consume)
                FULF_HANDLER -> POS_DAO: Request to retrieve Transfer Fulfilment and Transfer state\n<color #FF0000><b>Error code:</b> 2003</color>
                activate POS_DAO
                POS_DAO -> DB: Request to retrieve Transfer Fulfilment and Transfer state
                hnote over DB #lightyellow
                    transferFulfilment
                    transferStateChange
                end note
                activate DB
                POS_DAO <- - DB: Return Transfer Fulfilment and Transfer state
                deactivate DB
                POS_DAO - -> FULF_HANDLER: Return Transfer Fulfilment and Transfer state
                deactivate POS_DAO
                alt transferFulfilment.isValid == 0
                    break
                        alt If type == 'fulfil'
                            note right of FULF_HANDLER #yellow
                            Message:
                            {
                                id: <ID>,
                                from: <transferHeaders.FSPIOP-Source>,
                                to: <transferHeaders.FSPIOP-Destination>,
                                type: application/json,
                                content: {
                                    headers: <transferHeaders>,
                                    payload: <transferMessage>
                                },
                                metadata: {
                                    event: {
                                        id: <uuid>,
                                        responseTo: <previous.uuid>,
                                        type: notification,
                                        action: fulfil-duplicate,
                                        createdAt: <timestamp>,
                                        state: {
                                            status: "error",
                                            code: 1
                                        }
                                    }
                                }
                            }
                            end note
                            FULF_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notification event for Payee - Modified Request\n<color #FF0000><b>Error codes:</b> 3106</color>
                            activate TOPIC_NOTIFICATIONS
                            deactivate TOPIC_NOTIFICATIONS
                        else If type == 'bulk-fulfil'
                            note right of FULF_HANDLER #yellow
                            Message:
                            {
                                id: <ID>,
                                from: <transferHeaders.FSPIOP-Source>,
                                to: <transferHeaders.FSPIOP-Destination>,
                                type: application/json,
                                content: {
                                    headers: <transferHeaders>,
                                    payload: <transferMessage>
                                },
                                metadata: {
                                    event: {
                                        id: <uuid>,
                                        responseTo: <previous.uuid>,
                                        type: bulk-processing,
                                        action: fulfil-duplicate,
                                        createdAt: <timestamp>,
                                        state: {
                                            status: "error",
                                            code: 1
                                        }
                                    }
                                }
                            }
                            end note
                            FULF_HANDLER -> TOPIC_BULK_PROCESSING: Publish Notification event for Payee - Modified Request \n3106 to Bulk Processing Topic\n<color #FF0000><b>Error codes:</b> 3106</color>
                            activate TOPIC_BULK_PROCESSING
                            deactivate TOPIC_BULK_PROCESSING
                        end
                    end
                else transferState IN ['COMMITTED', 'ABORTED']
                    break
                        alt If type == 'fulfil'
                            ref over FULF_HANDLER, TOPIC_NOTIFICATIONS: Send notification to Participant (Payee)\n
                        else If type == 'bulk-fulfil'
                            note right of FULF_HANDLER #yellow
                            Message:
                            {
                                id: <ID>,
                                from: <transferHeaders.FSPIOP-Source>,
                                to: <transferHeaders.FSPIOP-Destination>,
                                type: application/json,
                                content: {
                                    headers: <transferHeaders>,
                                    payload: <transferMessage>
                                },
                                metadata: {
                                    event: {
                                        id: <uuid>,
                                        responseTo: <previous.uuid>,
                                        type: bulk-processing,
                                        action: fulfil-duplicate,
                                        createdAt: <timestamp>,
                                        state: {
                                            status: "success",
                                            code: 0
                                        }
                                    }
                                }
                            }
                            end note
                            FULF_HANDLER -> TOPIC_BULK_PROCESSING: Publish Notification event for Payee to Bulk Processing Topic\n<color #FF0000><b>Error codes:</b> 2003</color>
                            activate TOPIC_BULK_PROCESSING
                            deactivate TOPIC_BULK_PROCESSING
                        end
                    end
                else transferState NOT 'RESERVED'
                    break
                        FULF_HANDLER <-> FULF_HANDLER: <color Magenta><b>Reference: Failure in validation</b></color>\n<color #FF0000><b>Error code:</b> 2001</color>
                    end
                else
                    break
                        alt If type == 'fulfil'
                            FULF_HANDLER <-> FULF_HANDLER: Allow previous request to complete
                        else If type == 'bulk-fulfil'
                            note right of FULF_HANDLER #yellow
                            Message:
                            {
                                id: <ID>,
                                from: <transferHeaders.FSPIOP-Source>,
                                to: <transferHeaders.FSPIOP-Destination>,
                                type: application/json,
                                content: {
                                    headers: <transferHeaders>,
                                    payload: <transferMessage>
                                },
                                metadata: {
                                    event: {
                                        id: <uuid>,
                                        responseTo: <previous.uuid>,
                                        type: bulk-processing,
                                        action: fulfil-duplicate,
                                        createdAt: <timestamp>,
                                        state: {
                                            status: "success",
                                            code: 0
                                        }
                                    }
                                }
                            }
                            end note
                            FULF_HANDLER -> TOPIC_BULK_PROCESSING: Publish Notification event for Payee to Bulk Processing Topic\n<color #FF0000><b>Error codes:</b> 2003</color>
                            activate TOPIC_BULK_PROCESSING
                            deactivate TOPIC_BULK_PROCESSING
                        end
                    end
                end
            else Hash not matched
                FULF_HANDLER -> POS_DAO: Request to persist transfer hash\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate POS_DAO
                POS_DAO -> DB: Persist hash
                hnote over DB #lightyellow
                    transferFulfilmentDuplicateCheck
                end note
                activate DB
                deactivate DB
                POS_DAO - -> FULF_HANDLER: Return success
                deactivate POS_DAO
            end
        end
        group Validate and persist Transfer Fulfilment
            FULF_HANDLER -> POS_DAO: Request information for the validate checks\n<color #FF0000><b>Error code:</b> 2003</color>
            activate POS_DAO
            POS_DAO -> DB: Fetch from database
            activate DB
            hnote over DB #lightyellow
                transfer
            end note
            DB - -> POS_DAO
            deactivate DB
            FULF_HANDLER <- - POS_DAO: Return transfer
            deactivate POS_DAO
            FULF_HANDLER ->FULF_HANDLER: Validate that Transfer.ilpCondition = SHA-256 (content.payload.fulfilment)\n<color #FF0000><b>Error code:</b> 2001</color>
            FULF_HANDLER -> FULF_HANDLER: Validate expirationDate\n<color #FF0000><b>Error code:</b> 3303</color>

            opt Transfer.ilpCondition validate successful
                group Request current Settlement Window
                    FULF_HANDLER -> POS_DAO: Request to retrieve current/latest transfer settlement window\n<color #FF0000><b>Error code:</b> 2003</color>
                    activate POS_DAO
                    POS_DAO -> DB: Fetch settlementWindowId
                    activate DB
                    hnote over DB #lightyellow
                        settlementWindow
                    end note
                    DB - -> POS_DAO
                    deactivate DB
                    FULF_HANDLER <- - POS_DAO: Return settlementWindowId to be appended during transferFulfilment insert\n**TODO**: During settlement design make sure transfers in 'RECEIVED-FULFIL'\nstate are updated to the next settlement window
                    deactivate POS_DAO
                end
            end

            group Persist fulfilment
                FULF_HANDLER -> POS_DAO: Persist fulfilment with the result of the above check (transferFulfilment.isValid)\n<color #FF0000><b>Error code:</b> 2003</color>
                activate POS_DAO
                POS_DAO -> DB: Persist to database
                activate DB
                deactivate DB
                hnote over DB #lightyellow
                    transferFulfilment
                    transferExtension
                end note
                FULF_HANDLER <- - POS_DAO: Return success
                deactivate POS_DAO
            end

            alt Transfer.ilpCondition validate successful
                group Persist Transfer State (with transferState='RECEIVED-FULFIL')
                    FULF_HANDLER -> POS_DAO: Request to persist transfer state\n<color #FF0000><b>Error code:</b> 2003</color>
                    activate POS_DAO
                    POS_DAO -> DB: Persist transfer state
                    activate DB
                    hnote over DB #lightyellow
                        transferStateChange
                    end note
                    deactivate DB
                    POS_DAO - -> FULF_HANDLER: Return success
                    deactivate POS_DAO
                end

                alt If type == 'fulfil'
                    note right of FULF_HANDLER #yellow
                        Message:
                        {
                            id: <ID>,
                            from: <transferHeaders.FSPIOP-Source>,
                            to: <transferHeaders.FSPIOP-Destination>,
                            type: application/json,
                            content: {
                                headers: <transferHeaders>,
                                payload: <transferMessage>
                            },
                            metadata: {
                                event: {
                                    id: <uuid>,
                                    responseTo: <previous.uuid>,
                                    type: position,
                                    action: commit,
                                    createdAt: <timestamp>,
                                    state: {
                                        status: "success",
                                        code: 0
                                    }
                                }
                            }
                        }
                    end note
                    FULF_HANDLER -> TOPIC_TRANSFER_POSITION: Route & Publish Position event for Payee
                    activate TOPIC_TRANSFER_POSITION
                    deactivate TOPIC_TRANSFER_POSITION
                else If type == 'bulk-fulfil'
                    note right of FULF_HANDLER #yellow
                        Message:
                        {
                            id: <ID>,
                            from: <transferHeaders.FSPIOP-Source>,
                            to: <transferHeaders.FSPIOP-Destination>,
                            type: application/json,
                            content: {
                                headers: <transferHeaders>,
                                payload: <transferMessage>
                            },
                            metadata: {
                                event: {
                                    id: <uuid>,
                                    responseTo: <previous.uuid>,
                                    type: bulk-position,
                                    action: commit,
                                    createdAt: <timestamp>,
                                    state: {
                                        status: "success",
                                        code: 0
                                    }
                                }
                            }
                        }
                    end note
                    FULF_HANDLER -> TOPIC_TRANSFER_POSITION: Route & Publish Position event for Payee
                    activate TOPIC_TRANSFER_POSITION
                    deactivate TOPIC_TRANSFER_POSITION
                end
            else Validate Fulfil Transfer not successful
                break
                    FULF_HANDLER -> FULF_HANDLER: Route & Publish Notification event for Payee\n<color Magenta><b>Reference: Failure in validation</b></color>
                end
            end
        end
    else Consume Batch Messages
        note left of FULF_HANDLER #lightblue
            To be delivered by future story
        end note
    end
end

group Reference: Failure in validation
    alt If type == 'bulk-fulfil'
        note right of FULF_HANDLER #yellow
        Message:
        {
            id: <ID>,
            from: <transferHeaders.FSPIOP-Source>,
            to: <transferHeaders.FSPIOP-Destination>,
            type: application/json,
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: bulk-processing,
                    action: commit,
                    createdAt: <timestamp>,
                    state: {
                        status: "error",
                        code: 1
                    }
                }
            }
        }
        end note
        FULF_HANDLER -> TOPIC_BULK_PROCESSING: Publish Notification event for Payee to Bulk Processing Topic\n<color #FF0000><b>Error codes:</b> 2003</color>
        activate TOPIC_BULK_PROCESSING
        deactivate TOPIC_BULK_PROCESSING
    else If type == 'fulfil'
        note right of FULF_HANDLER #yellow
        Message:
        {
            id: <ID>,
            from: <transferHeaders.FSPIOP-Source>,
            to: <transferHeaders.FSPIOP-Destination>,
            type: application/json,
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: <previous.uuid>,
                    type: notification,
                    action: commit,
                    createdAt: <timestamp>,
                    state: {
                        status: "error",
                        code: 1
                    }
                }
            }
        }
        end note
        FULF_HANDLER -> TOPIC_NOTIFICATIONS: Route & Publish Notification event for Payee
        activate TOPIC_NOTIFICATIONS
        deactivate TOPIC_NOTIFICATIONS
    end
end

deactivate FULF_HANDLER
@enduml

PlantUML version 1.2018.02(Fri Mar 09 17:20:44 GMT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_212-b04
Operating System: Linux
OS Version: 4.15.0-1035-aws
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>