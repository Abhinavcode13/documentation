<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1930px" preserveAspectRatio="none" style="width:1918px;height:1930px;" version="1.1" viewBox="0 0 1918 1930" width="1918px" zoomAndPan="magnify"><defs><filter height="300%" id="f1fpjrokigchts" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="775" x="572.5" y="22.9951">1.1.0. DFSP1 sends a Prepare Transfer request to DFSP2 (single message, includes individual transfers from Bulk)</text><rect fill="#D3D3D3" height="1885.2109" style="stroke: #A80036; stroke-width: 1.0;" width="178" x="4" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="172" x="7" y="46.3638">Financial Service Providers</text><rect fill="#ADD8E6" height="1885.2109" style="stroke: #A80036; stroke-width: 1.0;" width="524.5" x="264.5" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="452.25" y="46.3638">ML API Adapter Service</text><rect fill="#FFFFE0" height="1885.2109" style="stroke: #A80036; stroke-width: 1.0;" width="1110" x="791" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="1297" y="46.3638">Central Service</text><rect fill="#FFFFFF" filter="url(#f1fpjrokigchts)" height="589.1172" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="316" y="746.8047"/><rect fill="#FFFFFF" filter="url(#f1fpjrokigchts)" height="1643.8906" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="669" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f1fpjrokigchts)" height="86.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1008" y="1220.3906"/><rect fill="#FFFFFF" filter="url(#f1fpjrokigchts)" height="1643.8906" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1337" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f1fpjrokigchts)" height="1643.8906" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1671.5" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f1fpjrokigchts)" height="1629.8906" style="stroke: #000000; stroke-width: 2.0;" width="1875" x="32" y="170.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="65" x2="65" y1="153.0234" y2="1816.9141"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="121" x2="121" y1="153.0234" y2="1816.9141"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="320.5" x2="320.5" y1="153.0234" y2="1816.9141"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="674" x2="674" y1="153.0234" y2="1816.9141"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="858" x2="858" y1="153.0234" y2="1816.9141"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1013" x2="1013" y1="153.0234" y2="1816.9141"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1342" x2="1342" y1="153.0234" y2="1816.9141"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1508" x2="1508" y1="153.0234" y2="1816.9141"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1676" x2="1676" y1="153.0234" y2="1816.9141"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1829" x2="1829" y1="153.0234" y2="1816.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="42" y="133.4248">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="44.5" y="149.7217">Payer</text><ellipse cx="65" cy="63.4297" fill="#FEFECE" filter="url(#f1fpjrokigchts)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M65,71.4297 L65,98.4297 M52,79.4297 L78,79.4297 M65,98.4297 L52,113.4297 M65,98.4297 L78,113.4297 " fill="none" filter="url(#f1fpjrokigchts)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="42" y="1828.9092">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="44.5" y="1845.2061">Payer</text><ellipse cx="65" cy="1858.5078" fill="#FEFECE" filter="url(#f1fpjrokigchts)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M65,1866.5078 L65,1893.5078 M52,1874.5078 L78,1874.5078 M65,1893.5078 L52,1908.5078 M65,1893.5078 L78,1908.5078 " fill="none" filter="url(#f1fpjrokigchts)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="98" y="133.4248">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="99" y="149.7217">Payee</text><ellipse cx="121" cy="63.4297" fill="#FEFECE" filter="url(#f1fpjrokigchts)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M121,71.4297 L121,98.4297 M108,79.4297 L134,79.4297 M121,98.4297 L108,113.4297 M121,98.4297 L134,113.4297 " fill="none" filter="url(#f1fpjrokigchts)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="98" y="1828.9092">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="99" y="1845.2061">Payee</text><ellipse cx="121" cy="1858.5078" fill="#FEFECE" filter="url(#f1fpjrokigchts)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M121,1866.5078 L121,1893.5078 M108,1874.5078 L134,1874.5078 M121,1893.5078 L108,1908.5078 M121,1893.5078 L134,1908.5078 " fill="none" filter="url(#f1fpjrokigchts)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="268.5" y="149.7217">ML API Adapter</text><path d="M300.5,108.7266 L300.5,132.7266 M300.5,120.7266 L317.5,120.7266 " fill="none" filter="url(#f1fpjrokigchts)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="329.5" cy="120.7266" fill="#FEFECE" filter="url(#f1fpjrokigchts)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="268.5" y="1828.9092">ML API Adapter</text><path d="M300.5,1836.2109 L300.5,1860.2109 M300.5,1848.2109 L317.5,1848.2109 " fill="none" filter="url(#f1fpjrokigchts)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="329.5" cy="1848.2109" fill="#FEFECE" filter="url(#f1fpjrokigchts)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="216" x="563" y="149.7217">ML API Notification Event Handler</text><ellipse cx="674" cy="120.7266" fill="#FEFECE" filter="url(#f1fpjrokigchts)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="670,108.7266,676,103.7266,674,108.7266,676,113.7266,670,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="216" x="563" y="1828.9092">ML API Notification Event Handler</text><ellipse cx="674" cy="1848.2109" fill="#FEFECE" filter="url(#f1fpjrokigchts)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="670,1836.2109,676,1831.2109,674,1836.2109,676,1841.2109,670,1836.2109" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="795" y="149.7217">Central Service API</text><path d="M838,108.7266 L838,132.7266 M838,120.7266 L855,120.7266 " fill="none" filter="url(#f1fpjrokigchts)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="867" cy="120.7266" fill="#FEFECE" filter="url(#f1fpjrokigchts)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="795" y="1828.9092">Central Service API</text><path d="M838,1836.2109 L838,1860.2109 M838,1848.2109 L855,1848.2109 " fill="none" filter="url(#f1fpjrokigchts)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="867" cy="1848.2109" fill="#FEFECE" filter="url(#f1fpjrokigchts)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1fpjrokigchts)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="154" x="936" y="113.7266"/><rect fill="#FEFECE" filter="url(#f1fpjrokigchts)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="154" x="932" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="140" x="939" y="137.7217">topic-transfer-prepare</text><rect fill="#FEFECE" filter="url(#f1fpjrokigchts)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="154" x="936" y="1815.9141"/><rect fill="#FEFECE" filter="url(#f1fpjrokigchts)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="154" x="932" y="1819.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="140" x="939" y="1839.9092">topic-transfer-prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="142" x="1268" y="149.7217">Prepare Event Handler</text><ellipse cx="1342" cy="120.7266" fill="#FEFECE" filter="url(#f1fpjrokigchts)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1338,108.7266,1344,103.7266,1342,108.7266,1344,113.7266,1338,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="142" x="1268" y="1828.9092">Prepare Event Handler</text><ellipse cx="1342" cy="1848.2109" fill="#FEFECE" filter="url(#f1fpjrokigchts)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1338,1836.2109,1344,1831.2109,1342,1836.2109,1344,1841.2109,1338,1836.2109" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1fpjrokigchts)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="1430" y="113.7266"/><rect fill="#FEFECE" filter="url(#f1fpjrokigchts)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="1426" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="1433" y="137.7217">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#f1fpjrokigchts)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="1430" y="1815.9141"/><rect fill="#FEFECE" filter="url(#f1fpjrokigchts)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="1426" y="1819.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="1433" y="1839.9092">topic-transfer-position</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="145" x="1601" y="149.7217">Position Event Handler</text><ellipse cx="1676.5" cy="120.7266" fill="#FEFECE" filter="url(#f1fpjrokigchts)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1672.5,108.7266,1678.5,103.7266,1676.5,108.7266,1678.5,113.7266,1672.5,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="145" x="1601" y="1828.9092">Position Event Handler</text><ellipse cx="1676.5" cy="1848.2109" fill="#FEFECE" filter="url(#f1fpjrokigchts)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1672.5,1836.2109,1678.5,1831.2109,1676.5,1836.2109,1678.5,1841.2109,1672.5,1836.2109" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1fpjrokigchts)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1766" y="113.7266"/><rect fill="#FEFECE" filter="url(#f1fpjrokigchts)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1762" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1769" y="137.7217">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1fpjrokigchts)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1766" y="1815.9141"/><rect fill="#FEFECE" filter="url(#f1fpjrokigchts)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1762" y="1819.9141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1769" y="1839.9092">Notification-Topic</text><rect fill="#FFFFFF" filter="url(#f1fpjrokigchts)" height="589.1172" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="316" y="746.8047"/><rect fill="#FFFFFF" filter="url(#f1fpjrokigchts)" height="1643.8906" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="669" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f1fpjrokigchts)" height="86.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1008" y="1220.3906"/><rect fill="#FFFFFF" filter="url(#f1fpjrokigchts)" height="1643.8906" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1337" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f1fpjrokigchts)" height="1643.8906" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1671.5" y="163.0234"/><path d="M32,170.0234 L387,170.0234 L387,177.0234 L377,187.0234 L32,187.0234 L32,170.0234 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1629.8906" style="stroke: #000000; stroke-width: 2.0;" width="1875" x="32" y="170.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="310" x="47" y="183.0903">DFSP1 sends a Prepare Transfer request to DFSP2</text><path d="M70,192.1563 L70,716.1563 L375,716.1563 L375,202.1563 L365,192.1563 L70,192.1563 " fill="#FFFF00" filter="url(#f1fpjrokigchts)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M365,192.1563 L365,202.1563 L375,202.1563 L365,192.1563 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="76" y="209.2231">Headers - transferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="88" y="224.356">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="88" y="239.4888">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="88" y="254.6216">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="88" y="269.7544">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="88" y="284.8872">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="88" y="300.02">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="88" y="315.1528">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="88" y="330.2856">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="88" y="345.4185">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="88" y="360.5513">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="76" y="375.6841">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="79" y="390.8169"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="76" y="405.9497">Payload - transferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="76" y="421.0825">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="88" y="436.2153">"transferId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="88" y="451.3481">"payeeFsp": dfsp2,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="88" y="466.481">"payerFsp": dfsp1,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="88" y="481.6138">"amount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="100" y="496.7466">"currency": "AED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="100" y="511.8794">"amount": "string"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="88" y="527.0122">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="88" y="542.145">"ilpPacket": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="88" y="557.2778">"condition": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="88" y="572.4106">"expiration": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="88" y="587.5435">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="100" y="602.6763">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="112" y="617.8091">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="124" y="632.9419">"key": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="124" y="648.0747">"value": "string"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="112" y="663.2075">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="100" y="678.3403">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="88" y="693.4731">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="76" y="708.606">}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="314" x2="304" y1="746.8047" y2="742.8047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="314" x2="304" y1="746.8047" y2="750.8047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="65" x2="315" y1="746.8047" y2="746.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="72" y="741.7388">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="83" y="741.7388">POST - /transfers</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="326" x2="368" y1="791.0703" y2="791.0703"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="368" x2="368" y1="791.0703" y2="804.0703"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="327" x2="368" y1="804.0703" y2="804.0703"/><polygon fill="#A80036" points="337,800.0703,327,804.0703,337,808.0703,333,804.0703" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="333" y="778.438">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="318" x="344" y="770.8716">Validate incoming token and originator matching Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="344" y="786.0044">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="424" y="786.0044">3000-3002, 3100-3107</text><path d="M331,817.0703 L331,1175.0703 L568,1175.0703 L568,827.0703 L558,817.0703 L331,817.0703 " fill="#FFFF00" filter="url(#f1fpjrokigchts)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M558,817.0703 L558,827.0703 L568,827.0703 L558,817.0703 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="337" y="834.1372">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="337" y="849.27">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="349" y="864.4028">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="349" y="879.5356">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="349" y="894.6685">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="349" y="909.8013">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="349" y="924.9341">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="361" y="940.0669">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="361" y="955.1997">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="349" y="970.3325">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="349" y="985.4653">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="361" y="1000.5981">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="373" y="1015.731">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="373" y="1030.8638">type: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="373" y="1045.9966">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="373" y="1061.1294">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="373" y="1076.2622">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="385" y="1091.395">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="385" y="1106.5278">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="373" y="1121.6606">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="361" y="1136.7935">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="349" y="1151.9263">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="337" y="1167.0591">}</text><polygon fill="#A80036" points="996,1216.3906,1006,1220.3906,996,1224.3906,1000,1220.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="326" x2="1002" y1="1220.3906" y2="1220.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="333" y="1207.7583">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="344" y="1200.1919">Route &amp; Publish Prepare event for Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="344" y="1215.3247">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="418" y="1215.3247">2003</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1018" x2="1060" y1="1264.6563" y2="1264.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1060" x2="1060" y1="1264.6563" y2="1277.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1019" x2="1060" y1="1277.6563" y2="1277.6563"/><polygon fill="#A80036" points="1029,1273.6563,1019,1277.6563,1029,1281.6563,1025,1277.6563" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="1025" y="1252.0239">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="294" x="1036" y="1244.4575">Ensure event is replicated as configured (ACKS=all)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="1036" y="1259.5903">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="1110" y="1259.5903">2003</text><polygon fill="#A80036" points="337,1302.7891,327,1306.7891,337,1310.7891,333,1306.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="331" x2="1012" y1="1306.7891" y2="1306.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="343" y="1301.7231">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="350" x="354" y="1301.7231">Respond replication acknowledgements have been received</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="65" x2="75" y1="1335.9219" y2="1331.9219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="65" x2="75" y1="1335.9219" y2="1339.9219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="65" x2="320" y1="1335.9219" y2="1335.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="82" y="1330.856">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="93" y="1330.856">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="1024,1386.0547,1014,1390.0547,1024,1394.0547,1020,1390.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1018" x2="1336" y1="1390.0547" y2="1390.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="1030" y="1384.9888">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="1041" y="1384.9888">Consume message</text><rect fill="#FFFFFF" filter="url(#f1fpjrokigchts)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="661" x="929" y="1398.0547"/><polygon fill="#EEEEEE" points="929,1398.0547,993,1398.0547,993,1405.0547,983,1415.0547,929,1415.0547,929,1398.0547" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="942" y="1412.1216">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="1135.5" y="1431.1216">Prepare Handler Consume {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.1.a.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.1.a.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="37" x="1298.5" y="1431.1216">1.1.1.a</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1298.5" x2="1335.5" y1="1433.1216" y2="1433.1216"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="3" x="1335.5" y="1431.1216">,</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.1.b.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.1.b.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="38" x="1341.5" y="1431.1216">1.1.1.b</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1341.5" x2="1379.5" y1="1433.1216" y2="1433.1216"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1379.5" y="1431.1216">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1138.5" y="1446.2544"/><polygon fill="#A80036" points="1496.5,1475.5859,1506.5,1479.5859,1496.5,1483.5859,1500.5,1479.5859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1347" x2="1502.5" y1="1479.5859" y2="1479.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="1354" y="1474.52">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="1365" y="1474.52">Produce message</text><polygon fill="#A80036" points="1519.5,1529.7188,1509.5,1533.7188,1519.5,1537.7188,1515.5,1533.7188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1513.5" x2="1670.5" y1="1533.7188" y2="1533.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="1525.5" y="1528.6528">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="1536.5" y="1528.6528">Consume message</text><rect fill="#FFFFFF" filter="url(#f1fpjrokigchts)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="328" x="1423" y="1541.7188"/><polygon fill="#EEEEEE" points="1423,1541.7188,1487,1541.7188,1487,1548.7188,1477,1558.7188,1423,1558.7188,1423,1541.7188" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1436" y="1555.7856">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="1462.5" y="1574.7856">Position Handler Consume {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.2.a.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.2.a.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="37" x="1626.5" y="1574.7856">1.1.2.a</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1626.5" x2="1663.5" y1="1576.7856" y2="1576.7856"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="3" x="1663.5" y="1574.7856">,</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.2.b.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.2.b.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="38" x="1669.5" y="1574.7856">1.1.2.b</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1669.5" x2="1707.5" y1="1576.7856" y2="1576.7856"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1707.5" y="1574.7856">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1465.5" y="1589.9185"/><polygon fill="#A80036" points="1817.5,1619.25,1827.5,1623.25,1817.5,1627.25,1821.5,1623.25" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1681.5" x2="1823.5" y1="1623.25" y2="1623.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1688.5" y="1618.1841">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="1706.5" y="1618.1841">Produce message</text><polygon fill="#A80036" points="1817.5,1673.3828,1827.5,1677.3828,1817.5,1681.3828,1821.5,1677.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="679" x2="1823.5" y1="1677.3828" y2="1677.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="686" y="1672.3169">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="704" y="1672.3169">Consume message</text><rect fill="#FFFFFF" filter="url(#f1fpjrokigchts)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="1801" x="95" y="1685.3828"/><polygon fill="#EEEEEE" points="95,1685.3828,159,1685.3828,159,1692.3828,149,1702.3828,95,1702.3828,95,1685.3828" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="108" y="1699.4497">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="837" y="1718.4497">Send notification to Participant (Payee) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.4.a.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.4.a.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="37" x="1069" y="1718.4497">1.1.4.a</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1069" x2="1106" y1="1720.4497" y2="1720.4497"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="3" x="1106" y="1718.4497">,</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.4.b.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.4.b.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="38" x="1112" y="1718.4497">1.1.4.b</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1112" x2="1150" y1="1720.4497" y2="1720.4497"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1150" y="1718.4497">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="840" y="1733.5825"/><polygon fill="#A80036" points="132,1762.9141,122,1766.9141,132,1770.9141,128,1766.9141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="126" x2="668" y1="1766.9141" y2="1766.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="138" y="1761.8481">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="156" y="1761.8481">Send callback notification</text><!--
@startuml
title 1.1.0. DFSP1 sends a Prepare Transfer request to DFSP2 (single message, includes individual transfers from Bulk)

autonumber


actor "DFSP1\nPayer" as DFSP1
actor "DFSP2\nPayee" as DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "topic-transfer-prepare" as TOPIC_TRANSFER_PREPARE
control "Prepare Event Handler" as PREP_HANDLER
collections "topic-transfer-position" as TOPIC_TRANSFER_POSITION
control "Position Event Handler" as POS_HANDLER
collections "Notification-Topic" as TOPIC_NOTIFICATIONS

box "Financial Service Providers" #lightGray
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightBlue
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_TRANSFER_PREPARE
    participant PREP_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant POS_HANDLER
    participant TOPIC_NOTIFICATIONS
end box

activate NOTIFY_HANDLER
activate PREP_HANDLER
activate POS_HANDLER
group DFSP1 sends a Prepare Transfer request to DFSP2
    note right of DFSP1 #yellow
        Headers - transferHeaders: {
            Content-Length: <Content-Length>,
            Content-Type: <Content-Type>,
            Date: <Date>,
            X-Forwarded-For: <X-Forwarded-For>,
            FSPIOP-Source: <FSPIOP-Source>,
            FSPIOP-Destination: <FSPIOP-Destination>,
            FSPIOP-Encryption: <FSPIOP-Encryption>,
            FSPIOP-Signature: <FSPIOP-Signature>,
            FSPIOP-URI: <FSPIOP-URI>,
            FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
        }

        Payload - transferMessage:
        {
            "transferId": <uuid>,
            "payeeFsp": dfsp2,
            "payerFsp": dfsp1,
            "amount": {
                "currency": "AED",
                "amount": "string"
            },
            "ilpPacket": "string",
            "condition": "string",
            "expiration": "string",
            "extensionList": {
                "extension": [
                    {
                        "key": "string",
                        "value": "string"
                    }
                ]
            }
        }
    end note
    DFSP1 ->> MLAPI: POST - /transfers
    activate MLAPI
    MLAPI -> MLAPI: Validate incoming token and originator matching Payer\n<color #FF0000><b>Error codes:</b> 3000-3002, 3100-3107</color>
    note right of MLAPI #yellow
        Message:
        {
            id: <transferMessage.transferId>
            from: <transferMessage.payerFsp>,
            to: <transferMessage.payeeFsp>,
            type: application/json
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    type: prepare,
                    action: prepare,
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
    end note
    MLAPI -> TOPIC_TRANSFER_PREPARE: Route & Publish Prepare event for Payer\n<color #FF0000><b>Error code:</b> 2003</color>
    activate TOPIC_TRANSFER_PREPARE
    TOPIC_TRANSFER_PREPARE <-> TOPIC_TRANSFER_PREPARE: Ensure event is replicated as configured (ACKS=all)\n<color #FF0000><b>Error code:</b> 2003</color>
    TOPIC_TRANSFER_PREPARE - -> MLAPI: Respond replication acknowledgements have been received
    deactivate TOPIC_TRANSFER_PREPARE
    MLAPI - ->> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate MLAPI
    |||
    TOPIC_TRANSFER_PREPARE <- PREP_HANDLER: Consume message
    ref over TOPIC_TRANSFER_PREPARE, PREP_HANDLER, TOPIC_TRANSFER_POSITION :  Prepare Handler Consume {[[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.1.a.svg 1.1.1.a]], [[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.1.b.svg 1.1.1.b]]} \n
    PREP_HANDLER -> TOPIC_TRANSFER_POSITION: Produce message
    |||
    TOPIC_TRANSFER_POSITION <- POS_HANDLER: Consume message
    ref over TOPIC_TRANSFER_POSITION, POS_HANDLER : Position Handler Consume {[[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.2.a.svg 1.1.2.a]], [[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.2.b.svg 1.1.2.b]]} \n
    POS_HANDLER -> TOPIC_NOTIFICATIONS: Produce message
    |||
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: Consume message
    ref over DFSP2, TOPIC_NOTIFICATIONS : Send notification to Participant (Payee) {[[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.4.a.svg 1.1.4.a]], [[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.4.b.svg 1.1.4.b]]} \n
    NOTIFY_HANDLER -> DFSP2: Send callback notification
    |||
end
deactivate POS_HANDLER
deactivate PREP_HANDLER
deactivate NOTIFY_HANDLER
@enduml

PlantUML version 1.2018.02(Fri Mar 09 17:20:44 GMT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_212-b04
Operating System: Linux
OS Version: 4.15.0-1035-aws
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>