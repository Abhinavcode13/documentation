<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1991px" preserveAspectRatio="none" style="width:2097px;height:1991px;" version="1.1" viewBox="0 0 2097 1991" width="2097px" zoomAndPan="magnify"><defs><filter height="300%" id="f19lvorojbbvzc" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="342" x="878.5" y="22.9951">2.2.0. DFSP2 sends a Fulfil Reject Transfer request</text><rect fill="#D3D3D3" height="1945.9453" style="stroke: #A80036; stroke-width: 1.0;" width="178" x="4" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="172" x="7" y="46.3638">Financial Service Providers</text><rect fill="#ADD8E6" height="1945.9453" style="stroke: #A80036; stroke-width: 1.0;" width="526.5" x="369.5" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="558.25" y="46.3638">ML API Adapter Service</text><rect fill="#FFFFE0" height="1945.9453" style="stroke: #A80036; stroke-width: 1.0;" width="1172" x="898" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="1435" y="46.3638">Central Service</text><rect fill="#FFFFFF" filter="url(#f19lvorojbbvzc)" height="543.7188" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="421" y="821.8047"/><rect fill="#FFFFFF" filter="url(#f19lvorojbbvzc)" height="1705.625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="776" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f19lvorojbbvzc)" height="71.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="1265.125"/><rect fill="#FFFFFF" filter="url(#f19lvorojbbvzc)" height="1705.625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1409" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f19lvorojbbvzc)" height="1705.625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1840.5" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f19lvorojbbvzc)" height="1690.625" style="stroke: #000000; stroke-width: 2.0;" width="2064" x="22" y="170.0234"/><rect fill="#FFFFFF" filter="url(#f19lvorojbbvzc)" height="131.6641" style="stroke: #000000; stroke-width: 2.0;" width="2044" x="32" y="1696.9844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="65" x2="65" y1="153.0234" y2="1877.6484"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="121" x2="121" y1="153.0234" y2="1877.6484"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="425.5" x2="425.5" y1="153.0234" y2="1877.6484"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="781" x2="781" y1="153.0234" y2="1877.6484"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="965" x2="965" y1="153.0234" y2="1877.6484"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1085" x2="1085" y1="153.0234" y2="1877.6484"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1414" x2="1414" y1="153.0234" y2="1877.6484"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1571" x2="1571" y1="153.0234" y2="1877.6484"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1712" x2="1712" y1="153.0234" y2="1877.6484"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1845" x2="1845" y1="153.0234" y2="1877.6484"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1998" x2="1998" y1="153.0234" y2="1877.6484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="42" y="133.4248">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="44.5" y="149.7217">Payer</text><ellipse cx="65" cy="63.4297" fill="#FEFECE" filter="url(#f19lvorojbbvzc)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M65,71.4297 L65,98.4297 M52,79.4297 L78,79.4297 M65,98.4297 L52,113.4297 M65,98.4297 L78,113.4297 " fill="none" filter="url(#f19lvorojbbvzc)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="42" y="1889.6436">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="44.5" y="1905.9404">Payer</text><ellipse cx="65" cy="1919.2422" fill="#FEFECE" filter="url(#f19lvorojbbvzc)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M65,1927.2422 L65,1954.2422 M52,1935.2422 L78,1935.2422 M65,1954.2422 L52,1969.2422 M65,1954.2422 L78,1969.2422 " fill="none" filter="url(#f19lvorojbbvzc)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="98" y="133.4248">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="99" y="149.7217">Payee</text><ellipse cx="121" cy="63.4297" fill="#FEFECE" filter="url(#f19lvorojbbvzc)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M121,71.4297 L121,98.4297 M108,79.4297 L134,79.4297 M121,98.4297 L108,113.4297 M121,98.4297 L134,113.4297 " fill="none" filter="url(#f19lvorojbbvzc)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="98" y="1889.6436">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="99" y="1905.9404">Payee</text><ellipse cx="121" cy="1919.2422" fill="#FEFECE" filter="url(#f19lvorojbbvzc)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M121,1927.2422 L121,1954.2422 M108,1935.2422 L134,1935.2422 M121,1954.2422 L108,1969.2422 M121,1954.2422 L134,1969.2422 " fill="none" filter="url(#f19lvorojbbvzc)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="373.5" y="149.7217">ML API Adapter</text><path d="M405.5,108.7266 L405.5,132.7266 M405.5,120.7266 L422.5,120.7266 " fill="none" filter="url(#f19lvorojbbvzc)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="434.5" cy="120.7266" fill="#FEFECE" filter="url(#f19lvorojbbvzc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="373.5" y="1889.6436">ML API Adapter</text><path d="M405.5,1896.9453 L405.5,1920.9453 M405.5,1908.9453 L422.5,1908.9453 " fill="none" filter="url(#f19lvorojbbvzc)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="434.5" cy="1908.9453" fill="#FEFECE" filter="url(#f19lvorojbbvzc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="216" x="670" y="149.7217">ML API Notification Event Handler</text><ellipse cx="781" cy="120.7266" fill="#FEFECE" filter="url(#f19lvorojbbvzc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="777,108.7266,783,103.7266,781,108.7266,783,113.7266,777,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="216" x="670" y="1889.6436">ML API Notification Event Handler</text><ellipse cx="781" cy="1908.9453" fill="#FEFECE" filter="url(#f19lvorojbbvzc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="777,1896.9453,783,1891.9453,781,1896.9453,783,1901.9453,777,1896.9453" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="902" y="149.7217">Central Service API</text><path d="M945,108.7266 L945,132.7266 M945,120.7266 L962,120.7266 " fill="none" filter="url(#f19lvorojbbvzc)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="974" cy="120.7266" fill="#FEFECE" filter="url(#f19lvorojbbvzc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="902" y="1889.6436">Central Service API</text><path d="M945,1896.9453 L945,1920.9453 M945,1908.9453 L962,1908.9453 " fill="none" filter="url(#f19lvorojbbvzc)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="974" cy="1908.9453" fill="#FEFECE" filter="url(#f19lvorojbbvzc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f19lvorojbbvzc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="1043" y="113.7266"/><rect fill="#FEFECE" filter="url(#f19lvorojbbvzc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="1039" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="1046" y="137.7217">Fulfil-Topic</text><rect fill="#FEFECE" filter="url(#f19lvorojbbvzc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="1043" y="1876.6484"/><rect fill="#FEFECE" filter="url(#f19lvorojbbvzc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="1039" y="1880.6484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="1046" y="1900.6436">Fulfil-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="124" x="1349" y="149.7217">Fulfil Event Handler</text><ellipse cx="1414" cy="120.7266" fill="#FEFECE" filter="url(#f19lvorojbbvzc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1410,108.7266,1416,103.7266,1414,108.7266,1416,113.7266,1410,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="124" x="1349" y="1889.6436">Fulfil Event Handler</text><ellipse cx="1414" cy="1908.9453" fill="#FEFECE" filter="url(#f19lvorojbbvzc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1410,1896.9453,1416,1891.9453,1414,1896.9453,1416,1901.9453,1410,1896.9453" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f19lvorojbbvzc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="1493" y="113.7266"/><rect fill="#FEFECE" filter="url(#f19lvorojbbvzc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="1489" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="1496" y="137.7217">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#f19lvorojbbvzc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="1493" y="1876.6484"/><rect fill="#FEFECE" filter="url(#f19lvorojbbvzc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="1489" y="1880.6484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="1496" y="1900.6436">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#f19lvorojbbvzc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="1668" y="113.7266"/><rect fill="#FEFECE" filter="url(#f19lvorojbbvzc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="1664" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="1671" y="137.7217">Event-Topic</text><rect fill="#FEFECE" filter="url(#f19lvorojbbvzc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="1668" y="1876.6484"/><rect fill="#FEFECE" filter="url(#f19lvorojbbvzc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="1664" y="1880.6484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="1671" y="1900.6436">Event-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="145" x="1770" y="149.7217">Position Event Handler</text><ellipse cx="1845.5" cy="120.7266" fill="#FEFECE" filter="url(#f19lvorojbbvzc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1841.5,108.7266,1847.5,103.7266,1845.5,108.7266,1847.5,113.7266,1841.5,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="145" x="1770" y="1889.6436">Position Event Handler</text><ellipse cx="1845.5" cy="1908.9453" fill="#FEFECE" filter="url(#f19lvorojbbvzc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1841.5,1896.9453,1847.5,1891.9453,1845.5,1896.9453,1847.5,1901.9453,1841.5,1896.9453" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f19lvorojbbvzc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1935" y="113.7266"/><rect fill="#FEFECE" filter="url(#f19lvorojbbvzc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1931" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1938" y="137.7217">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f19lvorojbbvzc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1935" y="1876.6484"/><rect fill="#FEFECE" filter="url(#f19lvorojbbvzc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1931" y="1880.6484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1938" y="1900.6436">Notification-Topic</text><rect fill="#FFFFFF" filter="url(#f19lvorojbbvzc)" height="543.7188" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="421" y="821.8047"/><rect fill="#FFFFFF" filter="url(#f19lvorojbbvzc)" height="1705.625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="776" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f19lvorojbbvzc)" height="71.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="1265.125"/><rect fill="#FFFFFF" filter="url(#f19lvorojbbvzc)" height="1705.625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1409" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f19lvorojbbvzc)" height="1705.625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1840.5" y="163.0234"/><path d="M22,170.0234 L343,170.0234 L343,177.0234 L333,187.0234 L22,187.0234 L22,170.0234 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1690.625" style="stroke: #000000; stroke-width: 2.0;" width="2064" x="22" y="170.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="276" x="37" y="183.0903">DFSP2 sends a Fulfil Reject Transfer request</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="121" x2="163" y1="238.5547" y2="238.5547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="163" x2="163" y1="238.5547" y2="251.5547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="122" x2="163" y1="251.5547" y2="251.5547"/><polygon fill="#A80036" points="132,247.5547,122,251.5547,132,255.5547,128,251.5547" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="128" y="218.356">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="139" y="203.2231">Retrieve fulfilment string generated during</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="139" y="218.356">the quoting process or regenerate it using</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="78" x="139" y="233.4888">Local secret</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="220" y="233.4888">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="69" x="246" y="233.4888">ILP Packet</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="318" y="233.4888">as inputs</text><path d="M126,264.5547 L126,304.5547 L408,304.5547 L408,274.5547 L398,264.5547 L126,264.5547 " fill="#ADD8E6" filter="url(#f19lvorojbbvzc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M398,264.5547 L398,274.5547 L408,274.5547 L398,264.5547 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31" x="132" y="281.6216">Note</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="163" y="281.6216">: In the payload for PUT /transfers/&lt;ID&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="132" y="296.7544">only the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="88" x="182" y="296.7544">transferState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37" x="273" y="296.7544">field is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56" x="313" y="296.7544">required</text><path d="M126,318.8203 L126,736.8203 L431,736.8203 L431,328.8203 L421,318.8203 L126,318.8203 " fill="#FFFF00" filter="url(#f19lvorojbbvzc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M421,318.8203 L421,328.8203 L431,328.8203 L421,318.8203 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="132" y="335.8872">Headers - transferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="144" y="351.02">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="144" y="366.1528">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="144" y="381.2856">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="144" y="396.4185">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="144" y="411.5513">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="144" y="426.6841">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="144" y="441.8169">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="144" y="456.9497">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="144" y="472.0825">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="144" y="487.2153">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="132" y="502.3481">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="135" y="517.481"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="132" y="532.6138">Payload - transferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="132" y="547.7466">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="144" y="562.8794">"fulfilment": &lt;IlpFulfilment&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="144" y="578.0122">"completedTimestamp": &lt;DateTime&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="144" y="593.145">"transferState": "ABORTED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="144" y="608.2778">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="156" y="623.4106">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="168" y="638.5435">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="180" y="653.6763">"key": &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="180" y="668.8091">"value": &lt;string&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="168" y="683.9419">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="156" y="699.0747">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="144" y="714.2075">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="132" y="729.3403">}</text><path d="M126,751.4063 L126,791.4063 L434,791.4063 L434,761.4063 L424,751.4063 L126,751.4063 " fill="#D3D3D3" filter="url(#f19lvorojbbvzc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M424,751.4063 L424,761.4063 L434,761.4063 L424,751.4063 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31" x="132" y="768.4731">Note</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="163" y="768.4731">: Payee rejection reason should be captured</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="132" y="783.606">in the extensionList within the payload.</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="419" x2="409" y1="821.8047" y2="817.8047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="419" x2="409" y1="821.8047" y2="825.8047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="121" x2="420" y1="821.8047" y2="821.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="128" y="816.7388">2</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="131" x="139" y="816.7388">PUT - /transfers/&lt;ID&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="431" x2="473" y1="850.9375" y2="850.9375"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="473" x2="473" y1="850.9375" y2="863.9375"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="473" y1="863.9375" y2="863.9375"/><polygon fill="#A80036" points="442,859.9375,432,863.9375,442,867.9375,438,863.9375" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="438" y="845.8716">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="320" x="449" y="845.8716">Validate incoming token and originator matching Payee</text><path d="M436,876.9375 L436,1234.9375 L715,1234.9375 L715,886.9375 L705,876.9375 L436,876.9375 " fill="#FFFF00" filter="url(#f19lvorojbbvzc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M705,876.9375 L705,886.9375 L715,886.9375 L705,876.9375 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="442" y="894.0044">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="442" y="909.1372">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="454" y="924.27">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="454" y="939.4028">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="454" y="954.5356">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="454" y="969.6685">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="454" y="984.8013">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="466" y="999.9341">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="466" y="1015.0669">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="454" y="1030.1997">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="454" y="1045.3325">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="466" y="1060.4653">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="478" y="1075.5981">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="478" y="1090.731">type: fulfil,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="478" y="1105.8638">action: reject,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="478" y="1120.9966">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="478" y="1136.1294">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="490" y="1151.2622">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="490" y="1166.395">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="478" y="1181.5278">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="466" y="1196.6606">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="454" y="1211.7935">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="442" y="1226.9263">}</text><polygon fill="#A80036" points="1068,1261.125,1078,1265.125,1068,1269.125,1072,1265.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="431" x2="1074" y1="1265.125" y2="1265.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="438" y="1260.0591">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="449" y="1260.0591">Route &amp; Publish Fulfil event for Payee</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1090" x2="1132" y1="1294.2578" y2="1294.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1132" x2="1132" y1="1294.2578" y2="1307.2578"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1091" x2="1132" y1="1307.2578" y2="1307.2578"/><polygon fill="#A80036" points="1101,1303.2578,1091,1307.2578,1101,1311.2578,1097,1307.2578" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="1097" y="1289.1919">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="294" x="1108" y="1289.1919">Ensure event is replicated as configured (ACKS=all)</text><polygon fill="#A80036" points="442,1332.3906,432,1336.3906,442,1340.3906,438,1336.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="436" x2="1084" y1="1336.3906" y2="1336.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="448" y="1331.3247">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="350" x="459" y="1331.3247">Respond replication acknowledgements have been received</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="121" x2="131" y1="1365.5234" y2="1361.5234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="121" x2="131" y1="1365.5234" y2="1369.5234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="121" x2="425" y1="1365.5234" y2="1365.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="138" y="1360.4575">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="149" y="1360.4575">Respond HTTP - 200 (OK)</text><polygon fill="#A80036" points="1096,1390.6563,1086,1394.6563,1096,1398.6563,1092,1394.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1090" x2="1408" y1="1394.6563" y2="1394.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="1102" y="1389.5903">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="1113" y="1389.5903">Consume message</text><rect fill="#FFFFFF" filter="url(#f19lvorojbbvzc)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="723" x="1036" y="1402.6563"/><polygon fill="#EEEEEE" points="1036,1402.6563,1100,1402.6563,1100,1409.6563,1090,1419.6563,1036,1419.6563,1036,1402.6563" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1049" y="1416.7231">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="1268" y="1435.7231">Fulfil Handler Consume (Reject/Abort) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-reject-2.2.1.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-reject-2.2.1.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="27" x="1496" y="1435.7231">2.2.1</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1496" x2="1523" y1="1437.7231" y2="1437.7231"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1523" y="1435.7231">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1271" y="1450.856"/><polygon fill="#A80036" points="1559.5,1480.1875,1569.5,1484.1875,1559.5,1488.1875,1563.5,1484.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1419" x2="1565.5" y1="1484.1875" y2="1484.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="1426" y="1479.1216">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="1437" y="1479.1216">Produce message</text><polygon fill="#A80036" points="1582.5,1534.3203,1572.5,1538.3203,1582.5,1542.3203,1578.5,1538.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1576.5" x2="1839.5" y1="1538.3203" y2="1538.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1588.5" y="1533.2544">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="1606.5" y="1533.2544">Consume message</text><rect fill="#FFFFFF" filter="url(#f19lvorojbbvzc)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="579" x="1486" y="1546.3203"/><polygon fill="#EEEEEE" points="1486,1546.3203,1550,1546.3203,1550,1553.3203,1540,1563.3203,1486,1563.3203,1486,1546.3203" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1499" y="1560.3872">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="1655" y="1579.3872">Position Handler Consume (Reject) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-position-1.3.3-abort.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-position-1.3.3-abort.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="27" x="1865" y="1579.3872">1.3.3</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1865" x2="1892" y1="1581.3872" y2="1581.3872"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1892" y="1579.3872">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1658" y="1594.52"/><polygon fill="#A80036" points="1986.5,1623.8516,1996.5,1627.8516,1986.5,1631.8516,1990.5,1627.8516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1850.5" x2="1992.5" y1="1627.8516" y2="1627.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1857.5" y="1622.7856">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="1875.5" y="1622.7856">Produce message</text><polygon fill="#A80036" points="1986.5,1677.9844,1996.5,1681.9844,1986.5,1685.9844,1990.5,1681.9844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="786" x2="1992.5" y1="1681.9844" y2="1681.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="793" y="1676.9185">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="811" y="1676.9185">Consume message</text><path d="M32,1696.9844 L99,1696.9844 L99,1703.9844 L89,1713.9844 L32,1713.9844 L32,1696.9844 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="131.6641" style="stroke: #000000; stroke-width: 2.0;" width="2044" x="32" y="1696.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="47" y="1710.0513">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="114" y="1709.1948">[action == 'reject']</text><rect fill="#FFFFFF" filter="url(#f19lvorojbbvzc)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="2026" x="39" y="1739.1172"/><polygon fill="#EEEEEE" points="39,1739.1172,103,1739.1172,103,1746.1172,93,1756.1172,39,1756.1172,39,1739.1172" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="52" y="1753.1841">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="916.5" y="1772.1841">Send notification to Participant (Payer) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.4.a.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.4.a.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="37" x="1146.5" y="1772.1841">1.1.4.a</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1146.5" x2="1183.5" y1="1774.1841" y2="1774.1841"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1183.5" y="1772.1841">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="919.5" y="1787.3169"/><polygon fill="#A80036" points="76,1816.6484,66,1820.6484,76,1824.6484,72,1820.6484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="70" x2="775" y1="1820.6484" y2="1820.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="82" y="1815.5825">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="100" y="1815.5825">Send callback notification</text><!--
@startuml
title 2.2.0. DFSP2 sends a Fulfil Reject Transfer request

autonumber


actor "DFSP1\nPayer" as DFSP1
actor "DFSP2\nPayee" as DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Fulfil-Topic" as TOPIC_FULFIL
control "Fulfil Event Handler" as FULF_HANDLER
collections "topic-transfer-position" as TOPIC_TRANSFER_POSITION
control "Position Event Handler" as POS_HANDLER
collections "Event-Topic" as TOPIC_EVENTS
collections "Notification-Topic" as TOPIC_NOTIFICATIONS

box "Financial Service Providers" #lightGray
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightBlue
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_FULFIL
    participant FULF_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant TOPIC_EVENTS
    participant POS_HANDLER
    participant TOPIC_NOTIFICATIONS
end box

activate NOTIFY_HANDLER
activate FULF_HANDLER
activate POS_HANDLER
group DFSP2 sends a Fulfil Reject Transfer request
    DFSP2 <-> DFSP2: Retrieve fulfilment string generated during\nthe quoting process or regenerate it using\n**Local secret** and **ILP Packet** as inputs
    note right of DFSP2 #lightblue
        **Note**: In the payload for PUT /transfers/<ID>
        only the **transferState** field is **required**
    end note
    note right of DFSP2 #yellow
        Headers - transferHeaders: {
            Content-Length: <Content-Length>,
            Content-Type: <Content-Type>,
            Date: <Date>,
            X-Forwarded-For: <X-Forwarded-For>,
            FSPIOP-Source: <FSPIOP-Source>,
            FSPIOP-Destination: <FSPIOP-Destination>,
            FSPIOP-Encryption: <FSPIOP-Encryption>,
            FSPIOP-Signature: <FSPIOP-Signature>,
            FSPIOP-URI: <FSPIOP-URI>,
            FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
        }

        Payload - transferMessage:
        {
            "fulfilment": <IlpFulfilment>,
            "completedTimestamp": <DateTime>,
            "transferState": "ABORTED",
            "extensionList": {
                "extension": [
                    {
                        "key": <string>,
                        "value": <string>
                    }
                ]
            }
        }
    end note
    note right of DFSP2 #lightgray
        **Note**: Payee rejection reason should be captured
        in the extensionList within the payload.
    end note
    DFSP2 ->> MLAPI: **PUT - /transfers/<ID>**
    
    activate MLAPI
    MLAPI -> MLAPI: Validate incoming token and originator matching Payee
    note right of MLAPI #yellow
        Message:
        {
            id: <ID>,
            from: <transferHeaders.FSPIOP-Source>,
            to: <transferHeaders.FSPIOP-Destination>,
            type: application/json,
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    type: fulfil,
                    action: reject,
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
    end note
    MLAPI -> TOPIC_FULFIL: Route & Publish Fulfil event for Payee
    activate TOPIC_FULFIL
    TOPIC_FULFIL <-> TOPIC_FULFIL: Ensure event is replicated as configured (ACKS=all)
    TOPIC_FULFIL - -> MLAPI: Respond replication acknowledgements have been received
    deactivate TOPIC_FULFIL
    MLAPI - ->> DFSP2: Respond HTTP - 200 (OK)
    deactivate MLAPI
    TOPIC_FULFIL <- FULF_HANDLER: Consume message
    ref over TOPIC_FULFIL, TOPIC_EVENTS: Fulfil Handler Consume (Reject/Abort) {[[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-reject-2.2.1.svg 2.2.1]]} \n
    FULF_HANDLER -> TOPIC_TRANSFER_POSITION: Produce message
    |||
    TOPIC_TRANSFER_POSITION <- POS_HANDLER: Consume message
    ref over TOPIC_TRANSFER_POSITION, TOPIC_NOTIFICATIONS: Position Handler Consume (Reject) {[[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-position-1.3.3-abort.svg 1.3.3]]} \n
    POS_HANDLER -> TOPIC_NOTIFICATIONS: Produce message
    |||
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: Consume message
    opt action == 'reject'
        |||
        ref over DFSP1, TOPIC_NOTIFICATIONS: Send notification to Participant (Payer) {[[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.4.a.svg 1.1.4.a]]} \n
        NOTIFY_HANDLER -> DFSP1: Send callback notification
    end
    |||
end
activate POS_HANDLER
activate FULF_HANDLER
activate NOTIFY_HANDLER
@enduml

PlantUML version 1.2018.02(Fri Mar 09 17:20:44 GMT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_212-b04
Operating System: Linux
OS Version: 4.15.0-1035-aws
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>