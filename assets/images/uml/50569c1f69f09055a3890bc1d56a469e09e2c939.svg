<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2127px" preserveAspectRatio="none" style="width:1991px;height:2127px;" version="1.1" viewBox="0 0 1991 2127" width="1991px" zoomAndPan="magnify"><defs><filter height="300%" id="f19nc3y82hjq25" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="351" x="821" y="22.9951">2.1.0. DFSP2 sends a Fulfil Success Transfer request</text><rect fill="#D3D3D3" height="2082.6094" style="stroke: #A80036; stroke-width: 1.0;" width="178" x="4" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="172" x="7" y="46.3638">Financial Service Providers</text><rect fill="#ADD8E6" height="2082.6094" style="stroke: #A80036; stroke-width: 1.0;" width="526.5" x="369.5" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="558.25" y="46.3638">ML API Adapter Service</text><rect fill="#FFFFE0" height="2082.6094" style="stroke: #A80036; stroke-width: 1.0;" width="1066" x="898" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="1382" y="46.3638">Central Service</text><rect fill="#FFFFFF" filter="url(#f19nc3y82hjq25)" height="589.1172" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="421" y="713.2734"/><rect fill="#FFFFFF" filter="url(#f19nc3y82hjq25)" height="1841.2891" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="776" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f19nc3y82hjq25)" height="86.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="1186.8594"/><rect fill="#FFFFFF" filter="url(#f19nc3y82hjq25)" height="1841.2891" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1409" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f19nc3y82hjq25)" height="1841.2891" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1734.5" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f19nc3y82hjq25)" height="1827.2891" style="stroke: #000000; stroke-width: 2.0;" width="1958" x="22" y="170.0234"/><rect fill="#FFFFFF" filter="url(#f19nc3y82hjq25)" height="131.6641" style="stroke: #000000; stroke-width: 2.0;" width="1938" x="32" y="1633.8516"/><rect fill="#FFFFFF" filter="url(#f19nc3y82hjq25)" height="131.6641" style="stroke: #000000; stroke-width: 2.0;" width="1882" x="88" y="1833.6484"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="65" x2="65" y1="153.0234" y2="2014.3125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="121" x2="121" y1="153.0234" y2="2014.3125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="425.5" x2="425.5" y1="153.0234" y2="2014.3125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="781" x2="781" y1="153.0234" y2="2014.3125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="965" x2="965" y1="153.0234" y2="2014.3125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1085" x2="1085" y1="153.0234" y2="2014.3125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1414" x2="1414" y1="153.0234" y2="2014.3125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1571" x2="1571" y1="153.0234" y2="2014.3125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1739" x2="1739" y1="153.0234" y2="2014.3125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1892" x2="1892" y1="153.0234" y2="2014.3125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="42" y="133.4248">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="44.5" y="149.7217">Payer</text><ellipse cx="65" cy="63.4297" fill="#FEFECE" filter="url(#f19nc3y82hjq25)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M65,71.4297 L65,98.4297 M52,79.4297 L78,79.4297 M65,98.4297 L52,113.4297 M65,98.4297 L78,113.4297 " fill="none" filter="url(#f19nc3y82hjq25)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="42" y="2026.3076">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="44.5" y="2042.6045">Payer</text><ellipse cx="65" cy="2055.9063" fill="#FEFECE" filter="url(#f19nc3y82hjq25)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M65,2063.9063 L65,2090.9063 M52,2071.9063 L78,2071.9063 M65,2090.9063 L52,2105.9063 M65,2090.9063 L78,2105.9063 " fill="none" filter="url(#f19nc3y82hjq25)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="98" y="133.4248">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="99" y="149.7217">Payee</text><ellipse cx="121" cy="63.4297" fill="#FEFECE" filter="url(#f19nc3y82hjq25)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M121,71.4297 L121,98.4297 M108,79.4297 L134,79.4297 M121,98.4297 L108,113.4297 M121,98.4297 L134,113.4297 " fill="none" filter="url(#f19nc3y82hjq25)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="98" y="2026.3076">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="99" y="2042.6045">Payee</text><ellipse cx="121" cy="2055.9063" fill="#FEFECE" filter="url(#f19nc3y82hjq25)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M121,2063.9063 L121,2090.9063 M108,2071.9063 L134,2071.9063 M121,2090.9063 L108,2105.9063 M121,2090.9063 L134,2105.9063 " fill="none" filter="url(#f19nc3y82hjq25)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="373.5" y="149.7217">ML API Adapter</text><path d="M405.5,108.7266 L405.5,132.7266 M405.5,120.7266 L422.5,120.7266 " fill="none" filter="url(#f19nc3y82hjq25)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="434.5" cy="120.7266" fill="#FEFECE" filter="url(#f19nc3y82hjq25)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="373.5" y="2026.3076">ML API Adapter</text><path d="M405.5,2033.6094 L405.5,2057.6094 M405.5,2045.6094 L422.5,2045.6094 " fill="none" filter="url(#f19nc3y82hjq25)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="434.5" cy="2045.6094" fill="#FEFECE" filter="url(#f19nc3y82hjq25)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="216" x="670" y="149.7217">ML API Notification Event Handler</text><ellipse cx="781" cy="120.7266" fill="#FEFECE" filter="url(#f19nc3y82hjq25)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="777,108.7266,783,103.7266,781,108.7266,783,113.7266,777,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="216" x="670" y="2026.3076">ML API Notification Event Handler</text><ellipse cx="781" cy="2045.6094" fill="#FEFECE" filter="url(#f19nc3y82hjq25)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="777,2033.6094,783,2028.6094,781,2033.6094,783,2038.6094,777,2033.6094" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="902" y="149.7217">Central Service API</text><path d="M945,108.7266 L945,132.7266 M945,120.7266 L962,120.7266 " fill="none" filter="url(#f19nc3y82hjq25)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="974" cy="120.7266" fill="#FEFECE" filter="url(#f19nc3y82hjq25)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="902" y="2026.3076">Central Service API</text><path d="M945,2033.6094 L945,2057.6094 M945,2045.6094 L962,2045.6094 " fill="none" filter="url(#f19nc3y82hjq25)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="974" cy="2045.6094" fill="#FEFECE" filter="url(#f19nc3y82hjq25)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f19nc3y82hjq25)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="1043" y="113.7266"/><rect fill="#FEFECE" filter="url(#f19nc3y82hjq25)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="1039" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="1046" y="137.7217">Fulfil-Topic</text><rect fill="#FEFECE" filter="url(#f19nc3y82hjq25)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="1043" y="2013.3125"/><rect fill="#FEFECE" filter="url(#f19nc3y82hjq25)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="1039" y="2017.3125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="1046" y="2037.3076">Fulfil-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="124" x="1349" y="149.7217">Fulfil Event Handler</text><ellipse cx="1414" cy="120.7266" fill="#FEFECE" filter="url(#f19nc3y82hjq25)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1410,108.7266,1416,103.7266,1414,108.7266,1416,113.7266,1410,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="124" x="1349" y="2026.3076">Fulfil Event Handler</text><ellipse cx="1414" cy="2045.6094" fill="#FEFECE" filter="url(#f19nc3y82hjq25)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1410,2033.6094,1416,2028.6094,1414,2033.6094,1416,2038.6094,1410,2033.6094" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f19nc3y82hjq25)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="1493" y="113.7266"/><rect fill="#FEFECE" filter="url(#f19nc3y82hjq25)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="1489" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="1496" y="137.7217">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#f19nc3y82hjq25)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="1493" y="2013.3125"/><rect fill="#FEFECE" filter="url(#f19nc3y82hjq25)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="1489" y="2017.3125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="1496" y="2037.3076">topic-transfer-position</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="145" x="1664" y="149.7217">Position Event Handler</text><ellipse cx="1739.5" cy="120.7266" fill="#FEFECE" filter="url(#f19nc3y82hjq25)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1735.5,108.7266,1741.5,103.7266,1739.5,108.7266,1741.5,113.7266,1735.5,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="145" x="1664" y="2026.3076">Position Event Handler</text><ellipse cx="1739.5" cy="2045.6094" fill="#FEFECE" filter="url(#f19nc3y82hjq25)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1735.5,2033.6094,1741.5,2028.6094,1739.5,2033.6094,1741.5,2038.6094,1735.5,2033.6094" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f19nc3y82hjq25)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1829" y="113.7266"/><rect fill="#FEFECE" filter="url(#f19nc3y82hjq25)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1825" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1832" y="137.7217">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f19nc3y82hjq25)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1829" y="2013.3125"/><rect fill="#FEFECE" filter="url(#f19nc3y82hjq25)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1825" y="2017.3125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1832" y="2037.3076">Notification-Topic</text><rect fill="#FFFFFF" filter="url(#f19nc3y82hjq25)" height="589.1172" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="421" y="713.2734"/><rect fill="#FFFFFF" filter="url(#f19nc3y82hjq25)" height="1841.2891" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="776" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f19nc3y82hjq25)" height="86.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1080" y="1186.8594"/><rect fill="#FFFFFF" filter="url(#f19nc3y82hjq25)" height="1841.2891" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1409" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f19nc3y82hjq25)" height="1841.2891" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1734.5" y="163.0234"/><path d="M22,170.0234 L351,170.0234 L351,177.0234 L341,187.0234 L22,187.0234 L22,170.0234 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1827.2891" style="stroke: #000000; stroke-width: 2.0;" width="1958" x="22" y="170.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="284" x="37" y="183.0903">DFSP2 sends a Fulfil Success Transfer request</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="121" x2="163" y1="238.5547" y2="238.5547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="163" x2="163" y1="238.5547" y2="251.5547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="122" x2="163" y1="251.5547" y2="251.5547"/><polygon fill="#A80036" points="132,247.5547,122,251.5547,132,255.5547,128,251.5547" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="128" y="218.356">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="139" y="203.2231">Retrieve fulfilment string generated during</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="139" y="218.356">the quoting process or regenerate it using</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="78" x="139" y="233.4888">Local secret</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="220" y="233.4888">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="69" x="246" y="233.4888">ILP Packet</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="318" y="233.4888">as inputs</text><path d="M126,264.5547 L126,682.5547 L431,682.5547 L431,274.5547 L421,264.5547 L126,264.5547 " fill="#FFFF00" filter="url(#f19nc3y82hjq25)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M421,264.5547 L421,274.5547 L431,274.5547 L421,264.5547 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="132" y="281.6216">Headers - transferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="144" y="296.7544">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="144" y="311.8872">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="144" y="327.02">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="144" y="342.1528">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="144" y="357.2856">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="144" y="372.4185">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="144" y="387.5513">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="144" y="402.6841">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="144" y="417.8169">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="144" y="432.9497">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="132" y="448.0825">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="135" y="463.2153"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="132" y="478.3481">Payload - transferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="132" y="493.481">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="144" y="508.6138">"fulfilment": &lt;IlpFulfilment&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="144" y="523.7466">"completedTimestamp": &lt;DateTime&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="144" y="538.8794">"transferState": "COMMITTED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="144" y="554.0122">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="156" y="569.145">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="168" y="584.2778">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="180" y="599.4106">"key": &lt;string&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="180" y="614.5435">"value": &lt;string&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="168" y="629.6763">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="156" y="644.8091">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="144" y="659.9419">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="132" y="675.0747">}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="419" x2="409" y1="713.2734" y2="709.2734"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="419" x2="409" y1="713.2734" y2="717.2734"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="121" x2="420" y1="713.2734" y2="713.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="128" y="708.2075">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="139" y="708.2075">PUT - /transfers/&lt;ID&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="431" x2="473" y1="757.5391" y2="757.5391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="473" x2="473" y1="757.5391" y2="770.5391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="473" y1="770.5391" y2="770.5391"/><polygon fill="#A80036" points="442,766.5391,432,770.5391,442,774.5391,438,770.5391" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="438" y="744.9067">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="320" x="449" y="737.3403">Validate incoming token and originator matching Payee</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="449" y="752.4731">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="529" y="752.4731">3000-3002, 3100-3107</text><path d="M436,783.5391 L436,1141.5391 L715,1141.5391 L715,793.5391 L705,783.5391 L436,783.5391 " fill="#FFFF00" filter="url(#f19nc3y82hjq25)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M705,783.5391 L705,793.5391 L715,793.5391 L705,783.5391 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="442" y="800.606">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="442" y="815.7388">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="454" y="830.8716">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="454" y="846.0044">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="454" y="861.1372">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="454" y="876.27">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="454" y="891.4028">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="466" y="906.5356">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="466" y="921.6685">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="454" y="936.8013">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="454" y="951.9341">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="466" y="967.0669">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="478" y="982.1997">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="478" y="997.3325">type: fulfil,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="478" y="1012.4653">action: commit,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="478" y="1027.5981">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="478" y="1042.731">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="490" y="1057.8638">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="490" y="1072.9966">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="478" y="1088.1294">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="466" y="1103.2622">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="454" y="1118.395">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="442" y="1133.5278">}</text><polygon fill="#A80036" points="1068,1182.8594,1078,1186.8594,1068,1190.8594,1072,1186.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="431" x2="1074" y1="1186.8594" y2="1186.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="438" y="1174.2271">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="449" y="1166.6606">Route &amp; Publish Fulfil event for Payee</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="449" y="1181.7935">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="523" y="1181.7935">2003</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1090" x2="1132" y1="1231.125" y2="1231.125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1132" x2="1132" y1="1231.125" y2="1244.125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1091" x2="1132" y1="1244.125" y2="1244.125"/><polygon fill="#A80036" points="1101,1240.125,1091,1244.125,1101,1248.125,1097,1244.125" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="1097" y="1218.4927">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="294" x="1108" y="1210.9263">Ensure event is replicated as configured (ACKS=all)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="1108" y="1226.0591">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="1182" y="1226.0591">2003</text><polygon fill="#A80036" points="442,1269.2578,432,1273.2578,442,1277.2578,438,1273.2578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="436" x2="1084" y1="1273.2578" y2="1273.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="448" y="1268.1919">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="350" x="459" y="1268.1919">Respond replication acknowledgements have been received</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="121" x2="131" y1="1302.3906" y2="1298.3906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="121" x2="131" y1="1302.3906" y2="1306.3906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="121" x2="425" y1="1302.3906" y2="1302.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="138" y="1297.3247">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="149" y="1297.3247">Respond HTTP - 200 (OK)</text><polygon fill="#A80036" points="1096,1327.5234,1086,1331.5234,1096,1335.5234,1092,1331.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1090" x2="1408" y1="1331.5234" y2="1331.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="1102" y="1326.4575">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="1113" y="1326.4575">Consume message</text><rect fill="#FFFFFF" filter="url(#f19nc3y82hjq25)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="617" x="1036" y="1339.5234"/><polygon fill="#EEEEEE" points="1036,1339.5234,1100,1339.5234,1100,1346.5234,1090,1356.5234,1036,1356.5234,1036,1339.5234" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1049" y="1353.5903">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="1228.5" y="1372.5903">Fulfil Handler Consume (Success) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/documentation/tree/master/mojaloop-technical-overview/central-ledger/assets/diagrams/sequence/seq-fulfil-2.1.1.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/documentation/tree/master/mojaloop-technical-overview/central-ledger/assets/diagrams/sequence/seq-fulfil-2.1.1.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="27" x="1429.5" y="1372.5903">2.1.1</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1429.5" x2="1456.5" y1="1374.5903" y2="1374.5903"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1456.5" y="1372.5903">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1231.5" y="1387.7231"/><polygon fill="#A80036" points="1559.5,1417.0547,1569.5,1421.0547,1559.5,1425.0547,1563.5,1421.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1419" x2="1565.5" y1="1421.0547" y2="1421.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="1426" y="1415.9888">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="1437" y="1415.9888">Produce message</text><polygon fill="#A80036" points="1582.5,1471.1875,1572.5,1475.1875,1582.5,1479.1875,1578.5,1475.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1576.5" x2="1733.5" y1="1475.1875" y2="1475.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1588.5" y="1470.1216">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="1606.5" y="1470.1216">Consume message</text><rect fill="#FFFFFF" filter="url(#f19nc3y82hjq25)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="473" x="1486" y="1483.1875"/><polygon fill="#EEEEEE" points="1486,1483.1875,1550,1483.1875,1550,1490.1875,1540,1500.1875,1486,1500.1875,1486,1483.1875" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1499" y="1497.2544">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="1596.5" y="1516.2544">Position Handler Consume (Success) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-position-1.3.2-fulfil.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-position-1.3.2-fulfil.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="27" x="1817.5" y="1516.2544">1.3.2</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1817.5" x2="1844.5" y1="1518.2544" y2="1518.2544"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1844.5" y="1516.2544">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1599.5" y="1531.3872"/><polygon fill="#A80036" points="1880.5,1560.7188,1890.5,1564.7188,1880.5,1568.7188,1884.5,1564.7188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1744.5" x2="1886.5" y1="1564.7188" y2="1564.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1751.5" y="1559.6528">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="1769.5" y="1559.6528">Produce message</text><polygon fill="#A80036" points="1880.5,1614.8516,1890.5,1618.8516,1880.5,1622.8516,1884.5,1618.8516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="786" x2="1886.5" y1="1618.8516" y2="1618.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="793" y="1613.7856">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="811" y="1613.7856">Consume message</text><path d="M32,1633.8516 L99,1633.8516 L99,1640.8516 L89,1650.8516 L32,1650.8516 L32,1633.8516 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="131.6641" style="stroke: #000000; stroke-width: 2.0;" width="1938" x="32" y="1633.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="47" y="1646.9185">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="107" x="114" y="1646.062">[action == 'commit']</text><rect fill="#FFFFFF" filter="url(#f19nc3y82hjq25)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="1920" x="39" y="1675.9844"/><polygon fill="#EEEEEE" points="39,1675.9844,103,1675.9844,103,1682.9844,93,1692.9844,39,1692.9844,39,1675.9844" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="52" y="1690.0513">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="863.5" y="1709.0513">Send notification to Participant (Payer) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.4.a.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.4.a.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="37" x="1093.5" y="1709.0513">1.1.4.a</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1093.5" x2="1130.5" y1="1711.0513" y2="1711.0513"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1130.5" y="1709.0513">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="866.5" y="1724.1841"/><polygon fill="#A80036" points="76,1753.5156,66,1757.5156,76,1761.5156,72,1757.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="70" x2="775" y1="1757.5156" y2="1757.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="82" y="1752.4497">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="100" y="1752.4497">Send callback notification</text><polygon fill="#A80036" points="1880.5,1814.6484,1890.5,1818.6484,1880.5,1822.6484,1884.5,1818.6484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="786" x2="1886.5" y1="1818.6484" y2="1818.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="793" y="1813.5825">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="811" y="1813.5825">Consume message</text><path d="M88,1833.6484 L155,1833.6484 L155,1840.6484 L145,1850.6484 L88,1850.6484 L88,1833.6484 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="131.6641" style="stroke: #000000; stroke-width: 2.0;" width="1882" x="88" y="1833.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="103" y="1846.7153">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="107" x="170" y="1845.8589">[action == 'commit']</text><rect fill="#FFFFFF" filter="url(#f19nc3y82hjq25)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="1864" x="95" y="1875.7813"/><polygon fill="#EEEEEE" points="95,1875.7813,159,1875.7813,159,1882.7813,149,1892.7813,95,1892.7813,95,1875.7813" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="108" y="1889.8481">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="890.5" y="1908.8481">Send notification to Participant (Payee) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.4.a.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.4.a.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="37" x="1122.5" y="1908.8481">1.1.4.a</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1122.5" x2="1159.5" y1="1910.8481" y2="1910.8481"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1159.5" y="1908.8481">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="893.5" y="1923.981"/><polygon fill="#A80036" points="132,1953.3125,122,1957.3125,132,1961.3125,128,1957.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="126" x2="775" y1="1957.3125" y2="1957.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="138" y="1952.2466">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="156" y="1952.2466">Send callback notification</text><!--
@startuml
title 2.1.0. DFSP2 sends a Fulfil Success Transfer request

autonumber

actor "DFSP1\nPayer" as DFSP1
actor "DFSP2\nPayee" as DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Fulfil-Topic" as TOPIC_FULFIL
control "Fulfil Event Handler" as FULF_HANDLER
collections "topic-transfer-position" as TOPIC_TRANSFER_POSITION
control "Position Event Handler" as POS_HANDLER
collections "Notification-Topic" as TOPIC_NOTIFICATIONS

box "Financial Service Providers" #lightGray
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightBlue
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
	participant TOPIC_FULFIL
    participant FULF_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant POS_HANDLER
    participant TOPIC_NOTIFICATIONS
end box

activate NOTIFY_HANDLER
activate FULF_HANDLER
activate POS_HANDLER
group DFSP2 sends a Fulfil Success Transfer request
    DFSP2 <-> DFSP2: Retrieve fulfilment string generated during\nthe quoting process or regenerate it using\n**Local secret** and **ILP Packet** as inputs
    note right of DFSP2 #yellow
        Headers - transferHeaders: {
            Content-Length: <Content-Length>,
            Content-Type: <Content-Type>,
            Date: <Date>,
            X-Forwarded-For: <X-Forwarded-For>,
            FSPIOP-Source: <FSPIOP-Source>,
            FSPIOP-Destination: <FSPIOP-Destination>,
            FSPIOP-Encryption: <FSPIOP-Encryption>,
            FSPIOP-Signature: <FSPIOP-Signature>,
            FSPIOP-URI: <FSPIOP-URI>,
            FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
        }

        Payload - transferMessage:
        {
            "fulfilment": <IlpFulfilment>,
            "completedTimestamp": <DateTime>,
            "transferState": "COMMITTED",
            "extensionList": {
                "extension": [
                    {
                        "key": <string>,
                        "value": <string>
                    }
                ]
            }
        }
    end note
    DFSP2 ->> MLAPI: PUT - /transfers/<ID>
    activate MLAPI
    MLAPI -> MLAPI: Validate incoming token and originator matching Payee\n<color #FF0000><b>Error codes:</b> 3000-3002, 3100-3107</color>
    note right of MLAPI #yellow
        Message:
        {
            id: <ID>,
            from: <transferHeaders.FSPIOP-Source>,
            to: <transferHeaders.FSPIOP-Destination>,
            type: application/json,
            content: {
                headers: <transferHeaders>,
                payload: <transferMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    type: fulfil,
                    action: commit,
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
    end note
    MLAPI -> TOPIC_FULFIL: Route & Publish Fulfil event for Payee\n<color #FF0000><b>Error code:</b> 2003</color>
    activate TOPIC_FULFIL
    TOPIC_FULFIL <-> TOPIC_FULFIL: Ensure event is replicated as configured (ACKS=all)\n<color #FF0000><b>Error code:</b> 2003</color>
    TOPIC_FULFIL - -> MLAPI: Respond replication acknowledgements have been received
    deactivate TOPIC_FULFIL
    MLAPI - ->> DFSP2: Respond HTTP - 200 (OK)
    deactivate MLAPI
    TOPIC_FULFIL <- FULF_HANDLER: Consume message
    ref over TOPIC_FULFIL, TOPIC_TRANSFER_POSITION: Fulfil Handler Consume (Success) {[[https://github.com/mojaloop/documentation/tree/master/mojaloop-technical-overview/central-ledger/assets/diagrams/sequence/seq-fulfil-2.1.1.svg 2.1.1]]} \n
    FULF_HANDLER -> TOPIC_TRANSFER_POSITION: Produce message
    |||
    TOPIC_TRANSFER_POSITION <- POS_HANDLER: Consume message
    ref over TOPIC_TRANSFER_POSITION, TOPIC_NOTIFICATIONS:  Position Handler Consume (Success) {[[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-position-1.3.2-fulfil.svg 1.3.2]]} \n
    POS_HANDLER -> TOPIC_NOTIFICATIONS: Produce message
    |||
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: Consume message
    opt action == 'commit'
        |||
        ref over DFSP1, TOPIC_NOTIFICATIONS: Send notification to Participant (Payer) {[[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.4.a.svg 1.1.4.a]]} \n
        NOTIFY_HANDLER -> DFSP1: Send callback notification
    end
    |||
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: Consume message
    opt action == 'commit'
        |||
        ref over DFSP2, TOPIC_NOTIFICATIONS: Send notification to Participant (Payee) {[[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.4.a.svg 1.1.4.a]]} \n
        NOTIFY_HANDLER -> DFSP2: Send callback notification
    end
    |||
end
deactivate POS_HANDLER
deactivate FULF_HANDLER
deactivate NOTIFY_HANDLER
@enduml

PlantUML version 1.2018.02(Fri Mar 09 17:20:44 GMT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_212-b04
Operating System: Linux
OS Version: 4.15.0-1035-aws
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>