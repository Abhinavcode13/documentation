<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1774px" preserveAspectRatio="none" style="width:1468px;height:1774px;" version="1.1" viewBox="0 0 1468 1774" width="1468px" zoomAndPan="magnify"><defs><filter height="300%" id="f1tman0sjzrqx0" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="494" x="487.5" y="22.9951">1.1.5. Request transfer status (getTransferStatusById) - Phase2 version</text><rect fill="#D3D3D3" height="1728.9063" style="stroke: #A80036; stroke-width: 1.0;" width="172" x="4" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="166" x="7" y="46.3638">Financial Service Provider</text><rect fill="#ADD8E6" height="1728.9063" style="stroke: #A80036; stroke-width: 1.0;" width="230" x="398" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="438.5" y="46.3638">ML API Adapter Service</text><rect fill="#FFFFE0" height="1728.9063" style="stroke: #A80036; stroke-width: 1.0;" width="572.5" x="778.5" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="1015.75" y="46.3638">Central Service</text><rect fill="#FFFFFF" filter="url(#f1tman0sjzrqx0)" height="1480.5859" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="85" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f1tman0sjzrqx0)" height="197.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="841" y="286.5547"/><rect fill="#FFFFFF" filter="url(#f1tman0sjzrqx0)" height="255.3281" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="841" y="564.75"/><rect fill="#FFFFFF" filter="url(#f1tman0sjzrqx0)" height="168.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1036" y="286.5547"/><rect fill="#FFFFFF" filter="url(#f1tman0sjzrqx0)" height="166.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1140" y="609.0156"/><rect fill="#FFFFFF" filter="url(#f1tman0sjzrqx0)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1298" y="638.1484"/><rect fill="#FFFFFF" filter="url(#f1tman0sjzrqx0)" height="1473.5859" style="stroke: #000000; stroke-width: 2.0;" width="1433" x="23" y="170.0234"/><rect fill="#FFFFFF" filter="url(#f1tman0sjzrqx0)" height="244.0625" style="stroke: #000000; stroke-width: 2.0;" width="707" x="392" y="248.2891"/><rect fill="#FFFFFF" filter="url(#f1tman0sjzrqx0)" height="801.5313" style="stroke: #000000; stroke-width: 2.0;" width="620" x="33" y="835.0781"/><rect fill="#FFFFFF" filter="url(#f1tman0sjzrqx0)" height="572.5313" style="stroke: #000000; stroke-width: 2.0;" width="591" x="43" y="859.2109"/><rect fill="#FFFFFF" height="264.6641" style="stroke: none; stroke-width: 1.0;" width="591" x="43" y="1167.0781"/><rect fill="#FFFFFF" height="158.7344" style="stroke: none; stroke-width: 1.0;" width="620" x="33" y="1477.875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="90" x2="90" y1="153.0234" y2="1660.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="513" x2="513" y1="153.0234" y2="1660.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="845.5" x2="845.5" y1="153.0234" y2="1660.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1041" x2="1041" y1="153.0234" y2="1660.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1145" x2="1145" y1="153.0234" y2="1660.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1303" x2="1303" y1="153.0234" y2="1660.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="63" y="133.4248">DFSP(n)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="53" y="149.7217">Participant</text><ellipse cx="90" cy="63.4297" fill="#FEFECE" filter="url(#f1tman0sjzrqx0)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M90,71.4297 L90,98.4297 M77,79.4297 L103,79.4297 M90,98.4297 L77,113.4297 M90,98.4297 L103,113.4297 " fill="none" filter="url(#f1tman0sjzrqx0)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="63" y="1672.6045">DFSP(n)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="53" y="1688.9014">Participant</text><ellipse cx="90" cy="1702.2031" fill="#FEFECE" filter="url(#f1tman0sjzrqx0)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M90,1710.2031 L90,1737.2031 M77,1718.2031 L103,1718.2031 M90,1737.2031 L77,1752.2031 M90,1737.2031 L103,1752.2031 " fill="none" filter="url(#f1tman0sjzrqx0)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="216" x="402" y="149.7217">ML API Notification Event Handler</text><ellipse cx="513" cy="120.7266" fill="#FEFECE" filter="url(#f1tman0sjzrqx0)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="509,108.7266,515,103.7266,513,108.7266,515,113.7266,509,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="216" x="402" y="1672.6045">ML API Notification Event Handler</text><ellipse cx="513" cy="1691.9063" fill="#FEFECE" filter="url(#f1tman0sjzrqx0)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="509,1679.9063,515,1674.9063,513,1679.9063,515,1684.9063,509,1679.9063" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="782.5" y="149.7217">Central Service API</text><path d="M825.5,108.7266 L825.5,132.7266 M825.5,120.7266 L842.5,120.7266 " fill="none" filter="url(#f1tman0sjzrqx0)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="854.5" cy="120.7266" fill="#FEFECE" filter="url(#f1tman0sjzrqx0)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="782.5" y="1672.6045">Central Service API</text><path d="M825.5,1679.9063 L825.5,1703.9063 M825.5,1691.9063 L842.5,1691.9063 " fill="none" filter="url(#f1tman0sjzrqx0)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="854.5" cy="1691.9063" fill="#FEFECE" filter="url(#f1tman0sjzrqx0)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1tman0sjzrqx0)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="997" y="113.7266"/><rect fill="#FEFECE" filter="url(#f1tman0sjzrqx0)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="993" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="1000" y="137.7217">Event-Topic</text><rect fill="#FEFECE" filter="url(#f1tman0sjzrqx0)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="997" y="1659.6094"/><rect fill="#FEFECE" filter="url(#f1tman0sjzrqx0)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="993" y="1663.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="1000" y="1683.6045">Event-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="1099" y="149.7217">Transfer-DAO</text><ellipse cx="1145" cy="120.7266" fill="#FEFECE" filter="url(#f1tman0sjzrqx0)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1133" x2="1157" y1="134.7266" y2="134.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="1099" y="1672.6045">Transfer-DAO</text><ellipse cx="1145" cy="1691.9063" fill="#FEFECE" filter="url(#f1tman0sjzrqx0)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1133" x2="1157" y1="1705.9063" y2="1705.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1259" y="149.7217">Central Store</text><path d="M1285,100.7266 C1285,90.7266 1303,90.7266 1303,90.7266 C1303,90.7266 1321,90.7266 1321,100.7266 L1321,126.7266 C1321,136.7266 1303,136.7266 1303,136.7266 C1303,136.7266 1285,136.7266 1285,126.7266 L1285,100.7266 " fill="#FEFECE" filter="url(#f1tman0sjzrqx0)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1285,100.7266 C1285,110.7266 1303,110.7266 1303,110.7266 C1303,110.7266 1321,110.7266 1321,100.7266 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1259" y="1672.6045">Central Store</text><path d="M1285,1685.9063 C1285,1675.9063 1303,1675.9063 1303,1675.9063 C1303,1675.9063 1321,1675.9063 1321,1685.9063 L1321,1711.9063 C1321,1721.9063 1303,1721.9063 1303,1721.9063 C1303,1721.9063 1285,1721.9063 1285,1711.9063 L1285,1685.9063 " fill="#FEFECE" filter="url(#f1tman0sjzrqx0)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1285,1685.9063 C1285,1695.9063 1303,1695.9063 1303,1695.9063 C1303,1695.9063 1321,1695.9063 1321,1685.9063 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1tman0sjzrqx0)" height="1480.5859" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="85" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f1tman0sjzrqx0)" height="197.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="841" y="286.5547"/><rect fill="#FFFFFF" filter="url(#f1tman0sjzrqx0)" height="255.3281" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="841" y="564.75"/><rect fill="#FFFFFF" filter="url(#f1tman0sjzrqx0)" height="168.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1036" y="286.5547"/><rect fill="#FFFFFF" filter="url(#f1tman0sjzrqx0)" height="166.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1140" y="609.0156"/><rect fill="#FFFFFF" filter="url(#f1tman0sjzrqx0)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1298" y="638.1484"/><path d="M23,170.0234 L219,170.0234 L219,177.0234 L209,187.0234 L23,187.0234 L23,170.0234 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1473.5859" style="stroke: #000000; stroke-width: 2.0;" width="1433" x="23" y="170.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="151" x="38" y="183.0903">Request transfer status</text><polygon fill="#A80036" points="501,204.2891,511,208.2891,501,212.2891,505,208.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="95" x2="507" y1="208.2891" y2="208.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="102" y="203.2231">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="338" x="113" y="203.2231">Callback transfer status request URL - GET - /transfers/{ID}</text><path d="M392,248.2891 L602,248.2891 L602,255.2891 L592,265.2891 L392,265.2891 L392,248.2891 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="244.0625" style="stroke: #000000; stroke-width: 2.0;" width="707" x="392" y="248.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="165" x="407" y="261.356">Persist Event Information</text><polygon fill="#A80036" points="829,282.5547,839,286.5547,829,290.5547,833,286.5547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="513" x2="835" y1="286.5547" y2="286.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="520" y="281.4888">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="298" x="531" y="281.4888">Request transfer information - GET - /transfers/{ID}</text><polygon fill="#A80036" points="1024,311.6875,1034,315.6875,1024,319.6875,1028,315.6875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="851" x2="1030" y1="315.6875" y2="315.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="858" y="310.6216">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="869" y="310.6216">Publish event information</text><rect fill="#FFFFFF" filter="url(#f1tman0sjzrqx0)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="192" x="990" y="348.6875"/><polygon fill="#EEEEEE" points="990,348.6875,1054,348.6875,1054,355.6875,1044,365.6875,990,365.6875,990,348.6875" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1003" y="362.7544">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="996" y="381.7544">Event Handler Consume {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-event-9.1.0.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-event-9.1.0.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="27" x="1145" y="381.7544">9.1.0</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1145" x2="1172" y1="383.7544" y2="383.7544"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1172" y="381.7544">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="999" y="396.8872"/><polygon fill="#A80036" points="862,451.2188,852,455.2188,862,459.2188,858,455.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="856" x2="1040" y1="455.2188" y2="455.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="868" y="450.1528">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="879" y="450.1528">Return success</text><polygon fill="#A80036" points="524,480.3516,514,484.3516,524,488.3516,520,484.3516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="518" x2="845" y1="484.3516" y2="484.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="530" y="479.2856">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="541" y="479.2856">Return success</text><polygon fill="#A80036" points="106,516.4844,96,520.4844,106,524.4844,102,520.4844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="100" x2="512" y1="520.4844" y2="520.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="112" y="515.4185">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="123" y="515.4185">Respond HTTP - 200 (OK)</text><polygon fill="#A80036" points="829,560.75,839,564.75,829,568.75,833,564.75" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="513" x2="835" y1="564.75" y2="564.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="520" y="552.1177">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="290" x="531" y="544.5513">Request details for Transfer - GET - /transfers/{ID}</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="531" y="559.6841">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="605" y="559.6841">2003</text><polygon fill="#A80036" points="1128,605.0156,1138,609.0156,1128,613.0156,1132,609.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="851" x2="1134" y1="609.0156" y2="609.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="858" y="596.3833">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="869" y="588.8169">Request transfer status</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="869" y="603.9497">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="943" y="603.9497">2003</text><polygon fill="#A80036" points="1286,634.1484,1296,638.1484,1286,642.1484,1290,638.1484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1150" x2="1292" y1="638.1484" y2="638.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="1157" y="633.0825">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1168" y="633.0825">Fetch transfer status</text><polygon fill="#FFFFE0" filter="url(#f1tman0sjzrqx0)" points="1169,681.1484,1436,681.1484,1446,715.1484,1436,749.1484,1169,749.1484,1159,715.1484,1169,681.1484" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="1171" y="697.2153">SELECT transferId, transferStateId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="1171" y="712.3481">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="135" x="1209" y="712.3481">transferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="1171" y="727.481">WHERE transferId = {ID}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="263" x="1171" y="742.6138">ORDER BY transferStateChangeId desc limit 1</text><polygon fill="#A80036" points="862,771.8125,852,775.8125,862,779.8125,858,775.8125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="856" x2="1144" y1="775.8125" y2="775.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="868" y="770.7466">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="886" y="770.7466">Return transfer status</text><polygon fill="#A80036" points="524,816.0781,514,820.0781,524,824.0781,520,820.0781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="518" x2="845" y1="820.0781" y2="820.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="530" y="807.4458">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="548" y="799.8794">Return transfer status</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="548" y="815.0122">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="628" y="815.0122">3202, 3203</text><path d="M33,835.0781 L96,835.0781 L96,842.0781 L86,852.0781 L33,852.0781 L33,835.0781 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="801.5313" style="stroke: #000000; stroke-width: 2.0;" width="620" x="33" y="835.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="48" y="848.145">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="330" x="111" y="847.2886">[Is there a transfer with the given ID recorded in the system?]</text><path d="M43,859.2109 L106,859.2109 L106,866.2109 L96,876.2109 L43,876.2109 L43,859.2109 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="572.5313" style="stroke: #000000; stroke-width: 2.0;" width="591" x="43" y="859.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="58" y="872.2778">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="202" x="121" y="871.4214">[Yes AND transferState is COMMITTED</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="431" x="121" y="884.2261">This implies that a succesful transfer with the given ID is recorded in the system]</text><path d="M78,891.9531 L78,1127.9531 L504,1127.9531 L504,901.9531 L494,891.9531 L78,891.9531 " fill="#FFFF00" filter="url(#f1tman0sjzrqx0)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M494,891.9531 L494,901.9531 L504,901.9531 L494,891.9531 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="84" y="909.02">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="393" x="96" y="924.1528">"fulfilment": "WLctttbu2HvTsa1XWvUoGRcQozHsqeu9Ahl2JW9Bsu8",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="333" x="96" y="939.2856">"completedTimestamp": "2018-09-24T08:38:08.699-04:00",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="96" y="954.4185">"transferState": "COMMITTED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="96" y="969.5513">extensionList:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="108" y="984.6841">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="108" y="999.8169">extension:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="108" y="1014.9497">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="120" y="1030.0825">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="120" y="1045.2153">"key": "Description",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="120" y="1060.3481">"value": "This is a more detailed description"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="120" y="1075.481">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="108" y="1090.6138">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="96" y="1105.7466">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="84" y="1120.8794">}</text><polygon fill="#A80036" points="106,1155.0781,96,1159.0781,106,1163.0781,102,1159.0781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="100" x2="512" y1="1159.0781" y2="1159.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="112" y="1154.0122">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="130" y="1154.0122">callback PUT on /transfers/{ID}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="43" x2="634" y1="1168.0781" y2="1168.0781"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="272" x="48" y="1178.2886">[transferState in [RECEIVED, RESERVED, ABORTED]]</text><path d="M191,1186.8828 L191,1392.8828 L504,1392.8828 L504,1196.8828 L494,1186.8828 L191,1186.8828 " fill="#FFFF00" filter="url(#f1tman0sjzrqx0)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M494,1186.8828 L494,1196.8828 L504,1196.8828 L494,1186.8828 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="197" y="1203.9497">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="209" y="1219.0825">"transferState": "RECEIVED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="209" y="1234.2153">extensionList:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="221" y="1249.3481">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="221" y="1264.481">extension:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="221" y="1279.6138">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="233" y="1294.7466">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="233" y="1309.8794">"key": "Description",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="233" y="1325.0122">"value": "This is a more detailed description"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="233" y="1340.145">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="221" y="1355.2778">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="209" y="1370.4106">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="197" y="1385.5435">}</text><polygon fill="#A80036" points="106,1419.7422,96,1423.7422,106,1427.7422,102,1423.7422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="100" x2="512" y1="1423.7422" y2="1423.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="112" y="1418.6763">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="130" y="1418.6763">callback PUT on /transfers/{ID}</text><path d="M518,1443.7422 L518,1468.7422 L639,1468.7422 L639,1453.7422 L629,1443.7422 L518,1443.7422 " fill="#D3D3D3" filter="url(#f1tman0sjzrqx0)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M629,1443.7422 L629,1453.7422 L639,1453.7422 L629,1443.7422 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="524" y="1460.8091">Log ERROR event</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="33" x2="653" y1="1478.875" y2="1478.875"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="455" x="38" y="1489.0854">[A transfer with the given ID is not present in the System or this is an invalid request]</text><path d="M201,1497.6797 L201,1597.6797 L504,1597.6797 L504,1507.6797 L494,1497.6797 L201,1497.6797 " fill="#FFFF00" filter="url(#f1tman0sjzrqx0)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M494,1497.6797 L494,1507.6797 L504,1507.6797 L494,1497.6797 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="207" y="1514.7466">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="219" y="1529.8794">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="231" y="1545.0122">"errorCode": &lt;integer&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="231" y="1560.145">"errorDescription": "Client error description"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="219" y="1575.2778">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="207" y="1590.4106">}</text><polygon fill="#A80036" points="106,1624.6094,96,1628.6094,106,1632.6094,102,1628.6094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="100" x2="512" y1="1628.6094" y2="1628.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="112" y="1623.5435">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="130" y="1623.5435">callback PUT on /transfers/{ID}/error</text><!--
@startuml
title 1.1.5. Request transfer status (getTransferStatusById) - Phase2 version

autonumber

actor "DFSP(n)\nParticipant" as DFSP
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Event-Topic" as TOPIC_EVENTS
entity "Transfer-DAO" as TRANSFER_DAO
database "Central Store" as DB

box "Financial Service Provider" #lightGray
	participant DFSP
end box

box "ML API Adapter Service" #LightBlue
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
    participant TOPIC_EVENTS
    participant TRANSFER_DAO
    participant DB
end box

group Request transfer status
    activate DFSP
    DFSP -> NOTIFY_HANDLER: Callback transfer status request URL - GET - /transfers/{ID}
    |||
    group Persist Event Information
        NOTIFY_HANDLER -> CSAPI: Request transfer information - GET - /transfers/{ID}
        activate CSAPI

        activate TOPIC_EVENTS
        CSAPI -> TOPIC_EVENTS: Publish event information
        |||
        ref over TOPIC_EVENTS :  Event Handler Consume {[[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-event-9.1.0.svg 9.1.0]]} \n
        |||
        CSAPI <- - TOPIC_EVENTS: Return success
        deactivate TOPIC_EVENTS
        CSAPI - -> NOTIFY_HANDLER: Return success
        deactivate CSAPI
    end
        DFSP <- - NOTIFY_HANDLER: Respond HTTP - 200 (OK)
    NOTIFY_HANDLER -> CSAPI: Request details for Transfer - GET - /transfers/{ID}\n<color #FF0000><b>Error code:</b> 2003</color>
    activate CSAPI
    CSAPI -> TRANSFER_DAO: Request transfer status\n<color #FF0000><b>Error code:</b> 2003</color>
    activate TRANSFER_DAO
    TRANSFER_DAO -> DB: Fetch transfer status
    activate DB
    hnote over DB #lightyellow
        SELECT transferId, transferStateId
        FROM **transferStateChange**
        WHERE transferId = {ID}
        ORDER BY transferStateChangeId desc limit 1
    end note
    deactivate DB
    CSAPI <- - TRANSFER_DAO: Return transfer status
    deactivate TRANSFER_DAO
    NOTIFY_HANDLER <- - CSAPI: Return transfer status\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
    deactivate CSAPI

    alt Is there a transfer with the given ID recorded in the system?
        alt Yes AND transferState is COMMITTED \nThis implies that a succesful transfer with the given ID is recorded in the system
            note left of NOTIFY_HANDLER #yellow
                {
                    "fulfilment": "WLctttbu2HvTsa1XWvUoGRcQozHsqeu9Ahl2JW9Bsu8",
                    "completedTimestamp": "2018-09-24T08:38:08.699-04:00",
                    "transferState": "COMMITTED",
                    extensionList:
                        {
                        extension:
                        [
                            {
                            "key": "Description",
                            "value": "This is a more detailed description"
                            }
                        ]
                    }
                }
            end note
            DFSP <- NOTIFY_HANDLER: callback PUT on /transfers/{ID}
        else transferState in [RECEIVED, RESERVED, ABORTED]
            note left of NOTIFY_HANDLER #yellow
                {
                    "transferState": "RECEIVED",
                    extensionList:
                        {
                        extension:
                        [
                            {
                            "key": "Description",
                            "value": "This is a more detailed description"
                            }
                        ]
                    }
                }
            end note
            DFSP <- NOTIFY_HANDLER: callback PUT on /transfers/{ID}
        end
        note right of NOTIFY_HANDLER #lightgray
            Log ERROR event
        end note
    else A transfer with the given ID is not present in the System or this is an invalid request
        note left of NOTIFY_HANDLER #yellow
            {
                "errorInformation": {
                    "errorCode": <integer>,
                    "errorDescription": "Client error description"
                }
            }
        end note
        DFSP <- NOTIFY_HANDLER: callback PUT on /transfers/{ID}/error
    end
    deactivate NOTIFY_HANDLER
deactivate DFSP
end
@enduml

PlantUML version 1.2018.02(Fri Mar 09 17:20:44 GMT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_212-b04
Operating System: Linux
OS Version: 4.15.0-1035-aws
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>