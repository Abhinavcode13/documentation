<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2528px" preserveAspectRatio="none" style="width:1066px;height:2528px;" version="1.1" viewBox="0 0 1066 2528" width="1066px" zoomAndPan="magnify"><defs><filter height="300%" id="fl4upgpll70vl" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="278" x="394.5" y="22.9951">6.2.2. Query Settlements by Parameters</text><rect fill="#FFB6C1" height="2482.7266" style="stroke: #A80036; stroke-width: 1.0;" width="107" x="57" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="72" y="46.3638">Central HUB</text><rect fill="#90EE90" height="2482.7266" style="stroke: #A80036; stroke-width: 1.0;" width="394" x="269" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="123" x="404.5" y="46.3638">Settlement Service</text><rect fill="#FFFFE0" height="2482.7266" style="stroke: #A80036; stroke-width: 1.0;" width="110" x="734.5" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="104" x="737.5" y="46.3638">Central Services</text><rect fill="#FFFFFF" filter="url(#fl4upgpll70vl)" height="2252" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="105.5" y="146.7266"/><rect fill="#FFFFFF" filter="url(#fl4upgpll70vl)" height="2031.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="344.5" y="367.3203"/><rect fill="#FFFFFF" filter="url(#fl4upgpll70vl)" height="619.9141" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="598.5" y="411.5859"/><rect fill="#FFFFFF" filter="url(#fl4upgpll70vl)" height="561.6484" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="784.5" y="440.7188"/><rect fill="#FFFFFF" filter="url(#fl4upgpll70vl)" height="2260" style="stroke: #000000; stroke-width: 2.0;" width="1042" x="12" y="153.7266"/><rect fill="#FFFFFF" filter="url(#fl4upgpll70vl)" height="1360.2266" style="stroke: #000000; stroke-width: 2.0;" width="818" x="22" y="1046.5"/><rect fill="#FFFFFF" filter="url(#fl4upgpll70vl)" height="510.25" style="stroke: #000000; stroke-width: 2.0;" width="481" x="349" y="1140.0313"/><rect fill="#FFFFFF" height="185.0625" style="stroke: none; stroke-width: 1.0;" width="818" x="22" y="2221.6641"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="110" x2="110" y1="136.7266" y2="2430.7266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="349" x2="349" y1="136.7266" y2="2430.7266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="603" x2="603" y1="136.7266" y2="2430.7266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="789.5" x2="789.5" y1="136.7266" y2="2430.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="61" y="133.4248">Hub Employee</text><ellipse cx="110.5" cy="63.4297" fill="#FEFECE" filter="url(#fl4upgpll70vl)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M110.5,71.4297 L110.5,98.4297 M97.5,79.4297 L123.5,79.4297 M110.5,98.4297 L97.5,113.4297 M110.5,98.4297 L123.5,113.4297 " fill="none" filter="url(#fl4upgpll70vl)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="61" y="2442.7217">Hub Employee</text><ellipse cx="110.5" cy="2456.0234" fill="#FEFECE" filter="url(#fl4upgpll70vl)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M110.5,2464.0234 L110.5,2491.0234 M97.5,2472.0234 L123.5,2472.0234 M110.5,2491.0234 L97.5,2506.0234 M110.5,2491.0234 L123.5,2506.0234 " fill="none" filter="url(#fl4upgpll70vl)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="147" x="273" y="133.4248">Settlement Service API</text><path d="M329,92.4297 L329,116.4297 M329,104.4297 L346,104.4297 " fill="none" filter="url(#fl4upgpll70vl)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="358" cy="104.4297" fill="#FEFECE" filter="url(#fl4upgpll70vl)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="147" x="273" y="2442.7217">Settlement Service API</text><path d="M329,2450.0234 L329,2474.0234 M329,2462.0234 L346,2462.0234 " fill="none" filter="url(#fl4upgpll70vl)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="358" cy="2462.0234" fill="#FEFECE" filter="url(#fl4upgpll70vl)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="548" y="133.4248">Settlement DAO</text><ellipse cx="603.5" cy="104.4297" fill="#FEFECE" filter="url(#fl4upgpll70vl)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="591.5" x2="615.5" y1="118.4297" y2="118.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="548" y="2442.7217">Settlement DAO</text><ellipse cx="603.5" cy="2462.0234" fill="#FEFECE" filter="url(#fl4upgpll70vl)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="591.5" x2="615.5" y1="2476.0234" y2="2476.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="745.5" y="133.4248">Central Store</text><path d="M771.5,84.4297 C771.5,74.4297 789.5,74.4297 789.5,74.4297 C789.5,74.4297 807.5,74.4297 807.5,84.4297 L807.5,110.4297 C807.5,120.4297 789.5,120.4297 789.5,120.4297 C789.5,120.4297 771.5,120.4297 771.5,110.4297 L771.5,84.4297 " fill="#FEFECE" filter="url(#fl4upgpll70vl)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M771.5,84.4297 C771.5,94.4297 789.5,94.4297 789.5,94.4297 C789.5,94.4297 807.5,94.4297 807.5,84.4297 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="745.5" y="2442.7217">Central Store</text><path d="M771.5,2456.0234 C771.5,2446.0234 789.5,2446.0234 789.5,2446.0234 C789.5,2446.0234 807.5,2446.0234 807.5,2456.0234 L807.5,2482.0234 C807.5,2492.0234 789.5,2492.0234 789.5,2492.0234 C789.5,2492.0234 771.5,2492.0234 771.5,2482.0234 L771.5,2456.0234 " fill="#FEFECE" filter="url(#fl4upgpll70vl)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M771.5,2456.0234 C771.5,2466.0234 789.5,2466.0234 789.5,2466.0234 C789.5,2466.0234 807.5,2466.0234 807.5,2456.0234 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#fl4upgpll70vl)" height="2252" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="105.5" y="146.7266"/><rect fill="#FFFFFF" filter="url(#fl4upgpll70vl)" height="2031.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="344.5" y="367.3203"/><rect fill="#FFFFFF" filter="url(#fl4upgpll70vl)" height="619.9141" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="598.5" y="411.5859"/><rect fill="#FFFFFF" filter="url(#fl4upgpll70vl)" height="561.6484" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="784.5" y="440.7188"/><path d="M12,153.7266 L275,153.7266 L275,160.7266 L265,170.7266 L12,170.7266 L12,153.7266 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2260" style="stroke: #000000; stroke-width: 2.0;" width="1042" x="12" y="153.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="218" x="27" y="166.7935">Query Settlements by Parameters</text><path d="M120,175.8594 L120,336.8594 L561,336.8594 L561,185.8594 L551,175.8594 L120,175.8594 " fill="#FFFF00" filter="url(#fl4upgpll70vl)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M551,175.8594 L551,185.8594 L561,185.8594 L551,175.8594 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="52" x="126" y="192.9263">Params:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="126" y="208.0591">?[state={settlementStateId}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="126" y="223.1919">[&amp;fromDateTime={fromDateTime}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="126" y="238.3247">[&amp;toDateTime={toDateTime}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="126" y="253.4575">[&amp;currency={currencyId}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="126" y="268.5903">[&amp;settlementWindowId={settlementWindowId}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="420" x="126" y="283.7231">[&amp;fromSettlementWindowDateTime={fromSettlementWindowDateTime}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="388" x="126" y="298.856">[&amp;toSettlementWindowDateTime={toSettlementWindowDateTime}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="126" y="313.9888">[&amp;participantId={participantId}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="126" y="329.1216">[&amp;accountId={participantCurrencyId}]</text><polygon fill="#A80036" points="332.5,363.3203,342.5,367.3203,332.5,371.3203,336.5,367.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="115.5" x2="338.5" y1="367.3203" y2="367.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="122.5" y="362.2544">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="133.5" y="362.2544">GET - /settlements</text><polygon fill="#A80036" points="586.5,407.5859,596.5,411.5859,586.5,415.5859,590.5,411.5859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354.5" x2="592.5" y1="411.5859" y2="411.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="361.5" y="398.9536">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="372.5" y="391.3872">Retrieve settlements</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="372.5" y="406.52">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="446.5" y="406.52">2001</text><polygon fill="#A80036" points="772.5,436.7188,782.5,440.7188,772.5,444.7188,776.5,440.7188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="608.5" x2="778.5" y1="440.7188" y2="440.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="615.5" y="435.6528">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="626.5" y="435.6528">Retrieve requested data</text><polygon fill="#FFFFE0" filter="url(#fl4upgpll70vl)" points="544,453.7188,1034,453.7188,1044,714.7188,1034,975.7188,544,975.7188,534,714.7188,544,453.7188" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="546" y="469.7856">SELECT</text><text fill="#000066" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="57" x="591" y="469.7856">DISTINCT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="651" y="469.7856">s.settlementId, ssc.settlementStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="413" x="567" y="484.9185">ssw.settlementWindowId, swsc.settlementWindowStateId, swsc.reason</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="441" x="567" y="500.0513">settlementWindowReason, sw.createdDate, swsc.createdDate changedDate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="333" x="567" y="515.1841">pc.participantId, spc.participantCurrencyId, spcsc.reason</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="409" x="567" y="530.3169">accountReason, spcsc.settlementStateId accountState, spc.netAmount</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="284" x="567" y="545.4497">accountAmount, pc.currencyId accountCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="546" y="560.5825">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="584" y="560.5825">settlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="6" x="659" y="560.5825">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="546" y="575.7153">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="154" x="576" y="575.7153">settlementStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="733" y="575.7153">ssc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="343" x="546" y="590.8481">ON ssc.settlementStateChangeId = s.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="546" y="605.981">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="195" x="576" y="605.981">settlementSettlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="774" y="605.981">ssw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="546" y="621.1138">ON ssw.settlementId = s.settlementId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="546" y="636.2466">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="122" x="576" y="636.2466">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="701" y="636.2466">sw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="323" x="546" y="651.3794">ON sw.settlementWindowId = ssw.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="546" y="666.5122">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="204" x="576" y="666.5122">settlementWindowStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="783" y="666.5122">swsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="411" x="546" y="681.645">ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="546" y="696.7778">JOIN</text><text fill="#000066" font-family="sans-serif" font-size="13" font-style="italic" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="198" x="576" y="696.7778">settlementTransferParticipant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="777" y="696.7778">stp</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="546" y="711.9106">ON stp.settlementWindowId = s.settlementId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="326" x="546" y="727.0435">AND stp.settlementWindowId = sw.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="546" y="742.1763">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="203" x="576" y="742.1763">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="782" y="742.1763">spc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="546" y="757.3091">ON spc.settlementId = stp.settlementId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="344" x="546" y="772.4419">AND spc.participantCurrencyId = stp.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="546" y="787.5747">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="285" x="576" y="787.5747">settlementParticipantCurrencyStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="864" y="787.5747">spcsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="486" x="546" y="802.7075">ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="546" y="817.8403">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="131" x="576" y="817.8403">participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="710" y="817.8403">pc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="333" x="546" y="832.9731">ON pc.participantCurrencyId = spc.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="546" y="848.106">WHERE [ssc.settlementStateId = {settlementStateId}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="546" y="863.2388">[AND s.createdDate &gt;= {fromDateTime}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="546" y="878.3716">[AND s.createdDate &lt;= {toDateTime}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="546" y="893.5044">[AND pc.currencyId = {currencyId}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="329" x="546" y="908.6372">[AND ssw.settlementWindowId = {settlementWindowId}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="350" x="546" y="923.77">[AND sw.createdDate &gt;= {fromSettlementWindowDateTime}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="334" x="546" y="938.9028">[AND sw.createdDate &lt;= {toSettlementWindowDateTime}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="546" y="954.0356">[AND pc.participantId = {participantId}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="341" x="546" y="969.1685">[AND spc.participantCurrencyId = {participantCurrencyId}]</text><polygon fill="#A80036" points="619.5,998.3672,609.5,1002.3672,619.5,1006.3672,615.5,1002.3672" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="613.5" x2="788.5" y1="1002.3672" y2="1002.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="625.5" y="997.3013">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="636.5" y="997.3013">Return data</text><polygon fill="#A80036" points="365.5,1027.5,355.5,1031.5,365.5,1035.5,361.5,1031.5" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="359.5" x2="602.5" y1="1031.5" y2="1031.5"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="371.5" y="1026.4341">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="382.5" y="1026.4341">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="109" x="425.5" y="1026.4341">settlementsData</text><path d="M22,1046.5 L85,1046.5 L85,1053.5 L75,1063.5 L22,1063.5 L22,1046.5 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1360.2266" style="stroke: #000000; stroke-width: 2.0;" width="818" x="22" y="1046.5"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="37" y="1059.5669">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="116" x="100" y="1058.7104">[Settlement(s) found]</text><path d="M359,1068.6328 L359,1123.6328 L487,1123.6328 L487,1078.6328 L477,1068.6328 L359,1068.6328 " fill="#D3D3D3" filter="url(#fl4upgpll70vl)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M477,1068.6328 L477,1078.6328 L487,1078.6328 L477,1068.6328 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="365" y="1085.6997">let settlements = {}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="365" y="1100.8325">let settlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="365" y="1115.9653">let participant</text><path d="M349,1140.0313 L422,1140.0313 L422,1147.0313 L412,1157.0313 L349,1157.0313 L349,1140.0313 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="510.25" style="stroke: #000000; stroke-width: 2.0;" width="481" x="349" y="1140.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="364" y="1153.0981">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="96" x="437" y="1152.2417">[settlementsData]</text><path d="M359,1162.1641 L359,1641.1641 L816,1641.1641 L816,1172.1641 L806,1162.1641 L359,1162.1641 " fill="#D3D3D3" filter="url(#fl4upgpll70vl)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M806,1162.1641 L806,1172.1641 L816,1172.1641 L806,1162.1641 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="276" x="365" y="1179.231">if (!settlements[settlementsData.settlementId]) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="377" y="1194.3638">settlements[settlementsData.settlementId] = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="389" y="1209.4966">"id: settlementsData.settlementId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="389" y="1224.6294">"state": settlementsData.settlementStateId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="377" y="1239.7622">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="1254.895">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="320" x="365" y="1270.0278">settlement = settlements[settlementsData.settlementId]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="436" x="365" y="1285.1606">if (!settlement.settlementWindows[settlementsData.settlementWindowId]) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="424" x="377" y="1300.2935">settlement.settlementWindows[settlementsData.settlementWindowId] = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="389" y="1315.4263">"id": settlementsData.settlementWindowId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="295" x="389" y="1330.5591">"state": settlementsData.settlementWindowStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="389" y="1345.6919">"reason": settlementsData.settlementWindowReason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="389" y="1360.8247">"createdDate": settlementsData.createdDate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="389" y="1375.9575">"changedDate": settlementsData.changedDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="377" y="1391.0903">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="1406.2231">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="344" x="365" y="1421.356">if (!settlement.participants[settlementsData.participantId]) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="332" x="377" y="1436.4888">settlement.participants[settlementsData.participantId] = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="389" y="1451.6216">"id": settlementsData.participantId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="377" y="1466.7544">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="1481.8872">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="390" x="365" y="1497.02">participant = settlement.participants[settlementsData.participantId]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="302" x="365" y="1512.1528">participant.accounts[settlementsData.accountId] = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="377" y="1527.2856">"id": settlementsData.participantCurrencyId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="377" y="1542.4185">"state": settlementsData.accountState,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="377" y="1557.5513">"reason": settlementsData.accountReason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="377" y="1572.6841">"netSettlementAmount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="389" y="1587.8169">"amount": settlementsData.accountAmount,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="389" y="1602.9497">"currency": settlementsData.accountCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="377" y="1618.0825">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="1633.2153">}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="354.5" x2="396.5" y1="1683.4141" y2="1683.4141"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396.5" x2="396.5" y1="1683.4141" y2="1696.4141"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="349.5" x2="396.5" y1="1696.4141" y2="1696.4141"/><polygon fill="#A80036" points="359.5,1692.4141,349.5,1696.4141,359.5,1700.4141,355.5,1696.4141" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="361.5" y="1678.3481">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="372.5" y="1678.3481">Transform</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="78" x="436.5" y="1678.3481">settlements</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="74" x="517.5" y="1678.3481">map to array</text><path d="M53,1704.4141 L53,2183.4141 L335,2183.4141 L335,1714.4141 L325,1704.4141 L53,1704.4141 " fill="#FFFF00" filter="url(#fl4upgpll70vl)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M325,1704.4141 L325,1714.4141 L335,1714.4141 L325,1704.4141 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="59" y="1721.481">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="71" y="1736.6138">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="83" y="1751.7466">"id": settlementId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="83" y="1766.8794">"state": settlementStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="83" y="1782.0122">"settlementWindows": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="95" y="1797.145">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="107" y="1812.2778">"id": settlementWindowId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="107" y="1827.4106">"state": settlementWindowStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="107" y="1842.5435">"reason": settlementWindowReason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="107" y="1857.6763">"createdDate": createdDate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="107" y="1872.8091">"changedDate": changedDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="95" y="1887.9419">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="83" y="1903.0747">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="83" y="1918.2075">"participants": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="95" y="1933.3403">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="107" y="1948.4731">"id": participantId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="107" y="1963.606">"accounts": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="119" y="1978.7388">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="131" y="1993.8716">"id": participantCurrencyId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="131" y="2009.0044">"state": accountState,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="131" y="2024.1372">"reason": accountReason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="131" y="2039.27">"netSettlementAmount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="143" y="2054.4028">"amount": accountAmount,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="143" y="2069.5356">"currency": accountCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="131" y="2084.6685">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="119" y="2099.8013">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="107" y="2114.9341">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="95" y="2130.0669">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="83" y="2145.1997">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="71" y="2160.3325">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="59" y="2175.4653">]</text><polygon fill="#A80036" points="126.5,2209.6641,116.5,2213.6641,126.5,2217.6641,122.5,2213.6641" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="120.5" x2="343.5" y1="2213.6641" y2="2213.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="132.5" y="2208.5981">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="143.5" y="2208.5981">Respond HTTP - 200 (OK)</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="22" x2="840" y1="2222.6641" y2="2222.6641"/><path d="M359,2228.6641 L359,2253.6641 L480,2253.6641 L480,2238.6641 L470,2228.6641 L359,2228.6641 " fill="#D3D3D3" filter="url(#fl4upgpll70vl)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M470,2228.6641 L470,2238.6641 L480,2238.6641 L470,2228.6641 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="365" y="2245.731">Log ERROR event</text><path d="M32,2267.7969 L32,2367.7969 L335,2367.7969 L335,2277.7969 L325,2267.7969 L32,2267.7969 " fill="#FFFF00" filter="url(#fl4upgpll70vl)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M325,2267.7969 L325,2277.7969 L335,2277.7969 L325,2267.7969 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="38" y="2284.8638">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="50" y="2299.9966">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="62" y="2315.1294">"errorCode": &lt;integer&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="62" y="2330.2622">"errorDescription": "Client error description"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="50" y="2345.395">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="38" y="2360.5278">}</text><polygon fill="#A80036" points="121.5,2394.7266,111.5,2398.7266,121.5,2402.7266,117.5,2398.7266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="115.5" x2="348.5" y1="2398.7266" y2="2398.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="127.5" y="2393.6606">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="138.5" y="2393.6606">Respond HTTP - 4xx (Client error)</text><!--
@startuml
title 6.2.2. Query Settlements by Parameters

autonumber

actor "Hub Employee" as OPERATOR
boundary "Settlement Service API" as SSAPI
entity "Settlement DAO" as SETTLE_DAO
database "Central Store" as DB

box "Central HUB" #LightPink
    participant OPERATOR
end box

box "Settlement Service" #LightGreen
    participant SSAPI
    participant SETTLE_DAO
end box

box "Central Services" #LightYellow
    participant DB
end box

group Query Settlements by Parameters
    activate OPERATOR
    note right of OPERATOR #Yellow
        **Params:**
        ?[state={settlementStateId}]
        [&fromDateTime={fromDateTime}]
        [&toDateTime={toDateTime}]
        [&currency={currencyId}]
        [&settlementWindowId={settlementWindowId}]
        [&fromSettlementWindowDateTime={fromSettlementWindowDateTime}]
        [&toSettlementWindowDateTime={toSettlementWindowDateTime}]
        [&participantId={participantId}]
        [&accountId={participantCurrencyId}]
    end note

    OPERATOR -> SSAPI: GET - /settlements
    activate SSAPI
    SSAPI -> SETTLE_DAO: Retrieve settlements\n<color #FF0000><b>Error code:</b> 2001</color>
    activate SETTLE_DAO

    SETTLE_DAO -> DB: Retrieve requested data
    activate DB
    hnote over DB #LightYellow
        SELECT <color 006>**//DISTINCT//**</color> s.settlementId, ssc.settlementStateId,
               ssw.settlementWindowId, swsc.settlementWindowStateId, swsc.reason 
               settlementWindowReason, sw.createdDate, swsc.createdDate changedDate, 
               pc.participantId, spc.participantCurrencyId, spcsc.reason
               accountReason, spcsc.settlementStateId accountState, spc.netAmount
               accountAmount, pc.currencyId accountCurrency
        FROM **settlement** s
        JOIN **settlementStateChange** ssc
        ON ssc.settlementStateChangeId = s.currentStateChangeId
        JOIN **settlementSettlementWindow** ssw
        ON ssw.settlementId = s.settlementId
        JOIN **settlementWindow** sw
        ON sw.settlementWindowId = ssw.settlementWindowId
        JOIN **settlementWindowStateChange** swsc
        ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId
        JOIN <color 006>**//settlementTransferParticipant//**</color> stp
        ON stp.settlementWindowId = s.settlementId
        AND stp.settlementWindowId = sw.settlementWindowId
        JOIN **settlementParticipantCurrency** spc
        ON spc.settlementId = stp.settlementId
        AND spc.participantCurrencyId = stp.participantCurrencyId
        JOIN **settlementParticipantCurrencyStateChange** spcsc
        ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId
        JOIN **participantCurrency** pc
        ON pc.participantCurrencyId = spc.participantCurrencyId
        WHERE [ssc.settlementStateId = {settlementStateId}]
        [AND s.createdDate >= {fromDateTime}]
        [AND s.createdDate <= {toDateTime}]
        [AND pc.currencyId = {currencyId}]
        [AND ssw.settlementWindowId = {settlementWindowId}]
        [AND sw.createdDate >= {fromSettlementWindowDateTime}]
        [AND sw.createdDate <= {toSettlementWindowDateTime}]
        [AND pc.participantId = {participantId}]
        [AND spc.participantCurrencyId = {participantCurrencyId}]
    end hnote
    SETTLE_DAO <- - DB: Return data
    deactivate DB
    SSAPI <- - SETTLE_DAO: Return **settlementsData**
    deactivate SETTLE_DAO
    alt Settlement(s) found
        note right of SSAPI #lightgray
            let settlements = {}
            let settlement
            let participant
        end note
        loop settlementsData
            note right of SSAPI #lightgray
                if (!settlements[settlementsData.settlementId]) {
                    settlements[settlementsData.settlementId] = {
                        "id: settlementsData.settlementId,
                        "state": settlementsData.settlementStateId
                    }
                }
                settlement = settlements[settlementsData.settlementId]
                if (!settlement.settlementWindows[settlementsData.settlementWindowId]) {
                    settlement.settlementWindows[settlementsData.settlementWindowId] = {
                        "id": settlementsData.settlementWindowId,
                        "state": settlementsData.settlementWindowStateId,
                        "reason": settlementsData.settlementWindowReason,
                        "createdDate": settlementsData.createdDate,
                        "changedDate": settlementsData.changedDate
                    }
                }
                if (!settlement.participants[settlementsData.participantId]) {
                    settlement.participants[settlementsData.participantId] = {
                        "id": settlementsData.participantId
                    }
                }
                participant = settlement.participants[settlementsData.participantId]
                participant.accounts[settlementsData.accountId] = {
                    "id": settlementsData.participantCurrencyId,
                    "state": settlementsData.accountState,
                    "reason": settlementsData.accountReason,
                    "netSettlementAmount": {
                        "amount": settlementsData.accountAmount,
                        "currency": settlementsData.accountCurrency
                    }
                }
            end note
        end
        SSAPI -> SSAPI: Transform **settlements** map to array
        deactivate SETTLE_DAO
        note left of SSAPI #yellow
            [
                {
                    "id": settlementId,
                    "state": settlementStateId,
                    "settlementWindows": [
                        {
                            "id": settlementWindowId,
                            "state": settlementWindowStateId,
                            "reason": settlementWindowReason,
                            "createdDate": createdDate,
                            "changedDate": changedDate
                        }
                    ],
                    "participants": [
                        {
                            "id": participantId,
                            "accounts": [
                                {
                                    "id": participantCurrencyId,
                                    "state": accountState,
                                    "reason": accountReason,
                                    "netSettlementAmount": {
                                        "amount": accountAmount,
                                        "currency": accountCurrency
                                    }
                                }
                            ]
                        }
                    ]
                }
            ]
        end note
        OPERATOR <- - SSAPI: Respond HTTP - 200 (OK)
    else
        note right of SSAPI #lightgray
            Log ERROR event
        end note
        note left of SSAPI #yellow
            {
                errorInformation: {
                    "errorCode": <integer>,
                    "errorDescription": "Client error description"
                }
            }
        end note
        OPERATOR <- - SSAPI: Respond HTTP - 4xx (Client error)
        deactivate SSAPI
        deactivate OPERATOR
    end
end
@enduml

PlantUML version 1.2018.02(Fri Mar 09 17:20:44 GMT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_212-b04
Operating System: Linux
OS Version: 4.15.0-1035-aws
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>