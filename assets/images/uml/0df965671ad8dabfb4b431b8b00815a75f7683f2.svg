<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3512px" preserveAspectRatio="none" style="width:1150px;height:3512px;" version="1.1" viewBox="0 0 1150 3512" width="1150px" zoomAndPan="magnify"><defs><filter height="300%" id="f1vni6l1jht6gd" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="776" x="188" y="22.9951">6.2.3. Get Settlement By Settlement, Participant and Account (getSettlementBySettlementParticipantAccount)</text><rect fill="#FFB6C1" height="3467.1172" style="stroke: #A80036; stroke-width: 1.0;" width="107" x="64" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="79" y="46.3638">Central HUB</text><rect fill="#90EE90" height="3467.1172" style="stroke: #A80036; stroke-width: 1.0;" width="468" x="283" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="123" x="455.5" y="46.3638">Settlement Service</text><rect fill="#FFFFE0" height="3467.1172" style="stroke: #A80036; stroke-width: 1.0;" width="110" x="794.5" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="104" x="797.5" y="46.3638">Central Services</text><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="3236.3906" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="112.5" y="146.7266"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="3236.3906" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="358.5" y="146.7266"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="181.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="686.5" y="443.5859"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="197.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="686.5" y="763.3125"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="166.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="686.5" y="1098.1719"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="166.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="686.5" y="1402.7656"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="520.8516" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="686.5" y="1728.3594"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="369.5234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="686.5" y="2293.4766"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="844.5" y="472.7188"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="844.5" y="792.4453"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="844.5" y="1127.3047"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="844.5" y="1431.8984"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="470.5859" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="844.5" y="1757.4922"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="319.2578" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="844.5" y="2322.6094"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="3244.3906" style="stroke: #000000; stroke-width: 2.0;" width="1127" x="12" y="153.7266"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="122.7969" style="stroke: #000000; stroke-width: 2.0;" width="392" x="58" y="177.8594"/><rect fill="#FFFFFF" height="61.3984" style="stroke: none; stroke-width: 1.0;" width="392" x="58" y="239.2578"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="951.0469" style="stroke: #000000; stroke-width: 2.0;" width="781" x="257" y="709.9141"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="609.1875" style="stroke: #000000; stroke-width: 2.0;" width="743" x="267" y="1044.7734"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="297.5938" style="stroke: #000000; stroke-width: 2.0;" width="723" x="277" y="1349.3672"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="1716.1563" style="stroke: #000000; stroke-width: 2.0;" width="1107" x="22" y="1674.9609"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="448.5859" style="stroke: #000000; stroke-width: 2.0;" width="481" x="609" y="1772.4922"/><rect fill="#FFFFFF" height="246.9922" style="stroke: none; stroke-width: 1.0;" width="481" x="609" y="1974.0859"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="297.2578" style="stroke: #000000; stroke-width: 2.0;" width="539" x="580" y="2337.6094"/><rect fill="#FFFFFF" height="141.0625" style="stroke: none; stroke-width: 1.0;" width="539" x="580" y="2493.8047"/><rect fill="#FFFFFF" height="197.8672" style="stroke: none; stroke-width: 1.0;" width="1107" x="22" y="3193.25"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="117" x2="117" y1="136.7266" y2="3415.1172"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="363" x2="363" y1="136.7266" y2="3415.1172"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="691" x2="691" y1="136.7266" y2="3415.1172"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="849.5" x2="849.5" y1="136.7266" y2="3415.1172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="68" y="133.4248">Hub Employee</text><ellipse cx="117.5" cy="63.4297" fill="#FEFECE" filter="url(#f1vni6l1jht6gd)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M117.5,71.4297 L117.5,98.4297 M104.5,79.4297 L130.5,79.4297 M117.5,98.4297 L104.5,113.4297 M117.5,98.4297 L130.5,113.4297 " fill="none" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="68" y="3427.1123">Hub Employee</text><ellipse cx="117.5" cy="3440.4141" fill="#FEFECE" filter="url(#f1vni6l1jht6gd)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M117.5,3448.4141 L117.5,3475.4141 M104.5,3456.4141 L130.5,3456.4141 M117.5,3475.4141 L104.5,3490.4141 M117.5,3475.4141 L130.5,3490.4141 " fill="none" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="147" x="287" y="133.4248">Settlement Service API</text><path d="M343,92.4297 L343,116.4297 M343,104.4297 L360,104.4297 " fill="none" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="372" cy="104.4297" fill="#FEFECE" filter="url(#f1vni6l1jht6gd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="147" x="287" y="3427.1123">Settlement Service API</text><path d="M343,3434.4141 L343,3458.4141 M343,3446.4141 L360,3446.4141 " fill="none" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="372" cy="3446.4141" fill="#FEFECE" filter="url(#f1vni6l1jht6gd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="636" y="133.4248">Settlement DAO</text><ellipse cx="691.5" cy="104.4297" fill="#FEFECE" filter="url(#f1vni6l1jht6gd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="679.5" x2="703.5" y1="118.4297" y2="118.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="636" y="3427.1123">Settlement DAO</text><ellipse cx="691.5" cy="3446.4141" fill="#FEFECE" filter="url(#f1vni6l1jht6gd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="679.5" x2="703.5" y1="3460.4141" y2="3460.4141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="805.5" y="133.4248">Central Store</text><path d="M831.5,84.4297 C831.5,74.4297 849.5,74.4297 849.5,74.4297 C849.5,74.4297 867.5,74.4297 867.5,84.4297 L867.5,110.4297 C867.5,120.4297 849.5,120.4297 849.5,120.4297 C849.5,120.4297 831.5,120.4297 831.5,110.4297 L831.5,84.4297 " fill="#FEFECE" filter="url(#f1vni6l1jht6gd)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M831.5,84.4297 C831.5,94.4297 849.5,94.4297 849.5,94.4297 C849.5,94.4297 867.5,94.4297 867.5,84.4297 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="805.5" y="3427.1123">Central Store</text><path d="M831.5,3440.4141 C831.5,3430.4141 849.5,3430.4141 849.5,3430.4141 C849.5,3430.4141 867.5,3430.4141 867.5,3440.4141 L867.5,3466.4141 C867.5,3476.4141 849.5,3476.4141 849.5,3476.4141 C849.5,3476.4141 831.5,3476.4141 831.5,3466.4141 L831.5,3440.4141 " fill="#FEFECE" filter="url(#f1vni6l1jht6gd)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M831.5,3440.4141 C831.5,3450.4141 849.5,3450.4141 849.5,3450.4141 C849.5,3450.4141 867.5,3450.4141 867.5,3440.4141 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="3236.3906" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="112.5" y="146.7266"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="3236.3906" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="358.5" y="146.7266"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="181.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="686.5" y="443.5859"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="197.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="686.5" y="763.3125"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="166.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="686.5" y="1098.1719"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="166.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="686.5" y="1402.7656"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="520.8516" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="686.5" y="1728.3594"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="369.5234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="686.5" y="2293.4766"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="844.5" y="472.7188"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="844.5" y="792.4453"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="844.5" y="1127.3047"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="844.5" y="1431.8984"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="470.5859" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="844.5" y="1757.4922"/><rect fill="#FFFFFF" filter="url(#f1vni6l1jht6gd)" height="319.2578" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="844.5" y="2322.6094"/><path d="M12,153.7266 L412,153.7266 L412,160.7266 L402,170.7266 L12,170.7266 L12,153.7266 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3244.3906" style="stroke: #000000; stroke-width: 2.0;" width="1127" x="12" y="153.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="355" x="27" y="166.7935">Get Settlement By Settlement, Participant and Account</text><path d="M58,177.8594 L121,177.8594 L121,184.8594 L111,194.8594 L58,194.8594 L58,177.8594 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="122.7969" style="stroke: #000000; stroke-width: 2.0;" width="392" x="58" y="177.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="73" y="190.9263">alt</text><polygon fill="#A80036" points="346.5,227.2578,356.5,231.2578,346.5,235.2578,350.5,231.2578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="122.5" x2="352.5" y1="231.2578" y2="231.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="129.5" y="218.6255">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="140.5" y="211.0591">GET - /settlements/{settlementId}/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="140.5" y="226.1919">participants/{participantId}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="58" x2="450" y1="240.2578" y2="240.2578"/><polygon fill="#A80036" points="346.5,288.6563,356.5,292.6563,346.5,296.6563,350.5,292.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="122.5" x2="352.5" y1="292.6563" y2="292.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="129.5" y="272.4575">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="140.5" y="257.3247">GET - /settlements/{settlementId}/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="140.5" y="272.4575">participants/{participantId}/</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="140.5" y="287.5903">accounts/{accountId}</text><path d="M373,312.6563 L373,397.6563 L713,397.6563 L713,322.6563 L703,312.6563 L373,312.6563 " fill="#D3D3D3" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M703,312.6563 L703,322.6563 L713,322.6563 L703,312.6563 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="379" y="329.7231">let settlementFound = false</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="379" y="344.856">let participantFoundInSettlement = false</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="379" y="359.9888">let accountProvided = accountId &gt; 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="319" x="379" y="375.1216">let participantAndAccountMatched = !accountProvided</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="293" x="379" y="390.2544">let accountFoundInSettlement = !accountProvided</text><polygon fill="#A80036" points="674.5,439.5859,684.5,443.5859,674.5,447.5859,678.5,443.5859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="368.5" x2="680.5" y1="443.5859" y2="443.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="375.5" y="430.9536">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="386.5" y="423.3872">Request settlement state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="386.5" y="438.52">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="460.5" y="438.52">2001</text><polygon fill="#A80036" points="832.5,468.7188,842.5,472.7188,832.5,476.7188,836.5,472.7188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="696.5" x2="838.5" y1="472.7188" y2="472.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="703.5" y="467.6528">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="714.5" y="467.6528">Retrieve settlement</text><polygon fill="#FFFFE0" filter="url(#f1vni6l1jht6gd)" points="647,515.7188,1051,515.7188,1061,556.7188,1051,598.7188,647,598.7188,637,556.7188,647,515.7188" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="400" x="649" y="531.7856">SELECT s.settlementId, ssc.settlementStateId, s.reason, s.createdDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="649" y="546.9185">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="687" y="546.9185">settlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="6" x="762" y="546.9185">s</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="649" y="562.0513">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="154" x="679" y="562.0513">settlementStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="836" y="562.0513">ssc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="343" x="649" y="577.1841">ON ssc.settlementStateChangeId = s.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="649" y="592.3169">WHERE s.settlementId = {id}</text><polygon fill="#A80036" points="379.5,621.5156,369.5,625.5156,379.5,629.5156,375.5,625.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="373.5" x2="690.5" y1="625.5156" y2="625.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="385.5" y="620.4497">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="396.5" y="620.4497">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="439.5" y="620.4497">settlement</text><path d="M373,638.5156 L373,693.5156 L558,693.5156 L558,648.5156 L548,638.5156 L373,638.5156 " fill="#D3D3D3" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M548,638.5156 L548,648.5156 L558,648.5156 L548,638.5156 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="379" y="655.5825">if (settlement.settlementId) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="391" y="670.7153"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="391" y="670.7153">settlementFound</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="34" x="505" y="670.7153">= true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="379" y="685.8481">}</text><path d="M257,709.9141 L324,709.9141 L324,716.9141 L314,726.9141 L257,726.9141 L257,709.9141 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="951.0469" style="stroke: #000000; stroke-width: 2.0;" width="781" x="257" y="709.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="272" y="722.981">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="339" y="722.1245">[settlementFound]</text><polygon fill="#A80036" points="674.5,759.3125,684.5,763.3125,674.5,767.3125,678.5,763.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="368.5" x2="680.5" y1="763.3125" y2="763.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="375.5" y="750.6802">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="386.5" y="743.1138">Check participant</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="386.5" y="758.2466">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="460.5" y="758.2466">2001</text><polygon fill="#A80036" points="832.5,788.4453,842.5,792.4453,832.5,796.4453,836.5,792.4453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="696.5" x2="838.5" y1="792.4453" y2="792.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="703.5" y="787.3794">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="714.5" y="787.3794">Check exists</text><polygon fill="#FFFFE0" filter="url(#f1vni6l1jht6gd)" points="681,835.4453,1018,835.4453,1028,884.4453,1018,933.4453,681,933.4453,671,884.4453,681,835.4453" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="683" y="851.5122">SELECT settlementParticipantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="683" y="866.645">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="203" x="721" y="866.645">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="927" y="866.645">spc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="683" y="881.7778">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="131" x="713" y="881.7778">participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="847" y="881.7778">pc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="333" x="683" y="896.9106">ON pc.participantCurrencyId = spc.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="683" y="912.0435">WHERE spc.settlementId = {id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="683" y="927.1763">AND pc.participantId = {participantId}</text><polygon fill="#A80036" points="379.5,956.375,369.5,960.375,379.5,964.375,375.5,960.375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="373.5" x2="690.5" y1="960.375" y2="960.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="385.5" y="955.3091">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="396.5" y="955.3091">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="240" x="439.5" y="955.3091">settlementParticipantCurrencyIdList</text><path d="M373,973.375 L373,1028.375 L688,1028.375 L688,983.375 L678,973.375 L373,973.375 " fill="#D3D3D3" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M678,973.375 L678,983.375 L688,983.375 L678,973.375 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="294" x="379" y="990.4419">if (settlementParticipantCurrencyIdList.length &gt; 0) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="391" y="1005.5747"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="199" x="391" y="1005.5747">participantFoundInSettlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="34" x="593" y="1005.5747">= true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="379" y="1020.7075">}</text><path d="M267,1044.7734 L334,1044.7734 L334,1051.7734 L324,1061.7734 L267,1061.7734 L267,1044.7734 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="609.1875" style="stroke: #000000; stroke-width: 2.0;" width="743" x="267" y="1044.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="282" y="1057.8403">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="286" x="349" y="1056.9839">[participantFoundInSettlement &amp;&amp; accountProvided]</text><polygon fill="#A80036" points="674.5,1094.1719,684.5,1098.1719,674.5,1102.1719,678.5,1098.1719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="368.5" x2="680.5" y1="1098.1719" y2="1098.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="375.5" y="1085.5396">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="386.5" y="1077.9731">Check participant</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="386.5" y="1093.106">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="460.5" y="1093.106">2001</text><polygon fill="#A80036" points="832.5,1123.3047,842.5,1127.3047,832.5,1131.3047,836.5,1127.3047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="696.5" x2="838.5" y1="1127.3047" y2="1127.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="703.5" y="1122.2388">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="721.5" y="1122.2388">Check exists</text><polygon fill="#FFFFE0" filter="url(#f1vni6l1jht6gd)" points="719,1170.3047,980,1170.3047,990,1204.3047,980,1238.3047,719,1238.3047,709,1204.3047,719,1170.3047" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="721" y="1186.3716">SELECT participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="721" y="1201.5044">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="131" x="751" y="1201.5044">participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="257" x="721" y="1216.6372">WHERE participantCurrencyId = {accountId}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="721" y="1231.77">AND participantId = {participantId}</text><polygon fill="#A80036" points="379.5,1260.9688,369.5,1264.9688,379.5,1268.9688,375.5,1264.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="373.5" x2="690.5" y1="1264.9688" y2="1264.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="385.5" y="1259.9028">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="403.5" y="1259.9028">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="52" x="446.5" y="1259.9028">account</text><path d="M373,1277.9688 L373,1332.9688 L649,1332.9688 L649,1287.9688 L639,1277.9688 L373,1277.9688 " fill="#D3D3D3" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M639,1277.9688 L639,1287.9688 L649,1287.9688 L639,1277.9688 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="379" y="1295.0356">if (account) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="391" y="1310.1685"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="206" x="391" y="1310.1685">participantAndAccountMatched</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="34" x="600" y="1310.1685">= true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="379" y="1325.3013">}</text><path d="M277,1349.3672 L344,1349.3672 L344,1356.3672 L334,1366.3672 L277,1366.3672 L277,1349.3672 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="297.5938" style="stroke: #000000; stroke-width: 2.0;" width="723" x="277" y="1349.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="292" y="1362.4341">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="181" x="359" y="1361.5776">[participantAndAccountMatched]</text><polygon fill="#A80036" points="674.5,1398.7656,684.5,1402.7656,674.5,1406.7656,678.5,1402.7656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="368.5" x2="680.5" y1="1402.7656" y2="1402.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="375.5" y="1390.1333">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="393.5" y="1382.5669">Check account in settlement</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="393.5" y="1397.6997">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="467.5" y="1397.6997">2001</text><polygon fill="#A80036" points="832.5,1427.8984,842.5,1431.8984,832.5,1435.8984,836.5,1431.8984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="696.5" x2="838.5" y1="1431.8984" y2="1431.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="703.5" y="1426.8325">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="721.5" y="1426.8325">Check exists</text><polygon fill="#FFFFE0" filter="url(#f1vni6l1jht6gd)" points="718,1474.8984,980,1474.8984,990,1508.8984,980,1542.8984,718,1542.8984,708,1508.8984,718,1474.8984" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="720" y="1490.9653">SELECT settlementParticipantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="720" y="1506.0981">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="203" x="758" y="1506.0981">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="720" y="1521.231">WHERE spc.settlementId = {id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="720" y="1536.3638">AND pc.participantCurrencyId = {accountId}</text><polygon fill="#A80036" points="379.5,1565.5625,369.5,1569.5625,379.5,1573.5625,375.5,1569.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="373.5" x2="690.5" y1="1569.5625" y2="1569.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="385.5" y="1564.4966">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="403.5" y="1564.4966">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="217" x="446.5" y="1564.4966">settlementParticipantCurrencyId</text><path d="M373,1582.5625 L373,1637.5625 L621,1637.5625 L621,1592.5625 L611,1582.5625 L373,1582.5625 " fill="#D3D3D3" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M611,1582.5625 L611,1592.5625 L621,1592.5625 L611,1582.5625 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="379" y="1599.6294">if (settlementParticipantCurrencyId) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="391" y="1614.7622"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="178" x="391" y="1614.7622">accountFoundInSettlement</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="34" x="572" y="1614.7622">= true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="379" y="1629.895">}</text><path d="M22,1674.9609 L85,1674.9609 L85,1681.9609 L75,1691.9609 L22,1691.9609 L22,1674.9609 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1716.1563" style="stroke: #000000; stroke-width: 2.0;" width="1107" x="22" y="1674.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="37" y="1688.0278">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="651" x="100" y="1687.1714">[settlementFound &amp;&amp; participantFoundInSettlement &amp;&amp; participantAndAccountMatched &amp;&amp; accountFoundInSettlement]</text><polygon fill="#A80036" points="674.5,1724.3594,684.5,1728.3594,674.5,1732.3594,678.5,1728.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="368.5" x2="680.5" y1="1728.3594" y2="1728.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="375.5" y="1715.7271">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="393.5" y="1708.1606">Request settlement windows</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="393.5" y="1723.2935">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="467.5" y="1723.2935">2001</text><polygon fill="#A80036" points="832.5,1753.4922,842.5,1757.4922,832.5,1761.4922,836.5,1757.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="696.5" x2="838.5" y1="1757.4922" y2="1757.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="703.5" y="1752.4263">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="721.5" y="1752.4263">Retrieve windows</text><path d="M609,1772.4922 L672,1772.4922 L672,1779.4922 L662,1789.4922 L609,1789.4922 L609,1772.4922 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="448.5859" style="stroke: #000000; stroke-width: 2.0;" width="481" x="609" y="1772.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="624" y="1785.5591">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="687" y="1784.7026">[accountProvided]</text><polygon fill="#FFFFE0" filter="url(#f1vni6l1jht6gd)" points="629,1794.625,1070,1794.625,1080,1881.625,1070,1968.625,629,1968.625,619,1881.625,629,1794.625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="437" x="631" y="1810.6919">SELECT DISTINCT sw.settlementWindowId, swsc.settlementWindowStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="643" y="1825.8247">swsc.reason, sw.createdDate, swsc.createdDate changedDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="631" y="1840.9575">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="195" x="669" y="1840.9575">settlementSettlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="867" y="1840.9575">ssw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="631" y="1856.0903">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="122" x="661" y="1856.0903">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="786" y="1856.0903">sw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="323" x="631" y="1871.2231">ON sw.settlementWindowId = ssw.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="631" y="1886.356">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="204" x="661" y="1886.356">settlementWindowStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="868" y="1886.356">swsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="411" x="631" y="1901.4888">ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="631" y="1916.6216">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="198" x="661" y="1916.6216">settlementTransferParticipant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="862" y="1916.6216">stp</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="319" x="631" y="1931.7544">ON stp.settlementWindowId = sw.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="262" x="631" y="1946.8872">AND stp.participantCurrencyId = {accountId}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="631" y="1962.02">WHERE ssw.settlementId = {id}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="609" x2="1090" y1="1975.0859" y2="1975.0859"/><polygon fill="#FFFFE0" filter="url(#f1vni6l1jht6gd)" points="629,1981.0859,1070,1981.0859,1080,2098.0859,1070,2215.0859,629,2215.0859,619,2098.0859,629,1981.0859" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="437" x="631" y="1997.1528">SELECT DISTINCT sw.settlementWindowId, swsc.settlementWindowStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="643" y="2012.2856">swsc.reason, sw.createdDate, swsc.createdDate changedDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="631" y="2027.4185">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="195" x="669" y="2027.4185">settlementSettlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="22" x="867" y="2027.4185">ssw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="631" y="2042.5513">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="122" x="661" y="2042.5513">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="786" y="2042.5513">sw</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="323" x="631" y="2057.6841">ON sw.settlementWindowId = ssw.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="631" y="2072.8169">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="204" x="661" y="2072.8169">settlementWindowStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="868" y="2072.8169">swsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="411" x="631" y="2087.9497">ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="631" y="2103.0825">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="198" x="661" y="2103.0825">settlementTransferParticipant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="862" y="2103.0825">stp</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="319" x="631" y="2118.2153">ON stp.settlementWindowId = sw.settlementWindowId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="631" y="2133.3481">AND stp.participantCurrencyId IN(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="643" y="2148.481">SELECT participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="643" y="2163.6138">FROM participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="643" y="2178.7466">WHERE participantId = {participantId}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="631" y="2193.8794">)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="631" y="2209.0122">WHERE ssw.settlementId = {id}</text><polygon fill="#A80036" points="379.5,2245.2109,369.5,2249.2109,379.5,2253.2109,375.5,2249.2109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="373.5" x2="690.5" y1="2249.2109" y2="2249.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="385.5" y="2244.145">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="403.5" y="2244.145">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="54" x="446.5" y="2244.145">windows</text><polygon fill="#A80036" points="674.5,2289.4766,684.5,2293.4766,674.5,2297.4766,678.5,2293.4766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="368.5" x2="680.5" y1="2293.4766" y2="2293.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="375.5" y="2280.8442">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="393.5" y="2273.2778">Request settlement accounts</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="393.5" y="2288.4106">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="467.5" y="2288.4106">2001</text><polygon fill="#A80036" points="832.5,2318.6094,842.5,2322.6094,832.5,2326.6094,836.5,2322.6094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="696.5" x2="838.5" y1="2322.6094" y2="2322.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="703.5" y="2317.5435">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="721.5" y="2317.5435">Retrieve accounts</text><path d="M580,2337.6094 L643,2337.6094 L643,2344.6094 L633,2354.6094 L580,2354.6094 L580,2337.6094 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="297.2578" style="stroke: #000000; stroke-width: 2.0;" width="539" x="580" y="2337.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="595" y="2350.6763">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="658" y="2349.8198">[accountProvided]</text><polygon fill="#FFFFE0" filter="url(#f1vni6l1jht6gd)" points="604,2359.7422,1094,2359.7422,1104,2423.7422,1094,2488.7422,604,2488.7422,594,2423.7422,604,2359.7422" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="443" x="606" y="2375.8091">SELECT pc.participantId, spc.participantCurrencyId, spcsc.settlementStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="618" y="2390.9419">spcsc.reason, spc.netAmount, pc.currencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="606" y="2406.0747">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="203" x="644" y="2406.0747">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="850" y="2406.0747">spc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="606" y="2421.2075">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="285" x="636" y="2421.2075">settlementParticipantCurrencyStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="924" y="2421.2075">spcsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="486" x="606" y="2436.3403">ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="606" y="2451.4731">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="131" x="636" y="2451.4731">participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="770" y="2451.4731">pc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="333" x="606" y="2466.606">ON pc.participantCurrencyId = spc.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="469" x="606" y="2481.7388">WHERE spc.settlementParticipantCurrencyId = {settlementParticipantCurrencyId}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="580" x2="1119" y1="2494.8047" y2="2494.8047"/><polygon fill="#FFFFE0" filter="url(#f1vni6l1jht6gd)" points="600,2500.8047,1099,2500.8047,1109,2564.8047,1099,2629.8047,600,2629.8047,590,2564.8047,600,2500.8047" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="443" x="602" y="2516.8716">SELECT pc.participantId, spc.participantCurrencyId, spcsc.settlementStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="614" y="2532.0044">spcsc.reason, spc.netAmount, pc.currencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="602" y="2547.1372">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="203" x="640" y="2547.1372">settlementParticipantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="846" y="2547.1372">spc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="602" y="2562.27">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="285" x="632" y="2562.27">settlementParticipantCurrencyStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="920" y="2562.27">spcsc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="486" x="602" y="2577.4028">ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="27" x="602" y="2592.5356">JOIN</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="131" x="632" y="2592.5356">participantCurrency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="766" y="2592.5356">pc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="333" x="602" y="2607.6685">ON pc.participantCurrencyId = spc.participantCurrencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="495" x="602" y="2622.8013">WHERE spc.settlementParticipantCurrencyId IN {settlementParticipantCurrencyIdList}</text><polygon fill="#A80036" points="379.5,2659,369.5,2663,379.5,2667,375.5,2663" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="373.5" x2="690.5" y1="2663" y2="2663"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="385.5" y="2657.9341">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="403.5" y="2657.9341">Return</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58" x="446.5" y="2657.9341">accounts</text><path d="M32,2676 L32,3155 L349,3155 L349,2686 L339,2676 L32,2676 " fill="#FFFF00" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M339,2676 L339,2686 L349,2686 L339,2676 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="38" y="2693.0669">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="50" y="2708.1997">"id": settlement.settlementId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="50" y="2723.3325">"state": settlement.settlementStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="50" y="2738.4653">"settlementWindows": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="62" y="2753.5981">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="74" y="2768.731">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="86" y="2783.8638">"id": window.settlementWindowId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="86" y="2798.9966">"reason": window.reason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="86" y="2814.1294">"state": window.settlementWindowStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="86" y="2829.2622">"createdDate": window.createdDate,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="222" x="86" y="2844.395">"changedDate": window.changedDate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="74" y="2859.5278">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="62" y="2874.6606">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="50" y="2889.7935">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="50" y="2904.9263">"participants": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="62" y="2920.0591">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="74" y="2935.1919">"id": account.participantId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="74" y="2950.3247">"accounts": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="86" y="2965.4575">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="98" y="2980.5903">"id": account.participantCurrencyId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="98" y="2995.7231">"reason": account.reason,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="98" y="3010.856">"state": account.settlementStateId,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="98" y="3025.9888">"netSettlementAmount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="110" y="3041.1216">"amount": account.netAmount,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="110" y="3056.2544">"currency": account.currencyId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="98" y="3071.3872">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="86" y="3086.52">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="74" y="3101.6528">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="62" y="3116.7856">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="50" y="3131.9185">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="38" y="3147.0513">}</text><polygon fill="#A80036" points="133.5,3181.25,123.5,3185.25,133.5,3189.25,129.5,3185.25" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="127.5" x2="357.5" y1="3185.25" y2="3185.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="139.5" y="3180.1841">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="157.5" y="3180.1841">Respond HTTP - 200 (OK)</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="22" x2="1129" y1="3194.25" y2="3194.25"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="655" x="27" y="3204.4604">[!settlementFound || !participantFoundInSettlement || !participantAndAccountMatched || !accountFoundInSettlement]</text><path d="M373,3213.0547 L373,3238.0547 L622,3238.0547 L622,3223.0547 L612,3213.0547 L373,3213.0547 " fill="#D3D3D3" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M612,3213.0547 L612,3223.0547 L622,3223.0547 L612,3213.0547 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="379" y="3230.1216">Log ERROR event (based on the failure)</text><path d="M46,3252.1875 L46,3352.1875 L349,3352.1875 L349,3262.1875 L339,3252.1875 L46,3252.1875 " fill="#FFFF00" filter="url(#f1vni6l1jht6gd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M339,3252.1875 L339,3262.1875 L349,3262.1875 L339,3252.1875 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="52" y="3269.2544">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="64" y="3284.3872">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="76" y="3299.52">"errorCode": &lt;integer&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="76" y="3314.6528">"errorDescription": "Client error description"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="64" y="3329.7856">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="52" y="3344.9185">}</text><polygon fill="#A80036" points="128.5,3379.1172,118.5,3383.1172,128.5,3387.1172,124.5,3383.1172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="122.5" x2="362.5" y1="3383.1172" y2="3383.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="134.5" y="3378.0513">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="152.5" y="3378.0513">Respond HTTP - 4xx (Client error)</text><!--
@startuml
title 6.2.3. Get Settlement By Settlement, Participant and Account (getSettlementBySettlementParticipantAccount)
autonumber

actor "Hub Employee" as OPERATOR
boundary "Settlement Service API" as SSAPI
entity "Settlement DAO" as SETTLE_DAO
database "Central Store" as DB

box "Central HUB" #lightpink
    participant OPERATOR
end box

box "Settlement Service" #lightgreen
    participant SSAPI
    participant SETTLE_DAO
end box

box "Central Services" #lightyellow
    participant DB
end box

group Get Settlement By Settlement, Participant and Account
activate OPERATOR
    alt
        OPERATOR -> SSAPI: GET - /settlements/{settlementId}/\nparticipants/{participantId}
    else
        OPERATOR -> SSAPI: GET - /settlements/{settlementId}/\nparticipants/{participantId}/\naccounts/{accountId}
    end

    activate SSAPI

    note right of SSAPI #lightgray
        let settlementFound = false
        let participantFoundInSettlement = false
        let accountProvided = accountId > 0
        let participantAndAccountMatched = !accountProvided
        let accountFoundInSettlement = !accountProvided
    end note
    SSAPI-> SETTLE_DAO: Request settlement state\n<color #FF0000><b>Error code:</b> 2001</color>
    activate SETTLE_DAO
    SETTLE_DAO -> DB: Retrieve settlement
    activate DB
    hnote over DB #lightyellow
        SELECT s.settlementId, ssc.settlementStateId, s.reason, s.createdDate
        FROM **settlement** s
        JOIN **settlementStateChange** ssc
        ON ssc.settlementStateChangeId = s.currentStateChangeId
        WHERE s.settlementId = {id}
    end hnote
    deactivate DB
    SSAPI <- - SETTLE_DAO: Return **settlement**
    deactivate SETTLE_DAO
    note right of SSAPI #lightgray
        if (settlement.settlementId) {
            **settlementFound** = true
        }
    end note

    opt settlementFound
        SSAPI-> SETTLE_DAO: Check participant\n<color #FF0000><b>Error code:</b> 2001</color>
        activate SETTLE_DAO
        SETTLE_DAO -> DB: Check exists
        activate DB
        hnote over DB #lightyellow
            SELECT settlementParticipantCurrencyId
            FROM **settlementParticipantCurrency** spc
            JOIN **participantCurrency** pc
            ON pc.participantCurrencyId = spc.participantCurrencyId
            WHERE spc.settlementId = {id}
            AND pc.participantId = {participantId}
        end hnote
        deactivate DB
        SSAPI <- - SETTLE_DAO: Return **settlementParticipantCurrencyIdList**
        deactivate SETTLE_DAO
        note right of SSAPI #lightgray
            if (settlementParticipantCurrencyIdList.length > 0) {
                **participantFoundInSettlement** = true
            }
        end note

        opt participantFoundInSettlement && accountProvided
            SSAPI-> SETTLE_DAO: Check participant\n<color #FF0000><b>Error code:</b> 2001</color>
            activate SETTLE_DAO
            SETTLE_DAO -> DB: Check exists
            activate DB
            hnote over DB #lightyellow
                SELECT participantCurrencyId
                JOIN **participantCurrency**
                WHERE participantCurrencyId = {accountId}
                AND participantId = {participantId}
            end hnote
            deactivate DB
            SSAPI <- - SETTLE_DAO: Return **account**
            deactivate SETTLE_DAO
            note right of SSAPI #lightgray
                if (account) {
                    **participantAndAccountMatched** = true
                }
            end note

            opt participantAndAccountMatched
                SSAPI-> SETTLE_DAO: Check account in settlement\n<color #FF0000><b>Error code:</b> 2001</color>
                activate SETTLE_DAO
                SETTLE_DAO -> DB: Check exists
                activate DB
                hnote over DB #lightyellow
                    SELECT settlementParticipantCurrencyId
                    FROM **settlementParticipantCurrency**
                    WHERE spc.settlementId = {id}
                    AND pc.participantCurrencyId = {accountId}
                end hnote
                deactivate DB
                SSAPI <- - SETTLE_DAO: Return **settlementParticipantCurrencyId**
                deactivate SETTLE_DAO

                note right of SSAPI #lightgray
                    if (settlementParticipantCurrencyId) {
                        **accountFoundInSettlement** = true
                    }
                end note
            end
        end
    end

    alt settlementFound && participantFoundInSettlement && participantAndAccountMatched && accountFoundInSettlement
        SSAPI-> SETTLE_DAO: Request settlement windows\n<color #FF0000><b>Error code:</b> 2001</color>
        activate SETTLE_DAO
        SETTLE_DAO -> DB: Retrieve windows
        activate DB
        alt accountProvided
            hnote over DB #lightyellow
                SELECT DISTINCT sw.settlementWindowId, swsc.settlementWindowStateId,
                    swsc.reason, sw.createdDate, swsc.createdDate changedDate
                FROM **settlementSettlementWindow** ssw
                JOIN **settlementWindow** sw
                ON sw.settlementWindowId = ssw.settlementWindowId
                JOIN **settlementWindowStateChange** swsc
                ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId
                JOIN **settlementTransferParticipant** stp
                ON stp.settlementWindowId = sw.settlementWindowId
                AND stp.participantCurrencyId = {accountId}
                WHERE ssw.settlementId = {id}
            end hnote
        else
            hnote over DB #lightyellow
                SELECT DISTINCT sw.settlementWindowId, swsc.settlementWindowStateId,
                    swsc.reason, sw.createdDate, swsc.createdDate changedDate
                FROM **settlementSettlementWindow** ssw
                JOIN **settlementWindow** sw
                ON sw.settlementWindowId = ssw.settlementWindowId
                JOIN **settlementWindowStateChange** swsc
                ON swsc.settlementWindowStateChangeId = sw.currentStateChangeId
                JOIN **settlementTransferParticipant** stp
                ON stp.settlementWindowId = sw.settlementWindowId
                AND stp.participantCurrencyId IN(
                    SELECT participantCurrencyId
                    FROM participantCurrency
                    WHERE participantId = {participantId}
                )
                WHERE ssw.settlementId = {id}
            end hnote
        end
        deactivate DB
        SSAPI <- - SETTLE_DAO: Return **windows**
        deactivate SETTLE_DAO

        SSAPI-> SETTLE_DAO: Request settlement accounts\n<color #FF0000><b>Error code:</b> 2001</color>
        activate SETTLE_DAO
        SETTLE_DAO -> DB: Retrieve accounts
        activate DB
        alt accountProvided
            hnote over DB #lightyellow
                SELECT pc.participantId, spc.participantCurrencyId, spcsc.settlementStateId, 
                    spcsc.reason, spc.netAmount, pc.currencyId
                FROM **settlementParticipantCurrency** spc
                JOIN **settlementParticipantCurrencyStateChange** spcsc
                ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId
                JOIN **participantCurrency** pc
                ON pc.participantCurrencyId = spc.participantCurrencyId
                WHERE spc.settlementParticipantCurrencyId = {settlementParticipantCurrencyId}
            end hnote
        else
            hnote over DB #lightyellow
                SELECT pc.participantId, spc.participantCurrencyId, spcsc.settlementStateId, 
                    spcsc.reason, spc.netAmount, pc.currencyId
                FROM **settlementParticipantCurrency** spc
                JOIN **settlementParticipantCurrencyStateChange** spcsc
                ON spcsc.settlementParticipantCurrencyStateChangeId = spc.currentStateChangeId
                JOIN **participantCurrency** pc
                ON pc.participantCurrencyId = spc.participantCurrencyId
                WHERE spc.settlementParticipantCurrencyId IN {settlementParticipantCurrencyIdList}
            end hnote
        end
        deactivate DB
        SSAPI <- - SETTLE_DAO: Return **accounts**
        deactivate SETTLE_DAO

        deactivate SETTLE_DAO
        note left of SSAPI #yellow
            {
                "id": settlement.settlementId,
                "state": settlement.settlementStateId,
                "settlementWindows": [
                    [
                        {
                            "id": window.settlementWindowId,
                            "reason": window.reason,
                            "state": window.settlementWindowStateId,
                            "createdDate": window.createdDate,
                            "changedDate": window.changedDate
                        }
                    ]
                ],
                "participants": [
                    {
                        "id": account.participantId,
                        "accounts": [
                            {
                                "id": account.participantCurrencyId,
                                "reason": account.reason,
                                "state": account.settlementStateId,
                                "netSettlementAmount": {
                                    "amount": account.netAmount,
                                    "currency": account.currencyId
                                }
                            }
                        ]
                    }
                ]
            }
        end note
        OPERATOR <- - SSAPI: Respond HTTP - 200 (OK)
    else !settlementFound || !participantFoundInSettlement || !participantAndAccountMatched || !accountFoundInSettlement
        note right of SSAPI #lightgray
            Log ERROR event (based on the failure)
        end note
        note left of SSAPI #yellow
            {
                errorInformation: {
                    "errorCode": <integer>,
                    "errorDescription": "Client error description"
                }
            }
        end note
        OPERATOR <- - SSAPI: Respond HTTP - 4xx (Client error)
        deactivate SSAPI
        deactivate OPERATOR
    end
end
@enduml

PlantUML version 1.2018.02(Fri Mar 09 17:20:44 GMT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_212-b04
Operating System: Linux
OS Version: 4.15.0-1035-aws
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>