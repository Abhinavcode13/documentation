<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="903px" preserveAspectRatio="none" style="width:2077px;height:903px;" version="1.1" viewBox="0 0 2077 903" width="2077px" zoomAndPan="magnify"><defs><filter height="300%" id="f1uxo6e40pmu42" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="499" x="790" y="22.9951">1.1.4.b. Send notification to Participant (Payer/Payee) (batch messages)</text><rect fill="#D3D3D3" height="857.8438" style="stroke: #A80036; stroke-width: 1.0;" width="172" x="4" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="166" x="7" y="46.3638">Financial Service Provider</text><rect fill="#ADD8E6" height="857.8438" style="stroke: #A80036; stroke-width: 1.0;" width="230" x="586" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="626.5" y="46.3638">ML API Adapter Service</text><rect fill="#FFFFE0" height="857.8438" style="stroke: #A80036; stroke-width: 1.0;" width="964.5" x="1071.5" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="1504.75" y="46.3638">Central Service</text><rect fill="#FFFFFF" filter="url(#f1uxo6e40pmu42)" height="616.5234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="696" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f1uxo6e40pmu42)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1138" y="208.2891"/><rect fill="#FFFFFF" filter="url(#f1uxo6e40pmu42)" height="197.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1279" y="315.6875"/><rect fill="#FFFFFF" filter="url(#f1uxo6e40pmu42)" height="178.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1279" y="549.6172"/><rect fill="#FFFFFF" filter="url(#f1uxo6e40pmu42)" height="139.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1469" y="344.8203"/><rect fill="#FFFFFF" filter="url(#f1uxo6e40pmu42)" height="120.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1687" y="578.75"/><rect fill="#FFFFFF" filter="url(#f1uxo6e40pmu42)" height="172.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1983" y="607.8828"/><rect fill="#FFFFFF" filter="url(#f1uxo6e40pmu42)" height="602.5234" style="stroke: #000000; stroke-width: 2.0;" width="2033" x="33" y="170.0234"/><rect fill="#FFFFFF" filter="url(#f1uxo6e40pmu42)" height="512.2578" style="stroke: #000000; stroke-width: 2.0;" width="2013" x="43" y="253.2891"/><rect fill="#FFFFFF" filter="url(#f1uxo6e40pmu42)" height="244.0625" style="stroke: #000000; stroke-width: 2.0;" width="952" x="580" y="277.4219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="90" x2="90" y1="153.0234" y2="789.5469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="701" x2="701" y1="153.0234" y2="789.5469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1142.5" x2="1142.5" y1="153.0234" y2="789.5469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1283.5" x2="1283.5" y1="153.0234" y2="789.5469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1474" x2="1474" y1="153.0234" y2="789.5469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1578" x2="1578" y1="153.0234" y2="789.5469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1692" x2="1692" y1="153.0234" y2="789.5469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1988" x2="1988" y1="153.0234" y2="789.5469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="63" y="133.4248">DFSP(n)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="53" y="149.7217">Participant</text><ellipse cx="90" cy="63.4297" fill="#FEFECE" filter="url(#f1uxo6e40pmu42)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M90,71.4297 L90,98.4297 M77,79.4297 L103,79.4297 M90,98.4297 L77,113.4297 M90,98.4297 L103,113.4297 " fill="none" filter="url(#f1uxo6e40pmu42)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="63" y="801.542">DFSP(n)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="53" y="817.8389">Participant</text><ellipse cx="90" cy="831.1406" fill="#FEFECE" filter="url(#f1uxo6e40pmu42)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M90,839.1406 L90,866.1406 M77,847.1406 L103,847.1406 M90,866.1406 L77,881.1406 M90,866.1406 L103,881.1406 " fill="none" filter="url(#f1uxo6e40pmu42)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="216" x="590" y="149.7217">ML API Notification Event Handler</text><ellipse cx="701" cy="120.7266" fill="#FEFECE" filter="url(#f1uxo6e40pmu42)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="697,108.7266,703,103.7266,701,108.7266,703,113.7266,697,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="216" x="590" y="801.542">ML API Notification Event Handler</text><ellipse cx="701" cy="820.8438" fill="#FEFECE" filter="url(#f1uxo6e40pmu42)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="697,808.8438,703,803.8438,701,808.8438,703,813.8438,697,808.8438" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1uxo6e40pmu42)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1079.5" y="113.7266"/><rect fill="#FEFECE" filter="url(#f1uxo6e40pmu42)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1075.5" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1082.5" y="137.7217">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1uxo6e40pmu42)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1079.5" y="788.5469"/><rect fill="#FEFECE" filter="url(#f1uxo6e40pmu42)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1075.5" y="792.5469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1082.5" y="812.542">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="1220.5" y="149.7217">Central Service API</text><path d="M1263.5,108.7266 L1263.5,132.7266 M1263.5,120.7266 L1280.5,120.7266 " fill="none" filter="url(#f1uxo6e40pmu42)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1292.5" cy="120.7266" fill="#FEFECE" filter="url(#f1uxo6e40pmu42)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="1220.5" y="801.542">Central Service API</text><path d="M1263.5,808.8438 L1263.5,832.8438 M1263.5,820.8438 L1280.5,820.8438 " fill="none" filter="url(#f1uxo6e40pmu42)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1292.5" cy="820.8438" fill="#FEFECE" filter="url(#f1uxo6e40pmu42)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1uxo6e40pmu42)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="1430" y="113.7266"/><rect fill="#FEFECE" filter="url(#f1uxo6e40pmu42)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="1426" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="1433" y="137.7217">Event-Topic</text><rect fill="#FEFECE" filter="url(#f1uxo6e40pmu42)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="1430" y="788.5469"/><rect fill="#FEFECE" filter="url(#f1uxo6e40pmu42)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="1426" y="792.5469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="1433" y="812.542">Event-Topic</text><rect fill="#FEFECE" filter="url(#f1uxo6e40pmu42)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="1532" y="117.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="1539" y="137.7217">EVENT_DAO</text><rect fill="#FEFECE" filter="url(#f1uxo6e40pmu42)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="89" x="1532" y="788.5469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="1539" y="808.542">EVENT_DAO</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="1635" y="149.7217">Notification DAO</text><ellipse cx="1692" cy="120.7266" fill="#FEFECE" filter="url(#f1uxo6e40pmu42)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1680" x2="1704" y1="134.7266" y2="134.7266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="1635" y="801.542">Notification DAO</text><ellipse cx="1692" cy="820.8438" fill="#FEFECE" filter="url(#f1uxo6e40pmu42)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1680" x2="1704" y1="834.8438" y2="834.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1944" y="149.7217">Central Store</text><path d="M1970,100.7266 C1970,90.7266 1988,90.7266 1988,90.7266 C1988,90.7266 2006,90.7266 2006,100.7266 L2006,126.7266 C2006,136.7266 1988,136.7266 1988,136.7266 C1988,136.7266 1970,136.7266 1970,126.7266 L1970,100.7266 " fill="#FEFECE" filter="url(#f1uxo6e40pmu42)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1970,100.7266 C1970,110.7266 1988,110.7266 1988,110.7266 C1988,110.7266 2006,110.7266 2006,100.7266 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1944" y="801.542">Central Store</text><path d="M1970,814.8438 C1970,804.8438 1988,804.8438 1988,804.8438 C1988,804.8438 2006,804.8438 2006,814.8438 L2006,840.8438 C2006,850.8438 1988,850.8438 1988,850.8438 C1988,850.8438 1970,850.8438 1970,840.8438 L1970,814.8438 " fill="#FEFECE" filter="url(#f1uxo6e40pmu42)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1970,814.8438 C1970,824.8438 1988,824.8438 1988,824.8438 C1988,824.8438 2006,824.8438 2006,814.8438 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1uxo6e40pmu42)" height="616.5234" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="696" y="163.0234"/><rect fill="#FFFFFF" filter="url(#f1uxo6e40pmu42)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1138" y="208.2891"/><rect fill="#FFFFFF" filter="url(#f1uxo6e40pmu42)" height="197.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1279" y="315.6875"/><rect fill="#FFFFFF" filter="url(#f1uxo6e40pmu42)" height="178.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1279" y="549.6172"/><rect fill="#FFFFFF" filter="url(#f1uxo6e40pmu42)" height="139.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1469" y="344.8203"/><rect fill="#FFFFFF" filter="url(#f1uxo6e40pmu42)" height="120.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1687" y="578.75"/><rect fill="#FFFFFF" filter="url(#f1uxo6e40pmu42)" height="172.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1983" y="607.8828"/><path d="M33,170.0234 L281,170.0234 L281,177.0234 L271,187.0234 L33,187.0234 L33,170.0234 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="602.5234" style="stroke: #000000; stroke-width: 2.0;" width="2033" x="33" y="170.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="203" x="48" y="183.0903">Send notification to Participant</text><polygon fill="#A80036" points="1126,204.2891,1136,208.2891,1126,212.2891,1130,208.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="706" x2="1132" y1="208.2891" y2="208.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="713" y="203.2231">1</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="402" x="724" y="203.2231">Consume Notifications event batch of messages for Participant</text><path d="M43,253.2891 L116,253.2891 L116,260.2891 L106,270.2891 L43,270.2891 L43,253.2891 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="512.2578" style="stroke: #000000; stroke-width: 2.0;" width="2013" x="43" y="253.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="58" y="266.356">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="147" x="131" y="265.4995">[for each message in batch]</text><path d="M580,277.4219 L790,277.4219 L790,284.4219 L780,294.4219 L580,294.4219 L580,277.4219 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="244.0625" style="stroke: #000000; stroke-width: 2.0;" width="952" x="580" y="277.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="165" x="595" y="290.4888">Persist Event Information</text><polygon fill="#A80036" points="1267,311.6875,1277,315.6875,1267,319.6875,1271,315.6875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="706" x2="1273" y1="315.6875" y2="315.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="713" y="310.6216">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="306" x="724" y="310.6216">Request to persist event information - POST - /events</text><polygon fill="#A80036" points="1457,340.8203,1467,344.8203,1457,348.8203,1461,344.8203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1289" x2="1463" y1="344.8203" y2="344.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="1296" y="339.7544">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="1307" y="339.7544">Publish event information</text><rect fill="#FFFFFF" filter="url(#f1uxo6e40pmu42)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="192" x="1423" y="377.8203"/><polygon fill="#EEEEEE" points="1423,377.8203,1487,377.8203,1487,384.8203,1477,394.8203,1423,394.8203,1423,377.8203" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1436" y="391.8872">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="1429" y="410.8872">Event Handler Consume {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-event-9.1.0.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-event-9.1.0.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="27" x="1578" y="410.8872">9.1.0</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1578" x2="1605" y1="412.8872" y2="412.8872"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1605" y="410.8872">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1432" y="426.02"/><polygon fill="#A80036" points="1300,480.3516,1290,484.3516,1300,488.3516,1296,484.3516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1294" x2="1473" y1="484.3516" y2="484.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="1306" y="479.2856">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="1317" y="479.2856">Return success</text><polygon fill="#A80036" points="717,509.4844,707,513.4844,717,517.4844,713,513.4844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="711" x2="1283" y1="513.4844" y2="513.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="723" y="508.4185">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="734" y="508.4185">Return success</text><polygon fill="#A80036" points="1267,545.6172,1277,549.6172,1267,553.6172,1271,549.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="706" x2="1273" y1="549.6172" y2="549.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="713" y="544.5513">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="420" x="724" y="544.5513">Request Notifications details for Participant - GET - /notifications/DFPS(n)</text><polygon fill="#A80036" points="1675,574.75,1685,578.75,1675,582.75,1679,578.75" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1289" x2="1681" y1="578.75" y2="578.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="1296" y="573.6841">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="1307" y="573.6841">Fetch Notifications details for Participant</text><polygon fill="#A80036" points="1971,603.8828,1981,607.8828,1971,611.8828,1975,607.8828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1697" x2="1977" y1="607.8828" y2="607.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="1704" y="602.8169">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="1715" y="602.8169">Fetch Notifications details for Participant</text><polygon fill="#FFFFE0" filter="url(#f1uxo6e40pmu42)" points="1939,620.8828,2036,620.8828,2046,631.8828,2036,643.8828,1939,643.8828,1929,631.8828,1939,620.8828" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="1941" y="636.9497">transferPosition</text><polygon fill="#A80036" points="1708,666.1484,1698,670.1484,1708,674.1484,1704,670.1484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1702" x2="1982" y1="670.1484" y2="670.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="1714" y="665.0825">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="1725" y="665.0825">Retrieved Notification details for Participant</text><polygon fill="#A80036" points="1300,695.2813,1290,699.2813,1300,703.2813,1296,699.2813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1294" x2="1691" y1="699.2813" y2="699.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1306" y="694.2153">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="1324" y="694.2153">Return Notifications details for Participant</text><polygon fill="#A80036" points="717,724.4141,707,728.4141,717,732.4141,713,728.4141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="711" x2="1283" y1="728.4141" y2="728.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="723" y="723.3481">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="741" y="723.3481">Return Notifications details for Participant</text><polygon fill="#A80036" points="101,753.5469,91,757.5469,101,761.5469,97,757.5469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="95" x2="695" y1="757.5469" y2="757.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="107" y="752.481">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="519" x="125" y="752.481">Callback with Prepare result to Participant to specified URL - PUT - /&lt;dfsp-host&gt;&gt;/transfers</text><!--
@startuml
title 1.1.4.b. Send notification to Participant (Payer/Payee) (batch messages)

autonumber


actor "DFSP(n)\nParticipant" as DFSP
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
collections "Event-Topic" as TOPIC_EVENTS
entity "Notification DAO" as NOTIFY_DAO
database "Central Store" as DB

box "Financial Service Provider" #lightGray
	participant DFSP
end box

box "ML API Adapter Service" #LightBlue
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
participant TOPIC_NOTIFICATIONS
    participant CSAPI
    participant TOPIC_EVENTS
    participant EVENT_DAO
    participant NOTIFY_DAO
    participant DB
end box

activate NOTIFY_HANDLER
group Send notification to Participant
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: <color #FF0000>**Consume Notifications event batch of messages for Participant**</color>
    activate TOPIC_NOTIFICATIONS
    deactivate TOPIC_NOTIFICATIONS
    loop for each message in batch
        group Persist Event Information
            NOTIFY_HANDLER -> CSAPI: Request to persist event information - POST - /events
            activate CSAPI
            CSAPI -> TOPIC_EVENTS: Publish event information
            activate TOPIC_EVENTS
            |||
            ref over TOPIC_EVENTS :  Event Handler Consume {[[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-event-9.1.0.svg 9.1.0]]} \n
            |||
            TOPIC_EVENTS - -> CSAPI: Return success
            deactivate TOPIC_EVENTS
            CSAPI - -> NOTIFY_HANDLER: Return success
            deactivate CSAPI
        end
        NOTIFY_HANDLER -> CSAPI: Request Notifications details for Participant - GET - /notifications/DFPS(n)
        activate CSAPI
        CSAPI -> NOTIFY_DAO: Fetch Notifications details for Participant
        activate NOTIFY_DAO
        NOTIFY_DAO -> DB: Fetch Notifications details for Participant
        activate DB
        hnote over DB #lightyellow
            transferPosition
        end note
        DB - -> NOTIFY_DAO: Retrieved Notification details for Participant
        NOTIFY_DAO - -> CSAPI: Return Notifications details for Participant
        deactivate NOTIFY_DAO
        CSAPI - -> NOTIFY_HANDLER: Return Notifications details for Participant
        deactivate CSAPI
        NOTIFY_HANDLER - -> DFSP: Callback with Prepare result to Participant to specified URL - PUT - /<dfsp-host>>/transfers
    end
end
deactivate NOTIFY_HANDLER
@enduml

PlantUML version 1.2018.02(Fri Mar 09 17:20:44 GMT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_212-b04
Operating System: Linux
OS Version: 4.15.0-1035-aws
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>