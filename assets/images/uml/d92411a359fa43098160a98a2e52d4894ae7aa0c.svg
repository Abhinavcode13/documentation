<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="4948px" preserveAspectRatio="none" style="width:1862px;height:4948px;" version="1.1" viewBox="0 0 1862 4948" width="1862px" zoomAndPan="magnify"><defs><filter height="300%" id="fvpz4chvh2xfd" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="304" x="780" y="22.9951">2.2.1. Fulfil Handler Consume (Reject/Abort)</text><rect fill="#FFFFE0" height="4902.9297" style="stroke: #A80036; stroke-width: 1.0;" width="1699" x="29" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="829.5" y="46.3638">Central Service</text><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="74" y="195.125"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="4736.2031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="344" y="125.7266"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="908" y="3038.1563"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="908" y="4249.7344"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1174" y="3523.4141"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1174" y="4734.9922"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="150.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1297" y="677.25"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="135.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1297" y="938.5781"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="121.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1297" y="1507.3828"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="120.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1297" y="1711.1797"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="136.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1297" y="1981.5078"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="121.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1297" y="2265.5078"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="2369.4922" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1297" y="2493.4375"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="1188.1797" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1302" y="3674.75"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="92.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1675" y="706.3828"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="77.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1675" y="967.7109"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1675" y="1536.5156"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="62.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1675" y="1740.3125"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1675" y="2010.6406"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1675" y="2294.6406"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1675" y="2522.5703"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1675" y="3703.8828"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="4722.2031" style="stroke: #000000; stroke-width: 2.0;" width="1838" x="13" y="132.7266"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="4691.0703" style="stroke: #000000; stroke-width: 2.0;" width="1818" x="23" y="156.8594"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="105.5313" style="stroke: #000000; stroke-width: 2.0;" width="510" x="264" y="240.125"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="74.3984" style="stroke: #000000; stroke-width: 2.0;" width="490" x="274" y="264.2578"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="91.5313" style="stroke: #000000; stroke-width: 2.0;" width="837.5" x="274" y="359.6563"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="102.5313" style="stroke: #000000; stroke-width: 2.0;" width="982.5" x="274" y="465.1875"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="1062.0625" style="stroke: #000000; stroke-width: 2.0;" width="1587" x="244" y="581.7188"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="751.6016" style="stroke: #000000; stroke-width: 2.0;" width="1544" x="254" y="885.1797"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="360.0703" style="stroke: #000000; stroke-width: 2.0;" width="1002.5" x="264" y="1089.2422"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="59.2656" style="stroke: #000000; stroke-width: 2.0;" width="243" x="274" y="1113.375"/><rect fill="#FFFFFF" height="106.3359" style="stroke: none; stroke-width: 1.0;" width="1002.5" x="264" y="1179.6406"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="77.5313" style="stroke: #000000; stroke-width: 2.0;" width="982.5" x="274" y="1201.4453"/><rect fill="#FFFFFF" height="88.0703" style="stroke: none; stroke-width: 1.0;" width="1002.5" x="264" y="1285.9766"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="59.2656" style="stroke: #000000; stroke-width: 2.0;" width="219" x="274" y="1307.7813"/><rect fill="#FFFFFF" height="75.2656" style="stroke: none; stroke-width: 1.0;" width="1002.5" x="264" y="1374.0469"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="59.2656" style="stroke: #000000; stroke-width: 2.0;" width="323" x="274" y="1383.0469"/><rect fill="#FFFFFF" height="180.4688" style="stroke: none; stroke-width: 1.0;" width="1544" x="254" y="1456.3125"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="3129.2109" style="stroke: #000000; stroke-width: 2.0;" width="1528" x="254" y="1657.7813"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="555.1953" style="stroke: #000000; stroke-width: 2.0;" width="1500" x="264" y="1846.7109"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="197.9297" style="stroke: #000000; stroke-width: 2.0;" width="1480" x="274" y="1928.1094"/><rect fill="#FFFFFF" height="268.8672" style="stroke: none; stroke-width: 1.0;" width="1500" x="264" y="2133.0391"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="182.7969" style="stroke: #000000; stroke-width: 2.0;" width="1480" x="274" y="2212.1094"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="1152.5078" style="stroke: #000000; stroke-width: 2.0;" width="1508" x="264" y="2415.9063"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="182.7969" style="stroke: #000000; stroke-width: 2.0;" width="1488" x="274" y="2440.0391"/><rect fill="#FFFFFF" height="492.2578" style="stroke: none; stroke-width: 1.0;" width="1508" x="264" y="3076.1563"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="463.4531" style="stroke: #000000; stroke-width: 2.0;" width="982.5" x="274" y="3097.9609"/><rect fill="#FFFFFF" height="1211.5781" style="stroke: none; stroke-width: 1.0;" width="1528" x="254" y="3575.4141"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="1182.7734" style="stroke: #000000; stroke-width: 2.0;" width="1508" x="264" y="3597.2188"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="213.0625" style="stroke: #000000; stroke-width: 2.0;" width="1488" x="274" y="3621.3516"/><rect fill="#FFFFFF" height="492.2578" style="stroke: none; stroke-width: 1.0;" width="1508" x="264" y="4287.7344"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="463.4531" style="stroke: #000000; stroke-width: 2.0;" width="982.5" x="274" y="4309.5391"/><rect fill="#FFFFFF" height="53.9375" style="stroke: none; stroke-width: 1.0;" width="1818" x="23" y="4793.9922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="79" x2="79" y1="115.7266" y2="4871.9297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="349" x2="349" y1="115.7266" y2="4871.9297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="912.5" x2="912.5" y1="115.7266" y2="4871.9297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1053.5" x2="1053.5" y1="115.7266" y2="4871.9297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1178.5" x2="1178.5" y1="115.7266" y2="4871.9297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1301.5" x2="1301.5" y1="115.7266" y2="4871.9297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1680" x2="1680" y1="115.7266" y2="4871.9297"/><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="37" y="76.4297"/><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="33" y="80.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="40" y="100.4248">Fulfil-Topic</text><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="37" y="4870.9297"/><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="33" y="4874.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="40" y="4894.9248">Fulfil-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="124" x="284" y="112.4248">Fulfil Event Handler</text><ellipse cx="349" cy="83.4297" fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="345,71.4297,351,66.4297,349,71.4297,351,76.4297,345,71.4297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="124" x="284" y="4883.9248">Fulfil Event Handler</text><ellipse cx="349" cy="4903.2266" fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="345,4891.2266,351,4886.2266,349,4891.2266,351,4896.2266,345,4891.2266" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="834.5" y="76.4297"/><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="830.5" y="80.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="837.5" y="100.4248">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="834.5" y="4870.9297"/><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="830.5" y="4874.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="837.5" y="4894.9248">topic-transfer-position</text><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="1009.5" y="76.4297"/><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="1005.5" y="80.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="1012.5" y="100.4248">Event-Topic</text><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="1009.5" y="4870.9297"/><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="88" x="1005.5" y="4874.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="1012.5" y="4894.9248">Event-Topic</text><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1115.5" y="76.4297"/><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1111.5" y="80.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1118.5" y="100.4248">Notification-Topic</text><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1115.5" y="4870.9297"/><rect fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="127" x="1111.5" y="4874.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="113" x="1118.5" y="4894.9248">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="1256.5" y="112.4248">Transfer DAO</text><ellipse cx="1302" cy="83.4297" fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1290" x2="1314" y1="97.4297" y2="97.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="1256.5" y="4883.9248">Transfer DAO</text><ellipse cx="1302" cy="4903.2266" fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1290" x2="1314" y1="4917.2266" y2="4917.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1636" y="112.4248">Central Store</text><path d="M1662,63.4297 C1662,53.4297 1680,53.4297 1680,53.4297 C1680,53.4297 1698,53.4297 1698,63.4297 L1698,89.4297 C1698,99.4297 1680,99.4297 1680,99.4297 C1680,99.4297 1662,99.4297 1662,89.4297 L1662,63.4297 " fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1662,63.4297 C1662,73.4297 1680,73.4297 1680,73.4297 C1680,73.4297 1698,73.4297 1698,63.4297 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1636" y="4883.9248">Central Store</text><path d="M1662,4897.2266 C1662,4887.2266 1680,4887.2266 1680,4887.2266 C1680,4887.2266 1698,4887.2266 1698,4897.2266 L1698,4923.2266 C1698,4933.2266 1680,4933.2266 1680,4933.2266 C1680,4933.2266 1662,4933.2266 1662,4923.2266 L1662,4897.2266 " fill="#FEFECE" filter="url(#fvpz4chvh2xfd)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1662,4897.2266 C1662,4907.2266 1680,4907.2266 1680,4907.2266 C1680,4907.2266 1698,4907.2266 1698,4897.2266 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="74" y="195.125"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="4736.2031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="344" y="125.7266"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="908" y="3038.1563"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="908" y="4249.7344"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1174" y="3523.4141"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1174" y="4734.9922"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="150.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1297" y="677.25"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="135.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1297" y="938.5781"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="121.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1297" y="1507.3828"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="120.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1297" y="1711.1797"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="136.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1297" y="1981.5078"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="121.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1297" y="2265.5078"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="2369.4922" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1297" y="2493.4375"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="1188.1797" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1302" y="3674.75"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="92.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1675" y="706.3828"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="77.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1675" y="967.7109"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1675" y="1536.5156"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="62.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1675" y="1740.3125"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1675" y="2010.6406"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1675" y="2294.6406"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1675" y="2522.5703"/><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1675" y="3703.8828"/><path d="M13,132.7266 L261,132.7266 L261,139.7266 L251,149.7266 L13,149.7266 L13,132.7266 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="4722.2031" style="stroke: #000000; stroke-width: 2.0;" width="1838" x="13" y="132.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="203" x="28" y="145.7935">Fulfil Handler Consume (Failure)</text><path d="M23,156.8594 L86,156.8594 L86,163.8594 L76,173.8594 L23,173.8594 L23,156.8594 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="4691.0703" style="stroke: #000000; stroke-width: 2.0;" width="1818" x="23" y="156.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="38" y="169.9263">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="138" x="101" y="169.0698">[Consume Single Message]</text><polygon fill="#A80036" points="95,191.125,85,195.125,95,199.125,91,195.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="89" x2="343" y1="195.125" y2="195.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="101" y="190.0591">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="112" y="190.0591">Consume Fulfil event message for Payer</text><path d="M264,240.125 L347,240.125 L347,247.125 L337,257.125 L264,257.125 L264,240.125 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="105.5313" style="stroke: #000000; stroke-width: 2.0;" width="510" x="264" y="240.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="279" y="253.1919">break</text><path d="M274,264.2578 L412,264.2578 L412,271.2578 L402,281.2578 L274,281.2578 L274,264.2578 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="74.3984" style="stroke: #000000; stroke-width: 2.0;" width="490" x="274" y="264.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="289" y="277.3247">Validate Event</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="396" y1="317.6563" y2="317.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="396" y1="317.6563" y2="330.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="396" y1="330.6563" y2="330.6563"/><polygon fill="#A80036" points="365,326.6563,355,330.6563,365,334.6563,361,330.6563" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="361" y="305.0239">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="380" x="372" y="297.4575">Validate event - Rule: type == 'fulfil' &amp;&amp; ( action IN ['reject','abort'] )</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="372" y="312.5903">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="452" y="312.5903">2001</text><path d="M274,359.6563 L484,359.6563 L484,366.6563 L474,376.6563 L274,376.6563 L274,359.6563 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="91.5313" style="stroke: #000000; stroke-width: 2.0;" width="837.5" x="274" y="359.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="165" x="289" y="372.7231">Persist Event Information</text><polygon fill="#A80036" points="1041.5,393.9219,1051.5,397.9219,1041.5,401.9219,1045.5,397.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1047.5" y1="397.9219" y2="397.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="361" y="392.856">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="372" y="392.856">Publish event information</text><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="40.2656" style="stroke: #000000; stroke-width: 2.0;" width="819.5" x="281" y="405.9219"/><polygon fill="#EEEEEE" points="281,405.9219,345,405.9219,345,412.9219,335,422.9219,281,422.9219,281,405.9219" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="294" y="419.9888">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="602.25" y="438.9888">Event Handler Consume {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-event-9.1.0.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-event-9.1.0.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="27" x="751.25" y="438.9888">9.1.0</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="751.25" x2="778.25" y1="440.9888" y2="440.9888"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="778.25" y="438.9888">}</text><path d="M274,465.1875 L488,465.1875 L488,472.1875 L478,482.1875 L274,482.1875 L274,465.1875 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="102.5313" style="stroke: #000000; stroke-width: 2.0;" width="982.5" x="274" y="465.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="169" x="289" y="478.2544">Validate FSPIOP-Signature</text><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="964.5" x="281" y="507.3203"/><polygon fill="#EEEEEE" points="281,507.3203,345,507.3203,345,514.3203,335,524.3203,281,524.3203,281,507.3203" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="294" y="521.3872">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="529.75" y="540.3872">Validate message.content.headers.</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="112" x="731.75" y="540.3872">FSPIOP-Signature</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="846.75" y="540.3872">{</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-signature-validation.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-signature-validation.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="141" x="851.75" y="540.3872">seq-signature-validation</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="851.75" x2="992.75" y1="542.3872" y2="542.3872"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="992.75" y="540.3872">}</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="529.75" y="555.52">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="609.75" y="555.52">2001</text><path d="M244,581.7188 L541,581.7188 L541,588.7188 L531,598.7188 L244,598.7188 L244,581.7188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1062.0625" style="stroke: #000000; stroke-width: 2.0;" width="1587" x="244" y="581.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="252" x="259" y="594.7856">Validate Transfer Fulfil Duplicate Check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="396" y1="619.9844" y2="619.9844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="396" y1="619.9844" y2="632.9844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="396" y1="632.9844" y2="632.9844"/><polygon fill="#A80036" points="365,628.9844,355,632.9844,365,636.9844,361,632.9844" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="361" y="614.9185">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="203" x="372" y="614.9185">Generate transferFulfilmentId uuid</text><polygon fill="#A80036" points="1285,673.25,1295,677.25,1285,681.25,1289,677.25" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1291" y1="677.25" y2="677.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="361" y="664.6177">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="341" x="372" y="657.0513">Request to retrieve transfer fulfilment hashes by transferId</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="372" y="672.1841">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="446" y="672.1841">2003</text><polygon fill="#A80036" points="1663,702.3828,1673,706.3828,1663,710.3828,1667,706.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1307" x2="1669" y1="706.3828" y2="706.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="1314" y="701.3169">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="314" x="1325" y="701.3169">Request Transfer fulfilment duplicate message hashes</text><polygon fill="#FFFFE0" filter="url(#fvpz4chvh2xfd)" points="1549,719.3828,1811,719.3828,1821,745.3828,1811,772.3828,1549,772.3828,1539,745.3828,1549,719.3828" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="1551" y="735.4497">SELET transferId, hash</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="1551" y="750.5825">FROM</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="220" x="1589" y="750.5825">transferFulfilmentDuplicateCheck</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="1551" y="765.7153">WHERE transferId = request.params.id</text><polygon fill="#A80036" points="1318,794.9141,1308,798.9141,1318,802.9141,1314,798.9141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1312" x2="1679" y1="798.9141" y2="798.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="1324" y="793.8481">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="1335" y="793.8481">Return existing hashes</text><polygon fill="#A80036" points="365,824.0469,355,828.0469,365,832.0469,361,828.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="359" x2="1301" y1="828.0469" y2="828.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="371" y="822.981">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="382" y="822.981">Return (list of) transfer fulfil messages hash(es)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="396" y1="857.1797" y2="857.1797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="396" y1="857.1797" y2="870.1797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="396" y1="870.1797" y2="870.1797"/><polygon fill="#A80036" points="365,866.1797,355,870.1797,365,874.1797,361,870.1797" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="361" y="852.1138">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="529" x="372" y="852.1138">Loop the list of returned hashes and compare each entry with the calculated message hash</text><path d="M254,885.1797 L317,885.1797 L317,892.1797 L307,902.1797 L254,902.1797 L254,885.1797 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="751.6016" style="stroke: #000000; stroke-width: 2.0;" width="1544" x="254" y="885.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="269" y="898.2466">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="84" x="332" y="897.3901">[Hash matched]</text><polygon fill="#A80036" points="1285,934.5781,1295,938.5781,1285,942.5781,1289,938.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1291" y1="938.5781" y2="938.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="925.9458">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="331" x="379" y="918.3794">Request to retrieve Transfer Fulfilment and Transfer state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="379" y="933.5122">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="453" y="933.5122">2003</text><polygon fill="#A80036" points="1663,963.7109,1673,967.7109,1663,971.7109,1667,967.7109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1307" x2="1669" y1="967.7109" y2="967.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1314" y="962.645">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="331" x="1332" y="962.645">Request to retrieve Transfer Fulfilment and Transfer state</text><polygon fill="#FFFFE0" filter="url(#fvpz4chvh2xfd)" points="1618,980.7109,1742,980.7109,1752,999.7109,1742,1018.7109,1618,1018.7109,1608,999.7109,1618,980.7109" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="1620" y="996.7778">transferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="1620" y="1011.9106">transferStateChange</text><polygon fill="#A80036" points="1318,1041.1094,1308,1045.1094,1318,1049.1094,1314,1045.1094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1312" x2="1679" y1="1045.1094" y2="1045.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1324" y="1040.0435">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="1342" y="1040.0435">Return Transfer Fulfilment and Transfer state</text><polygon fill="#A80036" points="365,1070.2422,355,1074.2422,365,1078.2422,361,1074.2422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="359" x2="1301" y1="1074.2422" y2="1074.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="371" y="1069.1763">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="389" y="1069.1763">Return Transfer Fulfilment and Transfer state</text><path d="M264,1089.2422 L327,1089.2422 L327,1096.2422 L317,1106.2422 L264,1106.2422 L264,1089.2422 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="360.0703" style="stroke: #000000; stroke-width: 2.0;" width="1002.5" x="264" y="1089.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="279" y="1102.3091">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="169" x="342" y="1101.4526">[transferFulfilment.isValid == 0]</text><path d="M274,1113.375 L357,1113.375 L357,1120.375 L347,1130.375 L274,1130.375 L274,1113.375 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.2656" style="stroke: #000000; stroke-width: 2.0;" width="243" x="274" y="1113.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="289" y="1126.4419">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="396" y1="1151.6406" y2="1151.6406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="396" y1="1151.6406" y2="1164.6406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="396" y1="1164.6406" y2="1164.6406"/><polygon fill="#A80036" points="365,1160.6406,355,1164.6406,365,1168.6406,361,1164.6406" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="1146.5747">14</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="95" x="379" y="1146.5747">Error handling:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="477" y="1146.5747">3105</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="264" x2="1266.5" y1="1180.6406" y2="1180.6406"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="241" x="269" y="1190.8511">[transferState IN ['COMMITTED', 'ABORTED']]</text><path d="M274,1201.4453 L357,1201.4453 L357,1208.4453 L347,1218.4453 L274,1218.4453 L274,1201.4453 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="77.5313" style="stroke: #000000; stroke-width: 2.0;" width="982.5" x="274" y="1201.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="289" y="1214.5122">break</text><rect fill="#FFFFFF" filter="url(#fvpz4chvh2xfd)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="964.5" x="281" y="1218.5781"/><polygon fill="#EEEEEE" points="281,1218.5781,345,1218.5781,345,1225.5781,335,1235.5781,281,1235.5781,281,1218.5781" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="294" y="1232.645">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="626.75" y="1251.645">Send notification to Participant (Payee) {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.4.a.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.4.a.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="37" x="858.75" y="1251.645">1.1.4.a</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="858.75" x2="895.75" y1="1253.645" y2="1253.645"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="895.75" y="1251.645">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="629.75" y="1266.7778"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="264" x2="1266.5" y1="1286.9766" y2="1286.9766"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="168" x="269" y="1297.187">[transferState NOT 'RESERVED']</text><path d="M274,1307.7813 L357,1307.7813 L357,1314.7813 L347,1324.7813 L274,1324.7813 L274,1307.7813 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.2656" style="stroke: #000000; stroke-width: 2.0;" width="219" x="274" y="1307.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="289" y="1320.8481">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="396" y1="1346.0469" y2="1346.0469"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="396" y1="1346.0469" y2="1359.0469"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="396" y1="1359.0469" y2="1359.0469"/><polygon fill="#A80036" points="365,1355.0469,355,1359.0469,365,1363.0469,361,1359.0469" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="1340.981">15</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="379" y="1340.981">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="453" y="1340.981">2001</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="264" x2="1266.5" y1="1375.0469" y2="1375.0469"/><path d="M274,1383.0469 L357,1383.0469 L357,1390.0469 L347,1400.0469 L274,1400.0469 L274,1383.0469 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.2656" style="stroke: #000000; stroke-width: 2.0;" width="323" x="274" y="1383.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="289" y="1396.1138">break</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="396" y1="1421.3125" y2="1421.3125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="396" y1="1421.3125" y2="1434.3125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="396" y1="1434.3125" y2="1434.3125"/><polygon fill="#A80036" points="365,1430.3125,355,1434.3125,365,1438.3125,361,1434.3125" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="1416.2466">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206" x="379" y="1416.2466">Allow previous request to complete</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="254" x2="1798" y1="1457.3125" y2="1457.3125"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="106" x="259" y="1467.5229">[Hash not matched]</text><polygon fill="#A80036" points="1285,1503.3828,1295,1507.3828,1285,1511.3828,1289,1507.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1291" y1="1507.3828" y2="1507.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="1494.7505">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="379" y="1487.1841">Request to persist transfer hash</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="379" y="1502.3169">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="459" y="1502.3169">2003</text><polygon fill="#A80036" points="1663,1532.5156,1673,1536.5156,1663,1540.5156,1667,1536.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1307" x2="1669" y1="1536.5156" y2="1536.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1314" y="1531.4497">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="1332" y="1531.4497">Persist hash</text><polygon fill="#FFFFE0" filter="url(#fvpz4chvh2xfd)" points="1581,1579.5156,1778,1579.5156,1788,1590.5156,1778,1602.5156,1581,1602.5156,1571,1590.5156,1581,1579.5156" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="1583" y="1595.5825">transferFulfilmentDuplicateCheck</text><polygon fill="#A80036" points="365,1624.7813,355,1628.7813,365,1632.7813,361,1628.7813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="359" x2="1301" y1="1628.7813" y2="1628.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="371" y="1623.7153">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="389" y="1623.7153">Return success</text><path d="M254,1657.7813 L317,1657.7813 L317,1664.7813 L307,1674.7813 L254,1674.7813 L254,1657.7813 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="3129.2109" style="stroke: #000000; stroke-width: 2.0;" width="1528" x="254" y="1657.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="269" y="1670.8481">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="267" x="332" y="1669.9917">[action=='reject' call made on PUT /transfers/{ID}]</text><polygon fill="#A80036" points="1285,1707.1797,1295,1711.1797,1285,1715.1797,1289,1711.1797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1291" y1="1711.1797" y2="1711.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="1698.5474">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252" x="379" y="1690.981">Request information for the validate checks</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="379" y="1706.1138">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="453" y="1706.1138">2003</text><polygon fill="#A80036" points="1663,1736.3125,1673,1740.3125,1663,1744.3125,1667,1740.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1307" x2="1669" y1="1740.3125" y2="1740.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1314" y="1735.2466">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1332" y="1735.2466">Fetch from database</text><polygon fill="#FFFFE0" filter="url(#fvpz4chvh2xfd)" points="1655,1753.3125,1705,1753.3125,1715,1764.3125,1705,1776.3125,1655,1776.3125,1645,1764.3125,1655,1753.3125" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="1657" y="1769.3794">transfer</text><polygon fill="#A80036" points="1318,1798.5781,1308,1802.5781,1318,1806.5781,1314,1802.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1312" x2="1679" y1="1802.5781" y2="1802.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1324" y="1797.5122">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1345" y="1797.5122"/><polygon fill="#A80036" points="365,1827.7109,355,1831.7109,365,1835.7109,361,1831.7109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="359" x2="1301" y1="1831.7109" y2="1831.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="371" y="1826.645">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="389" y="1826.645">Return transfer</text><path d="M264,1846.7109 L327,1846.7109 L327,1853.7109 L317,1863.7109 L264,1863.7109 L264,1846.7109 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="555.1953" style="stroke: #000000; stroke-width: 2.0;" width="1500" x="264" y="1846.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="279" y="1859.7778">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="294" x="342" y="1858.9214">[Fulfilment present in the PUT /transfers/{ID} message]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="396" y1="1900.1094" y2="1900.1094"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="396" y1="1900.1094" y2="1913.1094"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="396" y1="1913.1094" y2="1913.1094"/><polygon fill="#A80036" points="365,1909.1094,355,1913.1094,365,1917.1094,361,1913.1094" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="1887.4771">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="425" x="379" y="1879.9106">Validate that Transfer.ilpCondition = SHA-256 (content.payload.fulfilment)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="379" y="1895.0435">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="453" y="1895.0435">2001</text><path d="M274,1928.1094 L430,1928.1094 L430,1935.1094 L420,1945.1094 L274,1945.1094 L274,1928.1094 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="197.9297" style="stroke: #000000; stroke-width: 2.0;" width="1480" x="274" y="1928.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="289" y="1941.1763">Persist fulfilment</text><polygon fill="#A80036" points="1285,1977.5078,1295,1981.5078,1285,1985.5078,1289,1981.5078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1291" y1="1981.5078" y2="1981.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="1968.8755">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="448" x="379" y="1961.3091">Persist fulfilment with the result of the above check (transferFulfilment.isValid)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="379" y="1976.4419">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="453" y="1976.4419">2003</text><polygon fill="#A80036" points="1663,2006.6406,1673,2010.6406,1663,2014.6406,1667,2010.6406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1307" x2="1669" y1="2010.6406" y2="2010.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1314" y="2005.5747">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="1332" y="2005.5747">Persist to database</text><polygon fill="#FFFFE0" filter="url(#fvpz4chvh2xfd)" points="1626,2053.6406,1734,2053.6406,1744,2072.6406,1734,2091.6406,1626,2091.6406,1616,2072.6406,1626,2053.6406" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="1628" y="2069.7075">transferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="1628" y="2084.8403">transferExtension</text><polygon fill="#A80036" points="365,2114.0391,355,2118.0391,365,2122.0391,361,2118.0391" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="359" x2="1301" y1="2118.0391" y2="2118.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="371" y="2112.9731">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="389" y="2112.9731">Return success</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="264" x2="1764" y1="2134.0391" y2="2134.0391"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="320" x="269" y="2144.2495">[Fulfilment NOT present in the PUT /transfers/{ID} message]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="396" y1="2184.1094" y2="2184.1094"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="396" x2="396" y1="2184.1094" y2="2197.1094"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="355" x2="396" y1="2197.1094" y2="2197.1094"/><polygon fill="#A80036" points="365,2193.1094,355,2197.1094,365,2201.1094,361,2197.1094" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="2171.4771">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="326" x="379" y="2163.9106">Validate that transfer fulfilment message to Abort is valid</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="379" y="2179.0435">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="453" y="2179.0435">2001</text><path d="M274,2212.1094 L435,2212.1094 L435,2219.1094 L425,2229.1094 L274,2229.1094 L274,2212.1094 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="182.7969" style="stroke: #000000; stroke-width: 2.0;" width="1480" x="274" y="2212.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="116" x="289" y="2225.1763">Persist extensions</text><polygon fill="#A80036" points="1285,2261.5078,1295,2265.5078,1285,2269.5078,1289,2265.5078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1291" y1="2265.5078" y2="2265.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="2252.8755">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="379" y="2245.3091">Persist extensionList elements</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="379" y="2260.4419">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="453" y="2260.4419">2003</text><polygon fill="#A80036" points="1663,2290.6406,1673,2294.6406,1663,2298.6406,1667,2294.6406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1307" x2="1669" y1="2294.6406" y2="2294.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1314" y="2289.5747">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="1332" y="2289.5747">Persist to database</text><polygon fill="#FFFFE0" filter="url(#fvpz4chvh2xfd)" points="1626,2337.6406,1734,2337.6406,1744,2348.6406,1734,2360.6406,1626,2360.6406,1616,2348.6406,1626,2337.6406" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="1628" y="2353.7075">transferExtension</text><polygon fill="#A80036" points="365,2382.9063,355,2386.9063,365,2390.9063,361,2386.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="359" x2="1301" y1="2386.9063" y2="2386.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="371" y="2381.8403">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="389" y="2381.8403">Return success</text><path d="M264,2415.9063 L327,2415.9063 L327,2422.9063 L317,2432.9063 L264,2432.9063 L264,2415.9063 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1152.5078" style="stroke: #000000; stroke-width: 2.0;" width="1508" x="264" y="2415.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="279" y="2428.9731">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="401" x="342" y="2428.1167">[Transfer.ilpCondition validate successful OR generic validation successful]</text><path d="M274,2440.0391 L707,2440.0391 L707,2447.0391 L697,2457.0391 L274,2457.0391 L274,2440.0391 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="182.7969" style="stroke: #000000; stroke-width: 2.0;" width="1488" x="274" y="2440.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="388" x="289" y="2453.106">Persist Transfer State (with transferState='RECEIVED_REJECT')</text><polygon fill="#A80036" points="1285,2489.4375,1295,2493.4375,1285,2497.4375,1289,2493.4375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1291" y1="2493.4375" y2="2493.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="2480.8052">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="379" y="2473.2388">Request to persist transfer state</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="379" y="2488.3716">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="453" y="2488.3716">2003</text><polygon fill="#A80036" points="1663,2518.5703,1673,2522.5703,1663,2526.5703,1667,2522.5703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1307" x2="1669" y1="2522.5703" y2="2522.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1314" y="2517.5044">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1332" y="2517.5044">Persist transfer state</text><polygon fill="#FFFFE0" filter="url(#fvpz4chvh2xfd)" points="1618,2565.5703,1742,2565.5703,1752,2576.5703,1742,2588.5703,1618,2588.5703,1608,2576.5703,1618,2565.5703" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="1620" y="2581.6372">transferStateChange</text><polygon fill="#A80036" points="365,2610.8359,355,2614.8359,365,2618.8359,361,2614.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="359" x2="1296" y1="2614.8359" y2="2614.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="371" y="2609.77">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="389" y="2609.77">Return success</text><path d="M359,2634.8359 L359,3007.8359 L638,3007.8359 L638,2644.8359 L628,2634.8359 L359,2634.8359 " fill="#FFFF00" filter="url(#fvpz4chvh2xfd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M628,2634.8359 L628,2644.8359 L638,2644.8359 L628,2634.8359 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="365" y="2651.9028">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="2667.0356">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="377" y="2682.1685">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="377" y="2697.3013">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="377" y="2712.4341">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="377" y="2727.5669">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="377" y="2742.6997">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="389" y="2757.8325">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="389" y="2772.9653">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="377" y="2788.0981">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="377" y="2803.231">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="389" y="2818.3638">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="401" y="2833.4966">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="401" y="2848.6294">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="401" y="2863.7622">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="401" y="2878.895">action: reject,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="401" y="2894.0278">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="401" y="2909.1606">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="413" y="2924.2935">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="413" y="2939.4263">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="401" y="2954.5591">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="389" y="2969.6919">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="377" y="2984.8247">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="2999.9575">}</text><polygon fill="#A80036" points="896,3034.1563,906,3038.1563,896,3042.1563,900,3038.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="902" y1="3038.1563" y2="3038.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="3033.0903">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="379" y="3033.0903">Route &amp; Publish Position event for Payer</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="264" x2="1772" y1="3077.1563" y2="3077.1563"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="357" x="269" y="3087.3667">[Validate Fulfil Transfer not successful or Generic validation failed]</text><path d="M274,3097.9609 L357,3097.9609 L357,3104.9609 L347,3114.9609 L274,3114.9609 L274,3097.9609 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="463.4531" style="stroke: #000000; stroke-width: 2.0;" width="982.5" x="274" y="3097.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="289" y="3111.0278">break</text><path d="M359,3120.0938 L359,3493.0938 L638,3493.0938 L638,3130.0938 L628,3120.0938 L359,3120.0938 " fill="#FFFF00" filter="url(#fvpz4chvh2xfd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M628,3120.0938 L628,3130.0938 L638,3130.0938 L628,3120.0938 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="365" y="3137.1606">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="3152.2935">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="377" y="3167.4263">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="377" y="3182.5591">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="377" y="3197.6919">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="377" y="3212.8247">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="377" y="3227.9575">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="389" y="3243.0903">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="389" y="3258.2231">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="377" y="3273.356">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="377" y="3288.4888">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="389" y="3303.6216">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="401" y="3318.7544">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="401" y="3333.8872">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="401" y="3349.02">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="401" y="3364.1528">action: reject,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="401" y="3379.2856">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="401" y="3394.4185">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="413" y="3409.5513">status: "fail",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="413" y="3424.6841">code: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="401" y="3439.8169">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="389" y="3454.9497">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="377" y="3470.0825">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="3485.2153">}</text><polygon fill="#A80036" points="1162,3519.4141,1172,3523.4141,1162,3527.4141,1166,3523.4141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1168" y1="3523.4141" y2="3523.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="3518.3481">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="379" y="3518.3481">Route &amp; Publish Notification event for Payee</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="254" x2="1782" y1="3576.4141" y2="3576.4141"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="167" x="259" y="3586.6245">[action=='abort' Error callback]</text><path d="M264,3597.2188 L327,3597.2188 L327,3604.2188 L317,3614.2188 L264,3614.2188 L264,3597.2188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1182.7734" style="stroke: #000000; stroke-width: 2.0;" width="1508" x="264" y="3597.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="279" y="3610.2856">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="120" x="342" y="3609.4292">[Validation successful]</text><path d="M274,3621.3516 L708,3621.3516 L708,3628.3516 L698,3638.3516 L274,3638.3516 L274,3621.3516 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="213.0625" style="stroke: #000000; stroke-width: 2.0;" width="1488" x="274" y="3621.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="389" x="289" y="3634.4185">Persist Transfer State (with transferState='RECEIVED_ERROR')</text><polygon fill="#A80036" points="1290,3670.75,1300,3674.75,1290,3678.75,1294,3674.75" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1296" y1="3674.75" y2="3674.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="3662.1177">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="379" y="3654.5513">Request to persist transfer state and Error</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="379" y="3669.6841">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="453" y="3669.6841">2003</text><polygon fill="#A80036" points="1663,3699.8828,1673,3703.8828,1663,3707.8828,1667,3703.8828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1312" x2="1669" y1="3703.8828" y2="3703.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1319" y="3698.8169">38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="1337" y="3698.8169">Persist transfer state and error information</text><polygon fill="#FFFFE0" filter="url(#fvpz4chvh2xfd)" points="1618,3746.8828,1742,3746.8828,1752,3772.8828,1742,3799.8828,1618,3799.8828,1608,3772.8828,1618,3746.8828" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="1620" y="3762.9497">transferStateChange</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="1620" y="3778.0825">transferError</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="1620" y="3793.2153">transferExtension</text><polygon fill="#A80036" points="365,3822.4141,355,3826.4141,365,3830.4141,361,3826.4141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="359" x2="1301" y1="3826.4141" y2="3826.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="371" y="3821.3481">39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="389" y="3821.3481">Return success</text><path d="M359,3846.4141 L359,4219.4141 L638,4219.4141 L638,3856.4141 L628,3846.4141 L359,3846.4141 " fill="#FFFF00" filter="url(#fvpz4chvh2xfd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M628,3846.4141 L628,3856.4141 L638,3856.4141 L628,3846.4141 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="365" y="3863.481">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="3878.6138">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="377" y="3893.7466">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="377" y="3908.8794">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="377" y="3924.0122">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="377" y="3939.145">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="377" y="3954.2778">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="389" y="3969.4106">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="389" y="3984.5435">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="377" y="3999.6763">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="377" y="4014.8091">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="389" y="4029.9419">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="401" y="4045.0747">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="401" y="4060.2075">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="401" y="4075.3403">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="401" y="4090.4731">action: abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="401" y="4105.606">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="401" y="4120.7388">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="413" y="4135.8716">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="413" y="4151.0044">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="401" y="4166.1372">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="389" y="4181.27">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="377" y="4196.4028">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="4211.5356">}</text><polygon fill="#A80036" points="896,4245.7344,906,4249.7344,896,4253.7344,900,4249.7344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="902" y1="4249.7344" y2="4249.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="4244.6685">40</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="379" y="4244.6685">Route &amp; Publish Position event for Payer</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="264" x2="1772" y1="4288.7344" y2="4288.7344"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="257" x="269" y="4298.9448">[Validate Transfer Error Message not successful]</text><path d="M274,4309.5391 L357,4309.5391 L357,4316.5391 L347,4326.5391 L274,4326.5391 L274,4309.5391 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="463.4531" style="stroke: #000000; stroke-width: 2.0;" width="982.5" x="274" y="4309.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="38" x="289" y="4322.606">break</text><path d="M359,4331.6719 L359,4704.6719 L638,4704.6719 L638,4341.6719 L628,4331.6719 L359,4331.6719 " fill="#FFFF00" filter="url(#fvpz4chvh2xfd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M628,4331.6719 L628,4341.6719 L638,4341.6719 L628,4331.6719 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="365" y="4348.7388">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="4363.8716">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="377" y="4379.0044">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="377" y="4394.1372">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="377" y="4409.27">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="377" y="4424.4028">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="377" y="4439.5356">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="389" y="4454.6685">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="389" y="4469.8013">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="377" y="4484.9341">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="377" y="4500.0669">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="389" y="4515.1997">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="401" y="4530.3325">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="401" y="4545.4653">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="401" y="4560.5981">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="401" y="4575.731">action: abort,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="401" y="4590.8638">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="401" y="4605.9966">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="413" y="4621.1294">status: "fail",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="413" y="4636.2622">code: 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="401" y="4651.395">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="389" y="4666.5278">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="377" y="4681.6606">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="365" y="4696.7935">}</text><polygon fill="#A80036" points="1162,4730.9922,1172,4734.9922,1162,4738.9922,1166,4734.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="354" x2="1168" y1="4734.9922" y2="4734.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="361" y="4729.9263">41</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="379" y="4729.9263">Route &amp; Publish Notification event for Payee</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="1841" y1="4794.9922" y2="4794.9922"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="143" x="28" y="4805.2026">[Consume Batch Messages]</text><path d="M136,4813.7969 L136,4838.7969 L335,4838.7969 L335,4823.7969 L325,4813.7969 L136,4813.7969 " fill="#ADD8E6" filter="url(#fvpz4chvh2xfd)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M325,4813.7969 L325,4823.7969 L335,4823.7969 L325,4813.7969 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="142" y="4830.8638">To be delivered by future story</text><!--
@startuml
title 2.2.1. Fulfil Handler Consume (Reject/Abort)
autonumber
collections "Fulfil-Topic" as TOPIC_FULFIL
control "Fulfil Event Handler" as FULF_HANDLER
collections "Event-Topic" as TOPIC_EVENT
collections "topic-transfer-position" as TOPIC_TRANSFER_POSITION
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
entity "Transfer DAO" as TRANS_DAO
database "Central Store" as DB
box "Central Service" #LightYellow
    participant TOPIC_FULFIL
    participant FULF_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant TOPIC_EVENT
    participant TOPIC_NOTIFICATIONS
    participant TRANS_DAO
    participant DB
end box
activate FULF_HANDLER
group Fulfil Handler Consume (Failure)
    alt Consume Single Message
        TOPIC_FULFIL <- FULF_HANDLER: Consume Fulfil event message for Payer
        activate TOPIC_FULFIL
        deactivate TOPIC_FULFIL
        break
            group Validate Event
                FULF_HANDLER <-> FULF_HANDLER: Validate event - Rule: type == 'fulfil' && ( action IN ['reject','abort'] )\n<color #FF0000><b>Error codes:</b> 2001</color>
            end
        end
        group Persist Event Information
            FULF_HANDLER -> TOPIC_EVENT: Publish event information
            ref over FULF_HANDLER, TOPIC_EVENT:  Event Handler Consume {[[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-event-9.1.0.svg 9.1.0]]}
        end
        group Validate FSPIOP-Signature
            |||
            ref over FULF_HANDLER, TOPIC_NOTIFICATIONS: Validate message.content.headers.**FSPIOP-Signature** {[[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-signature-validation.svg seq-signature-validation]]} \n<color #FF0000><b>Error codes:</b> 2001</color>
        end
        group Validate Transfer Fulfil Duplicate Check
            FULF_HANDLER -> FULF_HANDLER: Generate transferFulfilmentId uuid
            FULF_HANDLER -> TRANS_DAO: Request to retrieve transfer fulfilment hashes by transferId\n<color #FF0000><b>Error code:</b> 2003</color>
            activate TRANS_DAO
            TRANS_DAO -> DB: Request Transfer fulfilment duplicate message hashes
            hnote over DB #lightyellow
                SELET transferId, hash
                FROM **transferFulfilmentDuplicateCheck**
                WHERE transferId = request.params.id
            end note
            activate DB
            TRANS_DAO <- - DB: Return existing hashes
            deactivate DB
            TRANS_DAO - -> FULF_HANDLER: Return (list of) transfer fulfil messages hash(es)
            deactivate TRANS_DAO
            FULF_HANDLER -> FULF_HANDLER: Loop the list of returned hashes and compare each entry with the calculated message hash
            alt Hash matched
                FULF_HANDLER -> TRANS_DAO: Request to retrieve Transfer Fulfilment and Transfer state\n<color #FF0000><b>Error code:</b> 2003</color>
                activate TRANS_DAO
                TRANS_DAO -> DB: Request to retrieve Transfer Fulfilment and Transfer state
                hnote over DB #lightyellow
                    transferFulfilment
                    transferStateChange
                end note
                activate DB
                TRANS_DAO <- - DB: Return Transfer Fulfilment and Transfer state
                deactivate DB
                TRANS_DAO - -> FULF_HANDLER: Return Transfer Fulfilment and Transfer state
                deactivate TRANS_DAO
                alt transferFulfilment.isValid == 0
                    break
                        FULF_HANDLER <-> FULF_HANDLER: <color #FF0000><b>Error handling:</b> 3105</color>
                    end
                else transferState IN ['COMMITTED', 'ABORTED']
                    break
                        ref over FULF_HANDLER, TOPIC_NOTIFICATIONS: Send notification to Participant (Payee) {[[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-prepare-1.1.4.a.svg 1.1.4.a]]} \n
                    end
                else transferState NOT 'RESERVED'
                    break
                        FULF_HANDLER <-> FULF_HANDLER: <color #FF0000><b>Error code:</b> 2001</color>
                    end
                else
                    break
                        FULF_HANDLER <-> FULF_HANDLER: Allow previous request to complete
                    end
                end
            else Hash not matched
                FULF_HANDLER -> TRANS_DAO: Request to persist transfer hash\n<color #FF0000><b>Error codes:</b> 2003</color>
                activate TRANS_DAO
                TRANS_DAO -> DB: Persist hash
                hnote over DB #lightyellow
                    transferFulfilmentDuplicateCheck
                end note
                activate DB
                deactivate DB
                TRANS_DAO - -> FULF_HANDLER: Return success
                deactivate TRANS_DAO
            end
        end
        alt action=='reject' call made on PUT /transfers/{ID}
            FULF_HANDLER -> TRANS_DAO: Request information for the validate checks\n<color #FF0000><b>Error code:</b> 2003</color>
            activate TRANS_DAO
            TRANS_DAO -> DB: Fetch from database
            activate DB
            hnote over DB #lightyellow
                transfer
            end note
            DB - -> TRANS_DAO
            deactivate DB
            FULF_HANDLER <- - TRANS_DAO: Return transfer
            deactivate TRANS_DAO

            alt Fulfilment present in the PUT /transfers/{ID} message
                FULF_HANDLER ->FULF_HANDLER: Validate that Transfer.ilpCondition = SHA-256 (content.payload.fulfilment)\n<color #FF0000><b>Error code:</b> 2001</color>

                group Persist fulfilment
                    FULF_HANDLER -> TRANS_DAO: Persist fulfilment with the result of the above check (transferFulfilment.isValid)\n<color #FF0000><b>Error code:</b> 2003</color>
                    activate TRANS_DAO
                    TRANS_DAO -> DB: Persist to database
                    activate DB
                    deactivate DB
                    hnote over DB #lightyellow
                        transferFulfilment
                        transferExtension
                    end note
                    FULF_HANDLER <- - TRANS_DAO: Return success
                    deactivate TRANS_DAO
                end
            else Fulfilment NOT present in the PUT /transfers/{ID} message
                FULF_HANDLER ->FULF_HANDLER: Validate that transfer fulfilment message to Abort is valid\n<color #FF0000><b>Error code:</b> 2001</color>
                group Persist extensions
                    FULF_HANDLER -> TRANS_DAO: Persist extensionList elements\n<color #FF0000><b>Error code:</b> 2003</color>
                    activate TRANS_DAO
                    TRANS_DAO -> DB: Persist to database
                    activate DB
                    deactivate DB
                    hnote over DB #lightyellow
                        transferExtension
                    end note
                    FULF_HANDLER <- - TRANS_DAO: Return success
                    deactivate TRANS_DAO
                end
            end

            alt Transfer.ilpCondition validate successful OR generic validation successful
                group Persist Transfer State (with transferState='RECEIVED_REJECT')
                    FULF_HANDLER -> TRANS_DAO: Request to persist transfer state\n<color #FF0000><b>Error code:</b> 2003</color>
                    activate TRANS_DAO
                    TRANS_DAO -> DB: Persist transfer state
                    activate DB
                    hnote over DB #lightyellow
                        transferStateChange
                    end note
                    deactivate DB
                    TRANS_DAO - -> FULF_HANDLER: Return success
                end

                note right of FULF_HANDLER #yellow
                    Message:
                    {
                        id: <ID>,
                        from: <transferHeaders.FSPIOP-Source>,
                        to: <transferHeaders.FSPIOP-Destination>,
                        type: application/json,
                        content: {
                            headers: <transferHeaders>,
                            payload: <transferMessage>
                        },
                        metadata: {
                            event: {
                                id: <uuid>,
                                responseTo: <previous.uuid>,
                                type: position,
                                action: reject,
                                createdAt: <timestamp>,
                                state: {
                                    status: "success",
                                    code: 0
                                }
                            }
                        }
                    }
                end note

                FULF_HANDLER -> TOPIC_TRANSFER_POSITION: Route & Publish Position event for Payer
                activate TOPIC_TRANSFER_POSITION
                deactivate TOPIC_TRANSFER_POSITION
            else Validate Fulfil Transfer not successful or Generic validation failed
                break
                    note right of FULF_HANDLER #yellow
                        Message:
                        {
                            id: <ID>,
                            from: <transferHeaders.FSPIOP-Source>,
                            to: <transferHeaders.FSPIOP-Destination>,
                            type: application/json,
                            content: {
                                headers: <transferHeaders>,
                                payload: <transferMessage>
                            },
                            metadata: {
                                event: {
                                    id: <uuid>,
                                    responseTo: <previous.uuid>,
                                    type: position,
                                    action: reject,
                                    createdAt: <timestamp>,
                                    state: {
                                        status: "fail",
                                        code: 1
                                    }
                                }
                            }
                        }
                    end note
                    FULF_HANDLER -> TOPIC_NOTIFICATIONS: Route & Publish Notification event for Payee
                    activate TOPIC_NOTIFICATIONS
                    deactivate TOPIC_NOTIFICATIONS
                end
            end
        else action=='abort' Error callback
            alt Validation successful
                group Persist Transfer State (with transferState='RECEIVED_ERROR')
                    FULF_HANDLER -> TRANS_DAO: Request to persist transfer state and Error\n<color #FF0000><b>Error code:</b> 2003</color>
                    activate TRANS_DAO
                    TRANS_DAO -> DB: Persist transfer state and error information
                    activate DB
                    hnote over DB #lightyellow
                        transferStateChange
                        transferError
                        transferExtension
                    end note
                    deactivate DB
                    TRANS_DAO - -> FULF_HANDLER: Return success
                end

                note right of FULF_HANDLER #yellow
                    Message:
                    {
                        id: <ID>,
                        from: <transferHeaders.FSPIOP-Source>,
                        to: <transferHeaders.FSPIOP-Destination>,
                        type: application/json,
                        content: {
                            headers: <transferHeaders>,
                            payload: <transferMessage>
                        },
                        metadata: {
                            event: {
                                id: <uuid>,
                                responseTo: <previous.uuid>,
                                type: position,
                                action: abort,
                                createdAt: <timestamp>,
                                state: {
                                    status: "success",
                                    code: 0
                                }
                            }
                        }
                    }
                end note

                FULF_HANDLER -> TOPIC_TRANSFER_POSITION: Route & Publish Position event for Payer
                activate TOPIC_TRANSFER_POSITION
                deactivate TOPIC_TRANSFER_POSITION
            else Validate Transfer Error Message not successful
                break
                    note right of FULF_HANDLER #yellow
                        Message:
                        {
                            id: <ID>,
                            from: <transferHeaders.FSPIOP-Source>,
                            to: <transferHeaders.FSPIOP-Destination>,
                            type: application/json,
                            content: {
                                headers: <transferHeaders>,
                                payload: <transferMessage>
                            },
                            metadata: {
                                event: {
                                    id: <uuid>,
                                    responseTo: <previous.uuid>,
                                    type: position,
                                    action: abort,
                                    createdAt: <timestamp>,
                                    state: {
                                        status: "fail",
                                        code: 1
                                    }
                                }
                            }
                        }
                    end note
                    FULF_HANDLER -> TOPIC_NOTIFICATIONS: Route & Publish Notification event for Payee
                    activate TOPIC_NOTIFICATIONS
                    deactivate TOPIC_NOTIFICATIONS
                end
            end
        end
    else Consume Batch Messages
        note left of FULF_HANDLER #lightblue
            To be delivered by future story
        end note
    end
end
deactivate FULF_HANDLER
@enduml

PlantUML version 1.2018.02(Fri Mar 09 17:20:44 GMT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_212-b04
Operating System: Linux
OS Version: 4.15.0-1035-aws
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>