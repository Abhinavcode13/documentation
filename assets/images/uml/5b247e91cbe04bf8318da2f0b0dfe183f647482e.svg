<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3055px" preserveAspectRatio="none" style="width:2487px;height:3055px;" version="1.1" viewBox="0 0 2487 3055" width="2487px" zoomAndPan="magnify"><defs><filter height="300%" id="fqlyoynqkvozg" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="415" x="1037" y="22.9951">1.1.0. DFSP1 sends a Bulk Prepare Transfer request to DFSP2</text><rect fill="#D3D3D3" height="3009.7266" style="stroke: #A80036; stroke-width: 1.0;" width="178" x="4" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="172" x="7" y="46.3638">Financial Service Providers</text><rect fill="#ADD8E6" height="3009.7266" style="stroke: #A80036; stroke-width: 1.0;" width="368" x="264.5" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="374" y="46.3638">ML API Adapter Service</text><rect fill="#FFFFE0" height="3009.7266" style="stroke: #A80036; stroke-width: 1.0;" width="1780" x="680" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="1521" y="46.3638">Central Service</text><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="783.5781" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="316" y="1004.0625"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2768.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="557" y="163.0234"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="729" y="1105.5938"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="44.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="729" y="1886.0391"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="729" y="2616.1016"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="729" y="2772.7656"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="116.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="977.5" y="1641.8438"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2768.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1164.5" y="163.0234"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2768.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1563.5" y="163.0234"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2768.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1870.5" y="163.0234"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2768.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2177.5" y="163.0234"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2754.4063" style="stroke: #000000; stroke-width: 2.0;" width="2444" x="32" y="170.0234"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="105.3359" style="stroke: #000000; stroke-width: 2.0;" width="1350" x="1116" y="2005.7031"/><rect fill="#FFFFFF" height="43.9375" style="stroke: none; stroke-width: 1.0;" width="1350" x="1116" y="2067.1016"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="90.2031" style="stroke: #000000; stroke-width: 2.0;" width="593" x="1504" y="2239.5703"/><rect fill="#FFFFFF" height="43.9375" style="stroke: none; stroke-width: 1.0;" width="593" x="1504" y="2285.8359"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="65" x2="65" y1="153.0234" y2="2941.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="121" x2="121" y1="153.0234" y2="2941.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="320.5" x2="320.5" y1="153.0234" y2="2941.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="561.5" x2="561.5" y1="153.0234" y2="2941.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="734" x2="734" y1="153.0234" y2="2941.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="857" x2="857" y1="153.0234" y2="2941.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="982" x2="982" y1="153.0234" y2="2941.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1169" x2="1169" y1="153.0234" y2="2941.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1411" x2="1411" y1="153.0234" y2="2941.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1568" x2="1568" y1="153.0234" y2="2941.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1718.5" x2="1718.5" y1="153.0234" y2="2941.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1875.5" x2="1875.5" y1="153.0234" y2="2941.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2025" x2="2025" y1="153.0234" y2="2941.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2182" x2="2182" y1="153.0234" y2="2941.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2405" x2="2405" y1="153.0234" y2="2941.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="42" y="133.4248">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="44.5" y="149.7217">Payer</text><ellipse cx="65" cy="63.4297" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M65,71.4297 L65,98.4297 M52,79.4297 L78,79.4297 M65,98.4297 L52,113.4297 M65,98.4297 L78,113.4297 " fill="none" filter="url(#fqlyoynqkvozg)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="42" y="2953.4248">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="44.5" y="2969.7217">Payer</text><ellipse cx="65" cy="2983.0234" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M65,2991.0234 L65,3018.0234 M52,2999.0234 L78,2999.0234 M65,3018.0234 L52,3033.0234 M65,3018.0234 L78,3033.0234 " fill="none" filter="url(#fqlyoynqkvozg)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="98" y="133.4248">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="99" y="149.7217">Payee</text><ellipse cx="121" cy="63.4297" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M121,71.4297 L121,98.4297 M108,79.4297 L134,79.4297 M121,98.4297 L108,113.4297 M121,98.4297 L134,113.4297 " fill="none" filter="url(#fqlyoynqkvozg)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="98" y="2953.4248">DFSP2</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="99" y="2969.7217">Payee</text><ellipse cx="121" cy="2983.0234" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M121,2991.0234 L121,3018.0234 M108,2999.0234 L134,2999.0234 M121,3018.0234 L108,3033.0234 M121,3018.0234 L134,3033.0234 " fill="none" filter="url(#fqlyoynqkvozg)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="268.5" y="149.7217">ML API Adapter</text><path d="M300.5,108.7266 L300.5,132.7266 M300.5,120.7266 L317.5,120.7266 " fill="none" filter="url(#fqlyoynqkvozg)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="329.5" cy="120.7266" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="268.5" y="2953.4248">ML API Adapter</text><path d="M300.5,2960.7266 L300.5,2984.7266 M300.5,2972.7266 L317.5,2972.7266 " fill="none" filter="url(#fqlyoynqkvozg)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="329.5" cy="2972.7266" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="123" x="495.5" y="133.4248">ML API Notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="534" y="149.7217">Handler</text><ellipse cx="562" cy="104.4297" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="558,92.4297,564,87.4297,562,92.4297,564,97.4297,558,92.4297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="123" x="495.5" y="2953.4248">ML API Notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="534" y="2969.7217">Handler</text><ellipse cx="562" cy="2989.0234" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="558,2977.0234,564,2972.0234,562,2977.0234,564,2982.0234,558,2977.0234" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="688" y="97.4297"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="684" y="101.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="705.5" y="121.4248">mongo-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="691" y="137.7217">object-store</text><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="688" y="2940.4297"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="684" y="2944.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="705.5" y="2964.4248">mongo-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="691" y="2980.7217">object-store</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="794" y="149.7217">Central Service API</text><path d="M837,108.7266 L837,132.7266 M837,120.7266 L854,120.7266 " fill="none" filter="url(#fqlyoynqkvozg)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="866" cy="120.7266" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="794" y="2953.4248">Central Service API</text><path d="M837,2960.7266 L837,2984.7266 M837,2972.7266 L854,2972.7266 " fill="none" filter="url(#fqlyoynqkvozg)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="866" cy="2972.7266" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="935" y="97.4297"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="931" y="101.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="960" y="121.4248">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="938" y="137.7217">bulk-prepare</text><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="935" y="2940.4297"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="931" y="2944.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="960" y="2964.4248">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="938" y="2980.7217">bulk-prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="1126" y="133.4248">Bulk Prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="1141.5" y="149.7217">Handler</text><ellipse cx="1169.5" cy="104.4297" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1165.5,92.4297,1171.5,87.4297,1169.5,92.4297,1171.5,97.4297,1165.5,92.4297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="1126" y="2953.4248">Bulk Prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="1141.5" y="2969.7217">Handler</text><ellipse cx="1169.5" cy="2989.0234" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1165.5,2977.0234,1171.5,2972.0234,1169.5,2977.0234,1171.5,2982.0234,1165.5,2977.0234" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="1353" y="97.4297"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="1349" y="101.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="1389" y="121.4248">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="1356" y="137.7217">transfer-prepare</text><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="1353" y="2940.4297"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="1349" y="2944.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="1389" y="2964.4248">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="1356" y="2980.7217">transfer-prepare</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="1514" y="149.7217">Prepare Handler</text><ellipse cx="1568.5" cy="120.7266" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1564.5,108.7266,1570.5,103.7266,1568.5,108.7266,1570.5,113.7266,1564.5,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="1514" y="2953.4248">Prepare Handler</text><ellipse cx="1568.5" cy="2972.7266" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1564.5,2960.7266,1570.5,2955.7266,1568.5,2960.7266,1570.5,2965.7266,1564.5,2960.7266" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="120" x="1658.5" y="97.4297"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="120" x="1654.5" y="101.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="1696" y="121.4248">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="1661.5" y="137.7217">transfer-position</text><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="120" x="1658.5" y="2940.4297"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="120" x="1654.5" y="2944.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="1696" y="2964.4248">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="1661.5" y="2980.7217">transfer-position</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="1819.5" y="149.7217">Position Handler</text><ellipse cx="1875.5" cy="120.7266" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1871.5,108.7266,1877.5,103.7266,1875.5,108.7266,1877.5,113.7266,1871.5,108.7266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="1819.5" y="2953.4248">Position Handler</text><ellipse cx="1875.5" cy="2972.7266" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="1871.5,2960.7266,1877.5,2955.7266,1875.5,2960.7266,1877.5,2965.7266,1871.5,2960.7266" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="1968" y="97.4297"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="1964" y="101.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="2003" y="121.4248">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="1971" y="137.7217">bulk-processing</text><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="1968" y="2940.4297"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="1964" y="2944.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="2003" y="2964.4248">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="1971" y="2980.7217">bulk-processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="2129" y="133.4248">Bulk Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="2154.5" y="149.7217">Handler</text><ellipse cx="2182.5" cy="104.4297" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2178.5,92.4297,2184.5,87.4297,2182.5,92.4297,2184.5,97.4297,2178.5,92.4297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="2129" y="2953.4248">Bulk Processing</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="2154.5" y="2969.7217">Handler</text><ellipse cx="2182.5" cy="2989.0234" fill="#FEFECE" filter="url(#fqlyoynqkvozg)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="2178.5,2977.0234,2184.5,2972.0234,2182.5,2977.0234,2184.5,2982.0234,2178.5,2977.0234" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="2359" y="97.4297"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="2355" y="101.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="2383" y="121.4248">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="2362" y="137.7217">notifications</text><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="2359" y="2940.4297"/><rect fill="#FEFECE" filter="url(#fqlyoynqkvozg)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="2355" y="2944.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="37" x="2383" y="2964.4248">topic-</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="2362" y="2980.7217">notifications</text><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="783.5781" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="316" y="1004.0625"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2768.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="557" y="163.0234"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="729" y="1105.5938"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="44.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="729" y="1886.0391"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="729" y="2616.1016"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="729" y="2772.7656"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="116.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="977.5" y="1641.8438"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2768.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1164.5" y="163.0234"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2768.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1563.5" y="163.0234"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2768.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1870.5" y="163.0234"/><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="2768.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2177.5" y="163.0234"/><path d="M32,170.0234 L418,170.0234 L418,177.0234 L408,187.0234 L32,187.0234 L32,170.0234 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2754.4063" style="stroke: #000000; stroke-width: 2.0;" width="2444" x="32" y="170.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="341" x="47" y="183.0903">DFSP1 sends a Bulk Prepare Transfer request to DFSP2</text><path d="M70,192.1563 L70,973.1563 L375,973.1563 L375,202.1563 L365,192.1563 L70,192.1563 " fill="#FFFF00" filter="url(#fqlyoynqkvozg)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M365,192.1563 L365,202.1563 L375,202.1563 L365,192.1563 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="76" y="209.2231">Headers - bulkTransferHeaders: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="88" y="224.356">Content-Length: &lt;Content-Length&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="88" y="239.4888">Content-Type: &lt;Content-Type&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="88" y="254.6216">Date: &lt;Date&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="88" y="269.7544">X-Forwarded-For: &lt;X-Forwarded-For&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="88" y="284.8872">FSPIOP-Source: &lt;FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="88" y="300.02">FSPIOP-Destination: &lt;FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="88" y="315.1528">FSPIOP-Encryption: &lt;FSPIOP-Encryption&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="88" y="330.2856">FSPIOP-Signature: &lt;FSPIOP-Signature&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="88" y="345.4185">FSPIOP-URI: &lt;FSPIOP-URI&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="88" y="360.5513">FSPIOP-HTTP-Method: &lt;FSPIOP-HTTP-Method&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="76" y="375.6841">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="79" y="390.8169"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="76" y="405.9497">Payload - bulkTransferMessage:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="76" y="421.0825">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="88" y="436.2153">"bulkTransferId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="88" y="451.3481">"bulkQuoteId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="88" y="466.481">"payeeFsp": &lt;fspID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="88" y="481.6138">"payerFsp": &lt;fspID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="88" y="496.7466">"individualTransfers":</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="88" y="511.8794">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="100" y="527.0122">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="112" y="542.145">"transferId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="112" y="557.2778">"transferAmount":</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="112" y="572.4106">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="124" y="587.5435">"currency": &lt;currency&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="124" y="602.6763">"amount": &lt;amount&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="112" y="617.8091">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="112" y="632.9419">"ilpPacket": &lt;ilpPacket&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="112" y="648.0747">"condition": &lt;ilpCondition&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="112" y="663.2075">"extensionList":</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="112" y="678.3403">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="124" y="693.4731">"extension":</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="124" y="708.606">[</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="136" y="723.7388">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="148" y="738.8716">“key”: &lt;key&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="148" y="754.0044">“value”: &lt;value&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="136" y="769.1372">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="124" y="784.27">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="112" y="799.4028">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="100" y="814.5356">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="88" y="829.6685">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="88" y="844.8013">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="100" y="859.9341">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="112" y="875.0669">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="124" y="890.1997">“key”: &lt;key&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="124" y="905.3325">“value”: &lt;value&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="112" y="920.4653">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="100" y="935.5981">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="88" y="950.731">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="76" y="965.8638">}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="314" x2="304" y1="1004.0625" y2="1000.0625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="314" x2="304" y1="1004.0625" y2="1008.0625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="65" x2="315" y1="1004.0625" y2="1004.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="72" y="998.9966">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="83" y="998.9966">POST - /bulkTransfers</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="326" x2="368" y1="1048.3281" y2="1048.3281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="368" x2="368" y1="1048.3281" y2="1061.3281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="327" x2="368" y1="1061.3281" y2="1061.3281"/><polygon fill="#A80036" points="337,1057.3281,327,1061.3281,337,1065.3281,333,1061.3281" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="333" y="1035.6958">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="344" y="1028.1294">Validate incoming message</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="344" y="1043.2622">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="424" y="1043.2622">3000-3002, 3100-3107</text><polygon fill="#A80036" points="717,1101.5938,727,1105.5938,717,1109.5938,721,1105.5938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="326" x2="723" y1="1105.5938" y2="1105.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="333" y="1092.9614">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="344" y="1085.395">Persist incoming bulk message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="344" y="1100.5278">to object store</text><polygon fill="#A80036" points="337,1130.7266,327,1134.7266,337,1138.7266,333,1134.7266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="331" x2="733" y1="1134.7266" y2="1134.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="343" y="1129.6606">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="354" y="1129.6606">Return reference to the stored object</text><path d="M331,1147.7266 L331,1580.7266 L776,1580.7266 L776,1157.7266 L766,1147.7266 L331,1147.7266 " fill="#FFFF00" filter="url(#fqlyoynqkvozg)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M766,1147.7266 L766,1157.7266 L776,1157.7266 L766,1147.7266 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="337" y="1164.7935">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="337" y="1179.9263">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="349" y="1195.0591">id: &lt;bulkTransferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="349" y="1210.1919">from: &lt;bulkTransferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="349" y="1225.3247">to: &lt;bulkTransferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="349" y="1240.4575">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="349" y="1255.5903">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="361" y="1270.7231">headers: &lt;bulkTransferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="361" y="1285.856">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="373" y="1300.9888">objstore: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="397" y="1316.1216">transactionid: &lt;bulkTransferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="364" x="397" y="1331.2544">referenceid: &lt;bulkTransferMessage_ObjectStoreReference_ID&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="373" y="1346.3872">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="361" y="1361.52">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="349" y="1376.6528">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="349" y="1391.7856">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="361" y="1406.9185">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="373" y="1422.0513">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="373" y="1437.1841">type: bulk-prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="373" y="1452.3169">action: bulk-prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="373" y="1467.4497">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="373" y="1482.5825">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="385" y="1497.7153">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="385" y="1512.8481">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="373" y="1527.981">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="361" y="1543.1138">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="349" y="1558.2466">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="337" y="1573.3794">}</text><polygon fill="#A80036" points="965.5,1637.8438,975.5,1641.8438,965.5,1645.8438,969.5,1641.8438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="326" x2="971.5" y1="1641.8438" y2="1641.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="333" y="1621.645">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="344" y="1606.5122">Route &amp; Publish Bulk Prepare event</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="344" y="1621.645">for Payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="344" y="1636.7778">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="418" y="1636.7778">2003</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="987.5" x2="1029.5" y1="1701.2422" y2="1701.2422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1029.5" x2="1029.5" y1="1701.2422" y2="1714.2422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="988.5" x2="1029.5" y1="1714.2422" y2="1714.2422"/><polygon fill="#A80036" points="998.5,1710.2422,988.5,1714.2422,998.5,1718.2422,994.5,1714.2422" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="994.5" y="1681.0435">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="1005.5" y="1665.9106">Ensure event is replicated</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="1005.5" y="1681.0435">as configured (ACKS=all)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="1005.5" y="1696.1763">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="1079.5" y="1696.1763">2003</text><polygon fill="#A80036" points="337,1754.5078,327,1758.5078,337,1762.5078,333,1758.5078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="331" x2="981.5" y1="1758.5078" y2="1758.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="343" y="1745.8755">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="354" y="1738.3091">Respond replication acknowledgements</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="354" y="1753.4419">have been received</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="65" x2="75" y1="1787.6406" y2="1783.6406"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="65" x2="75" y1="1787.6406" y2="1791.6406"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="65" x2="320" y1="1787.6406" y2="1787.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="82" y="1782.5747">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="93" y="1782.5747">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="993.5,1837.7734,983.5,1841.7734,993.5,1845.7734,989.5,1841.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="987.5" x2="1163.5" y1="1841.7734" y2="1841.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="999.5" y="1836.7075">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="1010.5" y="1836.7075">Consume message</text><polygon fill="#A80036" points="750,1882.0391,740,1886.0391,750,1890.0391,746,1886.0391" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="744" x2="1163.5" y1="1886.0391" y2="1886.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="756" y="1873.4067">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="774" y="1865.8403">Retrieve bulk payload using reference</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="774" y="1880.9731">by streaming individual transfers</text><polygon fill="#A80036" points="1152.5,1926.3047,1162.5,1930.3047,1152.5,1934.3047,1156.5,1930.3047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="734" x2="1158.5" y1="1930.3047" y2="1930.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="741" y="1917.6724">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="759" y="1910.106">Return individual transfers</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="759" y="1925.2388">part of the payload</text><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="545" x="928" y="1938.3047"/><polygon fill="#EEEEEE" points="928,1938.3047,992,1938.3047,992,1945.3047,982,1955.3047,928,1955.3047,928,1938.3047" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="941" y="1952.3716">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="1109.5" y="1971.3716">Bulk Prepare Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1112.5" y="1986.5044"/><path d="M1116,2005.7031 L1179,2005.7031 L1179,2012.7031 L1169,2022.7031 L1116,2022.7031 L1116,2005.7031 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="105.3359" style="stroke: #000000; stroke-width: 2.0;" width="1350" x="1116" y="2005.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1131" y="2018.77">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="49" x="1194" y="2017.9136">[Success]</text><polygon fill="#A80036" points="1399.5,2055.1016,1409.5,2059.1016,1399.5,2063.1016,1403.5,2059.1016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1174.5" x2="1405.5" y1="2059.1016" y2="2059.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1181.5" y="2046.4692">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="189" x="1199.5" y="2038.9028">Produce single transfer message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="1199.5" y="2054.0356">for each individual transfer [loop]</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1116" x2="2466" y1="2068.1016" y2="2068.1016"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="44" x="1121" y="2078.312">[Failure]</text><polygon fill="#A80036" points="2393.5,2099.0391,2403.5,2103.0391,2393.5,2107.0391,2397.5,2103.0391" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1174.5" x2="2399.5" y1="2103.0391" y2="2103.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1181.5" y="2097.9731">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="222" x="1199.5" y="2097.9731">Produce message for the bulk transfer</text><polygon fill="#A80036" points="1422.5,2160.1719,1412.5,2164.1719,1422.5,2168.1719,1418.5,2164.1719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1416.5" x2="1562.5" y1="2164.1719" y2="2164.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1428.5" y="2159.106">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="1446.5" y="2159.106">Consume message</text><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="435.5" x="1346" y="2172.1719"/><polygon fill="#EEEEEE" points="1346,2172.1719,1410,2172.1719,1410,2179.1719,1400,2189.1719,1346,2189.1719,1346,2172.1719" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1359" y="2186.2388">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="1488.25" y="2205.2388">Prepare Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1491.25" y="2220.3716"/><path d="M1504,2239.5703 L1567,2239.5703 L1567,2246.5703 L1557,2256.5703 L1504,2256.5703 L1504,2239.5703 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.2031" style="stroke: #000000; stroke-width: 2.0;" width="593" x="1504" y="2239.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1519" y="2252.6372">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="49" x="1582" y="2251.7808">[Success]</text><polygon fill="#A80036" points="1706.5,2273.8359,1716.5,2277.8359,1706.5,2281.8359,1710.5,2277.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1573.5" x2="1712.5" y1="2277.8359" y2="2277.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1580.5" y="2272.77">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="1598.5" y="2272.77">Produce message</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1504" x2="2097" y1="2286.8359" y2="2286.8359"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="44" x="1509" y="2297.0464">[Failure]</text><polygon fill="#A80036" points="2013.5,2317.7734,2023.5,2321.7734,2013.5,2325.7734,2017.5,2321.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1573.5" x2="2019.5" y1="2321.7734" y2="2321.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1580.5" y="2316.7075">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="1598.5" y="2316.7075">Produce message</text><polygon fill="#A80036" points="1729.5,2378.9063,1719.5,2382.9063,1729.5,2386.9063,1725.5,2382.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1723.5" x2="1869.5" y1="2382.9063" y2="2382.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1735.5" y="2377.8403">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="1753.5" y="2377.8403">Consume message</text><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="434.5" x="1651.5" y="2390.9063"/><polygon fill="#EEEEEE" points="1651.5,2390.9063,1715.5,2390.9063,1715.5,2397.9063,1705.5,2407.9063,1651.5,2407.9063,1651.5,2390.9063" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1664.5" y="2404.9731">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="1792.75" y="2423.9731">Position Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1795.75" y="2439.106"/><polygon fill="#A80036" points="2013.5,2468.4375,2023.5,2472.4375,2013.5,2476.4375,2017.5,2472.4375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1880.5" x2="2019.5" y1="2472.4375" y2="2472.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="1887.5" y="2467.3716">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="1905.5" y="2467.3716">Produce message</text><polygon fill="#A80036" points="2036.5,2522.5703,2026.5,2526.5703,2036.5,2530.5703,2032.5,2526.5703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2030.5" x2="2176.5" y1="2526.5703" y2="2526.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="2042.5" y="2521.5044">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="2060.5" y="2521.5044">Consume message</text><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="494" x="1961" y="2534.5703"/><polygon fill="#EEEEEE" points="1961,2534.5703,2025,2534.5703,2025,2541.5703,2015,2551.5703,1961,2551.5703,1961,2534.5703" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1974" y="2548.6372">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="2108.5" y="2567.6372">Bulk Processing Handler Consume</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="2111.5" y="2582.77"/><polygon fill="#A80036" points="750,2612.1016,740,2616.1016,750,2620.1016,746,2616.1016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="744" x2="2176.5" y1="2616.1016" y2="2616.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="756" y="2611.0356">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="207" x="774" y="2611.0356">Persist bulk message to object store</text><polygon fill="#A80036" points="2165.5,2641.2344,2175.5,2645.2344,2165.5,2649.2344,2169.5,2645.2344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="734" x2="2171.5" y1="2645.2344" y2="2645.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="741" y="2640.1685">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="759" y="2640.1685">Return reference to the stored object</text><polygon fill="#A80036" points="2393.5,2670.3672,2403.5,2674.3672,2393.5,2678.3672,2397.5,2674.3672" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2187.5" x2="2399.5" y1="2674.3672" y2="2674.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="2194.5" y="2669.3013">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="2212.5" y="2669.3013">Send Bulk Prepare notification</text><polygon fill="#A80036" points="2393.5,2724.5,2403.5,2728.5,2393.5,2732.5,2397.5,2728.5" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="567" x2="2399.5" y1="2728.5" y2="2728.5"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="574" y="2723.4341">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="592" y="2723.4341">Consume message</text><polygon fill="#A80036" points="717,2768.7656,727,2772.7656,717,2776.7656,721,2772.7656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="567" x2="723" y1="2772.7656" y2="2772.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="574" y="2760.1333">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="592" y="2752.5669">Retrieve bulk payload</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="592" y="2767.6997">using reference</text><polygon fill="#A80036" points="578,2797.8984,568,2801.8984,578,2805.8984,574,2801.8984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="572" x2="733" y1="2801.8984" y2="2801.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="584" y="2796.8325">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="602" y="2796.8325">Return payload</text><rect fill="#FFFFFF" filter="url(#fqlyoynqkvozg)" height="55.3984" style="stroke: #000000; stroke-width: 2.0;" width="2360" x="95" y="2809.8984"/><polygon fill="#EEEEEE" points="95,2809.8984,159,2809.8984,159,2816.8984,149,2826.8984,95,2826.8984,95,2809.8984" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="108" y="2823.9653">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="1165" y="2842.9653">Send notification to Participant (Payee)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1168" y="2858.0981"/><polygon fill="#A80036" points="132,2887.4297,122,2891.4297,132,2895.4297,128,2891.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="126" x2="556" y1="2891.4297" y2="2891.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="138" y="2886.3638">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="156" y="2886.3638">Send Bulk Prepare notification to Payee</text><!--
@startuml
title 1.1.0. DFSP1 sends a Bulk Prepare Transfer request to DFSP2

autonumber


actor "DFSP1\nPayer" as DFSP1
actor "DFSP2\nPayee" as DFSP2
boundary "ML API Adapter" as MLAPI
control "ML API Notification \nHandler" as NOTIFY_HANDLER
collections "mongo-\nobject-store" as OBJECT_STORE
boundary "Central Service API" as CSAPI
collections "topic-\nbulk-prepare" as TOPIC_BULK_PREPARE
control "Bulk Prepare\nHandler" as BULK_PREP_HANDLER
collections "topic-\ntransfer-prepare" as TOPIC_TRANSFER_PREPARE
control "Prepare Handler" as PREP_HANDLER
collections "topic-\ntransfer-position" as TOPIC_TRANSFER_POSITION
control "Position Handler" as POS_HANDLER
collections "topic-\nbulk-processing" as TOPIC_BULK_PROCESSING
control "Bulk Processing\nHandler" as BULK_PROC_HANDLER
collections "topic-\nnotifications" as TOPIC_NOTIFICATIONS

box "Financial Service Providers" #lightGray
	participant DFSP1
	participant DFSP2
end box

box "ML API Adapter Service" #LightBlue
	participant MLAPI
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant OBJECT_STORE
    participant CSAPI
	participant TOPIC_BULK_PREPARE
    participant BULK_PREP_HANDLER
    participant TOPIC_TRANSFER_PREPARE
    participant PREP_HANDLER
    participant TOPIC_TRANSFER_POSITION
    participant POS_HANDLER
    participant TOPIC_BULK_PROCESSING
    participant BULK_PROC_HANDLER
    participant TOPIC_NOTIFICATIONS
end box

activate NOTIFY_HANDLER
activate BULK_PREP_HANDLER
activate PREP_HANDLER
activate POS_HANDLER
activate BULK_PROC_HANDLER
group DFSP1 sends a Bulk Prepare Transfer request to DFSP2
    note right of DFSP1 #yellow
        Headers - bulkTransferHeaders: {
            Content-Length: <Content-Length>,
            Content-Type: <Content-Type>,
            Date: <Date>,
            X-Forwarded-For: <X-Forwarded-For>,
            FSPIOP-Source: <FSPIOP-Source>,
            FSPIOP-Destination: <FSPIOP-Destination>,
            FSPIOP-Encryption: <FSPIOP-Encryption>,
            FSPIOP-Signature: <FSPIOP-Signature>,
            FSPIOP-URI: <FSPIOP-URI>,
            FSPIOP-HTTP-Method: <FSPIOP-HTTP-Method>
        }

        Payload - bulkTransferMessage:
        {
            "bulkTransferId": <uuid>,
            "bulkQuoteId": <uuid>, 
            "payeeFsp": <fspID>,
            "payerFsp": <fspID>,
            "individualTransfers": 
            [
                {
                    "transferId": <uuid>, 
                    "transferAmount": 
                    { 
                        "currency": <currency>, 
                        "amount": <amount> 
                    }, 
                    "ilpPacket": <ilpPacket>,
                    "condition": <ilpCondition>,
                    "extensionList":
                    {
                        "extension":
                        [ 
                            { 
                                “key”: <key>, 
                                “value”: <value> 
                            }
                        ]
                    }
                }
            ],
            "extensionList": {
                "extension": [
                    {
                        “key”: <key>, 
                        “value”: <value> 
                    }
                ]
            }
        }
    end note
    DFSP1 ->> MLAPI: POST - /bulkTransfers
    activate MLAPI
    MLAPI -> MLAPI: Validate incoming message\n<color #FF0000><b>Error codes:</b> 3000-3002, 3100-3107</color>
    MLAPI -> OBJECT_STORE: Persist incoming bulk message\nto object store
    activate OBJECT_STORE
    OBJECT_STORE - -> MLAPI: Return reference to the stored object
    deactivate OBJECT_STORE
    note right of MLAPI #yellow
        Message:
        {
            id: <bulkTransferMessage.transferId>
            from: <bulkTransferMessage.payerFsp>,
            to: <bulkTransferMessage.payeeFsp>,
            type: application/json
            content: {
                headers: <bulkTransferHeaders>,
                payload: {
                    objstore: {
                            transactionid: <bulkTransferId>
                            referenceid: <bulkTransferMessage_ObjectStoreReference_ID>
                    }
                }
            },
            metadata: {
                event: {
                    id: <uuid>,
                    type: bulk-prepare,
                    action: bulk-prepare,
                    createdAt: <timestamp>,
                    state: {
                        status: "success",
                        code: 0
                    }
                }
            }
        }
    end note
    MLAPI -> TOPIC_BULK_PREPARE: Route & Publish Bulk Prepare event \nfor Payer\n<color #FF0000><b>Error code:</b> 2003</color>
    activate TOPIC_BULK_PREPARE
    TOPIC_BULK_PREPARE <-> TOPIC_BULK_PREPARE: Ensure event is replicated \nas configured (ACKS=all)\n<color #FF0000><b>Error code:</b> 2003</color>
    TOPIC_BULK_PREPARE - -> MLAPI: Respond replication acknowledgements \nhave been received
    deactivate TOPIC_BULK_PREPARE
    MLAPI - ->> DFSP1: Respond HTTP - 202 (Accepted)
    deactivate MLAPI
    |||
    TOPIC_BULK_PREPARE <- BULK_PREP_HANDLER: Consume message
    BULK_PREP_HANDLER -> OBJECT_STORE: Retrieve bulk payload using reference\nby streaming individual transfers
    activate OBJECT_STORE
    OBJECT_STORE - -> BULK_PREP_HANDLER: Return individual transfers\npart of the payload
    deactivate OBJECT_STORE
    ref over TOPIC_BULK_PREPARE, BULK_PREP_HANDLER, TOPIC_TRANSFER_PREPARE :  Bulk Prepare Handler Consume \n
    alt Success
        BULK_PREP_HANDLER -> TOPIC_TRANSFER_PREPARE: Produce single transfer message\nfor each individual transfer [loop]
    else Failure
        BULK_PREP_HANDLER - -> TOPIC_NOTIFICATIONS: Produce message for the bulk transfer
    end
    |||
    TOPIC_TRANSFER_PREPARE <- PREP_HANDLER: Consume message
    ref over TOPIC_TRANSFER_PREPARE, PREP_HANDLER, TOPIC_TRANSFER_POSITION :  Prepare Handler Consume\n
    alt Success
        PREP_HANDLER -> TOPIC_TRANSFER_POSITION: Produce message
    else Failure
        PREP_HANDLER - -> TOPIC_BULK_PROCESSING: Produce message
    end
    |||
    TOPIC_TRANSFER_POSITION <- POS_HANDLER: Consume message
    ref over TOPIC_TRANSFER_POSITION, POS_HANDLER, TOPIC_BULK_PROCESSING : Position Handler Consume\n
    POS_HANDLER -> TOPIC_BULK_PROCESSING: Produce message
    |||
    TOPIC_BULK_PROCESSING <- BULK_PROC_HANDLER: Consume message
    ref over TOPIC_BULK_PROCESSING, BULK_PROC_HANDLER, TOPIC_NOTIFICATIONS : Bulk Processing Handler Consume \n
    BULK_PROC_HANDLER -> OBJECT_STORE: Persist bulk message to object store
    activate OBJECT_STORE
    OBJECT_STORE - -> BULK_PROC_HANDLER: Return reference to the stored object
    deactivate OBJECT_STORE
    BULK_PROC_HANDLER -> TOPIC_NOTIFICATIONS: Send Bulk Prepare notification
    |||
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: Consume message
    NOTIFY_HANDLER -> OBJECT_STORE: Retrieve bulk payload\nusing reference
    activate OBJECT_STORE
    OBJECT_STORE - -> NOTIFY_HANDLER: Return payload
    deactivate OBJECT_STORE
    ref over DFSP2, TOPIC_NOTIFICATIONS : Send notification to Participant (Payee)\n
    NOTIFY_HANDLER -> DFSP2: Send Bulk Prepare notification to Payee
    |||
end
deactivate POS_HANDLER
deactivate BULK_PREP_HANDLER
deactivate PREP_HANDLER
deactivate BULK_PROC_HANDLER
deactivate NOTIFY_HANDLER
@enduml

PlantUML version 1.2018.02(Fri Mar 09 17:20:44 GMT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_212-b04
Operating System: Linux
OS Version: 4.15.0-1035-aws
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>