<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2050px" preserveAspectRatio="none" style="width:1358px;height:2050px;" version="1.1" viewBox="0 0 1358 2050" width="1358px" zoomAndPan="magnify"><defs><filter height="300%" id="fpzrbzaawjav1" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="269" x="545.5" y="22.9951">5.1.1. Record Funds In (recordFundsIn)</text><rect fill="#FFB6C1" height="2005.6797" style="stroke: #A80036; stroke-width: 1.0;" width="107" x="19" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="34" y="46.3638">Central HUB</text><rect fill="#FFFFE0" height="2005.6797" style="stroke: #A80036; stroke-width: 1.0;" width="861.5" x="300" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="681.75" y="46.3638">Central Service</text><rect fill="#FFFFFF" filter="url(#fpzrbzaawjav1)" height="546.9844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="349.5" y="503.5156"/><rect fill="#FFFFFF" filter="url(#fpzrbzaawjav1)" height="116.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="566.5" y="904.7031"/><rect fill="#FFFFFF" filter="url(#fpzrbzaawjav1)" height="1796.9531" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="750.5" y="146.7266"/><rect fill="#FFFFFF" filter="url(#fpzrbzaawjav1)" height="819.9141" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="885.5" y="1108.7656"/><rect fill="#FFFFFF" filter="url(#fpzrbzaawjav1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1108.5" y="1555.4219"/><rect fill="#FFFFFF" filter="url(#fpzrbzaawjav1)" height="1782.9531" style="stroke: #000000; stroke-width: 2.0;" width="1334" x="13" y="153.7266"/><rect fill="#FFFFFF" filter="url(#fpzrbzaawjav1)" height="776.7813" style="stroke: #000000; stroke-width: 2.0;" width="512" x="825" y="1123.7656"/><rect fill="#FFFFFF" filter="url(#fpzrbzaawjav1)" height="117.6641" style="stroke: #000000; stroke-width: 2.0;" width="332.5" x="835" y="1147.8984"/><rect fill="#FFFFFF" filter="url(#fpzrbzaawjav1)" height="223.5938" style="stroke: #000000; stroke-width: 2.0;" width="332.5" x="835" y="1279.5625"/><rect fill="#FFFFFF" filter="url(#fpzrbzaawjav1)" height="376.3906" style="stroke: #000000; stroke-width: 2.0;" width="492" x="835" y="1517.1563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="72" x2="72" y1="136.7266" y2="1953.6797"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="354" x2="354" y1="136.7266" y2="1953.6797"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="571" x2="571" y1="136.7266" y2="1953.6797"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="755" x2="755" y1="136.7266" y2="1953.6797"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="890" x2="890" y1="136.7266" y2="1953.6797"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1113.5" x2="1113.5" y1="136.7266" y2="1953.6797"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="23" y="133.4248">Hub Employee</text><ellipse cx="72.5" cy="63.4297" fill="#FEFECE" filter="url(#fpzrbzaawjav1)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M72.5,71.4297 L72.5,98.4297 M59.5,79.4297 L85.5,79.4297 M72.5,98.4297 L59.5,113.4297 M72.5,98.4297 L85.5,113.4297 " fill="none" filter="url(#fpzrbzaawjav1)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="23" y="1965.6748">Hub Employee</text><ellipse cx="72.5" cy="1978.9766" fill="#FEFECE" filter="url(#fpzrbzaawjav1)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M72.5,1986.9766 L72.5,2013.9766 M59.5,1994.9766 L85.5,1994.9766 M72.5,2013.9766 L59.5,2028.9766 M72.5,2013.9766 L85.5,2028.9766 " fill="none" filter="url(#fpzrbzaawjav1)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="304" y="117.1279">Central Service</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="319.5" y="133.4248">Admin API</text><path d="M334,76.1328 L334,100.1328 M334,88.1328 L351,88.1328 " fill="none" filter="url(#fpzrbzaawjav1)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="363" cy="88.1328" fill="#FEFECE" filter="url(#fpzrbzaawjav1)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="304" y="1965.6748">Central Service</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="319.5" y="1981.9717">Admin API</text><path d="M334,1989.2734 L334,2013.2734 M334,2001.2734 L351,2001.2734 " fill="none" filter="url(#fpzrbzaawjav1)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="363" cy="2001.2734" fill="#FEFECE" filter="url(#fpzrbzaawjav1)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fpzrbzaawjav1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="151" x="496" y="97.4297"/><rect fill="#FEFECE" filter="url(#fpzrbzaawjav1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="151" x="492" y="101.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="137" x="499" y="121.4248">Admin-Transfer-Topic</text><rect fill="#FEFECE" filter="url(#fpzrbzaawjav1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="151" x="496" y="1952.6797"/><rect fill="#FEFECE" filter="url(#fpzrbzaawjav1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="151" x="492" y="1956.6797"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="137" x="499" y="1976.6748">Admin-Transfer-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="135" x="685" y="133.4248">Admin Event Handler</text><ellipse cx="755.5" cy="104.4297" fill="#FEFECE" filter="url(#fpzrbzaawjav1)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="751.5,92.4297,757.5,87.4297,755.5,92.4297,757.5,97.4297,751.5,92.4297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="135" x="685" y="1965.6748">Admin Event Handler</text><ellipse cx="755.5" cy="1984.9766" fill="#FEFECE" filter="url(#fpzrbzaawjav1)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="751.5,1972.9766,757.5,1967.9766,755.5,1972.9766,757.5,1977.9766,751.5,1972.9766" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="845" y="133.4248">Transfer DAO</text><ellipse cx="890.5" cy="104.4297" fill="#FEFECE" filter="url(#fpzrbzaawjav1)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="878.5" x2="902.5" y1="118.4297" y2="118.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="845" y="1965.6748">Transfer DAO</text><ellipse cx="890.5" cy="1984.9766" fill="#FEFECE" filter="url(#fpzrbzaawjav1)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="878.5" x2="902.5" y1="1998.9766" y2="1998.9766"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1069.5" y="133.4248">Central Store</text><path d="M1095.5,84.4297 C1095.5,74.4297 1113.5,74.4297 1113.5,74.4297 C1113.5,74.4297 1131.5,74.4297 1131.5,84.4297 L1131.5,110.4297 C1131.5,120.4297 1113.5,120.4297 1113.5,120.4297 C1113.5,120.4297 1095.5,120.4297 1095.5,110.4297 L1095.5,84.4297 " fill="#FEFECE" filter="url(#fpzrbzaawjav1)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1095.5,84.4297 C1095.5,94.4297 1113.5,94.4297 1113.5,94.4297 C1113.5,94.4297 1131.5,94.4297 1131.5,84.4297 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1069.5" y="1965.6748">Central Store</text><path d="M1095.5,1978.9766 C1095.5,1968.9766 1113.5,1968.9766 1113.5,1968.9766 C1113.5,1968.9766 1131.5,1968.9766 1131.5,1978.9766 L1131.5,2004.9766 C1131.5,2014.9766 1113.5,2014.9766 1113.5,2014.9766 C1113.5,2014.9766 1095.5,2014.9766 1095.5,2004.9766 L1095.5,1978.9766 " fill="#FEFECE" filter="url(#fpzrbzaawjav1)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1095.5,1978.9766 C1095.5,1988.9766 1113.5,1988.9766 1113.5,1988.9766 C1113.5,1988.9766 1131.5,1988.9766 1131.5,1978.9766 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#fpzrbzaawjav1)" height="546.9844" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="349.5" y="503.5156"/><rect fill="#FFFFFF" filter="url(#fpzrbzaawjav1)" height="116.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="566.5" y="904.7031"/><rect fill="#FFFFFF" filter="url(#fpzrbzaawjav1)" height="1796.9531" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="750.5" y="146.7266"/><rect fill="#FFFFFF" filter="url(#fpzrbzaawjav1)" height="819.9141" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="885.5" y="1108.7656"/><rect fill="#FFFFFF" filter="url(#fpzrbzaawjav1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1108.5" y="1555.4219"/><path d="M13,153.7266 L160,153.7266 L160,160.7266 L150,170.7266 L13,170.7266 L13,153.7266 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1782.9531" style="stroke: #000000; stroke-width: 2.0;" width="1334" x="13" y="153.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="28" y="166.7935">Record Funds In</text><path d="M77,175.8594 L77,472.8594 L279,472.8594 L279,185.8594 L269,175.8594 L77,175.8594 " fill="#FFFF00" filter="url(#fpzrbzaawjav1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M269,175.8594 L269,185.8594 L279,185.8594 L269,175.8594 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="83" y="192.9263">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="95" y="208.0591">"transferId": &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="95" y="223.1919">"externalReference": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="95" y="238.3247">"action": "recordFundsIn",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="95" y="253.4575">"amount": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="107" y="268.5903">"amount": &lt;decimal&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="107" y="283.7231">"currency": "string"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="86" y="298.856"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="95" y="313.9888">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="95" y="329.1216">"reason": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="95" y="344.2544">"extensionList": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="107" y="359.3872">"extension": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="119" y="374.52">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="131" y="389.6528">"key": "string",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="131" y="404.7856">"value": "string"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="119" y="419.9185">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="107" y="435.0513">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="95" y="450.1841">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="83" y="465.3169">}</text><polygon fill="#A80036" points="337.5,499.5156,347.5,503.5156,337.5,507.5156,341.5,503.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72.5" x2="343.5" y1="503.5156" y2="503.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="79.5" y="498.4497">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="90.5" y="498.4497">POST - /participants/{name}/accounts/{id}</text><path d="M364,516.5156 L364,858.5156 L576,858.5156 L576,526.5156 L566,516.5156 L364,516.5156 " fill="#FFFF00" filter="url(#fpzrbzaawjav1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M566,516.5156 L566,526.5156 L576,526.5156 L566,516.5156 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="370" y="533.5825">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="370" y="548.7153">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="382" y="563.8481">id: &lt;payload.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="382" y="578.981">from: "dfspName",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="382" y="594.1138">to: "Hub",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="382" y="609.2466">type: "application/json"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="382" y="624.3794">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="394" y="639.5122">headers: &lt;payloadHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="394" y="654.645">payload: &lt;payloadMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="382" y="669.7778">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="382" y="684.9106">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="394" y="700.0435">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="406" y="715.1763">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="406" y="730.3091">responseTo: "",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="406" y="745.4419">type: "transfer",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="406" y="760.5747">action: "recordFundsIn",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="406" y="775.7075">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44" x="406" y="790.8403">state: ""</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="394" y="805.9731">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="382" y="821.106">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="382" y="836.2388">pp: ""</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="370" y="851.3716">}</text><polygon fill="#A80036" points="554.5,900.7031,564.5,904.7031,554.5,908.7031,558.5,904.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="359.5" x2="560.5" y1="904.7031" y2="904.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="366.5" y="892.0708">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="377.5" y="884.5044">Route &amp; Publish Prepare event</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="377.5" y="899.6372">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="451.5" y="899.6372">2003</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="576.5" x2="618.5" y1="964.1016" y2="964.1016"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="618.5" x2="618.5" y1="964.1016" y2="977.1016"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="577.5" x2="618.5" y1="977.1016" y2="977.1016"/><polygon fill="#A80036" points="587.5,973.1016,577.5,977.1016,587.5,981.1016,583.5,977.1016" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="583.5" y="943.9028">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="594.5" y="928.77">Ensure event is replicated</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="594.5" y="943.9028">as configured (ACKS=all)</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="594.5" y="959.0356">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="668.5" y="959.0356">2003</text><polygon fill="#A80036" points="370.5,1017.3672,360.5,1021.3672,370.5,1025.3672,366.5,1021.3672" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="364.5" x2="570.5" y1="1021.3672" y2="1021.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="376.5" y="1008.7349">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="387.5" y="1001.1685">Respond replication acks</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="387.5" y="1016.3013">have been received</text><polygon fill="#A80036" points="83.5,1046.5,73.5,1050.5,83.5,1054.5,79.5,1050.5" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="77.5" x2="353.5" y1="1050.5" y2="1050.5"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="89.5" y="1045.4341">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="100.5" y="1045.4341">Respond HTTP - 202 (Accepted)</text><polygon fill="#A80036" points="582.5,1075.6328,572.5,1079.6328,582.5,1083.6328,578.5,1079.6328" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="576.5" x2="749.5" y1="1079.6328" y2="1079.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="588.5" y="1074.5669">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="599.5" y="1074.5669">Consume message</text><polygon fill="#A80036" points="873.5,1104.7656,883.5,1108.7656,873.5,1112.7656,877.5,1108.7656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="760.5" x2="879.5" y1="1108.7656" y2="1108.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="767.5" y="1103.6997">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="778.5" y="1103.6997">Prepare transfer</text><path d="M825,1123.7656 L975,1123.7656 L975,1130.7656 L965,1140.7656 L825,1140.7656 L825,1123.7656 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="776.7813" style="stroke: #000000; stroke-width: 2.0;" width="512" x="825" y="1123.7656"/><text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="840" y="1136.8325">DB TRANSACTION</text><path d="M835,1147.8984 L1083,1147.8984 L1083,1154.8984 L1073,1164.8984 L835,1164.8984 L835,1147.8984 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="117.6641" style="stroke: #000000; stroke-width: 2.0;" width="332.5" x="835" y="1147.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="203" x="850" y="1160.9653">Reconciliation Transfer Prepare</text><rect fill="#FFFFFF" filter="url(#fpzrbzaawjav1)" height="70.5313" style="stroke: #000000; stroke-width: 2.0;" width="314.5" x="842" y="1190.0313"/><polygon fill="#EEEEEE" points="842,1190.0313,906,1190.0313,906,1197.0313,896,1207.0313,842,1207.0313,842,1190.0313" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="855" y="1204.0981">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="195" x="878.75" y="1223.0981">reconciliationTransferPrepare</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1076.75" y="1223.0981">{</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-recfunds-5.1.0.a-reconciliationTransferPrepare.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-recfunds-5.1.0.a-reconciliationTransferPrepare.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="37" x="1081.75" y="1223.0981">5.1.0.a</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1081.75" x2="1118.75" y1="1225.0981" y2="1225.0981"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1118.75" y="1223.0981">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="878.75" y="1238.231">(payload, trx)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="881.75" y="1253.3638"/><path d="M835,1279.5625 L1082,1279.5625 L1082,1286.5625 L1072,1296.5625 L835,1296.5625 L835,1279.5625 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="223.5938" style="stroke: #000000; stroke-width: 2.0;" width="332.5" x="835" y="1279.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="202" x="850" y="1292.6294">Reconciliation Transfer Reserve</text><rect fill="#FFFFFF" filter="url(#fpzrbzaawjav1)" height="176.4609" style="stroke: #000000; stroke-width: 2.0;" width="314.5" x="842" y="1321.6953"/><polygon fill="#EEEEEE" points="842,1321.6953,906,1321.6953,906,1328.6953,896,1338.6953,842,1338.6953,842,1321.6953" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="855" y="1335.7622">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="211" x="868.75" y="1354.7622">transferStateAndPositionUpdate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1082.75" y="1354.7622">{</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-recfunds-5.1.0.b-transferStateAndPositionUpdate.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-recfunds-5.1.0.b-transferStateAndPositionUpdate.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="38" x="1087.75" y="1354.7622">5.1.0.b</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1087.75" x2="1125.75" y1="1356.7622" y2="1356.7622"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1125.75" y="1354.7622">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="9" x="868.75" y="1369.895">({</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="880.75" y="1385.0278">transferId: {payload.transferId},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="880.75" y="1400.1606">transferStateId: "RESERVED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="880.75" y="1415.2935">reason: {payload.reason},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="880.75" y="1430.4263">createdDate: {transactionTimestamp},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="880.75" y="1445.5591">drUpdated: true,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="880.75" y="1460.6919">crUpdated: false</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="868.75" y="1475.8247">}, trx)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="871.75" y="1490.9575"/><path d="M835,1517.1563 L1081,1517.1563 L1081,1524.1563 L1071,1534.1563 L835,1534.1563 L835,1517.1563 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="376.3906" style="stroke: #000000; stroke-width: 2.0;" width="492" x="835" y="1517.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="201" x="850" y="1530.2231">Reconciliation Transfer Commit</text><polygon fill="#A80036" points="1096.5,1551.4219,1106.5,1555.4219,1096.5,1559.4219,1100.5,1555.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="895.5" x2="1102.5" y1="1555.4219" y2="1555.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="902.5" y="1550.356">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="913.5" y="1550.356">Insert transferFulfilment record</text><polygon fill="#FFFFE0" filter="url(#fpzrbzaawjav1)" points="919,1598.4219,1307,1598.4219,1317,1639.4219,1307,1681.4219,919,1681.4219,909,1639.4219,919,1598.4219" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="921" y="1614.4888">INSERT INTO</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="119" x="1001" y="1614.4888">transferFulfilment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="933" y="1629.6216">(transferFulfilmentId, transferId, ilpFulfilment,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="341" x="933" y="1644.7544">completedDate, isValid, settlementWindowId, createdDate)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="384" x="921" y="1659.8872">VALUES ({Uuid()}, {payload.transferId}, 0, {transactionTimestamp},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="933" y="1675.02">1, NULL, {transactionTimestamp})</text><rect fill="#FFFFFF" filter="url(#fpzrbzaawjav1)" height="176.4609" style="stroke: #000000; stroke-width: 2.0;" width="314.5" x="842" y="1712.0859"/><polygon fill="#EEEEEE" points="842,1712.0859,906,1712.0859,906,1719.0859,896,1729.0859,842,1729.0859,842,1712.0859" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="855" y="1726.1528">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="211" x="868.75" y="1745.1528">transferStateAndPositionUpdate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1082.75" y="1745.1528">{</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-recfunds-5.1.0.b-transferStateAndPositionUpdate.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-recfunds-5.1.0.b-transferStateAndPositionUpdate.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="38" x="1087.75" y="1745.1528">5.1.0.b</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="1087.75" x2="1125.75" y1="1747.1528" y2="1747.1528"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="1125.75" y="1745.1528">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="9" x="868.75" y="1760.2856">({</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="880.75" y="1775.4185">transferId: {payload.transferId},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="880.75" y="1790.5513">transferStateId: "COMMITTED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="880.75" y="1805.6841">reason: {payload.reason},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="880.75" y="1820.8169">createdDate: {transactionTimestamp},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="880.75" y="1835.9497">drUpdated: false,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="880.75" y="1851.0825">crUpdated: true</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="868.75" y="1866.2153">}, trx)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="871.75" y="1881.3481"/><polygon fill="#A80036" points="771.5,1924.6797,761.5,1928.6797,771.5,1932.6797,767.5,1928.6797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="765.5" x2="889.5" y1="1928.6797" y2="1928.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="777.5" y="1923.6138">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="788.5" y="1923.6138">Finished await</text><!--
@startuml
title 5.1.1. Record Funds In (recordFundsIn)

autonumber


actor "Hub Employee" as OPERATOR
boundary "Central Service\n Admin API" as CS_ADMIN_API
collections "Admin-Transfer-Topic" as TOPIC_ADMIN_TRANSFER
control "Admin Event Handler" as ADMIN_HANDLER
entity "Transfer DAO" as TRANSFER_DAO
database "Central Store" as DB

box "Central HUB" #lightpink
    participant OPERATOR
end box

box "Central Service" #LightYellow
    participant CS_ADMIN_API
	participant TOPIC_ADMIN_TRANSFER
    participant ADMIN_HANDLER
    participant TRANSFER_DAO
    participant DB
end box

activate ADMIN_HANDLER
group Record Funds In
    note right of OPERATOR #yellow
        {
            "transferId": <uuid>,
            "externalReference": "string",
            "action": "recordFundsIn",
            "amount": {
                "amount": <decimal>,
                "currency": "string"

            },
            "reason": "string",
            "extensionList": {
                "extension": [
                    {
                        "key": "string",
                        "value": "string"
                    }
                ]
            }
        }
    end note
    OPERATOR -> CS_ADMIN_API: POST - /participants/{name}/accounts/{id}
    activate CS_ADMIN_API

    note right of CS_ADMIN_API #yellow
        Message:
        {
            id: <payload.transferId>
            from: "dfspName",
            to: "Hub",
            type: "application/json"
            content: {
                headers: <payloadHeaders>,
                payload: <payloadMessage>
            },
            metadata: {
                event: {
                    id: <uuid>,
                    responseTo: "",
                    type: "transfer",
                    action: "recordFundsIn",
                    createdAt: <timestamp>,
                    state: ""
                }
            },
            pp: ""
        }
    end note
    CS_ADMIN_API -> TOPIC_ADMIN_TRANSFER: Route & Publish Prepare event\n<color #FF0000><b>Error code:</b> 2003</color>
    activate TOPIC_ADMIN_TRANSFER
    TOPIC_ADMIN_TRANSFER <-> TOPIC_ADMIN_TRANSFER: Ensure event is replicated\nas configured (ACKS=all)\n<color #FF0000><b>Error code:</b> 2003</color>
    TOPIC_ADMIN_TRANSFER - -> CS_ADMIN_API: Respond replication acks\nhave been received
    deactivate TOPIC_ADMIN_TRANSFER
    CS_ADMIN_API - - -> OPERATOR: Respond HTTP - 202 (Accepted)
    deactivate CS_ADMIN_API

    TOPIC_ADMIN_TRANSFER <- ADMIN_HANDLER: Consume message
    ADMIN_HANDLER -> TRANSFER_DAO: Prepare transfer
    activate TRANSFER_DAO
    group <color #blue>DB TRANSACTION</color>
        group Reconciliation Transfer Prepare
            |||
            ref over TRANSFER_DAO, DB:**reconciliationTransferPrepare** {[[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-recfunds-5.1.0.a-reconciliationTransferPrepare.svg 5.1.0.a]]}\n(payload, trx)\n
        end

        group Reconciliation Transfer Reserve
            |||
            ref over TRANSFER_DAO, DB:**transferStateAndPositionUpdate** {[[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-recfunds-5.1.0.b-transferStateAndPositionUpdate.svg 5.1.0.b]]} \n({\n    transferId: {payload.transferId},\n    transferStateId: "RESERVED",\n    reason: {payload.reason},\n    createdDate: {transactionTimestamp},\n    drUpdated: true,\n    crUpdated: false\n}, trx)\n
        end

        group Reconciliation Transfer Commit
            TRANSFER_DAO -> DB: Insert transferFulfilment record
            activate DB
            deactivate DB
            hnote over DB #lightyellow
                INSERT INTO **transferFulfilment**
                    (transferFulfilmentId, transferId, ilpFulfilment,
                    completedDate, isValid, settlementWindowId, createdDate)
                VALUES ({Uuid()}, {payload.transferId}, 0, {transactionTimestamp},
                    1, NULL, {transactionTimestamp})
            end hnote
            |||
            ref over TRANSFER_DAO, DB:**transferStateAndPositionUpdate** {[[https://github.com/mojaloop/docs/blob/master/Diagrams/SequenceDiagrams/seq-recfunds-5.1.0.b-transferStateAndPositionUpdate.svg 5.1.0.b]]} \n({\n    transferId: {payload.transferId},\n    transferStateId: "COMMITTED",\n    reason: {payload.reason},\n    createdDate: {transactionTimestamp},\n    drUpdated: false,\n    crUpdated: true\n}, trx)\n
        end
    end
    ADMIN_HANDLER <- - TRANSFER_DAO: Finished await
    deactivate TRANSFER_DAO
end
deactivate ADMIN_HANDLER
@enduml

PlantUML version 1.2018.02(Fri Mar 09 17:20:44 GMT 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_212-b04
Operating System: Linux
OS Version: 4.15.0-1035-aws
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>