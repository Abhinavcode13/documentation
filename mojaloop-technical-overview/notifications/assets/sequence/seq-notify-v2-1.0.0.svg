<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="4608px" preserveAspectRatio="none" style="width:2299px;height:4608px;" version="1.1" viewBox="0 0 2299 4608" width="2299px" zoomAndPan="magnify"><defs><filter height="300%" id="f15ajfi4kpxnrj" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="644" x="825.5" y="29.4023">1.0.0. Send Notification to Participant (Payer/Payee) (single message) v2.0</text><rect fill="#FFFFE0" height="4561.7441" style="stroke:#A80036;stroke-width:1.0;" width="1070.5" x="16" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="500.75" y="53.7676">Central Service</text><rect fill="#E0FFFF" height="4561.7441" style="stroke:#A80036;stroke-width:1.0;" width="748" x="1088.5" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128" x="1398.5" y="53.7676">Notification Engine</text><rect fill="#D3D3D3" height="4561.7441" style="stroke:#A80036;stroke-width:1.0;" width="266" x="1838.5" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="260" x="1841.5" y="53.7676">Financial Service Provider (Participant)</text><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="88.5" y="199.6191"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="88.5" y="3812.002"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="3642.3828" style="stroke:#A80036;stroke-width:1.0;" width="10" x="306.5" y="199.6191"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="58.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="306.5" y="4366.5234"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="383.4824"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="661.8535"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="940.2246"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="1218.5957"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="1506.3223"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="1791.6934"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="2070.0645"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="2348.4355"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="2626.8066"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="2890.2227"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="3168.5938"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="3446.9648"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="125.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1177" y="3775.6914"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1177" y="4461.4551"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="620.1426" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1485" y="3871.3125"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1755" y="4337.2129"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="82.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1755" y="4425.1445"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="4338.457" style="stroke:#000000;stroke-width:2.0;" width="2275" x="10" y="160.998"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="46.6211" style="stroke:#000000;stroke-width:2.0;" width="883" x="209.5" y="244.6191"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="3375.5195" style="stroke:#000000;stroke-width:2.0;" width="800" x="189.5" y="305.2402"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="3344.209" style="stroke:#000000;stroke-width:2.0;" width="780" x="199.5" y="329.5508"/><rect fill="#FFFFFF" height="278.3711" style="stroke:none;stroke-width:1.0;" width="780" x="199.5" y="610.2773"/><rect fill="#FFFFFF" height="278.3711" style="stroke:none;stroke-width:1.0;" width="780" x="199.5" y="888.6484"/><rect fill="#FFFFFF" height="573.0977" style="stroke:none;stroke-width:1.0;" width="780" x="199.5" y="1167.0195"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="280.7266" style="stroke:#000000;stroke-width:2.0;" width="760" x="209.5" y="1452.3906"/><rect fill="#FFFFFF" height="278.3711" style="stroke:none;stroke-width:1.0;" width="780" x="199.5" y="1740.1172"/><rect fill="#FFFFFF" height="278.3711" style="stroke:none;stroke-width:1.0;" width="780" x="199.5" y="2018.4883"/><rect fill="#FFFFFF" height="278.3711" style="stroke:none;stroke-width:1.0;" width="780" x="199.5" y="2296.8594"/><rect fill="#FFFFFF" height="541.7871" style="stroke:none;stroke-width:1.0;" width="780" x="199.5" y="2575.2305"/><rect fill="#FFFFFF" height="278.3711" style="stroke:none;stroke-width:1.0;" width="780" x="199.5" y="3117.0176"/><rect fill="#FFFFFF" height="278.3711" style="stroke:none;stroke-width:1.0;" width="780" x="199.5" y="3395.3887"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="46.6211" style="stroke:#000000;stroke-width:2.0;" width="1072" x="209.5" y="3737.0703"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="283.6582" style="stroke:#000000;stroke-width:2.0;" width="884.5" x="1390.5" y="3958.623"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="134.5527" style="stroke:#000000;stroke-width:2.0;" width="1633" x="209.5" y="4298.5918"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="93" x2="93" y1="143.998" y2="4516.4551"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="311.5" x2="311.5" y1="143.998" y2="4516.4551"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="892.5" x2="892.5" y1="143.998" y2="4516.4551"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1025.5" x2="1025.5" y1="143.998" y2="4516.4551"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1181.5" x2="1181.5" y1="143.998" y2="4516.4551"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1489.5" x2="1489.5" y1="143.998" y2="4516.4551"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1759.5" x2="1759.5" y1="143.998" y2="4516.4551"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1971" x2="1971" y1="143.998" y2="4516.4551"/><rect fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="139" x="24" y="104.5098"/><rect fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="139" x="20" y="108.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="27" y="129.0449">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="139" x="24" y="4515.4551"/><rect fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="139" x="20" y="4519.4551"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="27" y="4539.9902">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="178" x="219.5" y="141.0449">Notification Event Handler</text><ellipse cx="311.5" cy="111.5098" fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><polygon fill="#A80036" points="307.5,99.5098,313.5,94.5098,311.5,99.5098,313.5,104.5098,307.5,99.5098" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="178" x="219.5" y="4528.9902">Notification Event Handler</text><ellipse cx="311.5" cy="4547.9434" fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><polygon fill="#A80036" points="307.5,4535.9434,313.5,4530.9434,311.5,4535.9434,313.5,4540.9434,307.5,4535.9434" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="825.5" y="141.0449">Central Service API</text><path d="M872,99.5098 L872,123.5098 M872,111.5098 L889,111.5098 " fill="none" filter="url(#f15ajfi4kpxnrj)" style="stroke:#A80036;stroke-width:2.0;"/><ellipse cx="901" cy="111.5098" fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="825.5" y="4528.9902">Central Service API</text><path d="M872,4535.9434 L872,4559.9434 M872,4547.9434 L889,4547.9434 " fill="none" filter="url(#f15ajfi4kpxnrj)" style="stroke:#A80036;stroke-width:2.0;"/><ellipse cx="901" cy="4547.9434" fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="969.5" y="141.0449">Persistant Store</text><path d="M1008,91.5098 C1008,81.5098 1026,81.5098 1026,81.5098 C1026,81.5098 1044,81.5098 1044,91.5098 L1044,117.5098 C1044,127.5098 1026,127.5098 1026,127.5098 C1026,127.5098 1008,127.5098 1008,117.5098 L1008,91.5098 " fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" style="stroke:#000000;stroke-width:1.5;"/><path d="M1008,91.5098 C1008,101.5098 1026,101.5098 1026,101.5098 C1026,101.5098 1044,101.5098 1044,91.5098 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="969.5" y="4528.9902">Persistant Store</text><path d="M1008,4541.9434 C1008,4531.9434 1026,4531.9434 1026,4531.9434 C1026,4531.9434 1044,4531.9434 1044,4541.9434 L1044,4567.9434 C1044,4577.9434 1026,4577.9434 1026,4577.9434 C1026,4577.9434 1008,4577.9434 1008,4567.9434 L1008,4541.9434 " fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" style="stroke:#000000;stroke-width:1.5;"/><path d="M1008,4541.9434 C1008,4551.9434 1026,4551.9434 1026,4551.9434 C1026,4551.9434 1044,4551.9434 1044,4541.9434 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="171" x="1096.5" y="104.5098"/><rect fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="171" x="1092.5" y="108.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="1099.5" y="129.0449">NotificationsCommand</text><rect fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="171" x="1096.5" y="4515.4551"/><rect fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="171" x="1092.5" y="4519.4551"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="1099.5" y="4539.9902">NotificationsCommand</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="173" x="1400.5" y="141.0449">Notification Cmd Handler</text><ellipse cx="1490" cy="111.5098" fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><polygon fill="#A80036" points="1486,99.5098,1492,94.5098,1490,99.5098,1492,104.5098,1486,99.5098" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="173" x="1400.5" y="4528.9902">Notification Cmd Handler</text><ellipse cx="1490" cy="4547.9434" fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><polygon fill="#A80036" points="1486,4535.9434,1492,4530.9434,1490,4535.9434,1492,4540.9434,1486,4535.9434" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="137" x="1691.5" y="104.5098"/><rect fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="137" x="1687.5" y="108.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="123" x="1694.5" y="129.0449">NotificationsEvent</text><rect fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="137" x="1691.5" y="4515.4551"/><rect fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="137" x="1687.5" y="4519.4551"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="123" x="1694.5" y="4539.9902">NotificationsEvent</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="1932" y="141.0449">Participant</text><ellipse cx="1971.5" cy="70.5098" fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M1971.5,78.5098 L1971.5,105.5098 M1958.5,86.5098 L1984.5,86.5098 M1971.5,105.5098 L1958.5,120.5098 M1971.5,105.5098 L1984.5,120.5098 " fill="none" filter="url(#f15ajfi4kpxnrj)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="1932" y="4528.9902">Participant</text><ellipse cx="1971.5" cy="4541.9434" fill="#FEFECE" filter="url(#f15ajfi4kpxnrj)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M1971.5,4549.9434 L1971.5,4576.9434 M1958.5,4557.9434 L1984.5,4557.9434 M1971.5,4576.9434 L1958.5,4591.9434 M1971.5,4576.9434 L1984.5,4591.9434 " fill="none" filter="url(#f15ajfi4kpxnrj)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="88.5" y="199.6191"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="88.5" y="3812.002"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="3642.3828" style="stroke:#A80036;stroke-width:1.0;" width="10" x="306.5" y="199.6191"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="58.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="306.5" y="4366.5234"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="383.4824"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="661.8535"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="940.2246"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="1218.5957"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="1506.3223"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="1791.6934"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="2070.0645"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="2348.4355"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="2626.8066"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="2890.2227"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="3168.5938"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="887.5" y="3446.9648"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="125.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1177" y="3775.6914"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1177" y="4461.4551"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="620.1426" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1485" y="3871.3125"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1755" y="4337.2129"/><rect fill="#FFFFFF" filter="url(#f15ajfi4kpxnrj)" height="82.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1755" y="4425.1445"/><path d="M10,160.998 L269,160.998 L269,167.998 L259,177.998 L10,177.998 L10,160.998 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="4338.457" style="stroke:#000000;stroke-width:2.0;" width="2275" x="10" y="160.998"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="214" x="25" y="174.5664">Send notification to Participants</text><polygon fill="#A80036" points="109.5,195.6191,99.5,199.6191,109.5,203.6191,105.5,199.6191" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="103.5" x2="305.5" y1="199.6191" y2="199.6191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="115.5" y="194.877">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="128.5" y="194.877">Consume Notification event</text><path d="M209.5,244.6191 L271.5,244.6191 L271.5,251.6191 L261.5,261.6191 L209.5,261.6191 L209.5,244.6191 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="46.6211" style="stroke:#000000;stroke-width:2.0;" width="883" x="209.5" y="244.6191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="224.5" y="258.1875">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="244" x="286.5" y="257.2539">[transport.options.deliver-report === true]</text><polygon fill="#A80036" points="1014,279.2402,1024,283.2402,1014,287.2402,1018,283.2402" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="316.5" x2="1020" y1="283.2402" y2="283.2402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="323.5" y="278.498">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="336.5" y="278.498">Record Notification event</text><path d="M189.5,305.2402 L323.5,305.2402 L323.5,312.2402 L313.5,322.2402 L189.5,322.2402 L189.5,305.2402 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="3375.5195" style="stroke:#000000;stroke-width:2.0;" width="800" x="189.5" y="305.2402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="204.5" y="318.8086">Routing logic</text><path d="M199.5,329.5508 L261.5,329.5508 L261.5,336.5508 L251.5,346.5508 L199.5,346.5508 L199.5,329.5508 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="3344.209" style="stroke:#000000;stroke-width:2.0;" width="780" x="199.5" y="329.5508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="214.5" y="343.1191">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="518" x="276.5" y="342.1855">[event.type === 'notification' &amp;&amp; event.action === 'prepare' &amp;&amp; event.status === 'success']</text><polygon fill="#A80036" points="327.5,379.4824,317.5,383.4824,327.5,387.4824,323.5,383.4824" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="875.5,379.4824,885.5,383.4824,875.5,387.4824,879.5,383.4824" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="321.5" x2="881.5" y1="383.4824" y2="383.4824"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="333.5" y="371.085">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="346.5" y="363.4297">Return Endpoint details for Payee-Participant</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="346.5" y="378.7402">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="430.5" y="378.7402">3202, 3203</text><line style="stroke:#A80036;stroke-width:1.0;" x1="316.5" x2="358.5" y1="442.793" y2="442.793"/><line style="stroke:#A80036;stroke-width:1.0;" x1="358.5" x2="358.5" y1="442.793" y2="455.793"/><line style="stroke:#A80036;stroke-width:1.0;" x1="317.5" x2="358.5" y1="455.793" y2="455.793"/><polygon fill="#A80036" points="327.5,451.793,317.5,455.793,327.5,459.793,323.5,455.793" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="323.5" y="438.0508">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="393" x="336.5" y="438.0508">Construct NotifyCmd Command Message - recipient: PayerFSP</text><path d="M321,468.793 L321,600.793 L747,600.793 L747,478.793 L737,468.793 L321,468.793 " fill="#FFFF00" filter="url(#f15ajfi4kpxnrj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M737,468.793 L737,478.793 L747,478.793 L737,468.793 " fill="#FFFF00" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="327" y="486.3613">"transport": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="343" y="501.6719">"type": "HTTP",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="343" y="516.9824">"method": "POST",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="389" x="343" y="532.293">"endpoint": "http://Payee-Participant/transfers/{{transferId}}",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="343" y="547.6035">"params": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="359" y="562.9141">"transferId": "{transferId}"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="343" y="578.2246">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="327" y="593.5352">}</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="199.5" x2="979.5" y1="611.2773" y2="611.2773"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="610" x="204.5" y="621.9121">[event.type === 'notification' &amp;&amp; event.action === 'prepare.*|position-prepare' &amp;&amp; event.status === 'error']</text><polygon fill="#A80036" points="327.5,657.8535,317.5,661.8535,327.5,665.8535,323.5,661.8535" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="875.5,657.8535,885.5,661.8535,875.5,665.8535,879.5,661.8535" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="321.5" x2="881.5" y1="661.8535" y2="661.8535"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="333.5" y="649.4561">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="281" x="346.5" y="641.8008">Return Endpoint details for Payer-Participant</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="346.5" y="657.1113">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="430.5" y="657.1113">3202, 3203</text><line style="stroke:#A80036;stroke-width:1.0;" x1="316.5" x2="358.5" y1="721.1641" y2="721.1641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="358.5" x2="358.5" y1="721.1641" y2="734.1641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="317.5" x2="358.5" y1="734.1641" y2="734.1641"/><polygon fill="#A80036" points="327.5,730.1641,317.5,734.1641,327.5,738.1641,323.5,734.1641" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="323.5" y="716.4219">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="512" x="336.5" y="716.4219">Construct NotifyCmd Command Message with enriched message &amp; endpoint data</text><path d="M321,747.1641 L321,879.1641 L782,879.1641 L782,757.1641 L772,747.1641 L321,747.1641 " fill="#FFFF00" filter="url(#f15ajfi4kpxnrj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M772,747.1641 L772,757.1641 L782,757.1641 L772,747.1641 " fill="#FFFF00" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="327" y="764.7324">"transport": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="343" y="780.043">"type": "HTTP",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="343" y="795.3535">"method": "PUT",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="424" x="343" y="810.6641">"endpoint": "http://Payer-Participant/transfers/{{transferId}}/error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="343" y="825.9746">"params": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="359" y="841.2852">"transferId": "{transferId}"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="343" y="856.5957">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="327" y="871.9063">}</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="199.5" x2="979.5" y1="889.6484" y2="889.6484"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="576" x="204.5" y="900.2832">[event.type === 'notification' &amp;&amp; event.action === 'prepare-duplicate' &amp;&amp; event.status === 'success']</text><polygon fill="#A80036" points="327.5,936.2246,317.5,940.2246,327.5,944.2246,323.5,940.2246" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="875.5,936.2246,885.5,940.2246,875.5,944.2246,879.5,940.2246" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="321.5" x2="881.5" y1="940.2246" y2="940.2246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="333.5" y="927.8271">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="281" x="346.5" y="920.1719">Return Endpoint details for Payer-Participant</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="346.5" y="935.4824">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="430.5" y="935.4824">3202, 3203</text><line style="stroke:#A80036;stroke-width:1.0;" x1="316.5" x2="358.5" y1="999.5352" y2="999.5352"/><line style="stroke:#A80036;stroke-width:1.0;" x1="358.5" x2="358.5" y1="999.5352" y2="1012.5352"/><line style="stroke:#A80036;stroke-width:1.0;" x1="317.5" x2="358.5" y1="1012.5352" y2="1012.5352"/><polygon fill="#A80036" points="327.5,1008.5352,317.5,1012.5352,327.5,1016.5352,323.5,1012.5352" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="323.5" y="994.793">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="512" x="336.5" y="994.793">Construct NotifyCmd Command Message with enriched message &amp; endpoint data</text><path d="M321,1025.5352 L321,1157.5352 L782,1157.5352 L782,1035.5352 L772,1025.5352 L321,1025.5352 " fill="#FFFF00" filter="url(#f15ajfi4kpxnrj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M772,1025.5352 L772,1035.5352 L782,1035.5352 L772,1025.5352 " fill="#FFFF00" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="327" y="1043.1035">"transport": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="343" y="1058.4141">"type": "HTTP",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="343" y="1073.7246">"method": "PUT",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="424" x="343" y="1089.0352">"endpoint": "http://Payer-Participant/transfers/{{transferId}}/error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="343" y="1104.3457">"params": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="359" y="1119.6563">"transferId": "{transferId}"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="343" y="1134.9668">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="327" y="1150.2773">}</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="199.5" x2="979.5" y1="1168.0195" y2="1168.0195"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="564" x="204.5" y="1178.6543">[event.type === 'notification' &amp;&amp; event.action === 'commit|reserve' &amp;&amp; event.status === 'success']</text><polygon fill="#A80036" points="327.5,1214.5957,317.5,1218.5957,327.5,1222.5957,323.5,1218.5957" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="875.5,1214.5957,885.5,1218.5957,875.5,1222.5957,879.5,1218.5957" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="321.5" x2="881.5" y1="1218.5957" y2="1218.5957"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="333.5" y="1206.1982">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="281" x="346.5" y="1198.543">Return Endpoint details for Payer-Participant</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="346.5" y="1213.8535">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="430.5" y="1213.8535">3202, 3203</text><line style="stroke:#A80036;stroke-width:1.0;" x1="316.5" x2="358.5" y1="1277.9063" y2="1277.9063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="358.5" x2="358.5" y1="1277.9063" y2="1290.9063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="317.5" x2="358.5" y1="1290.9063" y2="1290.9063"/><polygon fill="#A80036" points="327.5,1286.9063,317.5,1290.9063,327.5,1294.9063,323.5,1290.9063" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="323.5" y="1273.1641">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="512" x="345.5" y="1273.1641">Construct NotifyCmd Command Message with enriched message &amp; endpoint data</text><path d="M321,1303.9063 L321,1435.9063 L745,1435.9063 L745,1313.9063 L735,1303.9063 L321,1303.9063 " fill="#FFFF00" filter="url(#f15ajfi4kpxnrj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M735,1303.9063 L735,1313.9063 L745,1313.9063 L735,1303.9063 " fill="#FFFF00" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="327" y="1321.4746">"transport": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="343" y="1336.7852">"type": "HTTP",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="343" y="1352.0957">"method": "PUT",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="387" x="343" y="1367.4063">"endpoint": "http://Payer-Participant/transfers/{{transferId}}",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="343" y="1382.7168">"params": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="359" y="1398.0273">"transferId": "{transferId}"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="343" y="1413.3379">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="327" y="1428.6484">}</text><path d="M209.5,1452.3906 L271.5,1452.3906 L271.5,1459.3906 L261.5,1469.3906 L209.5,1469.3906 L209.5,1452.3906 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="280.7266" style="stroke:#000000;stroke-width:2.0;" width="760" x="209.5" y="1452.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="224.5" y="1465.959">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="611" x="286.5" y="1465.0254">[(Config.SEND_TRANSFER_CONFIRMATION_TO_PAYEE === true || event.action === 'reserve') &amp;&amp; to!=from]</text><polygon fill="#A80036" points="327.5,1502.3223,317.5,1506.3223,327.5,1510.3223,323.5,1506.3223" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="875.5,1502.3223,885.5,1506.3223,875.5,1510.3223,879.5,1506.3223" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="321.5" x2="881.5" y1="1506.3223" y2="1506.3223"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="333.5" y="1493.9248">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="355.5" y="1486.2695">Return Endpoint details for Payee-Participant</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="355.5" y="1501.5801">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="439.5" y="1501.5801">3202, 3203</text><line style="stroke:#A80036;stroke-width:1.0;" x1="316.5" x2="358.5" y1="1565.6328" y2="1565.6328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="358.5" x2="358.5" y1="1565.6328" y2="1578.6328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="317.5" x2="358.5" y1="1578.6328" y2="1578.6328"/><polygon fill="#A80036" points="327.5,1574.6328,317.5,1578.6328,327.5,1582.6328,323.5,1578.6328" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="323.5" y="1560.8906">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="512" x="345.5" y="1560.8906">Construct NotifyCmd Command Message with enriched message &amp; endpoint data</text><path d="M321,1591.6328 L321,1723.6328 L747,1723.6328 L747,1601.6328 L737,1591.6328 L321,1591.6328 " fill="#FFFF00" filter="url(#f15ajfi4kpxnrj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M737,1591.6328 L737,1601.6328 L747,1601.6328 L737,1591.6328 " fill="#FFFF00" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="327" y="1609.2012">"transport": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="343" y="1624.5117">"type": "HTTP",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="343" y="1639.8223">"method": "PUT",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="389" x="343" y="1655.1328">"endpoint": "http://Payee-Participant/transfers/{{transferId}}",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="343" y="1670.4434">"params": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="359" y="1685.7539">"transferId": "{transferId}"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="343" y="1701.0645">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="327" y="1716.375">}</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="199.5" x2="979.5" y1="1741.1172" y2="1741.1172"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="540" x="204.5" y="1751.752">[event.type === 'notification' &amp;&amp; event.action === 'reject|abort' &amp;&amp; event.status === 'success']</text><polygon fill="#A80036" points="327.5,1787.6934,317.5,1791.6934,327.5,1795.6934,323.5,1791.6934" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="875.5,1787.6934,885.5,1791.6934,875.5,1795.6934,879.5,1791.6934" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="321.5" x2="881.5" y1="1791.6934" y2="1791.6934"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="333.5" y="1779.2959">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="355.5" y="1771.6406">Return Endpoint details for Payee-Participant</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="355.5" y="1786.9512">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="439.5" y="1786.9512">3202, 3203</text><line style="stroke:#A80036;stroke-width:1.0;" x1="316.5" x2="358.5" y1="1851.0039" y2="1851.0039"/><line style="stroke:#A80036;stroke-width:1.0;" x1="358.5" x2="358.5" y1="1851.0039" y2="1864.0039"/><line style="stroke:#A80036;stroke-width:1.0;" x1="317.5" x2="358.5" y1="1864.0039" y2="1864.0039"/><polygon fill="#A80036" points="327.5,1860.0039,317.5,1864.0039,327.5,1868.0039,323.5,1864.0039" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="323.5" y="1846.2617">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="512" x="345.5" y="1846.2617">Construct NotifyCmd Command Message with enriched message &amp; endpoint data</text><path d="M321,1877.0039 L321,2009.0039 L784,2009.0039 L784,1887.0039 L774,1877.0039 L321,1877.0039 " fill="#FFFF00" filter="url(#f15ajfi4kpxnrj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M774,1877.0039 L774,1887.0039 L784,1887.0039 L774,1877.0039 " fill="#FFFF00" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="327" y="1894.5723">"transport": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="343" y="1909.8828">"type": "HTTP",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="343" y="1925.1934">"method": "PUT",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="426" x="343" y="1940.5039">"endpoint": "http://Payee-Participant/transfers/{{transferId}}/error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="343" y="1955.8145">"params": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="359" y="1971.125">"transferId": "{transferId}"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="343" y="1986.4355">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="327" y="2001.7461">}</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="199.5" x2="979.5" y1="2019.4883" y2="2019.4883"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="549" x="204.5" y="2030.123">[event.type === 'notification' &amp;&amp; event.action === 'commit|reserve' &amp;&amp; event.status === 'error']</text><polygon fill="#A80036" points="327.5,2066.0645,317.5,2070.0645,327.5,2074.0645,323.5,2070.0645" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="875.5,2066.0645,885.5,2070.0645,875.5,2074.0645,879.5,2070.0645" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="321.5" x2="881.5" y1="2070.0645" y2="2070.0645"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="333.5" y="2057.667">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="355.5" y="2050.0117">Return Endpoint details for Payee-Participant</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="355.5" y="2065.3223">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="439.5" y="2065.3223">3202, 3203</text><line style="stroke:#A80036;stroke-width:1.0;" x1="316.5" x2="358.5" y1="2129.375" y2="2129.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="358.5" x2="358.5" y1="2129.375" y2="2142.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="317.5" x2="358.5" y1="2142.375" y2="2142.375"/><polygon fill="#A80036" points="327.5,2138.375,317.5,2142.375,327.5,2146.375,323.5,2142.375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="323.5" y="2124.6328">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="512" x="345.5" y="2124.6328">Construct NotifyCmd Command Message with enriched message &amp; endpoint data</text><path d="M321,2155.375 L321,2287.375 L784,2287.375 L784,2165.375 L774,2155.375 L321,2155.375 " fill="#FFFF00" filter="url(#f15ajfi4kpxnrj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M774,2155.375 L774,2165.375 L784,2165.375 L774,2155.375 " fill="#FFFF00" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="327" y="2172.9434">"transport": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="343" y="2188.2539">"type": "HTTP",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="343" y="2203.5645">"method": "PUT",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="426" x="343" y="2218.875">"endpoint": "http://Payee-Participant/transfers/{{transferId}}/error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="343" y="2234.1855">"params": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="359" y="2249.4961">"transferId": "{transferId}"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="343" y="2264.8066">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="327" y="2280.1172">}</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="199.5" x2="979.5" y1="2297.8594" y2="2297.8594"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="558" x="204.5" y="2308.4941">[event.type === 'notification' &amp;&amp; event.action === 'timeout-received' &amp;&amp; event.status === 'error']</text><polygon fill="#A80036" points="327.5,2344.4355,317.5,2348.4355,327.5,2352.4355,323.5,2348.4355" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="875.5,2344.4355,885.5,2348.4355,875.5,2352.4355,879.5,2348.4355" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="321.5" x2="881.5" y1="2348.4355" y2="2348.4355"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="333.5" y="2336.0381">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="355.5" y="2328.3828">Return Endpoint details for Payee-Participant</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="355.5" y="2343.6934">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="439.5" y="2343.6934">3202, 3203</text><line style="stroke:#A80036;stroke-width:1.0;" x1="316.5" x2="358.5" y1="2407.7461" y2="2407.7461"/><line style="stroke:#A80036;stroke-width:1.0;" x1="358.5" x2="358.5" y1="2407.7461" y2="2420.7461"/><line style="stroke:#A80036;stroke-width:1.0;" x1="317.5" x2="358.5" y1="2420.7461" y2="2420.7461"/><polygon fill="#A80036" points="327.5,2416.7461,317.5,2420.7461,327.5,2424.7461,323.5,2420.7461" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="323.5" y="2403.0039">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="512" x="345.5" y="2403.0039">Construct NotifyCmd Command Message with enriched message &amp; endpoint data</text><path d="M321,2433.7461 L321,2565.7461 L784,2565.7461 L784,2443.7461 L774,2433.7461 L321,2433.7461 " fill="#FFFF00" filter="url(#f15ajfi4kpxnrj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M774,2433.7461 L774,2443.7461 L784,2443.7461 L774,2433.7461 " fill="#FFFF00" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="327" y="2451.3145">"transport": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="343" y="2466.625">"type": "HTTP",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="343" y="2481.9355">"method": "PUT",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="426" x="343" y="2497.2461">"endpoint": "http://Payee-Participant/transfers/{{transferId}}/error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="343" y="2512.5566">"params": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="359" y="2527.8672">"transferId": "{transferId}"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="343" y="2543.1777">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="327" y="2558.4883">}</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="199.5" x2="979.5" y1="2576.2305" y2="2576.2305"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="574" x="204.5" y="2586.8652">[event.type === 'notification' &amp;&amp; event.action === 'timeout-reserved' &amp;&amp; event.status === 'success']</text><polygon fill="#A80036" points="327.5,2622.8066,317.5,2626.8066,327.5,2630.8066,323.5,2626.8066" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="875.5,2622.8066,885.5,2626.8066,875.5,2630.8066,879.5,2626.8066" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="321.5" x2="881.5" y1="2626.8066" y2="2626.8066"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="333.5" y="2614.4092">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="281" x="355.5" y="2606.7539">Return Endpoint details for Payer-Participant</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="355.5" y="2622.0645">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="439.5" y="2622.0645">3202, 3203</text><line style="stroke:#A80036;stroke-width:1.0;" x1="316.5" x2="358.5" y1="2686.1172" y2="2686.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="358.5" x2="358.5" y1="2686.1172" y2="2699.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="317.5" x2="358.5" y1="2699.1172" y2="2699.1172"/><polygon fill="#A80036" points="327.5,2695.1172,317.5,2699.1172,327.5,2703.1172,323.5,2699.1172" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="323.5" y="2681.375">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="512" x="345.5" y="2681.375">Construct NotifyCmd Command Message with enriched message &amp; endpoint data</text><path d="M321,2712.1172 L321,2844.1172 L782,2844.1172 L782,2722.1172 L772,2712.1172 L321,2712.1172 " fill="#FFFF00" filter="url(#f15ajfi4kpxnrj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M772,2712.1172 L772,2722.1172 L782,2722.1172 L772,2712.1172 " fill="#FFFF00" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="327" y="2729.6855">"transport": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="343" y="2744.9961">"type": "HTTP",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="343" y="2760.3066">"method": "PUT",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="424" x="343" y="2775.6172">"endpoint": "http://Payer-Participant/transfers/{{transferId}}/error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="343" y="2790.9277">"params": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="359" y="2806.2383">"transferId": "{transferId}"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="343" y="2821.5488">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="327" y="2836.8594">}</text><polygon fill="#A80036" points="327.5,2886.2227,317.5,2890.2227,327.5,2894.2227,323.5,2890.2227" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="875.5,2886.2227,885.5,2890.2227,875.5,2894.2227,879.5,2890.2227" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="321.5" x2="881.5" y1="2890.2227" y2="2890.2227"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="333.5" y="2877.8252">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="355.5" y="2870.1699">Return Endpoint details for Payee-Participant</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="355.5" y="2885.4805">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="439.5" y="2885.4805">3202, 3203</text><line style="stroke:#A80036;stroke-width:1.0;" x1="316.5" x2="358.5" y1="2949.5332" y2="2949.5332"/><line style="stroke:#A80036;stroke-width:1.0;" x1="358.5" x2="358.5" y1="2949.5332" y2="2962.5332"/><line style="stroke:#A80036;stroke-width:1.0;" x1="317.5" x2="358.5" y1="2962.5332" y2="2962.5332"/><polygon fill="#A80036" points="327.5,2958.5332,317.5,2962.5332,327.5,2966.5332,323.5,2962.5332" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="323.5" y="2944.791">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="512" x="345.5" y="2944.791">Construct NotifyCmd Command Message with enriched message &amp; endpoint data</text><path d="M321,2975.5332 L321,3107.5332 L784,3107.5332 L784,2985.5332 L774,2975.5332 L321,2975.5332 " fill="#FFFF00" filter="url(#f15ajfi4kpxnrj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M774,2975.5332 L774,2985.5332 L784,2985.5332 L774,2975.5332 " fill="#FFFF00" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="327" y="2993.1016">"transport": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="343" y="3008.4121">"type": "HTTP",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="343" y="3023.7227">"method": "PUT",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="426" x="343" y="3039.0332">"endpoint": "http://Payee-Participant/transfers/{{transferId}}/error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="343" y="3054.3438">"params": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="359" y="3069.6543">"transferId": "{transferId}"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="343" y="3084.9648">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="327" y="3100.2754">}</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="199.5" x2="979.5" y1="3118.0176" y2="3118.0176"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="493" x="204.5" y="3128.6523">[event.type === 'notification' &amp;&amp; event.action === 'get' &amp;&amp; event.status === 'success']</text><polygon fill="#A80036" points="327.5,3164.5938,317.5,3168.5938,327.5,3172.5938,323.5,3168.5938" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="875.5,3164.5938,885.5,3168.5938,875.5,3172.5938,879.5,3168.5938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="321.5" x2="881.5" y1="3168.5938" y2="3168.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="333.5" y="3156.1963">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="318" x="355.5" y="3148.541">Return Endpoint details for Requesting-Participant</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="355.5" y="3163.8516">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="439.5" y="3163.8516">3202, 3203</text><line style="stroke:#A80036;stroke-width:1.0;" x1="316.5" x2="358.5" y1="3227.9043" y2="3227.9043"/><line style="stroke:#A80036;stroke-width:1.0;" x1="358.5" x2="358.5" y1="3227.9043" y2="3240.9043"/><line style="stroke:#A80036;stroke-width:1.0;" x1="317.5" x2="358.5" y1="3240.9043" y2="3240.9043"/><polygon fill="#A80036" points="327.5,3236.9043,317.5,3240.9043,327.5,3244.9043,323.5,3240.9043" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="323.5" y="3223.1621">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="512" x="345.5" y="3223.1621">Construct NotifyCmd Command Message with enriched message &amp; endpoint data</text><path d="M321,3253.9043 L321,3385.9043 L782,3385.9043 L782,3263.9043 L772,3253.9043 L321,3253.9043 " fill="#FFFF00" filter="url(#f15ajfi4kpxnrj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M772,3253.9043 L772,3263.9043 L782,3263.9043 L772,3253.9043 " fill="#FFFF00" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="327" y="3271.4727">"transport": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="343" y="3286.7832">"type": "HTTP",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="343" y="3302.0938">"method": "PUT",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="424" x="343" y="3317.4043">"endpoint": "http://Requesting-Participant/transfers/{{transferId}}",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="343" y="3332.7148">"params": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="359" y="3348.0254">"transferId": "{transferId}"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="343" y="3363.3359">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="327" y="3378.6465">}</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="199.5" x2="979.5" y1="3396.3887" y2="3396.3887"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="478" x="204.5" y="3407.0234">[event.type === 'notification' &amp;&amp; event.action === 'get' &amp;&amp; event.status === 'error']</text><polygon fill="#A80036" points="327.5,3442.9648,317.5,3446.9648,327.5,3450.9648,323.5,3446.9648" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="875.5,3442.9648,885.5,3446.9648,875.5,3450.9648,879.5,3446.9648" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="321.5" x2="881.5" y1="3446.9648" y2="3446.9648"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="333.5" y="3434.5674">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="318" x="355.5" y="3426.9121">Return Endpoint details for Requesting-Participant</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="355.5" y="3442.2227">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="439.5" y="3442.2227">3202, 3203</text><line style="stroke:#A80036;stroke-width:1.0;" x1="316.5" x2="358.5" y1="3506.2754" y2="3506.2754"/><line style="stroke:#A80036;stroke-width:1.0;" x1="358.5" x2="358.5" y1="3506.2754" y2="3519.2754"/><line style="stroke:#A80036;stroke-width:1.0;" x1="317.5" x2="358.5" y1="3519.2754" y2="3519.2754"/><polygon fill="#A80036" points="327.5,3515.2754,317.5,3519.2754,327.5,3523.2754,323.5,3519.2754" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="323.5" y="3501.5332">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="512" x="345.5" y="3501.5332">Construct NotifyCmd Command Message with enriched message &amp; endpoint data</text><path d="M321,3532.2754 L321,3664.2754 L819,3664.2754 L819,3542.2754 L809,3532.2754 L321,3532.2754 " fill="#FFFF00" filter="url(#f15ajfi4kpxnrj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M809,3532.2754 L809,3542.2754 L819,3542.2754 L809,3532.2754 " fill="#FFFF00" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="327" y="3549.8438">"transport": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="343" y="3565.1543">"type": "HTTP",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="343" y="3580.4648">"method": "PUT",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="461" x="343" y="3595.7754">"endpoint": "http://Requesting-Participant/transfers/{{transferId}}/error",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="343" y="3611.0859">"params": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="359" y="3626.3965">"transferId": "{transferId}"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="343" y="3641.707">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="327" y="3657.0176">}</text><line style="stroke:#A80036;stroke-width:1.0;" x1="316.5" x2="358.5" y1="3709.0703" y2="3709.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="358.5" x2="358.5" y1="3709.0703" y2="3722.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="317.5" x2="358.5" y1="3722.0703" y2="3722.0703"/><polygon fill="#A80036" points="327.5,3718.0703,317.5,3722.0703,327.5,3726.0703,323.5,3722.0703" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="323.5" y="3704.3281">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="535" x="345.5" y="3704.3281">Construct NotifyCmd Command Message with notficiation-payload &amp; transport-data</text><path d="M209.5,3737.0703 L533.5,3737.0703 L533.5,3744.0703 L523.5,3754.0703 L209.5,3754.0703 L209.5,3737.0703 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="46.6211" style="stroke:#000000;stroke-width:2.0;" width="1072" x="209.5" y="3737.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="279" x="224.5" y="3750.6387">For-each NotifyCmd Command Messages</text><polygon fill="#A80036" points="1165,3771.6914,1175,3775.6914,1165,3779.6914,1169,3775.6914" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="316.5" x2="1171" y1="3775.6914" y2="3775.6914"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="323.5" y="3770.9492">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="345.5" y="3770.9492">Publish NotifyCmd Command Message</text><polygon fill="#A80036" points="109.5,3808.002,99.5,3812.002,109.5,3816.002,105.5,3812.002" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="103.5" x2="305.5" y1="3812.002" y2="3812.002"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="115.5" y="3807.2598">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="137.5" y="3807.2598">Commit Notification event</text><polygon fill="#A80036" points="1198,3867.3125,1188,3871.3125,1198,3875.3125,1194,3871.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1192" x2="1484" y1="3871.3125" y2="3871.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1204" y="3866.5703">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="257" x="1226" y="3866.5703">Consume NotifyCmd Command Message</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1495" x2="1537" y1="3930.623" y2="3930.623"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1537" x2="1537" y1="3930.623" y2="3943.623"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1496" x2="1537" y1="3943.623" y2="3943.623"/><polygon fill="#A80036" points="1506,3939.623,1496,3943.623,1506,3947.623,1502,3943.623" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1502" y="3925.8809">31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="1524" y="3925.8809">Construct Transport Message</text><path d="M1390.5,3958.623 L1810.5,3958.623 L1810.5,3965.623 L1800.5,3975.623 L1390.5,3975.623 L1390.5,3958.623 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="283.6582" style="stroke:#000000;stroke-width:2.0;" width="884.5" x="1390.5" y="3958.623"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="375" x="1405.5" y="3972.1914">Retry Transport Mechanism based on transport options</text><path d="M1500,3980.9336 L1500,4143.9336 L2261,4143.9336 L2261,3990.9336 L2251,3980.9336 L1500,3980.9336 " fill="#FFFF00" filter="url(#f15ajfi4kpxnrj)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2251,3980.9336 L2251,3990.9336 L2261,3990.9336 L2251,3980.9336 " fill="#FFFF00" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="1506" y="3998.502">"transport": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="1522" y="4013.8125">"options": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="1538" y="4029.123">"delivery-report": true,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="1538" y="4044.4336">"retry": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="1538" y="4059.7441">"count": 3,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="1538" y="4075.0547">"type": "noDelay|exponentialDelay",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="708" x="1538" y="4090.3652">"condition": "isNetworkError|isSafeRequestError|isIdempotentRequestError|isNetworkOrIdempotentRequestError"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1538" y="4105.6758">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1522" y="4120.9863">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1506" y="4136.2969">}</text><polygon fill="#A80036" points="1959.5,4200.9707,1969.5,4204.9707,1959.5,4208.9707,1963.5,4204.9707" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1495" x2="1965.5" y1="4204.9707" y2="4204.9707"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1502" y="4184.918">32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="287" x="1524" y="4169.6074">Notification with Prepare/fulfil result/error to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="1524" y="4184.918">Payer DFSP to specified Endpoint - PUT</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="73" x="1524" y="4200.2285">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="1601" y="4200.2285">1001</text><polygon fill="#A80036" points="1506,4230.2813,1496,4234.2813,1506,4238.2813,1502,4234.2813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1500" x2="1970.5" y1="4234.2813" y2="4234.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1512" y="4229.5391">33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="1534" y="4229.5391">HTTP 200 OK</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1495" x2="1537" y1="4270.5918" y2="4270.5918"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1537" x2="1537" y1="4270.5918" y2="4283.5918"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1496" x2="1537" y1="4283.5918" y2="4283.5918"/><polygon fill="#A80036" points="1506,4279.5918,1496,4283.5918,1506,4287.5918,1502,4283.5918" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1502" y="4265.8496">34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1524" y="4265.8496">Prepare Delivery Report</text><path d="M209.5,4298.5918 L271.5,4298.5918 L271.5,4305.5918 L261.5,4315.5918 L209.5,4315.5918 L209.5,4298.5918 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="134.5527" style="stroke:#000000;stroke-width:2.0;" width="1633" x="209.5" y="4298.5918"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="224.5" y="4312.1602">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="244" x="286.5" y="4311.2266">[transport.options.deliver-report === true]</text><polygon fill="#A80036" points="1743,4333.2129,1753,4337.2129,1743,4341.2129,1747,4337.2129" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1495" x2="1749" y1="4337.2129" y2="4337.2129"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1502" y="4332.4707">35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="1524" y="4332.4707">Publish NotifyDeliveryReport event</text><polygon fill="#A80036" points="1748,4362.5234,1758,4366.5234,1748,4370.5234,1752,4366.5234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="316.5" x2="1754" y1="4366.5234" y2="4366.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="323.5" y="4361.7813">36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="345.5" y="4361.7813">Consume NotifyDeliveryReport event</text><polygon fill="#A80036" points="1014,4391.834,1024,4395.834,1014,4399.834,1018,4395.834" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="316.5" x2="1020" y1="4395.834" y2="4395.834"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="323.5" y="4391.0918">37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="345.5" y="4391.0918">Record NotifyDeliveryReport event</text><polygon fill="#A80036" points="1743,4421.1445,1753,4425.1445,1743,4429.1445,1747,4425.1445" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="311.5" x2="1749" y1="4425.1445" y2="4425.1445"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="318.5" y="4420.4023">38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="340.5" y="4420.4023">Commit NotifyDeliveryReport event</text><polygon fill="#A80036" points="1198,4457.4551,1188,4461.4551,1198,4465.4551,1194,4461.4551" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1192" x2="1484" y1="4461.4551" y2="4461.4551"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1204" y="4456.7129">39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="1226" y="4456.7129">Commit NotifyCmd event</text><!--MD5=[c4ff4fcd09f997ea000697ab48551038]
@startuml
' declate title
title 1.0.0. Send Notification to Participant (Payer/Payee) (single message) v2.0

autonumber

' Actor Keys:
'   actor - Payer DFSP, Payee DFSP
'   boundary - APIs/Interfaces, etc
'   collections - Kafka Topics
'   control - Kafka Consumers
'   entity - Database Access Objects
'   database - Database Persistance Store

' declare actors
' actor "Payer DFSP\nParticipant" as PAYER_DFSP
actor "Participant" as PARTICIPANT
control "Notification Event Handler" as NOTIFY_HANDLER_EVT
control "Notification Cmd Handler" as NOTIFY_HANDLER_CMD
boundary "Central Service API" as CSAPI
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
collections "NotificationsCommand" as TOPIC_NOTIFICATIONS_CMD
collections "NotificationsEvent" as TOPIC_NOTIFICATIONS_EVT
' entity "Participant DAO" as PARTICIPANT_DAO
' entity "Notifications DAO" as NOTIFICATIONS_DAO
database "Persistant Store" as DB

' box "Financial Service Provider (Payer)" #lightGray
' 	participant PAYER_DFSP
' end box

' box "ML API Adapter Service" #LightBlue
' 	participant NOTIFY_HANDLER
' end box

box "Central Service" #LightYellow
    participant TOPIC_NOTIFICATIONS
    participant NOTIFY_HANDLER_EVT
    participant CSAPI
    ' participant NOTIFICATIONS_DAO
    participant DB
    participant TOPIC_NOTIFICATIONS_EVT
    ' participant PARTICIPANT_DAO
    ' participant DB
end box

box "Notification Engine" #LightCyan
    participant TOPIC_NOTIFICATIONS_CMD
    participant NOTIFY_HANDLER_CMD
    participant TOPIC_NOTIFICATIONS_EVT
end box

box "Financial Service Provider (Participant)" #lightGray
	participant PARTICIPANT
end box

' start flow
group Send notification to Participants
    ' note left of NOTIFY_HANDLER_EVT #yellow
    '     Message:
    '     {
    '         payload: {
    '             endpoint: {
    '                 type: <typeValue>,
    '                 value: <endpointValue>
    '            }
    '         }
    '     }
    ' end note

    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER_EVT: Consume Notification event
    activate NOTIFY_HANDLER_EVT
    activate TOPIC_NOTIFICATIONS
    deactivate TOPIC_NOTIFICATIONS

    alt transport.options.deliver-report === true
        NOTIFY_HANDLER_EVT -> DB: Record Notification event
    end

    ' put logic here to route command-type based on incoming events
    group Routing logic
        alt event.type === 'notification' && event.action === 'prepare' && event.status === 'success'
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Payee-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message - recipient: PayerFSP
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "POST",
                    "endpoint": "http://Payee-Participant/transfers/{{transferId}}",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
        else event.type === 'notification' && event.action === 'prepare.*|position-prepare' && event.status === 'error'
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Payer-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "PUT",
                    "endpoint": "http://Payer-Participant/transfers/{{transferId}}/error",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
        else event.type === 'notification' && event.action === 'prepare-duplicate' && event.status === 'success'
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Payer-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "PUT",
                    "endpoint": "http://Payer-Participant/transfers/{{transferId}}/error",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
       else event.type === 'notification' && event.action === 'commit|reserve' && event.status === 'success'
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Payer-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "PUT",
                    "endpoint": "http://Payer-Participant/transfers/{{transferId}}",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
            
            ' Notes:
            '   - To confirm if action=reserve results in sending out a payee notification <- - I assume this is for FSPIOP v1.1 changes
            '   - This is also only applicabble for "off-us" transfers
            alt (Config.SEND_TRANSFER_CONFIRMATION_TO_PAYEE === true || event.action === 'reserve') && to!=from
                CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Payee-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
                activate CSAPI
                deactivate CSAPI

                NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
                note right of NOTIFY_HANDLER_EVT #yellow
                    "transport": {
                        "type": "HTTP",
                        "method": "PUT",
                        "endpoint": "http://Payee-Participant/transfers/{{transferId}}",
                        "params": {
                            "transferId": "{transferId}"
                        }
                    }
                end note
            end
        else event.type === 'notification' && event.action === 'reject|abort' && event.status === 'success'
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Payee-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "PUT",
                    "endpoint": "http://Payee-Participant/transfers/{{transferId}}/error",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
        else event.type === 'notification' && event.action === 'commit|reserve' && event.status === 'error'
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Payee-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "PUT",
                    "endpoint": "http://Payee-Participant/transfers/{{transferId}}/error",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
        else event.type === 'notification' && event.action === 'timeout-received' && event.status === 'error'
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Payee-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "PUT",
                    "endpoint": "http://Payee-Participant/transfers/{{transferId}}/error",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
        else event.type === 'notification' && event.action === 'timeout-reserved' && event.status === 'success'
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Payer-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "PUT",
                    "endpoint": "http://Payer-Participant/transfers/{{transferId}}/error",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
            
            ' Notes:
            '   - To confirm if action=reserve results in sending out a payee notification <- - I assume this is for FSPIOP v1.1 changes
            '   - This is also only applicabble for "off-us" transfers
            ' alt (Config.SEND_TRANSFER_CONFIRMATION_TO_PAYEE === true || event.action === 'reserve') && to!=from
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Payee-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "PUT",
                    "endpoint": "http://Payee-Participant/transfers/{{transferId}}/error",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
            ' end
        else event.type === 'notification' && event.action === 'get' && event.status === 'success'
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Requesting-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "PUT",
                    "endpoint": "http://Requesting-Participant/transfers/{{transferId}}",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
        else event.type === 'notification' && event.action === 'get' && event.status === 'error'
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Requesting-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "PUT",
                    "endpoint": "http://Requesting-Participant/transfers/{{transferId}}/error",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
        end
    end
    

    NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with notficiation-payload & transport-data
    group For-each NotifyCmd Command Messages
        NOTIFY_HANDLER_EVT -> TOPIC_NOTIFICATIONS_CMD: Publish NotifyCmd Command Message
        activate TOPIC_NOTIFICATIONS_CMD
    end
    

    NOTIFY_HANDLER_EVT -> TOPIC_NOTIFICATIONS: Commit Notification event
    activate TOPIC_NOTIFICATIONS
    deactivate TOPIC_NOTIFICATIONS
    deactivate NOTIFY_HANDLER_EVT
    
    
    TOPIC_NOTIFICATIONS_CMD <- NOTIFY_HANDLER_CMD: Consume NotifyCmd Command Message
    activate NOTIFY_HANDLER_CMD
    deactivate TOPIC_NOTIFICATIONS_CMD

    NOTIFY_HANDLER_CMD -> NOTIFY_HANDLER_CMD: Construct Transport Message

    ' retry logic goes here
    group Retry Transport Mechanism based on transport options
        note right of NOTIFY_HANDLER_CMD #yellow
            "transport": {
                "options": {
                    "delivery-report": true,
                    "retry": {
                    "count": 3,
                    "type": "noDelay|exponentialDelay",
                    "condition": "isNetworkError|isSafeRequestError|isIdempotentRequestError|isNetworkOrIdempotentRequestError"
                    }
                }
            }
        end note
        NOTIFY_HANDLER_CMD -> PARTICIPANT: Notification with Prepare/fulfil result/error to \nPayer DFSP to specified Endpoint - PUT \n<color #FF0000><b>Error code:</b> 1001</color>
        NOTIFY_HANDLER_CMD <- - PARTICIPANT: HTTP 200 OK 
    end

    NOTIFY_HANDLER_CMD -> NOTIFY_HANDLER_CMD: Prepare Delivery Report

    alt transport.options.deliver-report === true
        NOTIFY_HANDLER_CMD -> TOPIC_NOTIFICATIONS_EVT: Publish NotifyDeliveryReport event
        activate TOPIC_NOTIFICATIONS_EVT

        TOPIC_NOTIFICATIONS_EVT <- NOTIFY_HANDLER_EVT: Consume NotifyDeliveryReport event
        deactivate TOPIC_NOTIFICATIONS_EVT
        activate NOTIFY_HANDLER_EVT

        NOTIFY_HANDLER_EVT -> DB: Record NotifyDeliveryReport event
        

        NOTIFY_HANDLER_EVT -> TOPIC_NOTIFICATIONS_EVT: Commit NotifyDeliveryReport event
        deactivate NOTIFY_HANDLER_EVT
        activate TOPIC_NOTIFICATIONS_EVT
        deactivate TOPIC_NOTIFICATIONS_EVT
    end

    NOTIFY_HANDLER_CMD -> TOPIC_NOTIFICATIONS_CMD: Commit NotifyCmd event
    activate TOPIC_NOTIFICATIONS_CMD
    deactivate TOPIC_NOTIFICATIONS_CMD
    deactivate NOTIFY_HANDLER_CMD

end
@enduml

@startuml
title 1.0.0. Send Notification to Participant (Payer/Payee) (single message) v2.0

autonumber


actor "Participant" as PARTICIPANT
control "Notification Event Handler" as NOTIFY_HANDLER_EVT
control "Notification Cmd Handler" as NOTIFY_HANDLER_CMD
boundary "Central Service API" as CSAPI
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
collections "NotificationsCommand" as TOPIC_NOTIFICATIONS_CMD
collections "NotificationsEvent" as TOPIC_NOTIFICATIONS_EVT
database "Persistant Store" as DB



box "Central Service" #LightYellow
    participant TOPIC_NOTIFICATIONS
    participant NOTIFY_HANDLER_EVT
    participant CSAPI
    participant DB
    participant TOPIC_NOTIFICATIONS_EVT
end box

box "Notification Engine" #LightCyan
    participant TOPIC_NOTIFICATIONS_CMD
    participant NOTIFY_HANDLER_CMD
    participant TOPIC_NOTIFICATIONS_EVT
end box

box "Financial Service Provider (Participant)" #lightGray
	participant PARTICIPANT
end box

group Send notification to Participants

    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER_EVT: Consume Notification event
    activate NOTIFY_HANDLER_EVT
    activate TOPIC_NOTIFICATIONS
    deactivate TOPIC_NOTIFICATIONS

    alt transport.options.deliver-report === true
        NOTIFY_HANDLER_EVT -> DB: Record Notification event
    end

    group Routing logic
        alt event.type === 'notification' && event.action === 'prepare' && event.status === 'success'
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Payee-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message - recipient: PayerFSP
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "POST",
                    "endpoint": "http://Payee-Participant/transfers/{{transferId}}",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
        else event.type === 'notification' && event.action === 'prepare.*|position-prepare' && event.status === 'error'
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Payer-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "PUT",
                    "endpoint": "http://Payer-Participant/transfers/{{transferId}}/error",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
        else event.type === 'notification' && event.action === 'prepare-duplicate' && event.status === 'success'
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Payer-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "PUT",
                    "endpoint": "http://Payer-Participant/transfers/{{transferId}}/error",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
       else event.type === 'notification' && event.action === 'commit|reserve' && event.status === 'success'
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Payer-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "PUT",
                    "endpoint": "http://Payer-Participant/transfers/{{transferId}}",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
            
            alt (Config.SEND_TRANSFER_CONFIRMATION_TO_PAYEE === true || event.action === 'reserve') && to!=from
                CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Payee-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
                activate CSAPI
                deactivate CSAPI

                NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
                note right of NOTIFY_HANDLER_EVT #yellow
                    "transport": {
                        "type": "HTTP",
                        "method": "PUT",
                        "endpoint": "http://Payee-Participant/transfers/{{transferId}}",
                        "params": {
                            "transferId": "{transferId}"
                        }
                    }
                end note
            end
        else event.type === 'notification' && event.action === 'reject|abort' && event.status === 'success'
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Payee-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "PUT",
                    "endpoint": "http://Payee-Participant/transfers/{{transferId}}/error",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
        else event.type === 'notification' && event.action === 'commit|reserve' && event.status === 'error'
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Payee-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "PUT",
                    "endpoint": "http://Payee-Participant/transfers/{{transferId}}/error",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
        else event.type === 'notification' && event.action === 'timeout-received' && event.status === 'error'
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Payee-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "PUT",
                    "endpoint": "http://Payee-Participant/transfers/{{transferId}}/error",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
        else event.type === 'notification' && event.action === 'timeout-reserved' && event.status === 'success'
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Payer-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "PUT",
                    "endpoint": "http://Payer-Participant/transfers/{{transferId}}/error",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
            
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Payee-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "PUT",
                    "endpoint": "http://Payee-Participant/transfers/{{transferId}}/error",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
        else event.type === 'notification' && event.action === 'get' && event.status === 'success'
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Requesting-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "PUT",
                    "endpoint": "http://Requesting-Participant/transfers/{{transferId}}",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
        else event.type === 'notification' && event.action === 'get' && event.status === 'error'
            CSAPI <-> NOTIFY_HANDLER_EVT: Return Endpoint details for Requesting-Participant\n<color #FF0000><b>Error codes:</b> 3202, 3203</color>
            activate CSAPI
            deactivate CSAPI

            NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with enriched message & endpoint data
            note right of NOTIFY_HANDLER_EVT #yellow
                "transport": {
                    "type": "HTTP",
                    "method": "PUT",
                    "endpoint": "http://Requesting-Participant/transfers/{{transferId}}/error",
                    "params": {
                        "transferId": "{transferId}"
                    }
                }
            end note
        end
    end
    

    NOTIFY_HANDLER_EVT -> NOTIFY_HANDLER_EVT: Construct NotifyCmd Command Message with notficiation-payload & transport-data
    group For-each NotifyCmd Command Messages
        NOTIFY_HANDLER_EVT -> TOPIC_NOTIFICATIONS_CMD: Publish NotifyCmd Command Message
        activate TOPIC_NOTIFICATIONS_CMD
    end
    

    NOTIFY_HANDLER_EVT -> TOPIC_NOTIFICATIONS: Commit Notification event
    activate TOPIC_NOTIFICATIONS
    deactivate TOPIC_NOTIFICATIONS
    deactivate NOTIFY_HANDLER_EVT
    
    
    TOPIC_NOTIFICATIONS_CMD <- NOTIFY_HANDLER_CMD: Consume NotifyCmd Command Message
    activate NOTIFY_HANDLER_CMD
    deactivate TOPIC_NOTIFICATIONS_CMD

    NOTIFY_HANDLER_CMD -> NOTIFY_HANDLER_CMD: Construct Transport Message

    group Retry Transport Mechanism based on transport options
        note right of NOTIFY_HANDLER_CMD #yellow
            "transport": {
                "options": {
                    "delivery-report": true,
                    "retry": {
                    "count": 3,
                    "type": "noDelay|exponentialDelay",
                    "condition": "isNetworkError|isSafeRequestError|isIdempotentRequestError|isNetworkOrIdempotentRequestError"
                    }
                }
            }
        end note
        NOTIFY_HANDLER_CMD -> PARTICIPANT: Notification with Prepare/fulfil result/error to \nPayer DFSP to specified Endpoint - PUT \n<color #FF0000><b>Error code:</b> 1001</color>
        NOTIFY_HANDLER_CMD <- - PARTICIPANT: HTTP 200 OK 
    end

    NOTIFY_HANDLER_CMD -> NOTIFY_HANDLER_CMD: Prepare Delivery Report

    alt transport.options.deliver-report === true
        NOTIFY_HANDLER_CMD -> TOPIC_NOTIFICATIONS_EVT: Publish NotifyDeliveryReport event
        activate TOPIC_NOTIFICATIONS_EVT

        TOPIC_NOTIFICATIONS_EVT <- NOTIFY_HANDLER_EVT: Consume NotifyDeliveryReport event
        deactivate TOPIC_NOTIFICATIONS_EVT
        activate NOTIFY_HANDLER_EVT

        NOTIFY_HANDLER_EVT -> DB: Record NotifyDeliveryReport event
        

        NOTIFY_HANDLER_EVT -> TOPIC_NOTIFICATIONS_EVT: Commit NotifyDeliveryReport event
        deactivate NOTIFY_HANDLER_EVT
        activate TOPIC_NOTIFICATIONS_EVT
        deactivate TOPIC_NOTIFICATIONS_EVT
    end

    NOTIFY_HANDLER_CMD -> TOPIC_NOTIFICATIONS_CMD: Commit NotifyCmd event
    activate TOPIC_NOTIFICATIONS_CMD
    deactivate TOPIC_NOTIFICATIONS_CMD
    deactivate NOTIFY_HANDLER_CMD

end
@enduml

PlantUML version 1.2020.22(Sun Dec 06 11:36:27 SAST 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>