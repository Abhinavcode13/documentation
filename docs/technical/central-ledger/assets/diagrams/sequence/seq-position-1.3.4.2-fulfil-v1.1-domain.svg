<?xml version="1.0" encoding="us-ascii" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1227px" preserveAspectRatio="none" style="width:741px;height:1227px;background:#FFFFFF;" version="1.1" viewBox="0 0 741 1227" width="741px" zoomAndPan="magnify">
  <defs/>
  <g>
    <text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="272" x="236" y="27.9951">1.3.4.2. Position Fulfil Domain v1.1</text>
    <rect fill="#FFFFFF" height="1067.6406" style="stroke:#181818;stroke-width:1.0;" width="10" x="101" y="100.5938"/>
    <rect fill="none" height="1020.5078" style="stroke:#000000;stroke-width:1.5;" width="725" x="10" y="140.7266"/>
    <rect fill="none" height="796.3125" style="stroke:#000000;stroke-width:1.5;" width="705" x="20" y="206.9922"/>
    <line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="106" x2="106" y1="90.5938" y2="1178.2344"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="30" y="87.292">Position Fulfil Domain</text>
    <ellipse cx="106" cy="58.2969" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <polygon fill="#181818" points="102,46.2969,108,41.2969,106,46.2969,108,51.2969,102,46.2969" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="30" y="1190.2295">Position Fulfil Domain</text>
    <ellipse cx="106" cy="1209.5313" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <polygon fill="#181818" points="102,1197.5313,108,1192.5313,106,1197.5313,108,1202.5313,102,1197.5313" style="stroke:#181818;stroke-width:1.0;"/>
    <rect fill="#FFFFFF" height="1067.6406" style="stroke:#181818;stroke-width:1.0;" width="10" x="101" y="100.5938"/>
    <rect fill="#ADD8E6" height="23" style="stroke:#181818;stroke-width:0.5;" width="363" x="116" y="105.5938"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="355" x="120" y="121.6606">INPUT: bin, accumulatedPosition, transferStateChanges</text>
    <path d="M10,140.7266 L288,140.7266 L288,147.8594 L278,157.8594 L10,157.8594 L10,140.7266 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/>
    <rect fill="none" height="1020.5078" style="stroke:#000000;stroke-width:1.5;" width="725" x="10" y="140.7266"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="233" x="25" y="153.7935">Fulfil Position Batch Processing</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="111" x2="153" y1="178.9922" y2="178.9922"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="153" x2="153" y1="178.9922" y2="191.9922"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="112" x2="153" y1="191.9922" y2="191.9922"/>
    <polygon fill="#181818" points="122,187.9922,112,191.9922,122,195.9922,118,191.9922" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="118" y="173.9263">1</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="115" x="131" y="173.9263">runningPosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="250" y="173.9263">= accumulatedPosition</text>
    <path d="M20,206.9922 L97,206.9922 L97,214.125 L87,224.125 L20,224.125 L20,206.9922 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/>
    <rect fill="none" height="796.3125" style="stroke:#000000;stroke-width:1.5;" width="705" x="20" y="206.9922"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="35" y="220.0591">loop</text>
    <text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="189" x="112" y="219.2026">[for each message in the bin]</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="111" x2="153" y1="275.5234" y2="275.5234"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="153" x2="153" y1="275.5234" y2="288.5234"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="112" x2="153" y1="288.5234" y2="288.5234"/>
    <polygon fill="#181818" points="122,284.5234,112,288.5234,122,292.5234,118,288.5234" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="118" y="255.3247">2</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="371" x="131" y="240.1919">Validate current state (transferState is &apos;RECEIVED-FULFIL&apos;)</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="82" x="131" y="255.3247">Error code:</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="32" x="217" y="255.3247">2001</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="253" y="255.3247">against failing transfers</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="131" y="270.4575">Batch is not rejected as a whole</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="111" x2="153" y1="317.6563" y2="317.6563"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="153" x2="153" y1="317.6563" y2="330.6563"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="112" x2="153" y1="330.6563" y2="330.6563"/>
    <polygon fill="#181818" points="122,326.6563,112,330.6563,122,334.6563,118,330.6563" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="118" y="312.5903">3</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="115" x="131" y="312.5903">runningPosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="284" x="250" y="312.5903">= runningPosition - payload.amount.amount</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="111" x2="153" y1="359.7891" y2="359.7891"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="153" x2="153" y1="359.7891" y2="372.7891"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="112" x2="153" y1="372.7891" y2="372.7891"/>
    <polygon fill="#181818" points="122,368.7891,112,372.7891,122,376.7891,118,372.7891" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="118" y="354.7231">4</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="341" x="131" y="354.7231">transferStateChange should be populated and add to</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="162" x="476" y="354.7231">transferStateChanges</text>
    <polygon fill="#FFFFE0" points="126,385.7891,348,385.7891,358,411.7891,348,438.7891,126,438.7891,116,411.7891,126,385.7891" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="128" y="401.856">transferStateChange</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="282" y="401.856">: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="128" y="416.9888">    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="112" x="144" y="416.9888">transferStateId</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="256" y="416.9888">: &apos;COMMITTED&apos;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="128" y="432.1216">}</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="111" x2="153" y1="465.3203" y2="465.3203"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="153" x2="153" y1="465.3203" y2="478.3203"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="112" x2="153" y1="478.3203" y2="478.3203"/>
    <polygon fill="#181818" points="122,474.3203,112,478.3203,122,482.3203,118,478.3203" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="118" y="460.2544">5</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="374" x="131" y="460.2544">participantPositionChange should be populated and add to</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="204" x="509" y="460.2544">participantPositionChanges</text>
    <polygon fill="#FFFFE0" points="126,491.3203,693,491.3203,703,540.3203,693,589.3203,126,589.3203,116,540.3203,126,491.3203" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="196" x="128" y="507.3872">participantPositionChange</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="324" y="507.3872">: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="520" x="144" y="522.52">transferStateChangeId: We need this, may be need to update in the handler (???)</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="144" y="537.6528">value = runningPosition,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="360" x="144" y="552.7856">reservedValue = participantPosition.reservedValue (???)</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="547" x="144" y="567.9185">createdDate = new Date() (Get time here or while executing the query in handler ???)</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="128" y="583.0513">}</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="111" x2="153" y1="616.25" y2="616.25"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="153" x2="153" y1="616.25" y2="629.25"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="112" x2="153" y1="629.25" y2="629.25"/>
    <polygon fill="#181818" points="122,625.25,112,629.25,122,633.25,118,629.25" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="118" y="611.1841">6</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="300" x="131" y="611.1841">resultMessage should be populated and add to</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="116" x="435" y="611.1841">resultMessages</text>
    <rect fill="#FFFF00" height="356" style="stroke:#181818;stroke-width:0.5;" width="257" x="116" y="642.25"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="108" x="120" y="658.3169">resultMessage</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="228" y="658.3169">:</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="120" y="673.4497">{</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="136" y="688.5825">id: &lt;transferMessage.transferId&gt;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="136" y="703.7153">from: &lt;transferMessage.payerFsp&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="136" y="718.8481">to: &lt;transferMessage.payeeFsp&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="136" y="733.981">type: application/json</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="136" y="749.1138">content: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="152" y="764.2466">headers: &lt;transferHeaders&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="152" y="779.3794">payload: &lt;transferMessage&gt;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="136" y="794.5122">},</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="136" y="809.645">metadata: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="152" y="824.7778">event: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="168" y="839.9106">id: &lt;uuid&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="168" y="855.0435">responseTo: &lt;previous.uuid&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="168" y="870.1763">type: transfer,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="168" y="885.3091">action: commit || reserve,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="168" y="900.4419">createdAt: &lt;timestamp&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="168" y="915.5747">state: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="184" y="930.7075">status: &quot;success&quot;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="184" y="945.8403">code: 0</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="168" y="960.9731">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="152" y="976.106">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="136" y="991.2388">}</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="111" x2="153" y1="1031.4375" y2="1031.4375"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="153" x2="153" y1="1031.4375" y2="1044.4375"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="112" x2="153" y1="1044.4375" y2="1044.4375"/>
    <polygon fill="#181818" points="122,1040.4375,112,1044.4375,122,1048.4375,118,1044.4375" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="118" y="1026.3716">7</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="131" y="1026.3716">Return the following</text>
    <rect fill="#ADD8E6" height="98" style="stroke:#181818;stroke-width:0.5;" width="473" x="116" y="1057.4375"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="120" y="1073.5044">{</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="120" y="1088.6372">    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="136" y="1088.6372">accumulatedPosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="290" y="1088.6372">: runningPosition,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="120" y="1103.77">    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="162" x="136" y="1103.77">transferStateChanges</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="298" y="1103.77">,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="120" y="1118.9028">    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="204" x="136" y="1118.9028">participantPositionChanges</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="340" y="1118.9028">,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="120" y="1134.0356">    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="116" x="136" y="1134.0356">resultMessages</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="333" x="252" y="1134.0356">, (The list of messages to be sent to the kafka topic)</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="120" y="1149.1685">}</text>
  </g>
</svg>
