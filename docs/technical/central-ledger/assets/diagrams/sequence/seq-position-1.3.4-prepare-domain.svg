<?xml version="1.0" encoding="us-ascii" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2338px" preserveAspectRatio="none" style="width:1024px;height:2338px;background:#FFFFFF;" version="1.1" viewBox="0 0 1024 2338" width="1024px" zoomAndPan="magnify">
  <defs/>
  <g>
    <text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="244" x="391.5" y="27.9951">1.3.1. Position Prepare Domain</text>
    <rect fill="#FFFFFF" height="2047.4141" style="stroke:#181818;stroke-width:1.0;" width="10" x="113" y="100.5938"/>
    <rect fill="none" height="2040.2813" style="stroke:#000000;stroke-width:1.5;" width="1008" x="10" y="231.5234"/>
    <rect fill="none" height="1621.0234" style="stroke:#000000;stroke-width:1.5;" width="988" x="20" y="492.8516"/>
    <rect fill="none" height="1011.9688" style="stroke:#000000;stroke-width:1.5;" width="713" x="118" y="688.7813"/>
    <line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="118" x2="118" y1="90.5938" y2="2288.8047"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="170" x="30" y="87.292">Position Prepare Domain</text>
    <ellipse cx="118" cy="58.2969" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <polygon fill="#181818" points="114,46.2969,120,41.2969,118,46.2969,120,51.2969,114,46.2969" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="170" x="30" y="2300.7998">Position Prepare Domain</text>
    <ellipse cx="118" cy="2320.1016" fill="#E2E2F0" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/>
    <polygon fill="#181818" points="114,2308.1016,120,2303.1016,118,2308.1016,120,2313.1016,114,2308.1016" style="stroke:#181818;stroke-width:1.0;"/>
    <rect fill="#FFFFFF" height="2047.4141" style="stroke:#181818;stroke-width:1.0;" width="10" x="113" y="100.5938"/>
    <rect fill="#ADD8E6" height="113" style="stroke:#181818;stroke-width:0.5;" width="256" x="128" y="105.5938"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="42" x="132" y="121.6606">INPUT:</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="148" y="136.7935">messages,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="148" y="151.9263">accumulatedPositionValue,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="148" y="167.0591">accumulatedPositionReservedValue,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="148" y="182.1919">settlementPositionValue,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139" x="148" y="197.3247">participantLimitValue,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="148" y="212.4575">accumulatedTransferStateChanges</text>
    <path d="M10,231.5234 L311,231.5234 L311,238.6563 L301,248.6563 L10,248.6563 L10,231.5234 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/>
    <rect fill="none" height="2040.2813" style="stroke:#000000;stroke-width:1.5;" width="1008" x="10" y="231.5234"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="256" x="25" y="244.5903">Prepare Position Batch Processing</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="123" x2="165" y1="269.7891" y2="269.7891"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="165" x2="165" y1="269.7891" y2="282.7891"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="124" x2="165" y1="282.7891" y2="282.7891"/>
    <polygon fill="#181818" points="134,278.7891,124,282.7891,134,286.7891,130,282.7891" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="130" y="264.7231">1</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="124" x="143" y="264.7231">effectivePosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="395" x="271" y="264.7231">= accumulatedPosition + accumulatedPositionReservedValue</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="123" x2="165" y1="311.9219" y2="311.9219"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="165" x2="165" y1="311.9219" y2="324.9219"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="124" x2="165" y1="324.9219" y2="324.9219"/>
    <polygon fill="#181818" points="134,320.9219,124,324.9219,134,328.9219,130,324.9219" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="130" y="306.856">2</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="125" x="143" y="306.856">availablePosition</text>
    <path d="M128,337.9219 L128,437.9219 L592,437.9219 L592,347.9219 L582,337.9219 L128,337.9219 " fill="#D3D3D3" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M582,337.9219 L582,347.9219 L592,347.9219 L582,337.9219 " fill="#D3D3D3" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="125" x="134" y="354.9888">availablePosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251" x="134" y="370.1216">if settlement model delay is IMMEDIATE</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="33" x="134" y="385.2544">then:</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="427" x="150" y="400.3872">settlementPositionValue + participantLimitValue - effectivePosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="134" y="415.52">otherwise:</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252" x="150" y="430.6528">participantLimitValue - effectivePosition</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="123" x2="165" y1="464.8516" y2="464.8516"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="165" x2="165" y1="464.8516" y2="477.8516"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="124" x2="165" y1="477.8516" y2="477.8516"/>
    <polygon fill="#181818" points="134,473.8516,124,477.8516,134,481.8516,130,477.8516" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="130" y="459.7856">3</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="146" x="143" y="459.7856">processedTransfers</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="682" x="293" y="459.7856">= {} (The list of processed transfers - so that we can store the additional information around the decision.)</text>
    <path d="M20,492.8516 L97,492.8516 L97,499.9844 L87,509.9844 L20,509.9844 L20,492.8516 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/>
    <rect fill="none" height="1621.0234" style="stroke:#000000;stroke-width:1.5;" width="988" x="20" y="492.8516"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="35" y="505.9185">loop</text>
    <text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="189" x="112" y="505.062">[for each message in the bin]</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="123" x2="165" y1="561.3828" y2="561.3828"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="165" x2="165" y1="561.3828" y2="574.3828"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="124" x2="165" y1="574.3828" y2="574.3828"/>
    <polygon fill="#181818" points="134,570.3828,124,574.3828,134,578.3828,130,574.3828" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="130" y="541.1841">4</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="550" x="143" y="526.0513">Validate current state (transferStateChange.transferStateId == &apos;RECEIVED_PREPARE&apos;)</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="82" x="143" y="541.1841">Error code:</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="32" x="229" y="541.1841">2001</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="265" y="541.1841">against failing transfers</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="143" y="556.3169">Batch is not rejected as a whole.</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="123" x2="165" y1="603.5156" y2="603.5156"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="165" x2="165" y1="603.5156" y2="616.5156"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="124" x2="165" y1="616.5156" y2="616.5156"/>
    <polygon fill="#181818" points="134,612.5156,124,616.5156,134,620.5156,130,616.5156" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="130" y="598.4497">5</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="341" x="143" y="598.4497">transferStateChange should be populated and add to</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="162" x="488" y="598.4497">transferStateChanges</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="346" x="650" y="598.4497">, build list of transferStateChanges from transferBatch</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="123" x2="165" y1="660.7813" y2="660.7813"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="165" x2="165" y1="660.7813" y2="673.7813"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="124" x2="165" y1="673.7813" y2="673.7813"/>
    <polygon fill="#181818" points="134,669.7813,124,673.7813,134,677.7813,130,673.7813" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="130" y="648.1489">6</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="414" x="143" y="640.5825">Validate availablePosition for each tranfser (see algorithm below)</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="82" x="143" y="655.7153">Error code:</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="32" x="229" y="655.7153">4001</text>
    <path d="M118,688.7813 L182,688.7813 L182,695.9141 L172,705.9141 L118,705.9141 L118,688.7813 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/>
    <rect fill="none" height="1011.9688" style="stroke:#000000;stroke-width:1.5;" width="713" x="118" y="688.7813"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="133" y="701.8481">alt</text>
    <text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="315" x="197" y="700.9917">[if availablePosition &gt;= payload.amount.amount]</text>
    <path d="M128,710.9141 L128,750.9141 L557,750.9141 L557,720.9141 L547,710.9141 L128,710.9141 " fill="#D3D3D3" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M547,710.9141 L547,720.9141 L557,720.9141 L547,710.9141 " fill="#D3D3D3" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="134" y="727.981">transferStateId =</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="91" x="249" y="727.981">&quot;RESERVED&quot;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="408" x="134" y="743.1138">availablePosition = availablePosition - preparedTransfer.amount</text>
    <path d="M128,761.1797 L128,1134.1797 L398,1134.1797 L398,771.1797 L388,761.1797 L128,761.1797 " fill="#FFFF00" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M388,761.1797 L388,771.1797 L398,771.1797 L388,761.1797 " fill="#FFFF00" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="134" y="778.2466">resultMessage:</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="134" y="793.3794">{</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="150" y="808.5122">id: &lt;transferMessage.transferId&gt;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="150" y="823.645">from: &lt;transferMessage.payerFsp&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="150" y="838.7778">to: &lt;transferMessage.payeeFsp&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="150" y="853.9106">type: application/json</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="150" y="869.0435">content: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="166" y="884.1763">headers: &lt;transferHeaders&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="166" y="899.3091">payload: &lt;transferMessage&gt;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="150" y="914.4419">},</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="150" y="929.5747">metadata: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="166" y="944.7075">event: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="182" y="959.8403">id: &lt;uuid&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="182" y="974.9731">responseTo: &lt;previous.uuid&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="182" y="990.106">type: transfer,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="182" y="1005.2388">action: prepare,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="182" y="1020.3716">createdAt: &lt;timestamp&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="182" y="1035.5044">state: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="198" y="1050.6372">status: &quot;success&quot;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="198" y="1065.77">code: 0</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="182" y="1080.9028">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="166" y="1096.0356">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="150" y="1111.1685">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="134" y="1126.3013">}</text>
    <line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="118" x2="831" y1="1140.3672" y2="1140.3672"/>
    <path d="M128,1146.3672 L128,1171.3672 L260,1171.3672 L260,1156.3672 L250,1146.3672 L128,1146.3672 " fill="#FF0000" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M250,1146.3672 L250,1156.3672 L260,1156.3672 L250,1146.3672 " fill="#FF0000" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="134" y="1163.4341">Validation failure!</text>
    <path d="M128,1181.5 L128,1221.5 L821,1221.5 L821,1191.5 L811,1181.5 L128,1181.5 " fill="#D3D3D3" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M811,1181.5 L811,1191.5 L821,1191.5 L811,1181.5 " fill="#D3D3D3" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="134" y="1198.5669">transferStateId =</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="83" x="249" y="1198.5669">&quot;ABORTED&quot;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="470" x="336" y="1198.5669">(This should only be done if not already in a final state (idempotency) ???)</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="548" x="134" y="1213.6997">reason = &quot;Net Debit Cap exceeded by this request at this time, please try again later&quot;</text>
    <path d="M128,1231.7656 L128,1694.7656 L536,1694.7656 L536,1241.7656 L526,1231.7656 L128,1231.7656 " fill="#FFFF00" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M526,1231.7656 L526,1241.7656 L536,1241.7656 L526,1231.7656 " fill="#FFFF00" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="134" y="1248.8325">resultMessage:</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="134" y="1263.9653">{</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="150" y="1279.0981">id: &lt;transferMessage.transferId&gt;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="150" y="1294.231">from: &lt;ledgerName&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216" x="150" y="1309.3638">to: &lt;transferMessage.payerFsp&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="150" y="1324.4966">type: application/json</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="150" y="1339.6294">content: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190" x="166" y="1354.7622">headers: &lt;transferHeaders&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="166" y="1369.895">payload: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="182" y="1385.0278">&quot;errorInformation&quot;: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="198" y="1400.1606">&quot;errorCode&quot;: 4001,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="323" x="198" y="1415.2935">&quot;errorDescription&quot;: &quot;Payer FSP insufficient liquidity&quot;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="319" x="198" y="1430.4263">&quot;extensionList&quot;: &lt;transferMessage.extensionList&gt;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="166" y="1445.5591">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="150" y="1460.6919">},</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="150" y="1475.8247">metadata: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="166" y="1490.9575">event: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="182" y="1506.0903">id: &lt;uuid&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="182" y="1521.2231">responseTo: &lt;previous.uuid&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="182" y="1536.356">type: notification,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="182" y="1551.4888">action: prepare,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="182" y="1566.6216">createdAt: &lt;timestamp&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="182" y="1581.7544">state: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="198" y="1596.8872">status: &apos;error&apos;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="198" y="1612.02">code: &lt;errorInformation.errorCode&gt;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="311" x="198" y="1627.1528">description: &lt;errorInformation.errorDescription&gt;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="182" y="1642.2856">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="166" y="1657.4185">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="150" y="1672.5513">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="134" y="1687.6841">}</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="123" x2="165" y1="1728.8828" y2="1728.8828"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="165" x2="165" y1="1728.8828" y2="1741.8828"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="124" x2="165" y1="1741.8828" y2="1741.8828"/>
    <polygon fill="#181818" points="134,1737.8828,124,1741.8828,134,1745.8828,130,1741.8828" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="130" y="1723.8169">7</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="143" y="1723.8169">resultMessage should be added to</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="116" x="367" y="1723.8169">resultMessages</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="123" x2="165" y1="1771.0156" y2="1771.0156"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="165" x2="165" y1="1771.0156" y2="1784.0156"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="124" x2="165" y1="1784.0156" y2="1784.0156"/>
    <polygon fill="#181818" points="134,1780.0156,124,1784.0156,134,1788.0156,130,1784.0156" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="130" y="1765.9497">8</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="341" x="143" y="1765.9497">transferStateChange should be populated and add to</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="162" x="488" y="1765.9497">transferStateChanges</text>
    <polygon fill="#FFFFE0" points="138,1797.0156,312,1797.0156,322,1831.0156,312,1865.0156,138,1865.0156,128,1831.0156,138,1797.0156" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="140" y="1813.0825">transferStateChange</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="294" y="1813.0825">: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="140" y="1828.2153">    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="112" x="156" y="1828.2153">transferStateId</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="268" y="1828.2153">,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44" x="156" y="1843.3481">reason</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="140" y="1858.481">}</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="123" x2="165" y1="1891.6797" y2="1891.6797"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="165" x2="165" y1="1891.6797" y2="1904.6797"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="124" x2="165" y1="1904.6797" y2="1904.6797"/>
    <polygon fill="#181818" points="134,1900.6797,124,1904.6797,134,1908.6797,130,1904.6797" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="130" y="1886.6138">9</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="374" x="143" y="1886.6138">participantPositionChange should be populated and add to</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="204" x="521" y="1886.6138">participantPositionChanges</text>
    <polygon fill="#FFFFE0" points="138,1917.6797,705,1917.6797,715,1966.6797,705,2015.6797,138,2015.6797,128,1966.6797,138,1917.6797" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="196" x="140" y="1933.7466">participantPositionChange</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="336" y="1933.7466">: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="520" x="156" y="1948.8794">transferStateChangeId: We need this, may be need to update in the handler (???)</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="156" y="1964.0122">value = availablePosition,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="339" x="156" y="1979.145">reservedValue = accumulatedPositionReservedValue</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="547" x="156" y="1994.2778">createdDate = new Date() (Get time here or while executing the query in handler ???)</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="140" y="2009.4106">}</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="123" x2="165" y1="2057.7422" y2="2057.7422"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="165" x2="165" y1="2057.7422" y2="2070.7422"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="124" x2="165" y1="2070.7422" y2="2070.7422"/>
    <polygon fill="#181818" points="134,2066.7422,124,2070.7422,134,2074.7422,130,2070.7422" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="130" y="2045.1099">10</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="273" x="152" y="2037.5435">Assess any limit thresholds on the position</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="231" x="152" y="2052.6763">adding to alarm list if triggered (???)</text>
    <path d="M128,2083.7422 L128,2108.7422 L793,2108.7422 L793,2093.7422 L783,2083.7422 L128,2083.7422 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/>
    <path d="M783,2083.7422 L783,2093.7422 L793,2093.7422 L783,2083.7422 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="644" x="134" y="2100.8091">If there are any alarm limits, process those returning limits in which the threshold has been breached</text>
    <line style="stroke:#181818;stroke-width:1.0;" x1="123" x2="165" y1="2147.0078" y2="2147.0078"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="165" x2="165" y1="2147.0078" y2="2160.0078"/>
    <line style="stroke:#181818;stroke-width:1.0;" x1="118" x2="165" y1="2160.0078" y2="2160.0078"/>
    <polygon fill="#181818" points="128,2156.0078,118,2160.0078,128,2164.0078,124,2160.0078" style="stroke:#181818;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="130" y="2141.9419">11</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="152" y="2141.9419">Return the following</text>
    <rect fill="#ADD8E6" height="98" style="stroke:#181818;stroke-width:0.5;" width="473" x="123" y="2168.0078"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="127" y="2184.0747">{</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="127" y="2199.2075">    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="143" y="2199.2075">accumulatedPosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="297" y="2199.2075">: availablePosition,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="127" y="2214.3403">    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="162" x="143" y="2214.3403">transferStateChanges</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="305" y="2214.3403">,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="127" y="2229.4731">    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="204" x="143" y="2229.4731">participantPositionChanges</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="347" y="2229.4731">,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="127" y="2244.606">    </text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="116" x="143" y="2244.606">resultMessages</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="333" x="259" y="2244.606">, (The list of messages to be sent to the kafka topic)</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="127" y="2259.7388">}</text>
  </g>
</svg>
