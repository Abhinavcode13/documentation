<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1263px" preserveAspectRatio="none" style="width:839px;height:1263px;" version="1.1" viewBox="0 0 839 1263" width="839px" zoomAndPan="magnify">
  <defs>
    <filter height="300%" id="fdnbfvw30784y" width="300%" x="-1" y="-1">
      <feGaussianBlur result="blurOut" stdDeviation="2.0"/>
      <feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/>
      <feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/>
      <feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/>
    </filter>
  </defs>
  <g>
    <text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="370" x="232.75" y="28.708">1.3.3. Position Timeout Reserved Domain</text>
    <rect fill="#FFFFFF" filter="url(#fdnbfvw30784y)" height="1098.3047" style="stroke:#A80036;stroke-width:1.0;" width="10" x="149.5" y="98.25"/>
    <rect fill="#FFFFFF" filter="url(#fdnbfvw30784y)" height="1051.1719" style="stroke:#000000;stroke-width:2.0;" width="815.5" x="10" y="138.3828"/>
    <rect fill="#FFFFFF" filter="url(#fdnbfvw30784y)" height="372.9922" style="stroke:#000000;stroke-width:2.0;" width="795.5" x="20" y="204.6484"/>
    <line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="154" x2="154" y1="88.25" y2="1206.5547"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="243" x="30" y="84.9482">Position Timeout Reserved Domain</text>
    <ellipse cx="154.5" cy="55.9531" fill="#FEFECE" filter="url(#fdnbfvw30784y)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/>
    <polygon fill="#A80036" points="150.5,43.9531,156.5,38.9531,154.5,43.9531,156.5,48.9531,150.5,43.9531" style="stroke:#A80036;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="243" x="30" y="1218.5498">Position Timeout Reserved Domain</text>
    <ellipse cx="154.5" cy="1237.8516" fill="#FEFECE" filter="url(#fdnbfvw30784y)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/>
    <polygon fill="#A80036" points="150.5,1225.8516,156.5,1220.8516,154.5,1225.8516,156.5,1230.8516,150.5,1225.8516" style="stroke:#A80036;stroke-width:1.0;"/>
    <rect fill="#FFFFFF" filter="url(#fdnbfvw30784y)" height="1098.3047" style="stroke:#A80036;stroke-width:1.0;" width="10" x="149.5" y="98.25"/>
    <rect fill="#ADD8E6" filter="url(#fdnbfvw30784y)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="363" x="164" y="103.25"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="355" x="168" y="119.3169">INPUT: bin, accumulatedPosition, transferStateChanges</text>
    <path d="M10,138.3828 L385,138.3828 L385,145.3828 L375,155.3828 L10,155.3828 L10,138.3828 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/>
    <rect fill="none" height="1051.1719" style="stroke:#000000;stroke-width:2.0;" width="815.5" x="10" y="138.3828"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="330" x="25" y="151.4497">Timeout Reserved Position Batch Processing</text>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="159.5" x2="201.5" y1="176.6484" y2="176.6484"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="201.5" x2="201.5" y1="176.6484" y2="189.6484"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="160.5" x2="201.5" y1="189.6484" y2="189.6484"/>
    <polygon fill="#A80036" points="170.5,185.6484,160.5,189.6484,170.5,193.6484,166.5,189.6484" style="stroke:#A80036;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="166.5" y="171.5825">1</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="179.5" y="171.5825">runningPosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="298.5" y="171.5825">= accumulatedPosition</text>
    <path d="M20,204.6484 L97,204.6484 L97,211.6484 L87,221.6484 L20,221.6484 L20,204.6484 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/>
    <rect fill="none" height="372.9922" style="stroke:#000000;stroke-width:2.0;" width="795.5" x="20" y="204.6484"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="35" y="217.7153">loop</text>
    <text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="189" x="112" y="216.8589">[for each message in the bin]</text>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="159.5" x2="201.5" y1="258.0469" y2="258.0469"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="201.5" x2="201.5" y1="258.0469" y2="271.0469"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="160.5" x2="201.5" y1="271.0469" y2="271.0469"/>
    <polygon fill="#A80036" points="170.5,267.0469,160.5,271.0469,170.5,275.0469,166.5,271.0469" style="stroke:#A80036;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="166.5" y="245.4146">2</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="624" x="179.5" y="237.8481">Validate current state of transfer (transferStateChange.transferStateId == &apos;RESERVED_TIMEOUT&apos;)</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="179.5" y="252.981">Error code:</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="265.5" y="252.981">2001</text>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="159.5" x2="201.5" y1="300.1797" y2="300.1797"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="201.5" x2="201.5" y1="300.1797" y2="313.1797"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="160.5" x2="201.5" y1="313.1797" y2="313.1797"/>
    <polygon fill="#A80036" points="170.5,309.1797,160.5,313.1797,170.5,317.1797,166.5,313.1797" style="stroke:#A80036;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="166.5" y="295.1138">3</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="179.5" y="295.1138">runningPosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="284" x="298.5" y="295.1138">= runningPosition - payload.amount.amount</text>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="159.5" x2="201.5" y1="342.3125" y2="342.3125"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="201.5" x2="201.5" y1="342.3125" y2="355.3125"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="160.5" x2="201.5" y1="355.3125" y2="355.3125"/>
    <polygon fill="#A80036" points="170.5,351.3125,160.5,355.3125,170.5,359.3125,166.5,355.3125" style="stroke:#A80036;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="166.5" y="337.2466">4</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="341" x="179.5" y="337.2466">transferStateChange should be populated and add to</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="162" x="524.5" y="337.2466">transferStateChanges</text>
    <polygon fill="#FFFFE0" filter="url(#fdnbfvw30784y)" points="174,368.3125,448,368.3125,458,394.3125,448,421.3125,174,421.3125,164,394.3125,174,368.3125" style="stroke:#A80036;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="154" x="176" y="384.3794">transferStateChange</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="330" y="384.3794">: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="192" y="399.5122"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="112" x="192" y="399.5122">transferStateId</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="304" y="399.5122">: &apos;EXPIRED_RESERVED&apos;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="176" y="414.645">}</text>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="159.5" x2="201.5" y1="447.8438" y2="447.8438"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="201.5" x2="201.5" y1="447.8438" y2="460.8438"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="160.5" x2="201.5" y1="460.8438" y2="460.8438"/>
    <polygon fill="#A80036" points="170.5,456.8438,160.5,460.8438,170.5,464.8438,166.5,460.8438" style="stroke:#A80036;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="166.5" y="442.7778">5</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="374" x="179.5" y="442.7778">participantPositionChange should be populated and add to</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="204" x="557.5" y="442.7778">participantPositionChanges</text>
    <polygon fill="#FFFFE0" filter="url(#fdnbfvw30784y)" points="174,473.8438,741,473.8438,751,522.8438,741,571.8438,174,571.8438,164,522.8438,174,473.8438" style="stroke:#A80036;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="196" x="176" y="489.9106">participantPositionChange</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="372" y="489.9106">: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="520" x="192" y="505.0435">transferStateChangeId: We need this, may be need to update in the handler (???)</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="192" y="520.1763">value = runningPosition,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="360" x="192" y="535.3091">reservedValue = participantPosition.reservedValue (???)</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="547" x="192" y="550.4419">createdDate = new Date() (Get time here or while executing the query in handler ???)</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="176" y="565.5747">}</text>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="159.5" x2="201.5" y1="605.7734" y2="605.7734"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="201.5" x2="201.5" y1="605.7734" y2="618.7734"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="160.5" x2="201.5" y1="618.7734" y2="618.7734"/>
    <polygon fill="#A80036" points="170.5,614.7734,160.5,618.7734,170.5,622.7734,166.5,618.7734" style="stroke:#A80036;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="166.5" y="600.7075">6</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="179.5" y="600.7075">Return the following</text>
    <rect fill="#ADD8E6" filter="url(#fdnbfvw30784y)" height="552" style="stroke:#A80036;stroke-width:1.0;" width="423" x="164" y="631.7734"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="168" y="647.8403">{</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="184" y="662.9731"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="154" x="184" y="662.9731">accumulatedPosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="338" y="662.9731">: runningPosition,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="184" y="678.106"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="162" x="184" y="678.106">transferStateChanges</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="346" y="678.106">,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="184" y="693.2388"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="204" x="184" y="693.2388">participantPositionChanges</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="388" y="693.2388">,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="172" y="708.3716"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="184" y="723.5044">Message: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="200" y="738.6372">id: &lt;transferMessage.transferId&gt;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="200" y="753.77">from: &lt;transferMessage.payerFsp&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="200" y="768.9028">to: &lt;transferMessage.payeeFsp&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="200" y="784.0356">type: application/json</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="200" y="799.1685">content: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="216" y="814.3013">headers: &lt;transferHeaders&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="216" y="829.4341">payload: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="248" y="844.5669">&quot;errorInformation&quot;: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="264" y="859.6997">&quot;errorCode&quot;: 3300,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="264" y="874.8325">&quot;errorDescription&quot;: &quot;Transfer expired&quot;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="319" x="264" y="889.9653">&quot;extensionList&quot;: &lt;transferMessage.extensionList&gt;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="248" y="905.0981">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="216" y="920.231">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="200" y="935.3638">},</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="200" y="950.4966">metadata: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="216" y="965.6294">event: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="232" y="980.7622">id: &lt;uuid&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="232" y="995.895">responseTo: &lt;previous.uuid&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="232" y="1011.0278">type: notification,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="232" y="1026.1606">action: abort,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="232" y="1041.2935">createdAt: &lt;timestamp&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="232" y="1056.4263">state: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="248" y="1071.5591">status: &apos;error&apos;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="248" y="1086.6919">code: &lt;errorInformation.errorCode&gt;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="311" x="248" y="1101.8247">description: &lt;errorInformation.errorDescription&gt;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="232" y="1116.9575">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="216" y="1132.0903">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="200" y="1147.2231">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="184" y="1162.356">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="168" y="1177.4888">}</text>
  </g>
</svg>
