<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1173px" preserveAspectRatio="none" style="width:749px;height:1173px;" version="1.1" viewBox="0 0 749 1173" width="749px" zoomAndPan="magnify">
  <defs>
    <filter height="300%" id="f1w4o0egzvcmda" width="300%" x="-1" y="-1">
      <feGaussianBlur result="blurOut" stdDeviation="2.0"/>
      <feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/>
      <feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/>
      <feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/>
    </filter>
  </defs>
  <g>
    <text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="293" x="226" y="28.708">1.3.2. Position Fulfil Domain v1.1</text>
    <rect fill="#FFFFFF" filter="url(#f1w4o0egzvcmda)" height="1007.5078" style="stroke:#A80036;stroke-width:1.0;" width="10" x="101" y="98.25"/>
    <rect fill="#FFFFFF" filter="url(#f1w4o0egzvcmda)" height="960.375" style="stroke:#000000;stroke-width:2.0;" width="725" x="10" y="138.3828"/>
    <rect fill="#FFFFFF" filter="url(#f1w4o0egzvcmda)" height="388.125" style="stroke:#000000;stroke-width:2.0;" width="705" x="20" y="204.6484"/>
    <line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="106" x2="106" y1="88.25" y2="1115.7578"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="30" y="84.9482">Position Fulfil Domain</text>
    <ellipse cx="106" cy="55.9531" fill="#FEFECE" filter="url(#f1w4o0egzvcmda)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/>
    <polygon fill="#A80036" points="102,43.9531,108,38.9531,106,43.9531,108,48.9531,102,43.9531" style="stroke:#A80036;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="30" y="1127.7529">Position Fulfil Domain</text>
    <ellipse cx="106" cy="1147.0547" fill="#FEFECE" filter="url(#f1w4o0egzvcmda)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/>
    <polygon fill="#A80036" points="102,1135.0547,108,1130.0547,106,1135.0547,108,1140.0547,102,1135.0547" style="stroke:#A80036;stroke-width:1.0;"/>
    <rect fill="#FFFFFF" filter="url(#f1w4o0egzvcmda)" height="1007.5078" style="stroke:#A80036;stroke-width:1.0;" width="10" x="101" y="98.25"/>
    <rect fill="#ADD8E6" filter="url(#f1w4o0egzvcmda)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="363" x="116" y="103.25"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="355" x="120" y="119.3169">INPUT: bin, accumulatedPosition, transferStateChanges</text>
    <path d="M10,138.3828 L288,138.3828 L288,145.3828 L278,155.3828 L10,155.3828 L10,138.3828 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/>
    <rect fill="none" height="960.375" style="stroke:#000000;stroke-width:2.0;" width="725" x="10" y="138.3828"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="233" x="25" y="151.4497">Fulfil Position Batch Processing</text>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="111" x2="153" y1="176.6484" y2="176.6484"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="153" x2="153" y1="176.6484" y2="189.6484"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="112" x2="153" y1="189.6484" y2="189.6484"/>
    <polygon fill="#A80036" points="122,185.6484,112,189.6484,122,193.6484,118,189.6484" style="stroke:#A80036;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="118" y="171.5825">1</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="131" y="171.5825">runningPosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="250" y="171.5825">= accumulatedPosition</text>
    <path d="M20,204.6484 L97,204.6484 L97,211.6484 L87,221.6484 L20,221.6484 L20,204.6484 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/>
    <rect fill="none" height="388.125" style="stroke:#000000;stroke-width:2.0;" width="705" x="20" y="204.6484"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="35" y="217.7153">loop</text>
    <text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="189" x="112" y="216.8589">[for each message in the bin]</text>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="111" x2="153" y1="273.1797" y2="273.1797"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="153" x2="153" y1="273.1797" y2="286.1797"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="112" x2="153" y1="286.1797" y2="286.1797"/>
    <polygon fill="#A80036" points="122,282.1797,112,286.1797,122,290.1797,118,286.1797" style="stroke:#A80036;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="118" y="252.981">2</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="371" x="131" y="237.8481">Validate current state (transferState is &apos;RECEIVED-FULFIL&apos;)</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="131" y="252.981">Error code:</text>
    <text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="32" x="217" y="252.981">2001</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="253" y="252.981">against failing transfers</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="203" x="131" y="268.1138">Batch is not rejected as a whole</text>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="111" x2="153" y1="315.3125" y2="315.3125"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="153" x2="153" y1="315.3125" y2="328.3125"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="112" x2="153" y1="328.3125" y2="328.3125"/>
    <polygon fill="#A80036" points="122,324.3125,112,328.3125,122,332.3125,118,328.3125" style="stroke:#A80036;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="118" y="310.2466">3</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="115" x="131" y="310.2466">runningPosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="284" x="250" y="310.2466">= runningPosition - payload.amount.amount</text>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="111" x2="153" y1="357.4453" y2="357.4453"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="153" x2="153" y1="357.4453" y2="370.4453"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="112" x2="153" y1="370.4453" y2="370.4453"/>
    <polygon fill="#A80036" points="122,366.4453,112,370.4453,122,374.4453,118,370.4453" style="stroke:#A80036;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="118" y="352.3794">4</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="341" x="131" y="352.3794">transferStateChange should be populated and add to</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="162" x="476" y="352.3794">transferStateChanges</text>
    <polygon fill="#FFFFE0" filter="url(#f1w4o0egzvcmda)" points="126,383.4453,348,383.4453,358,409.4453,348,436.4453,126,436.4453,116,409.4453,126,383.4453" style="stroke:#A80036;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="154" x="128" y="399.5122">transferStateChange</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="282" y="399.5122">: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="144" y="414.645"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="112" x="144" y="414.645">transferStateId</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="256" y="414.645">: &apos;COMMITTED&apos;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="128" y="429.7778">}</text>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="111" x2="153" y1="462.9766" y2="462.9766"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="153" x2="153" y1="462.9766" y2="475.9766"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="112" x2="153" y1="475.9766" y2="475.9766"/>
    <polygon fill="#A80036" points="122,471.9766,112,475.9766,122,479.9766,118,475.9766" style="stroke:#A80036;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="118" y="457.9106">5</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="374" x="131" y="457.9106">participantPositionChange should be populated and add to</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="204" x="509" y="457.9106">participantPositionChanges</text>
    <polygon fill="#FFFFE0" filter="url(#f1w4o0egzvcmda)" points="126,488.9766,693,488.9766,703,537.9766,693,586.9766,126,586.9766,116,537.9766,126,488.9766" style="stroke:#A80036;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="196" x="128" y="505.0435">participantPositionChange</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="324" y="505.0435">: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="520" x="144" y="520.1763">transferStateChangeId: We need this, may be need to update in the handler (???)</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="144" y="535.3091">value = runningPosition,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="360" x="144" y="550.4419">reservedValue = participantPosition.reservedValue (???)</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="547" x="144" y="565.5747">createdDate = new Date() (Get time here or while executing the query in handler ???)</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="128" y="580.7075">}</text>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="111" x2="153" y1="620.9063" y2="620.9063"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="153" x2="153" y1="620.9063" y2="633.9063"/>
    <line style="stroke:#A80036;stroke-width:1.0;" x1="112" x2="153" y1="633.9063" y2="633.9063"/>
    <polygon fill="#A80036" points="122,629.9063,112,633.9063,122,637.9063,118,633.9063" style="stroke:#A80036;stroke-width:1.0;"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="118" y="615.8403">6</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="131" y="615.8403">Return the following</text>
    <rect fill="#ADD8E6" filter="url(#f1w4o0egzvcmda)" height="446" style="stroke:#A80036;stroke-width:1.0;" width="288" x="116" y="646.9063"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="120" y="662.9731">{</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="136" y="678.106"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="154" x="136" y="678.106">accumulatedPosition</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="290" y="678.106">: runningPosition,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="136" y="693.2388"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="162" x="136" y="693.2388">transferStateChanges</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="298" y="693.2388">,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="136" y="708.3716"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="204" x="136" y="708.3716">participantPositionChanges</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="340" y="708.3716">,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="124" y="723.5044"/>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="136" y="738.6372">Message:</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="136" y="753.77">{</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="152" y="768.9028">id: &lt;transferMessage.transferId&gt;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="152" y="784.0356">from: &lt;transferMessage.payerFsp&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="152" y="799.1685">to: &lt;transferMessage.payeeFsp&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="152" y="814.3013">type: application/json</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="152" y="829.4341">content: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="168" y="844.5669">headers: &lt;transferHeaders&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="168" y="859.6997">payload: &lt;transferMessage&gt;</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="152" y="874.8325">},</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="152" y="889.9653">metadata: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="168" y="905.0981">event: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="184" y="920.231">id: &lt;uuid&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="184" y="935.3638">responseTo: &lt;previous.uuid&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="184" y="950.4966">type: transfer,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="184" y="965.6294">action: commit || reserve,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="184" y="980.7622">createdAt: &lt;timestamp&gt;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="184" y="995.895">state: {</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="200" y="1011.0278">status: &quot;success&quot;,</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="200" y="1026.1606">code: 0</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="184" y="1041.2935">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="168" y="1056.4263">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="152" y="1071.5591">}</text>
    <text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="136" y="1086.6919">}</text>
  </g>
</svg>
